(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[16],{1039:function(D,F,b){b.d(F,"a",function(){return a});D=b(0);var a;(function(d){d[d.unknown=0]="unknown";d[d.supported=1]="supported";d[d.userUnsupported=2]="userUnsupported";d[d.browserUnsupported=3]="browserUnsupported";d[d.hostUnsupported=4]="hostUnsupported"})(a||(a={}));Object(D.b)("SupportStatus",a)},1379:function(D,F,b){function a(fa){var Y=T.call(this)||this;Y.$=fa;Y.fc();return Y}function d(fa){this.oAuthManager=
fa}function c(){}function m(fa){this.RQb=fa}function r(){}function t(){}b.r(F);D=b(0);var k=b(15),u=b(968),w=b(1039),v=b(5),A=b(93),y=b(839),x=b(274),z=b(49),J=b(24),B=b(88),C=b(176);t.prototype.$h=function(fa){fa.register(451,"Common.App.OAuth.IOAuthManager").Ac().Lc(function(){return new u.OAuthManager})};t.prototype.init=function(){var fa=B.a.instance.resolve("Common.App.OAuth.IOAuthManager");this.utj(fa)};t.prototype.utj=function(fa){var Y=v.AFrameworkApplication.ha.Wa("FileSource");if(v.AFrameworkApplication.ha.ta("IsO365ConsumerHost")||
v.AFrameworkApplication.ha.ta("IsO365CommercialHost")||"WopiTest"===Y){var L=y.a.Qph,P=y.a.authority;if(void 0!==L&&null!==L&&L.length&&void 0!==P&&null!==P&&P.length&&("https://login.microsoftonline.com/"!==P||v.AFrameworkApplication.ha.getBooleanFeatureGate("Microsoft.Office.SharedOnline.CorePFTEnabled",!1))){var ea=w.a[fa.LR],X=J.a.xXa,ja=fa.hE();v.AFrameworkApplication.ha.ta("IsAnonymousUser")&&k.ULS.sendTraceTag(559272964,3E3,50,'OAuthManager skipped attempt to get a Core token to the WAC FrontEnd API for an anonymous user. SupportStatus={0}, Host="{1}", Browser="{2}", Strategy="{3}"',
ea,Y,X,ja);try{var R=new Map;void 0!==R&&null!==R?(R.set("SupportStatus",ea),R.set("Browser",X),R.set("AuthStrategy",ja)):R=null}catch(ha){R=null}A.Health.instance.recordKpiUsageForAlertableKpi("WacCorePFT","WacOAuthFC",R);var ba=z.a.hf();fa.vR("Core",L).then(function(ha){var oa=Math.floor(z.a.hf()-ba);ea=w.a[fa.LR];k.ULS.sendTraceTag(562943369,3E3,50,'OAuthManager attempted to get a Core token to the WAC FrontEnd API in {0} ms. Success={1}, SupportStatus={2}, ErrorCode="{3}", Host="{4}", Browser="{5}", AuthStrategy="{6}"',
oa,ha.IsSuccess,ea,ha.ErrorCode,Y,X,ja);oa=Object.assign(new C.a,{durationMs:oa,extendedProperties:R});ha.IsSuccess?A.Health.instance.recordKpiSuccess("WacCorePFT",oa):A.Health.instance.recordKpiFailure("WacCorePFT",ha.ErrorCode,!1,!1,oa)})}}};t.prototype.dispose=function(){};t.main=function(){x.a.instance.oj(new t)};Jl.Object.defineProperties(t.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return"Common.App.OAuth.OAuthPackage"}}});Object(D.a)(t,"OAuthPackage",null,[8,9]);var H=b(1066);
Object(D.a)(r,"LokiTokenResult",null,[]);m.prototype.j$c=function(){var fa=this,Y=this.ACh();return Y?m.Oid?new Promise(function(L,P){fa.RQb.continueWith(function(){fa.RQb.Dh||fa.RQb.ng?P(Error.create("Error downloading auth library")):fa.RQb.result.vR("Loki",Y).then(function(ea){ea=v.AFrameworkApplication.ha.ta("ForceLokiFallbackToACLPTokenIsEnabled")?fa.DCh():ea.IsSuccess&&ea.Token?Object.assign(new r,{isSuccess:!0,token:ea.Token,errorMessage:null}):Object.assign(new r,{isSuccess:!1,token:null,
errorMessage:JSON.stringify(ea)});L(ea);return ea})})}):Promise.resolve(Object.assign(new r,{isSuccess:!1,token:null,errorMessage:"Not attempting to fetch token because host is not an O365 host."})):Promise.resolve(Object.assign(new r,{isSuccess:!1,token:null,errorMessage:String.format("Could not get Loki App Id for HostAuthorityType: [{0}]",H.a.aOe())}))};m.prototype.DCh=function(){var fa=v.AFrameworkApplication.ha.Wa("LokiUserDataSignature")||"";return Object.assign(new r,{isSuccess:!0,token:fa,
errorMessage:null})};m.prototype.ACh=function(){var fa=null,Y=H.a.Lrb();2===Y?fa=v.AFrameworkApplication.ha.Wa("LokiAADAppId"):1===Y&&(fa=v.AFrameworkApplication.ha.Wa("LokiMSAAppId"));return fa};Jl.Object.defineProperties(m,{Oid:{configurable:!0,enumerable:!0,get:function(){return v.AFrameworkApplication.ha.ta("IsO365CommercialHost")||v.AFrameworkApplication.ha.ta("IsO365ConsumerHost")}}});Object(D.a)(m,"LokiTokenManager",null,[599]);var W=b(525);c.prototype.init=function(){B.a.instance.resolve("Common.ILokiTokenManager")};
c.prototype.dispose=function(){};c.prototype.$h=function(fa){fa.register(m,"Common.App.LivePersonaUtils.LokiTokenManager").as("Common.ILokiTokenManager").Ac().Lc(function(){return new m(W.a.uq(fa.yc("Common.App.OAuth.IOAuthManager")))})};c.main=function(){x.a.instance.oj(new c)};Jl.Object.defineProperties(c.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return"Common.App.LivePersonaUtils"}}});Object(D.a)(c,"LivePersonaUtilsPackage",null,[8,9]);var S=b(12);F=b(211);var N=b(930);d.prototype.vR=
function(fa,Y){return this.oAuthManager?this.oAuthManager.vR(fa,Y).then(function(L){L.IsSuccess||k.ULS.sendTraceTag(51401292,0,15,"Error retrieving auth token. Message: "+L.ErrorMessage+" Error code: "+L.ErrorCode+" App name: "+fa);return Object.assign(new N.a,{IsSuccess:L.IsSuccess,Token:L.Token,ErrorCode:L.ErrorCode,ErrorMessage:L.ErrorMessage})}):(k.ULS.sendTraceTag(51401291,0,10,"Oauth manager is null"),Promise.resolve(Object.assign(new N.a,{IsSuccess:!1,Token:null,ErrorCode:"FailedToResolve",
ErrorMessage:"Failed to resolve IOAuthManager from the container."})))};d.prototype.b3a=function(){return this.oAuthManager?this.oAuthManager.b3a():null};Object(D.a)(d,"OAuthManagerWrapper",null,[34]);var T=F.a;Cm(a,T);a.prototype.create=function(){this.Jb(this.$.ea.Ea(349,void 0)||new d(B.a.instance.resolve("Common.App.OAuth.IOAuthManager")))};a.la=function(fa){fa.ea.La(350,new a(fa))};Object(D.a)(a,"OAuthManagerFactory",F.a,[]);Type.registerNamespace("_Ewa");Type.registerNamespace("Common.App.AppsForOfficeCommon");
Type.registerNamespace("Common.App.OAuth");t.main();Type.registerNamespace("Common.App.LivePersonaUtils");c.main();(function(){S.a.Ja(function(fa){a.la(fa)})})()},968:function(D,F,b){function a(na){var xa=this;this.LR=0;this.dO=null;this.qig=0;this.Ydg=this.O1g(void 0===na?null:na).then(function(Oa){return Oa?xa.GTh():Promise.resolve(1)}).then(function(Oa){return Oa?Promise.resolve(Oa):xa.zai()})}function d(na){this.Zhb=na;this.kVa="UnsupportedAuthTokenStrategy Reason="+J.a[this.Zhb]}function c(){this.ht=
null;this.iPb=0;this.Pgb=this.xVa=this.szc=this.iCa=this.lL=this.iae=null;this.qv=new R.a(null,null);this.TMc=H.AFrameworkApplication.ha.getBooleanFeatureGate("Microsoft.Office.SharedOnline.SharedAuthVNext",!1);this.kVa="SharedAuthTokenStrategy "+(this.TMc?"BrowserAuth 1.20210701.2/MSAL 2.11.0":"BrowserAuth 1.20210426.1/MSAL 2.11.0");this.wX=W.a.qbj;this.o9d=W.a.pbj;this.IYd=W.a.enableConsoleLogging;this.Hbg=H.AFrameworkApplication.ha.getBooleanFeatureGate("Microsoft.Office.SharedOnline.OAuthPopupFlashEnabled",
!1);this.akg=H.AFrameworkApplication.ha.getBooleanFeatureGate("Microsoft.Office.SharedOnline.OAuthSkipUpnCheckEnabled",this.TMc);this.wpa={};this.ieg=new t(1500)}function m(na,xa,Oa,ib,sb,nb){var Gb=ja.call(this,!1,!1,!0)||this;Gb.H0=null;Gb.XXd=null;Gb.wX=na;Gb.Khg=Oa;Gb.qv=ib;Gb.Clg=sb;Gb.iCa=nb;Gb.ht=document.createElement("iframe");Gb.ht.id="SharedAuthInteractiveFrame";Gb.ht.setAttribute("name","SharedAuthInteractiveFrame");Gb.ht.setAttribute("title","SharedAuthInteractiveFrame");Gb.ht.setAttribute("sandbox",
"allow-scripts allow-same-origin allow-forms allow-popups");Gb.ht.style.border="0";Gb.ht.style.height="48px";$addHandler(Gb.ht,"error",Object(T.a)(Gb,Gb.fzi,"onSharedAuthFrameError"));na=String.format("{0}{1}{2}{3}{4}{5}{6}",Gb.wX,xa,"?replyUrl=",window.location.protocol,"//",window.location.host,"&interactive=1");H.AFrameworkApplication.ha.getBooleanFeatureGate("Microsoft.Office.SharedOnline.SharedAuthVNext",!1)&&(na+="&vnext=1");Gb.ht.src=na;Gb.nbg=new Promise(function(Ha){Gb.XXd=Ha});Gb.YXd=!1;
return Gb}function r(){this.correlationId=this.resolve=null}function t(na){na=void 0===na?0:na;this.kB=0;this.Hhb=!1;this.Bm=new Y.a;this._timeout=na}function k(){this.reject=this.resolve=null;this.startTime=0;this.uzf=this.Pke=null}function u(){this.kbe=null;var na=H.AFrameworkApplication.ha.Wa(H.AFrameworkApplication.$ma),xa=H.AFrameworkApplication.ha.Wa(H.AFrameworkApplication.D0f);this.kVa=String.format("ParentFrameTokenStrategy uiHost={0} uiHostIntegrationType={1}",na&&""!==na?na:"Unspecified",
xa&&""!==xa?xa:"Unspecified")}function w(na,xa,Oa,ib,sb){this.scope=this.resource=null;this.silentLogin=!1;this.correlationId=this.options=null;this.resource=na;this.scope=xa;this.silentLogin=Oa;this.options=ib;this.correlationId=sb}function v(){}function A(na){this.cgg=na}function y(){}b.r(F);D=b(0);var x=b(15),z=b(799),J=b(1039),B;(function(na){na[na.external=0]="external";na[na.msa=1]="msa";na[na.aad=2]="aad"})(B||(B={}));Object(D.b)("AuthorityType",B);Object(D.a)(y,"OAuthResult",null,[]);A.prototype.initialize=
function(){return Promise.resolve(0)};A.prototype.Qec=function(){return Promise.resolve(0)};A.prototype.vR=function(){x.ULS.sendTraceTag(574239257,3E3,50,"Automation flag set.  Returning Mock Token.");return Promise.resolve(Object.assign(new y,{IsSuccess:!0,Token:this.cgg}))};A.prototype.bvc=function(){return Promise.resolve(Object.assign(new y,{IsSuccess:!1,ErrorCode:"authTokenStrategy_loginNotSupported",ErrorMessage:"This Token Strategy does not support login flow, TryLogin could not be completed"}))};
A.prototype.Jtc=function(){return!1};A.prototype.Zsb=function(){return"MockAuthTokenStrategy"};Object(D.a)(A,"MockAuthTokenStrategy",null,[605]);var C=b(1066);v.get=function(na,xa,Oa){if(!Oa)return na;var ib=0;return Promise.race([na,new Promise(function(sb){ib=window.setTimeout(function(){sb(xa)},Oa)})]).then(function(sb){window.clearTimeout(ib);return Promise.resolve(sb)}).catch(function(){window.clearTimeout(ib);return Promise.resolve(xa)})};Object(D.a)(v,"PromiseWithTimeout",null,[]);var H=b(5),
W=b(839);Object(D.a)(w,"TokenRequestParameters",null,[616]);var S=b(24),N=b(88);u.prototype.initialize=function(){var na=this;return new Promise(function(xa){N.a.instance.yc("Common.App.WopiIdentity.IWopiIdentity").execute(function(Oa){na.kbe=Oa;xa(0)})})};u.prototype.Wh=function(na){for(var xa=!1,Oa=na.toLocaleUpperCase(),ib=Ml(["HTTPS:","API:"]),sb=ib.next();!sb.done;sb=ib.next())if(Oa.startsWith(sb.value)){xa=!0;break}return xa||this.h2h(na)?na+"/.default":na};u.prototype.h2h=function(na){return RegExp("/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i").test(na)};
u.prototype.Qec=function(){return Promise.resolve(0)};u.prototype.vR=function(na,xa,Oa,ib,sb,nb,Gb){if(S.a.Jja&&(sb=!1,H.AFrameworkApplication.ha.getBooleanFeatureGate("Microsoft.Office.SharedOnline.HostSupportsTeamsElectronSSO",!1)&&(nb=W.a.WBj)&&(sb=Array.contains(nb,na)),!sb))return xa=Object.assign(new y,{IsSuccess:!1,ErrorCode:"TeamsDisallowedApp",ErrorMessage:"Disallowed appName: "+na}),Promise.resolve(xa);na=this.Wh(Oa);Oa=new w(Oa,na,!ib,null,H.AFrameworkApplication.userSessionId);return this.kbe.getAccessToken(Oa,
xa,Gb).then(function(Ha){return Object.assign(new y,{IsSuccess:!0,Token:Ha.accessToken})},function(Ha){return Object.assign(new y,{IsSuccess:!1,ErrorCode:Ha})})};u.prototype.bvc=function(){return Promise.resolve(Object.assign(new y,{IsSuccess:!1,ErrorCode:"authTokenStrategy_loginNotSupported",ErrorMessage:"This Token Strategy does not support login flow, TryLogin could not be completed"}))};u.prototype.Jtc=function(){return!1};u.prototype.Zsb=function(){return this.kVa};Object(D.a)(u,"ParentFrameTokenStrategy",
null,[605]);var T=b(37),fa=b(974),Y=b(210);Object(D.a)(k,"PromiseWrapper",null,[]);t.prototype.enqueue=function(na){var xa=this;return new Promise(function(Oa,ib){xa.Bm.add(Object.assign(new k,{uzf:na,resolve:Oa,reject:ib}));xa.process()})};t.prototype.process=function(){var na=this;if(this.Hhb||this.kB===this.Bm.count)return!1;var xa=this.Bm.oa(this.kB++);try{this.Hhb=!0,xa.uzf().then(function(Oa){na.Hhb=!1;na.kXc(xa,Oa,null,!0)}).catch(function(Oa){na.Hhb=!1;na.kXc(xa,null,Oa,!1)})}catch(Oa){this.Hhb=
!1,this.kXc(xa,null,Oa,!1)}return!0};t.prototype.kXc=function(na,xa,Oa,ib){var sb=this;ib?0<this._timeout?window.setTimeout(function(){na.resolve(xa);sb.process()},this._timeout):(na.resolve(xa),sb.process()):0<this._timeout?window.setTimeout(function(){na.reject(Oa);sb.process()},this._timeout):(na.reject(Oa),sb.process())};Object(D.a)(t,"PromiseQueue",null,[]);Object(D.a)(r,"ResolveWithCorrelation",null,[]);var L=b(82),P=b(140),ea=b(944),X=b(177),ja=P.a;Cm(m,ja);m.prototype.dsc=function(){var na=
{};na=(na.promptMessage=this.Khg,na.errorText=CommonUIStrings.l_InternalError,na.rtl=H.AFrameworkApplication.isRtl,na.frameLoaded=!1,na.createFrame=Object(T.a)(this,this.gUg,"createFrame"),na.resolveDialogStyles=this.XXd,na);var xa={};this.H0=(xa.id="SharedAuthConsentDialog",xa.bodyControls=na,xa);this.lc=5;this.initializeAndShow(CommonUIStrings.l_SignIn,Object(T.a)(this,this.obj,"sharedAuthConsentDialogHandler"),this.H0)};m.prototype.j3f=function(na,xa){var Oa=!0;Oa=void 0===Oa?!1:Oa;na=void 0===
na?!1:na;xa=void 0===xa?5:xa;this.H0&&this.H0.bodyControls&&(Oa!==Object(L.a)(Object,this.H0.bodyControls).frameLoaded&&(Object(L.a)(Object,this.H0.bodyControls).frameLoaded=Oa),na!==Object(L.a)(Object,this.H0.bodyControls).frameLoadSuccess&&(Object(L.a)(Object,this.H0.bodyControls).frameLoadSuccess=na),xa!==this.H0.dialogButtonsOption&&(this.H0.dialogButtonsOption=null,this.lc=xa),this.update(this.H0))};m.prototype.Chj=function(na,xa){var Oa=new ea.a(X.a.sbj),ib={};na=(ib.signInLabel=CommonUIStrings.l_SignIn,
ib.cancelLabel=CommonUIStrings.l_DialogCancel,ib.rtl=H.AFrameworkApplication.isRtl,ib.messageCorrelationId=na,ib.dialogStyles=xa,ib);Oa.Values=na;this.qv.bPa(Oa,this.ht.contentWindow,this.wX)};m.prototype.VLe=function(){this.j3f(!1,6)};m.prototype.fzi=function(){this.VLe()};m.prototype.gUg=function(){return this.ht};m.prototype.obj=function(na){na||(this.Clg.reject(Object.assign(new y,{ErrorCode:"UserCancelled",ErrorMessage:"The interactive flow was cancelled by the user"})),this.iCa(null))};Jl.Object.defineProperties(m.prototype,
{MQf:{configurable:!0,enumerable:!0,get:function(){return this.ht}},A2g:{configurable:!0,enumerable:!0,get:function(){var na=this;return this.nbg.then(function(xa){na.YXd=!0;return xa})}},B2g:{configurable:!0,enumerable:!0,get:function(){return this.YXd}}});Object(D.a)(m,"SharedAuthConsentDialog",P.a,[615]);var R=b(1232),ba=b(93),ha=b(49),oa=b(194),Sa=b(176);c.prototype.Zsb=function(){return this.kVa};c.prototype.initialize=function(){var na=b(968).OAuthManager;if("loadFrame"in this.wpa)return this.wpa.loadFrame.Pke;
if(!this.wX)return ba.Health.instance.recordKpiFailure(na.kpiName,"SharedFrameOriginNotSet",!1,!1,null),x.ULS.sendTraceTag(562381581,3E3,10,"SharedAuthTokenStrategy Init failed: No Shared Frame Origin Path"),Promise.reject(1);na=this.stc("loadFrame");this.iPb=ha.a.hf();var xa=this.wX+this.o9d+"?replyUrl="+window.location.protocol+"//"+window.location.host+"&usid="+H.AFrameworkApplication.userSessionId;this.TMc&&(xa+="&vnext=1");this.ht=document.createElement("iframe");this.jVh(this.ht);this.ht.style.cssText=
"height:0;width:0;display:none;";this.ht.id="SharedAuthFrame";this.ht.setAttribute("name","SharedAuthFrame");this.ht.setAttribute("sandbox","allow-scripts allow-same-origin allow-forms allow-popups");this.ht.setAttribute("title","SharedAuthFrame");this.ht.src=xa;document.body.appendChild(this.ht);xa=ha.a.hf()-this.iPb;x.ULS.sendTraceTag(573112899,3E3,50,"SharedAuthTokenStrategy Create: Frame Appended to Document. E/T:[{0}]. sharedAuthFrame.Src={1}",xa,this.ht.src);return na};c.prototype.Qec=function(na){this.szc=
na;var xa=new ea.a(X.a.PQf);xa.Values=this.pke(na);na=this.stc("initFrame");this.qv.bPa(xa,this.ht.contentWindow,this.wX);x.ULS.sendTraceTag(573112900,3E3,50,"SharedAuthTokenStrategy Init: Called package initialize.");return na};c.prototype.vR=function(na,xa,Oa,ib,sb,nb){var Gb=this,Ha=new ea.a(X.a.tbj),ca=this.PTe();Ha.Values=this.a0f(na,xa,Oa,ib,sb,nb,ca);na=this.stc(ca);ib&&H.AFrameworkApplication.ha.getBooleanFeatureGate("Microsoft.Office.SharedOnline.SharedAuthInteractiveConsentUI",!1)?this.ieg.enqueue(function(){return new Promise(function(Ra){Gb.Jsj(nb,
Ha,Ra,ca)})}):(this.qv.bPa(Ha,this.ht.contentWindow,this.wX),x.ULS.sendTraceTag(573112901,3E3,50,"SharedAuthTokenStrategy TryGetToken: Called TryGetToken for app {0}",xa));return na};c.prototype.Jsj=function(na,xa,Oa,ib){var sb=this.wpa[ib];sb&&(this.xVa=xa,this.iCa=Object.assign(new r,{resolve:Oa,correlationId:ib}),this.lL=new m(this.wX,this.o9d,na,this.qv,sb,Oa),this.lL.dsc())};c.prototype.PTe=function(){return oa.a.create().toString()};c.prototype.a0f=function(na,xa,Oa,ib,sb,nb,Gb){var Ha={};Ha.appName=
na;Ha.appId=xa;Ha.target=Oa;Ha.withPopup=ib;Ha.claims=sb;Ha.promptMessage=nb;Ha.messageCorrelationId=Gb;return Ha};c.prototype.jVh=function(na){$addHandler(na,"load",Object(T.a)(this,this.kui,"onIFrameLoaded"));$addHandler(na,"error",Object(T.a)(this,this.pic,"onIFrameError"));this.qv.XDa(this.wX);this.qv.vn(X.a.SQf);this.qv.km(X.a.SQf,Object(T.a)(this,this.Byi,"onScriptLoaded"));this.qv.vn(X.a.RQf);this.qv.km(X.a.RQf,Object(T.a)(this,this.Ayi,"onScriptInitialized"));this.qv.vn(X.a.NQf);this.qv.km(X.a.NQf,
Object(T.a)(this,this.Oti,"onGetTokenResponse"));this.qv.vn(X.a.TQf);this.qv.km(X.a.TQf,Object(T.a)(this,this.Avi,"onLoginResponse"));this.qv.vn(X.a.QQf);this.qv.km(X.a.QQf,Object(T.a)(this,this.Eui,"onInteractiveFlowReady"));this.qv.vn(X.a.OQf);this.qv.km(X.a.OQf,Object(T.a)(this,this.dui,"onHideDialog"));this.qv.vn(X.a.LQf);this.qv.km(X.a.LQf,Object(T.a)(this,this.ypi,"onCloseDialog"))};c.prototype.stc=function(na){var xa=new k;xa.startTime=ha.a.hf();var Oa=new Promise(function(ib,sb){xa.resolve=
ib;xa.reject=sb});xa.Pke=Oa;this.wpa[na]=xa;return Oa};c.prototype.kui=function(){var na=ha.a.hf()-this.iPb;x.ULS.sendTraceTag(572346566,3E3,50,"WACOAuth.aspx iFrame loaded successfully. E/T:[{0}]",na)};c.prototype.pic=function(na){var xa=b(968).OAuthManager,Oa=ha.a.hf()-this.iPb,ib=Object.assign(new Sa.a,{durationMs:Oa});ba.Health.instance.recordKpiFailure(xa.kpiName,"WACOAuthAspxFrameError",!1,!0,ib);x.ULS.sendTraceTag(572346567,3E3,10,"WACOAuth.aspx iFrame failed to load after {0} ms: {1}",Oa,
this.IYd?JSON.stringify(na):"")};c.prototype.Byi=function(na){var xa=b(968).OAuthManager,Oa=this.wpa.loadFrame,ib=ha.a.hf()-Oa.startTime,sb=na.Values.AuthLibrary.toString();na=na.Values.Success.toString();x.ULS.sendTraceTag(573112902,3E3,50,"SharedAuthTokenStrategy OnScriptLoaded. Success={0} AuthLibrary={1} E/T: [{2}]",na,sb,ib);sb&&(this.kVa="SharedAuthTokenStrategy "+sb);sb=Boolean.parse(na);sb||(na=this.xs(),void 0!==na&&null!==na&&(na.set("AuthLibrary",this.Zsb()),ib=Object.assign(new Sa.a,{durationMs:ib,
extendedProperties:na}),ba.Health.instance.recordKpiFailure(xa.kpiName,"StrategyInitFailed",!1,!0,ib)));Oa.resolve(sb?0:1)};c.prototype.Ayi=function(na){var xa=this;if(na.Values.interactive&&this.xVa&&this.xVa.Values.messageCorrelationId){var Oa=this.xVa.Values.messageCorrelationId.toString();if(na.Values.interactive&&this.lL){this.lL.A2g.then(function(sb){xa.qv.bPa(xa.xVa,xa.lL.MQf.contentWindow,xa.wX);xa.lL.Chj(Oa,sb);xa.lL.j3f(!0);xa.xVa=null});return}}na=this.wpa.initFrame;var ib=ha.a.hf()-na.startTime;
x.ULS.sendTraceTag(573112903,3E3,50,"SharedAuthTokenStrategy OnScriptInitialized. E/T: [{0}]",ib);na.resolve(0)};c.prototype.Oti=function(na){if(na.Values.messageCorrelationId&&na.Values.messageCorrelationId.toString()){var xa=na.Values.messageCorrelationId.toString(),Oa=this.wpa[xa];if(Oa){var ib=ha.a.hf()-Oa.startTime;x.ULS.sendTraceTag(573112906,3E3,50,"SharedAuthTokenStrategy OnGetTokenResponse. E/T: [{0}]",ib);na.Values.isSuccess&&na.Values.isSuccess?Oa.resolve(na.Values.response):Oa.reject(na.Values.response);
this.p0f(xa)}else x.ULS.sendTraceTag(573112905,3E3,10,"SharedAuthTokenStrategy OnGetTokenResponse called with an unregistered messageCorrelationId")}else x.ULS.sendTraceTag(573112904,3E3,10,"SharedAuthTokenStrategy OnGetTokenResponse called without valid messageCorrelationId")};c.prototype.Eui=function(){if(this.lL.B2g)this.lL.VLe();else if(this.szc&&this.lL){var na=new ea.a(X.a.PQf);na.Values=this.pke(this.szc,!0);this.qv.bPa(na,this.lL.MQf.contentWindow,this.wX)}};c.prototype.dui=function(){this.lL&&
this.lL.kub()};c.prototype.ypi=function(na){na.Values.cancelled&&na.Values.cancelled&&na.Values.messageCorrelationId&&this.p0f(na.Values.messageCorrelationId.toString());this.lL&&this.lL.hide()};c.prototype.xs=function(){try{return new Map}catch(na){return null}};c.prototype.pke=function(na,xa){xa=void 0===xa?!1:xa;H.AFrameworkApplication.ha.getBooleanFeatureGate("Microsoft.Office.SharedOnline.SharedAuthVNext",!1);var Oa={};Oa.appIds=this.Cth();Oa.upn=na.loginHint;Oa.authority=na.authority;Oa.authorityType=
Object(z.a)(B,na.authorityType);Oa.tenantId=na.tenantId;Oa.correlationId=H.AFrameworkApplication.userSessionId;Oa.enableConsoleLogging=this.IYd;Oa.enablePopupFlash=this.Hbg;Oa.skipUpnCheck=this.akg;Oa.interactive=xa;return Oa};c.prototype.Cth=function(){var na=[],xa=W.a.EQc,Oa;for(Oa in xa)Array.add(na,xa[Oa]);return na};c.prototype.bvc=function(na,xa,Oa,ib,sb,nb){var Gb=new ea.a(X.a.rbj),Ha=this.PTe();Gb.Values=this.a0f(na,xa,Oa,ib,sb,nb,Ha);this.iae=Gb;na=this.stc(Ha);x.ULS.sendTraceTag(555049437,
3E3,50,"SharedAuthTokenStrategy TryLogin: Called TryLogin for app {0}",xa);this.efj();return na};c.prototype.Jtc=function(){return!0};c.prototype.efj=function(){var na=this;this.Pgb||(this.Pgb=new fa.a(CommonUIStrings.l_WAC_OAuth_CompleteSignIn_Title,CommonUIStrings.l_WAC_OAuth_CompleteSignIn_Body,null),this.Pgb.id=16,this.Pgb.u6e=!1,this.Pgb.addButton(CommonUIStrings.l_WAC_OAuth_CompleteSignIn_Button,function(){na.qv.bPa(na.iae,na.ht.contentWindow,na.wX)},CommonUIStrings.l_WAC_OAuth_CompleteSignIn_Button,
!0),x.ULS.sendTraceTag(555049438,3E3,10,"Failed to add entry to business bar. Login message could not be shown to user."))};c.prototype.Avi=function(na){if(na.Values.messageCorrelationId&&na.Values.messageCorrelationId.toString()){var xa=this.wpa[na.Values.messageCorrelationId.toString()];if(xa){var Oa=ha.a.hf()-xa.startTime;x.ULS.sendTraceTag(555049441,3E3,50,"SharedAuthTokenStrategy OnLoginResponse. E/T: [{0}]",Oa);na.Values.isSuccess&&na.Values.isSuccess?xa.resolve(na.Values.response):xa.reject(na.Values.response)}else x.ULS.sendTraceTag(555049440,
3E3,10,"SharedAuthTokenStrategy OnLoginResponse called with an unregistered messageCorrelationId")}else x.ULS.sendTraceTag(555049439,3E3,10,"SharedAuthTokenStrategy OnLoginResponse called without valid messageCorrelationId")};c.prototype.p0f=function(na){this.iCa&&this.iCa.correlationId===na&&(this.iCa.resolve(null),this.iCa=null)};Object(D.a)(c,"SharedAuthTokenStrategy",null,[605]);d.prototype.initialize=function(){return Promise.resolve(0)};d.prototype.Qec=function(){return Promise.resolve(0)};
d.prototype.vR=function(){return Promise.resolve(Object.assign(new y,{IsSuccess:!1,ErrorCode:J.a[this.Zhb],ErrorMessage:"Unable to get a token. Reason: ["+J.a[this.Zhb]+"]"}))};d.prototype.bvc=function(){return Promise.resolve(Object.assign(new y,{IsSuccess:!1,ErrorCode:"authTokenStrategy_loginNotSupported",ErrorMessage:"This Token Strategy does not support login flow, TryLogin could not be completed"}))};d.prototype.Jtc=function(){return!1};d.prototype.Zsb=function(){return this.kVa};Object(D.a)(d,
"UnsupportedAuthTokenStrategy",null,[605]);var ma=b(829);b.d(F,"OAuthManager",function(){return a});a.prototype.P1g=function(){var na=W.a.sii;na&&0<na.length?(this.LR=1,this.dO=new A(na)):H.AFrameworkApplication.ha.ta("IsO365ConsumerHost")||H.AFrameworkApplication.ha.ta("IsO365CommercialHost")?(na=C.a.getAuthContext().loginHint)&&na.length&&!H.AFrameworkApplication.ha.ta("IsAnonymousUser")?W.a.mub?(this.LR=1,this.dO=new u):a.L3h()?(this.LR=1,this.dO=new c):(this.LR=3,this.dO=new d(this.LR)):(this.LR=
2,this.dO=new d(this.LR)):(this.LR=4,this.dO=new d(this.LR))};a.prototype.hE=function(){return this.dO?this.dO.Zsb()||"Unknown":"None"};a.prototype.O1g=function(na){var xa=this;na=void 0===na?null:na;x.ULS.sendTraceTag(562128578,3E3,50,"Creating OAuthManager.");var Oa=ha.a.hf();return H.AFrameworkApplication.ha.G9c().then(function(ib){ib?(xa.P1g(),na&&(xa.dO=na),x.ULS.sendTraceTag(42084323,3E3,50,"Creation succeeded OAuthManager successfully in {4} ms with clientVer={0}, appVer={1}, docVer={2}, strategy={3}",
W.a.clientVersion,W.a.appVersion,W.a.Q4g,xa.hE(),Math.floor(ha.a.hf()-Oa))):x.ULS.sendTraceTag(562128579,3E3,15,"Creation failed for OAuthManager, unable to get app settings after {0} ms, all future TryGetToken requests will fail.",Math.floor(ha.a.hf()-Oa));return Promise.resolve(ib)},function(){x.ULS.sendTraceTag(562128580,3E3,15,"Creation failed for OAuthManager, unable to get app settings after {0} ms, all future TryGetToken requests will fail.",Math.floor(ha.a.hf()-Oa));return Promise.resolve(!1)})};
a.prototype.GTh=function(){var na=this;x.ULS.sendTraceTag(573390991,3E3,50,"Initializing {0}",this.hE());var xa=ha.a.hf();return v.get(this.dO.initialize(),2,W.a.vyd).then(function(Oa){if(Oa)if(1===Oa){var ib=na.xs();void 0!==ib&&null!==ib&&(ib.set("AuthLibrary",na.hE()),ib=Object.assign(new Sa.a,{durationMs:Math.floor(ha.a.hf()-xa),extendedProperties:ib}),ba.Health.instance.recordKpiFailure(a.kpiName,"StrategyInitFailed",!1,!0,ib))}else 2===Oa&&(x.ULS.sendTraceTag(42267908,3E3,15,"Initialization timed out for {0} after {1} ms, all future TryGetToken requests will fail.",
na.hE(),Math.floor(ha.a.hf()-xa)),ib=na.xs(),void 0!==ib&&null!==ib&&(ib.set("AuthLibrary",na.hE()),ib=Object.assign(new Sa.a,{durationMs:Math.floor(ha.a.hf()-xa),extendedProperties:ib}),ba.Health.instance.recordKpiFailure(a.kpiName,"StrategyInitTimedOut",!1,!0,ib)));else x.ULS.sendTraceTag(42084353,3E3,50,"Initialization succeeded for {0} in {1} ms.",na.hE(),Math.floor(ha.a.hf()-xa));return Promise.resolve(Oa)},function(){x.ULS.sendTraceTag(574239256,3E3,15,"Initialization failed for {0} after {1} ms, all future TryGetToken requests will fail.",
na.hE(),Math.floor(ha.a.hf()-xa));return Promise.resolve(1)})};a.prototype.zai=function(){var na=this;x.ULS.sendTraceTag(562128581,3E3,50,"Loading {0}",this.hE());var xa=ha.a.hf();return v.get(this.dO.Qec(C.a.getAuthContext()),2,W.a.vyd).then(function(Oa){Oa?1===Oa?x.ULS.sendTraceTag(562128583,3E3,15,"Load failed for {0} after {1} ms, all future TryGetToken requests will fail.",na.hE(),Math.floor(ha.a.hf()-xa)):2===Oa&&x.ULS.sendTraceTag(558469660,3E3,15,"Load timed out for {0} after {1} ms, all future TryGetToken requests will fail.",
na.hE(),Math.floor(ha.a.hf()-xa)):x.ULS.sendTraceTag(562128582,3E3,50,"Load succeeded for {0} in {1} ms.",na.hE(),Math.floor(ha.a.hf()-xa));return Promise.resolve(Oa)},function(){x.ULS.sendTraceTag(562128584,3E3,15,"Load failed for {0} after {1} ms, all future TryGetToken requests will fail.",na.hE(),Math.floor(ha.a.hf()-xa));return Promise.resolve(1)})};a.prototype.vR=function(na,xa,Oa){return this.$uc(na,xa,!1,null,"",void 0===Oa?null:Oa)};a.prototype.b0f=function(na,xa,Oa,ib,sb){return this.$uc(na,
xa,!0,Oa,ib,void 0===sb?null:sb)};a.prototype.$uc=function(na,xa,Oa,ib,sb,nb,Gb){Gb=void 0===Gb?0:Gb;Gb+=1;x.ULS.sendTraceTag(42084352,3E3,50,"OAuthManager TryGetToken(appName={0}, target={1}) called.  Using strategy {2} - attempt {3}",na,this.NOa(na,xa),this.hE(),Gb);var Ha=this.xs();void 0!==Ha&&null!==Ha&&(Ha.set("AuthLibrary",this.hE()),Ha.set("AppName",na),Ha.set("Target",this.NOa(na,xa)),ba.Health.instance.recordKpiUsage(a.kpiName,0,"WacOAuthFC",Ha));if(!W.a.isEnabled){var ca;return this.snd((ca=
new y,ca.IsSuccess=!1,ca.Token=null,ca.ErrorCode="NotEnabled",ca.ErrorMessage="OAuthManager is disabled.",ca),na)}var Ra=W.a.EQc[na];if(void 0===Ra||null===Ra){x.ULS.sendTraceTag(41961345,3E3,15,"Auth context not found. Ensure that your app [{0}] is listed in the OAuthManagerApplications setting.",na);var ua;return this.snd((ua=new y,ua.IsSuccess=!1,ua.Token=null,ua.ErrorCode="DisallowedApp",ua.ErrorMessage="Disallowed appName: "+na,ua),na)}var ta=ha.a.hf(),db=this;Ha=this.Ydg.then(function(Ia){return db.hZh(na,
Ra,xa,Oa,ib,sb,nb,Ia)});ca=Oa?0:W.a.vyd;var Ta;ua=(Ta=new y,Ta.IsSuccess=!1,Ta.Token=null,Ta.ErrorCode="authTokenStrategy_timeout",Ta.ErrorMessage="Auth Strategy timed out after ["+ca+"] ms when fetching token",Ta);var qb=this,za=this;return v.get(Ha,ua,ca).then(function(Ia){return Gb<=a.Mgi&&(Ia.ErrorCode===a.hZf||Ia.ErrorCode===a.amj)?(x.ULS.sendTraceTag(573175516,3E3,50,"TryGetToken attempt {0} timed out after {1} ms - retrying",Gb,Math.floor(ha.a.hf()-ta)),qb.$uc(na,xa,Oa,ib,sb,nb,Gb)):Ia.ErrorCode===
a.K9e&&!Oa&&(x.ULS.sendTraceTag(561517645,3E3,50,"TryGetToken attempt {0} failed with ITP error.  3P Cookies are [{1}]. Retry: [{2]}]",Gb,a.n2c),a.g8g&&qb.dO.Jtc()&&qb.dO.bvc(na,Ra,xa,Oa,ib,sb).then(function(va){return Promise.resolve(qb.jfc(va,na,xa,Ra,ta))}).catch(function(){var va,Ua=(va=new y,va.IsSuccess=!1,va.Token=null,va.ErrorCode="authTokenStrategy_failure",va.ErrorMessage="LoginPopup failed, GetToken could not be called",va);return Promise.resolve(qb.jfc(Ua,na,xa,Ra,ta))}),a.n2c)?qb.$uc(na,
xa,!0,ib,sb,nb,Gb):Promise.resolve(qb.jfc(Ia,na,xa,Ra,ta))}).catch(function(){var Ia,va=(Ia=new y,Ia.IsSuccess=!1,Ia.Token=null,Ia.ErrorCode="authTokenStrategy_failure",Ia.ErrorMessage="Auth Strategy failed with an unknown error",Ia);return Promise.resolve(za.jfc(va,na,xa,Ra,ta))})};a.prototype.hZh=function(na,xa,Oa,ib,sb,nb,Gb,Ha){var ca=this;return 1===Ha||2===Ha?this.snd(Object.assign(new y,{IsSuccess:!1,Token:null,ErrorCode:"InitFailed",ErrorMessage:"Auth Strategy Failed to Init or Load"}),na):
this.dO.vR(na,xa,Oa,ib,sb,nb,Gb).then(function(Ra){return Promise.resolve(ca.Hhf(Ra,!0,na))}).catch(function(Ra){return Promise.resolve(ca.Hhf(Ra,!1,na))})};a.prototype.jfc=function(na,xa,Oa,ib,sb){var nb={};sb=ha.a.hf()-sb;nb.IsSuccess=na.IsSuccess;nb.ErrorCode=na.IsSuccess?"Success":na.ErrorCode||"";nb.ErrorMessage=na.IsSuccess?"Success":this.NOa(xa,na.ErrorMessage||"");nb.Target=this.NOa(xa,Oa||"");nb.TimeInMS=Math.floor(sb);nb.AuthLibrary=this.hE();nb.AppName=xa;nb.AuthorityType=Object(z.a)(B,
C.a.Lrb());nb.UserType=this.uKh(C.a.getAuthContext());nb.IsAuthSupportedInSession=J.a[this.LR];nb.RequestCount=++this.qig;nb.AppId=ib;x.ULS.sendTraceTag(593863640,3E3,50,JSON.stringify(nb));na.IsSuccess||(Oa=this.xs(),void 0!==Oa&&null!==Oa&&(Oa.set("AppName",xa),Oa.set("AuthLibrary",this.hE()),Oa.set("ErrorCode",na.ErrorCode),Oa.set("ErrorMessage",this.NOa(xa,na.ErrorMessage)),xa=Object.assign(new Sa.a,{durationMs:sb,extendedProperties:Oa}),ba.Health.instance.recordKpiFailure(a.kpiName,"TryGetTokenFailure",
!1,!0,xa)));return na};a.prototype.snd=function(na,xa){x.ULS.sendTraceTag(578435090,3E3,15,"OAuthManager failed without invoking GetToken. AppName: '{0}', Reason: '{1}'",xa,this.NOa(xa,na.ErrorMessage));var Oa=this.xs();void 0!==Oa&&null!==Oa&&(Oa.set("AppName",xa),Oa.set("AuthLibrary",this.hE()),Oa.set("ErrorCode",na.ErrorCode),Oa.set("ErrorMessage",this.NOa(xa,na.ErrorMessage)),xa=Object.assign(new Sa.a,{extendedProperties:Oa}),ba.Health.instance.recordKpiFailure(a.kpiName,"FailureBeforeGetToken",
!1,!0,xa));return Promise.resolve(na)};a.prototype.b5e=function(na){return na===ma.a.suc};a.prototype.NOa=function(na,xa){return this.b5e(na)&&xa?"REDACTED":xa};a.prototype.uKh=function(na){return H.AFrameworkApplication.ha.ta("IsAnonymousUser")?"anonymous":!na.loginHint||1>na.loginHint.length?"empty":-1<na.loginHint.indexOf("guest#")?"guest":-1<na.loginHint.indexOf("ext#")?"external":0>na.upn.indexOf("@")?"no-at":"supported"};a.prototype.b3a=function(){return 1===this.LR};a.prototype.Hhf=function(na,
xa,Oa){var ib=null,sb=null,nb=null,Gb=null;na?na.ErrorCode||na.ErrorMessage?(sb=na.ErrorCode?na.ErrorCode:a.kIe,nb=na.ErrorMessage?na.ErrorMessage:"No message"):na.Token?xa?ib=na.Token:(sb=a.jRi,nb="A rejected promise returned a token."):(sb=a.kIe,nb=JSON.stringify(na)):(sb=a.Mki,nb="No result came from Auth Token Strategy");na&&na.Telemetry&&!this.b5e(Oa)&&(Gb=na.Telemetry,x.ULS.sendTraceTag(579166408,3E3,50,JSON.stringify(Gb)));if(sb===a.Eii||sb===a.wqj)sb=a.hZf,nb="Auth Library Timed Out";sb===
a.bAg&&-1<nb.indexOf(a.smg)&&(sb=a.K9e);if(sb||nb)ib=null;return Object.assign(new y,{IsSuccess:!!ib,Token:ib,ErrorCode:sb,ErrorMessage:nb,Telemetry:Gb})};a.prototype.xs=function(){try{return new Map}catch(na){return null}};a.L3h=function(){var na=W.a.g3g;return na&&(S.a.rA&&Array.contains(na,"Electron")||S.a.edc&&Array.contains(na,"Safari")&&!a.n2c)?!1:!0};Jl.Object.defineProperties(a,{n2c:{configurable:!0,enumerable:!0,get:function(){return H.AFrameworkApplication.ha.getBooleanFeatureGate("Microsoft.Office.SharedOnline.OAuthInteractiveFallbackEnabled",
!1)}},g8g:{configurable:!0,enumerable:!0,get:function(){return H.AFrameworkApplication.ha.getBooleanFeatureGate("Microsoft.Office.SharedOnline.OAuthLoginFlowEnabled",!1)}}});a.wqj="token_renewal_error";a.kIe="Exception";a.Mki="NoResult";a.jRi="RejectToken";a.Eii="monitor_window_timeout";a.hZf="Timeout";a.amj="authTokenStrategy_timeout";a.bAg="login_required";a.smg="AADSTS50058";a.K9e="Cookies Disabled";a.kpiName="OAuthManager";a.Mgi=2;Object(D.a)(a,"OAuthManager",null,[451])}}]);

//# sourceMappingURL=EwaDS.oauth.js.map
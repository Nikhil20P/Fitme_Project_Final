(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[17],{1196:function(D,F,b){function a(){}b.d(F,"a",function(){return a});D=b(0);a.fyc="b-ring_Apc_Trans";a.Y6f="cdn_static_resource_ewa_image";Object(D.a)(a,"ResourceHosts",null,[])},1241:function(D,F,b){function a(){}function d(u,w,v,A,y){this.url="";this.L2a=!1;this.Q6=-1;this.testIteration=0;this.baseUrl=v;this.ilf=A;this.Cdd=w;this.result=new c(w,y)}function c(u,w){this.testName=null;this.startTimeMs=0;this.isSuccess=!1;this.caller=
this.errorStatusCode=this.errorMessage=null;this.reqTotalDurationMs=0;this.browserResourceTiming=null;this.testIteration=0;this.testName=u;this.caller=w;this.reset()}D=b(0);var m=b(55),r=b(15),t=b(277);c.prototype.reset=function(){this.isSuccess=!1;this.startTimeMs=-1;this.errorStatusCode=this.errorMessage="";this.reqTotalDurationMs=-1;this.browserResourceTiming=null};Object(D.a)(c,"NetworkTestResult",null,[]);var k=b(594);d.prototype.SEd=function(){try{if(this.L2a)r.ULS.sendTraceTag(573851738,0,
50,"NetworkTestReq.RunTest: a test for the host {0} is already mid way, not starting a new one.",this.Cdd);else{this.reset();this.L2a=!0;this.result.startTimeMs=Date.now();var u=new t.QueryStringBuilder(this.baseUrl);u.I8("tid",this.result.startTimeMs.toString());this.url=u.toString();this.Q3i();this.testIteration++;this.result.testIteration=this.testIteration}}catch(w){this.Lqb("Exeption: "+w.message)}};d.prototype.reset=function(){this.url="";this.result.reset();this.L2a=!1;this.Q6=-1};d.prototype.clearTimeout=
function(){-1!==this.Q6&&(window.clearTimeout(this.Q6),this.Q6=-1)};d.prototype.Q3i=function(){var u=this;try{var w=new XMLHttpRequest;w.onreadystatechange=function(){4===w.readyState&&(200===w.status?u.Smh():u.Lqb(String.format("Error when downloading resource. status code: {0}, status text: {1}",w.status,w.statusText),w.status.toString()))};w.onerror=function(){u.Lqb(String.format("Client error when attempting to download resource. status code: {0}, response: {1}",w.status,w.statusText))};this.Q6=
window.setTimeout(function(){u.Q6=-1;u.Lqb("Request timeout")},1E4);w.open("GET",this.url,!0);w.send(null)}catch(v){this.Lqb("Exeption: "+v.message)}};d.prototype.Smh=function(){this.L2a&&(this.result.reqTotalDurationMs=Date.now()-this.result.startTimeMs,this.clearTimeout(),this.result.browserResourceTiming=k.a(this.url),this.result.isSuccess=!0,this.g_b())};d.prototype.Lqb=function(u,w){w=void 0===w?null:w;this.L2a&&(this.clearTimeout(),this.result.errorMessage=u,this.result.isSuccess=!1,this.result.errorStatusCode=
w,this.g_b())};d.prototype.g_b=function(){this.L2a=!1;this.ilf&&this.ilf(this.result,this.Cdd)};Object(D.a)(d,"NetworkTestReq",null,[]);b.d(F,"a",function(){return a});a.A7c=function(u,w,v,A){A=void 0===A?null:A;a.Tgc||(a.Tgc=Array.isArray(m.a.gi(v.Ba.NetworkMeasurementUrlList))?m.a.gi(v.Ba.NetworkMeasurementUrlList):null);for(var y=[],x=0;x<a.Tgc.length;x++){var z=a.Tgc[x],J=z.key;J||(J=z.Key);if(!A||Array.contains(A,J)){var B=z.value;B||(B=z.Value);J&&B&&y.push(new d(v,J,B,u,w))}}return y};a.Tgc=
null;Object(D.a)(a,"NetworkConnectionHelpers",null,[])},1355:function(D,F,b){function a(V){var Pa=Th.call(this)||this;Pa.$=V;Pa.fc();return Pa}function d(V,Pa,Ib,wc){this.eN=null;this.$=V;this.Plc=Pa;this.Jt=Ib;this.nk=wc;this.Rld=this.Dld=null;this.CZ=this.K4b=this.q2b=this.n$b=!1;this.jSd=0;this.$.ea.La(406,this)}function c(V){var Pa=zh.call(this)||this;Pa.$=V;Pa.fc();return Pa}function m(V,Pa,Ib){Ib=void 0===Ib?!0:Ib;var wc=Wh.call(this)||this;wc.gQa=null;wc.yma=null;wc.tMa=null;wc.s_b=null;wc.Q_=
null;wc.fhf=0;wc.O8a=!1;wc.N8a=!1;wc.umc=!1;wc.documentVisibilityObserver=null;wc.ghf=null;wc.cij=null;wc.Bea=!1;wc.O6=0;wc.ved=0;wc.Awb=!1;wc.yUf=0;wc.rJd=!1;wc.c0=null;wc.zSb=B.vai;wc.xXc=B.connected;wc.$=V;wc.yf=V.ra.yf;wc.FRf=qc.EwaSettings.isChangeGateEnabled("OfficeVSO:5618694_BackToWorkLoadingUIEnabled");wc.zHb=qc.EwaSettings.isChangeGateEnabled("OfficeVSO:5798300_SilentReopenDuringWorkUIEnabled");wc.Grc=qc.EwaSettings.isChangeGateEnabled("OfficeVSO:5618594_OfflineModeUXEnabled");Ib&&(wc.ghf=
new k(V,Pa));qc.EwaSettings.isChangeGateEnabled("OfficeVSO:5589104_AlwaysInitDocumentVisibilityObserver")&&wc.$.ea.ub(291,function(nd){wc.documentVisibilityObserver=nd});wc.Grc&&(qc.EwaSettings.isChangeGateEnabled("OfficeVSO:5589104_AlwaysInitDocumentVisibilityObserver")||wc.$.ea.ub(291,function(nd){wc.documentVisibilityObserver=nd}),wc.fhf=wc.$.Ba.ExcelNetworkCheckAfterTabActivationDelayMs,wc.yf.ltg(Object(ld.a)(wc,wc.bBb,"onNetworkDownEvent")),wc.yf.Akb(Object(ld.a)(wc,wc.Hpf,"onNetworkResumedEvent")),
wc.yf.Kee(Object(ld.a)(wc,wc.nlf,"onConnectivityIssuesBeganEvent")),wc.yf.Jrg(Object(ld.a)(wc,wc.olf,"onConnectivityIssuesEndedEvent")));if(wc.FRf||wc.zHb)wc.cij=new r(wc.$,wc);wc.fdf=wc.$.Ba.LongInactivityTimePeriodSeconds;wc.$.fa.SPc(Object(ld.a)(wc,wc.Ksf,"onSilentReopenDueToTimeoutOrDeploymentInitiated"));wc.$.fa.Ff.pqa(Object(ld.a)(wc,wc.uba,"onThrottledUserActivity"));wc.zHb&&(wc.yUf=wc.$.Ba.SilentReopenDuringWorkDelayMs);return wc}function r(V){this.D6=null;this.$=V;this.vg=rf.a(this.$).vg;
this.vg.nfe(Object(ld.a)(this,this.apf,"onLongInactivitySilentReopenPartialInteractivityStatusChanged"));this.vg.wug(Object(ld.a)(this,this.Lsf,"onSilentReopenDuringWorkPartialInteractivityStatusChanged"))}function t(V,Pa,Ib,wc){V=J.call(this,V,Pa,Ib)||this;V.wasInteruptedByOfflineMode=!1;V.type=wc;V.wasInteruptedByOfflineMode=!1;return V}function k(V,Pa){this.oka=this.Jqd=this.djf=null;this.$=V;!qc.EwaSettings.isChangeGateEnabled("OfficeVSO:5618594_OfflineModeUXEnabled")||qc.EwaSettings.isChangeGateEnabled("OfficeVSO:4956381_DisableNetworkLoggingInFirefox")&&
ff.a.Pf||(this.djf=new u(V,Pa));qc.EwaSettings.ka(216)&&(this.Jqd=new A(this.$),this.Jqd.YTh());!qc.EwaSettings.ka(599)||qc.EwaSettings.isChangeGateEnabled("OfficeVSO:4956381_DisableNetworkLoggingInFirefox")&&ff.a.Pf||(this.oka=new sh.NetworkConnectionHealthChecker(this.$));this.mPg=new y(this.$)}function u(V,Pa){this.sMa=this.wT=null;this.Oxd=-1;this.Yqb=null;this.$$e=Ud.Task.delay(0);this.$=V;this.indexedDB=Pa;this.y5f=!1;this.indexedDB.te()&&(this.indexedDB.initialize(u.Ced,u.Ded),this.YWi(),this.sMa=
new v(this.$.Ba.UserSessionId),rf.a(this.$).vg.xPc(Object(ld.a)(this,this.R6a,"onOfflineModePartialInteractivityStatusChanged")));this.nk=Rb.a.instance.VB();this.nk.la("beforeunload",Object(ld.a)(this,this.gAb,"onBeforeUnload"))}function w(V,Pa,Ib){V=J.call(this,V,Pa,Ib)||this;V.timeFromLastOffline=0;V._errorDataDuringOfflineMode=null;V.timeFromLastOffline=-1;V.type=5;return V}function v(V){this._count=0;this.sessionID=this.allOfflinePartialInteractivitiesDataInSession=null;this.allOfflinePartialInteractivitiesDataInSession=
[];this.sessionID=V}function A(V){var Pa=this;this.xJf=null;this.Nld=this.Hpd=this.Uzb=this.Vzb=0;this.yJd=!1;this.nXc=this.lQa=this.Qsc=this.Y5a=null;this.BXc=0;this.$=V;if(this.zJd=qc.EwaSettings.isChangeGateEnabled("OfficeVSO:5186511_SendSlowNetworkPingTests")&&this.$Jg())this.xJf=[gh.a.fyc],this.BXc=1,this.nXc={},this.$.fa.Ff.pqa(Object(ld.a)(this,this.uba,"onThrottledUserActivity")),this.$.ea.ub(291,function(Ib){Ib.fEa(Object(ld.a)(Pa,Pa.pV,"onDocumentHidden"));Ib.tkb(Object(ld.a)(Pa,Pa.Pwa,
"onDocumentUnhidden"))})}function y(V){this.lec=this.data=null;this.$4c=0;this.Wse=null;this.$=V;rf.a(this.$).vg.Lee(Object(ld.a)(this,this.plf,"onConnectivityIssuesStatusChanged"));this.$.yf.Kee(Object(ld.a)(this,this.mlf,"onConnectivityIssuesBegan"))}function x(){}function z(V,Pa,Ib,wc,nd,Bd){V=J.call(this,V,Pa,wc)||this;V.swappedByOffline=!1;V.swappedOffline=!1;V.averageDurationBetweenFailedRequestsSec=0;V.longestDurationBetweenFailedRequestsSec=0;V.lastFailedRequestToOnlineTimeGapSec=0;V.disconnectionSource=
null;V.errorDataDuringConnectivityIssuesMode=null;V.failedRequests=[];V.triggeringRequest=null;V.type=4;V.swappedOffline=Ib;V.disconnectionSource=Enum.toString(Zf.a,nd);V.triggeringRequest=Bd;return V}function J(V,Pa,Ib){this.type=0;this.startTime=null;this.blockedOperationsCount=this.durationMs=0;this.blockedActions=null;this.blockedUserOperationsWhileToastShown=this.durationUntilToastShownMs=0;this.toastRaiser=null;this.wasUserActiveOnPIEnd=this.wasUserActiveOnPIStart=this.hasTabbedOut=this.isToastShown=
!1;this.durationUntilUserInactive=-1;this.isTaskPaneCollapsed=this.isTaskPaneShown=this.isDialogShown=!1;this.startTime=V;this.durationUntilToastShownMs=0;this.blockedActions={};this.isToastShown=Ib;Pa.fa&&Pa.fa.Ff&&(this.wasUserActiveOnPIStart=Pa.fa.Ff.Tq);this.Xj(Pa);qc.EwaSettings.isChangeGateEnabled("OfficeVSO:5340853_ImprovePIData")?(this.isDialogShown=0<Pa.Db.PQ,V=Pa.ea.Ea(183,void 0),this.isTaskPaneShown=!!V&&V.isVisible&&!V.isCollapsed,this.isTaskPaneCollapsed=!!V&&V.isVisible&&V.isCollapsed):
this.isTaskPaneCollapsed=this.isTaskPaneShown=this.isDialogShown=!1}function B(){}function C(V){var Pa=Jd.call(this)||this;Pa.Qc=V;Pa.fc();return Pa}function H(V,Pa,Ib){Ib=void 0===Ib?null:Ib;var wc=Ld.call(this)||this;wc.$Xa=null;wc.E2a=null;wc.oac=null;wc.jBa=null;fc.ULS.sendTraceTag(577572892,0,50,"MergeSuspensionManager.ctor started");wc.$=V;wc.Ghb=new ja(V);wc.uUh(V,Ib);Ib=qc.EwaSettings.isChangeGateEnabled("OfficeVSO:5738250_refreshStateRefactored");var nd=qc.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.DPMOWaitsForMergeToEnd",
!1);wc.Jea=new R(wc.jBa,wc.Ghb,!nd,Ib);wc.jDd=new W(V,wc.Jea,Pa,nd);qc.EwaSettings.ka(259)&&(wc.oac=new oa(V,wc));fc.ULS.sendTraceTag(588276810,0,50,"MergeSuspensionManager created");return wc}function W(V,Pa,Ib,wc,nd,Bd){nd=void 0===nd?null:nd;Bd=void 0===Bd?null:Bd;var yd=md.call(this)||this;yd.mAe=null;yd.ZOa=null;yd.rpb=null;yd.hxb=0;yd.S4a=null;yd.ixb=null;yd.$=V;yd.Kqa=Ib;yd.q3i=qc.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.SelectionAdjust",!1);yd.q3i&&(yd.ZOa=new S(yd.$));yd.jV=
Pa;yd.jV.Xtg(Object(ld.a)(yd,yd.Wqf,"onReadyForPendingMergesUpdated"));yd.jV.IVb(Object(ld.a)(yd,yd.GBb,"onTogglePendingMergeBlockedByClient"));yd.jV.ftg(Object(ld.a)(yd,yd.fpf,"onMergeCounterChanged"));yd.$.ra.qqa(Object(ld.a)(yd,yd.yAa,"webServiceAdjustContextEventHandler"));yd.xa=yd.$.ra.xa;yd.$Eb=yd.$.Ba.MergeSuspensionRequestThrottlingTimeInMs;yd.f9h=yd.$.Ba.KeepBlockingPendingMergesRequestIntervalMs;yd.mze=wc;yd.mze?(yd.mAe=nd?nd:new L(yd.xa,yd.$),fc.ULS.sendTraceTag(588276807,0,50,"RequestController initialized")):
Bd?yd.rpb=Bd:ih.TaskExtensions.Da(Hf.GetServiceTaskFactory.Xa(yd.$.ea,12,477,3,"Microsoft.Office.Excel.WebUI.Client.SharedUIControlsFactory.ISharedUIControlsFactory"),function(re){var xe=new fa(yd.xa,yd.$,yd.ZOa);yd.rpb=re.result.bob(xe,xe,null,"RequestController");fc.ULS.sendTraceTag(588276807,0,50,"RequestController initialized");2===yd.jV.getState()&&yd.iMf(yd.jV.o8b())},yd.$.ma);return yd}function S(V){this.Xfa=this.aja=null;this.mlj=0;this.Tkb=new T;this.$=V;this.gridView=vf.g(this.$);this.gridView.Ha.Xp(Object(ld.a)(this,
this.Zg,"onBlockCacheConsistent"));this.gXi=qc.EwaSettings.isChangeGateEnabled("OfficeVSO:5712698_ReportDivergenceInSelectionAdjust")}function N(V,Pa,Ib){this.BF=V;this.u8=Pa;this.rDa=Ib}function T(){this.errors=this.erd=this.h1c=this.nQc=this.oQc=0}function fa(V,Pa,Ib,wc){this.Exb=null;this.xa=V;this.$Eb=Pa.Ba.MergeSuspensionRequestThrottlingTimeInMs;var nd=Pa.Ba.GetRangeContentPrefetchDelayForMergeInMs;this.Ss=function(){Pa.lFd(nd)};this.Vg=(void 0===wc?null:wc)||vc.a.Ta;this.XKb=new Date(0);this.ZOa=
void 0===Ib?null:Ib;return this}function Y(){}function L(V,Pa,Ib,wc){this.Exb=null;this.Xua=!1;this.xa=V;this.$Eb=Pa.Ba.MergeSuspensionRequestThrottlingTimeInMs;var nd=Pa.Ba.GetRangeContentPrefetchDelayForMergeInMs;this.Ss=function(){Pa.lFd(nd)};this.Vg=(void 0===Ib?null:Ib)||vc.a.Ta;this.XKb=new Date(0);this.HN=void 0===wc?null:wc}function P(V,Pa,Ib,wc,nd,Bd,yd){yd=V.Ra(1,void 0===yd?null:yd);yd.suspensionStartTimestamp=Pa;return bf.i(V,"KeepBlockingPendingMerges",yd,Ib,wc,nd,Bd,0)}function ea(V,
Pa,Ib,wc,nd,Bd){Bd=V.Ra(1,void 0===Bd?null:Bd);return bf.i(V,"DoPendingMerge",Bd,Pa,Ib,wc,nd,0)}function X(){}function ja(V){var Pa=Na.call(this)||this;Pa.Z0=null;Pa.oec=0;Pa.lIf();Pa.$=V;Pa.$.ra.ls(Object(ld.a)(Pa,Pa.xAa,"webMethodSuccessEventHandler"));Pa.$.fa.ak(Object(ld.a)(Pa,Pa.Zpc,"sessionReloadEventHandler"));Pa.$.fa.DO(Object(ld.a)(Pa,Pa.Zpc,"sessionReloadEventHandler"));vf.g(Pa.$).Hc.mt(Object(ld.a)(Pa,Pa.Twa,"onEditCellEnded"));Pa.$.ea.ub(292,function(Ib){Ib.ykb(Object(ld.a)(Pa,Pa.$yb,
"mergeCounterUpdatedEventHandler"));fc.ULS.sendTraceTag(588276809,0,50,"PendingMergeMonitor initialized")});return Pa}function R(V,Pa,Ib,wc){var nd=Ca.call(this)||this;nd.Jga=V;nd.Jga.FVb(Object(ld.a)(nd,nd.MMa,"onSafeStateChanged"));nd.A7a=Pa;nd.A7a.ykb(Object(ld.a)(nd,nd.WAb,"onMergeCounterUpdated"));nd.AQ=Object.assign(new e.a,{Pending:0,Current:0,SuspensionStartTimestamp:null});nd.wA=nd.tUh();nd.Z7g=Ib;nd.$Cf=wc;return nd}function ba(V){var Pa=I.call(this)||this;Pa.uva=V;return Pa}function ha(V){return V?
String.format("{0} / {1} @{2}",V.Current,V.Pending,V.SuspensionStartTimestamp):null}function oa(V,Pa){var Ib=h.call(this)||this;Ib.statusBarManager=null;Ib.Wqd=!1;Ib.mergeSuspensionManager=Pa;Ib.mergeSuspensionManager.A7a.ykb(Object(ld.a)(Ib,Ib.WAb,"onMergeCounterUpdated"));Ib.Wgc="";Df.a.IX(1905775613,Vf.a.Nc,0,1);Ib.Na=V.Na;Ib.EJb=new Sa;V.ea.ub(29,function(wc){Ib.mergeSuspensionManager&&(Ib.statusBarManager=wc,wc.VF(Ib),Ib.mergeSuspensionManager.Jga.FVb(Object(ld.a)(Ib,Ib.MMa,"onSafeStateChanged")))});
Ib.Na.JX(Ib.EJb);return Ib}function Sa(){return og.call(this)||this}function ma(V,Pa){Pa=void 0===Pa?null:Pa;var Ib=$g.call(this)||this;Ib.Ioa=!1;Ib.$=V;Ib.L_d=Pa?Pa:pf.a(V).NP(rg.a.idle);pf.a(V).fPc(Object(ld.a)(Ib,Ib.Blf,"onCurrentActivityChanged"));Ib.D2a.np(Object(ld.a)(Ib,Ib.NM,"onIdleActivityStatusChanged"));Ib.refresh();return Ib}function na(){var V=Me.call(this)||this;V.Y$e=null;V.MOa=new Qf.a;return V}function xa(V,Pa){this.handler=null;this.publisher=V;this.wA=Pa}function Oa(V){var Pa=He.call(this)||
this;Pa.Ioa=!1;Pa.gridView=vf.g(V);Pa.gridView.Hc.Cm(Object(ld.a)(Pa,Pa.ykf,"onCellTextEditStarted"));Pa.gridView.Hc.mt(Object(ld.a)(Pa,Pa.xkf,"onCellTextEditEnded"));Pa.refresh();return Pa}function ib(V){return f.call(this,V)||this}function sb(V){this.$=V}function nb(V,Pa,Ib,wc,nd,Bd){Ib=Kb.call(this,null,Ib,wc)||this;Ib.odf=0;Ib.$=V;Ib.je=Pa;Ib.$_=Bd;Ib.Ihe=lf.a.instance.yc("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper");Ib.showDialog();return Ib}function Gb(V,Pa,Ib,wc,nd,Bd){var yd=
Sd.call(this)||this;yd.ccc=!1;yd.Qua=null;yd.WQ=null;yd.Zxb=null;yd.$n=Bd;yd.$=V;yd.S1e=Pa;yd.blb=Ib;yd.Iya=[];yd.yff=wc;yd.s2g=nd;yd.che=yd.$.Ba.InsertOnlinePictureMaxCountOfImagesToInsert;yd.Mf=yd.NUg();return yd}function Ha(){}function ca(V,Pa){return Ch.call(this,V,ef.a.K$(Pa))||this}function Ra(V,Pa,Ib,wc,nd,Bd,yd){V=ua.call(this,V,Pa,Ib,wc,nd,!1)||this;V.kRd=!1;V.$_=yd;V.aac=Ra.Rqh(Bd);if(Bd=V.KRd(V.aac.name,V.aac.size))return V.tTf(Bd),V.$_.setException(Error.create("DataUrlUploaderWrapper: Invlid data url")),
V.dispose(),V;V.yj=new Ta(V.$.domElement,Object(ld.a)(V,V.JBb,"onUploadFrameInitialized"),Object(ld.a)(V,V.jna,"uploadResponseReceived"),wc,!1,V.$);return V}function ua(V,Pa,Ib,wc,nd,Bd){Bd=void 0===Bd?!0:Bd;Ib=Kb.call(this,null,Ib,wc)||this;Ib.gr=null;Ib.o$=null;Ib.Rwb=!1;Ib.pwd=null;Ib.wb=V;Ib.je=Pa;Ib.uSd=V.Zb.yi("WebServiceCall","InsertPictureOperation");Ib.eXb=Mg.a.instance.create(Object(ld.a)(Ib,Ib.xAi,"onTimeoutReached"),1E5,Eh.a.sFi,!1);Ib.zuc=!1;Ib.Xod=Ib.$.Ba.InsertPictureMaxFileSizeBytes;
nd&&(Ib.Rwb="TestOnly"in nd);Bd&&Ib.showDialog();return Ib}function ta(V,Pa){this.dataUri=this.sheetName=null;this.sheetName=V;this.dataUri=Pa}function db(V,Pa,Ib){var wc=Ia.call(this,V,!1)||this;wc.$T=null;wc.vza=!1;wc.$=Pa;wc.ywc=V;wc.Hu=xd.a.instance;wc.ha=Ib;wc.XPf();wc.DU();wc.$.Db.MJ=!0;return wc}function Ta(V,Pa,Ib,wc,nd,Bd,yd){V=qb.call(this,V,Pa,Ib,wc,nd,"UploadFrame",Bd.fa.sessionId,"image/*",!1,null,void 0===yd?!1:yd)||this;V.$=Bd;V.c4f=!0;qc.EwaSettings.isChangeGateEnabled("OfficeVSO:5329840_InsertPictureOpenFileBrowserDirectly")?
V.H1e():V.bie();return V}function qb(V,Pa,Ib,wc,nd,Bd,yd,re,xe,Re,Tf){xe=void 0===xe?!0:xe;Tf=void 0===Tf?!1:Tf;this.RJe="FileUpload.ashx";this.Rn=null;this._initialized=!1;this.Pg=this.lfb=this.xCc=this.yfa=this.KOb=this.yq=this.es=null;this.ym=!1;this.YR=this.LOb=this.SMc=null;this._parent=V;this.aeg=Pa;this.vig=Ib;this.NZd=nd;this.SKc=yd;this.PTd=re;this.QVd=void 0===Re?null:Re;this.RMc=!1;this.teg=wc.ta("CanaryRenewalForFileUploadIsEnabled");this.c4f=!1;(this.kpa=Tf)||this.URg(Bd);xe&&this.H1e()}
function za(V,Pa,Ib){if(V){var wc=0;do{try{V();break}catch(nd){if(fc.ULS.sendTraceTag(50946190,306,10,"RetryOnException: [Retries: {0}] [Caller: {1}] [Exception: {2}] [Callstack: {3}].",wc,Ib,nd.message,nd.stack),wc>=Pa)break}wc++}while(1)}}function Ia(V,Pa){return Ua.call(this,V,void 0===Pa?!0:Pa)||this}function va(){}function Ua(V,Pa){Pa=void 0===Pa?!0:Pa;var Ib=ub.call(this,!1,!1,Ua.cy)||this;Ib.KUa=null;Ib.kZd=!1;Ib.Xm=[];Ib.yj=null;Ib.MTb=V;Ib.kjg=Pa;Ib.B$d=!1;Ib.ku=!1;Ib.yfa=null;Ib.yCc=!1;
Ib.Mf=Ib.r2g;Ib.We="InsertFileDialog";Ib.Dc(1,Ib.iUb);if(Ua.cy){V={};Pa={};var wc={};Ib.KUa=(wc.id=Ib.We,wc.bodyControls=(Pa.uploadButtonProps=(V.label=CommonUIStrings.l_DialogChooseFile,V.onExecute=Object(ld.a)(Ib,Ib.bBi,"onUploadButtonClick"),V),Pa),wc.uploadStatusLabel=CommonUIStrings.l_DialogNoFileChosen,wc.onFrameReady=Object(ld.a)(Ib,Ib.asi,"onFrameReady"),wc);Ib.initializeAndShow(Ib.titleText,Object(ld.a)(Ib,Ib.Fac,"insertDialogHandler"),Ib.KUa);Ib.lOb=!0}else Ib.showDialog(Ib.titleText,Object(ld.a)(Ib,
Ib.Fac,"insertDialogHandler")),Pa&&Ib.XPf(),(V=Ib.jU(1))&&Ib.Xm.push(V),(V=Ib.jU(0))&&Ib.Xm.push(V),Ib.U2f(),Ib.lOb=!1;return Ib}function Kb(V,Pa,Ib){V=ia.call(this,V,Pa,Ib)||this;V.Ypa=null;V.qRb=null;return V}function ia(V,Pa,Ib){this.yj=this.Oud=null;this.kDa=this.Dpa=0;this.MOb=null;this.XR=V;this.re=Pa;this.yb=Ib;this.KZa=!1;this.kRd=!0;this.OYi();this.U5a=this.ha.ta("NativeFileOpenDialogIsEnabled")}function E(V,Pa){this.filename=V;this.blob=Pa}function fb(V){var Pa=Ee.call(this)||this;Pa.ted=
null;Pa.$=V;Pa.fc();return Pa}function Za(V){var Pa=Bc.call(this)||this;Pa.$=V;Pa.fc();return Pa}function ec(V,Pa){this.ZKe=V;this.mnh=Pa}function zc(V){this.$=V}function Ab(V){var Pa=Cc.call(this)||this;Pa.$=V;Pa.fc();return Pa}function vb(V,Pa,Ib){var wc=ab.call(this)||this;wc.statusBarManager=null;wc.$=V;wc.Jt=Pa;wc.nk=Ib;wc.R2c=!1;wc.wSf=qc.EwaSettings.getBooleanFeatureGate(gg.a.BNa,!1);wc.wSf&&wc.$.ea.ub(29,function(nd){wc.statusBarManager=nd;nd.VF(wc)});return wc}function kc(V){var Pa=Bh.call(this)||
this;Pa.$=V;Pa.Rm=xf.a.instance;Pa.fc();return Pa}function td(V){this.d1b="";this.t1=this.xr=null;this.Zkc=!1;this.gridView=vf.g(V);this.gridView.ga.$F(Object(ld.a)(this,this.hide,"hide"))}function Oc(){}function tc(V,Pa){V=ug.call(this,V)||this;V.Ko=null;V.Nh(Pa);return V}function sc(V){this.qzc=this.AJc=null;this.$=V}function ic(){}function Ga(){}function cb(){}function Tb(){}function Bb(V){this.fYc=this.Hra=null;this.x7a=15;this.$=V}function nc(V,Pa){this.$=V;this.vlb=Pa}function Gc(V,Pa,Ib,wc){V=
Nc.call(this,V)||this;V.isFromCurrentSession=!1;V.top=0;V.left=0;V.isFromCurrentSession=Pa;V.top=Ib;V.left=wc;return V}function La(V,Pa,Ib,wc,nd){nd=void 0===nd?null:nd;var Bd=pb.call(this,V,"ArtCopyPasteHandler")||this;Bd.dMg="XLO";Bd.eMg="3";Bd.gC=V;Bd.JT=new Hb(V);Bd.q9=Pa;Bd.WWa=Ib;Bd.ga=vf.g(V).ga;Bd.hYc=nd||new Ub(Bd.q9);Bd.BEi=new Wa(Ib,V);Bd.vlb=wc;return Bd}function Wa(V,Pa){this.ZEb=new bd.a;this.WWa=V;this.$=Pa;this.XJi=function(Ib){return Promise.resolve(Ib)};this.jBb=function(Ib){return Promise.reject(Ib)}}
function wa(V,Pa,Ib,wc,nd,Bd,yd,re,xe){this.promise=null;this.ribbonCommandInfo=V;this.destination=Pa;this.Dye=Ib;this.uRd=nd;this.L_=Bd;this.item=yd;this.pasteContext=re;this.QLa=Ib||Pa.FirstRow+"_"+Pa.FirstColumn;this.M5e=!0;this.Eqe=xe}function Da(V,Pa,Ib,wc,nd,Bd,yd){this.floatingObjectId=V;this.commandParameters=Pa;this.gr=Ib;this.EZg=wc;this.p3=void 0===Bd?null:Bd;this.uRd=void 0===yd?null:yd;this.ZQg=nd}function Va(V,Pa,Ib,wc){Pa=Mb.call(this,V,Pa,Ib,"AcrossSessionRangeCopyPasteHandler",void 0===
wc?null:wc)||this;Pa.JT=new Hb(V);return Pa}function Jb(V,Pa){Pa=void 0===Pa?null:Pa;var Ib=Wg.call(this,Nf[V])||this;Ib.copyErrorName=0;Ib.ewaErrors=null;Ib.copyErrorName=V;(Ib.ewaErrors=Pa)&&Pa.length&&(Ib.innerError=new ch.a(Pa,null));return Ib}function Hb(V){this.JT=new bh.a(!0);this.$=V}function Mb(V,Pa,Ib,wc,nd){nd=void 0===nd?null:nd;wc=pb.call(this,V,wc)||this;wc.hRg=Pa;wc.q9=Ib;wc.iYc=nd||new Ub(wc.q9);wc.gridView=vf.g(V);wc.ga=wc.gridView.ga;wc.clipboardRangeFactory=V.ea.Ea(169,void 0);
return wc}function Ub(V){this.clipboardItems=this.key=null;this.q9=V}function pb(V,Pa){this._name=Pa;this.$=V;this.Rm=xf.a.instance;this.vs=new dc(V,vf.g(V))}function gb(V){return V.shadowWorkbookSizeExceedsLimit?!0:Qa(V)>Pd.a.Vfc}function Qa(V){return V?V.shadowWorkbookSizeExceedsLimit&&void 0!==V.shadowWorkbookBlockedSize&&null!==V.shadowWorkbookBlockedSize?V.shadowWorkbookBlockedSize:V.shadowWorkbookBase64?V.shadowWorkbookBase64.length:0:0}function eb(){}function xb(V){var Pa={};this.BWf=(Pa["SourceItemType.Range"]=
0,Pa["SourceItemType.Art"]=1,Pa);this.yIb={};Pa={};this.xWf=(Pa["FloatingObjectType.Unknown"]=99,Pa["FloatingObjectType.CardView"]=6,Pa["FloatingObjectType.Chart"]=0,Pa["FloatingObjectType.Group"]=7,Pa["FloatingObjectType.Image"]=1,Pa["FloatingObjectType.Ink"]=8,Pa["FloatingObjectType.InteractiveReport"]=4,Pa["FloatingObjectType.ModernOfficeExtension"]=3,Pa["FloatingObjectType.Shape"]=5,Pa["FloatingObjectType.Slicer"]=2,Pa["FloatingObjectType.Unsupported"]=100,Pa);Pa={};this.pRc=(Pa["99"]="FloatingObjectType.Unknown",
Pa["6"]="FloatingObjectType.CardView",Pa["0"]="FloatingObjectType.Chart",Pa["7"]="FloatingObjectType.Group",Pa["1"]="FloatingObjectType.Image",Pa["8"]="FloatingObjectType.Ink",Pa["4"]="FloatingObjectType.InteractiveReport",Pa["3"]="FloatingObjectType.ModernOfficeExtension",Pa["5"]="FloatingObjectType.Shape",Pa["2"]="FloatingObjectType.Slicer",Pa["100"]="FloatingObjectType.Unsupported",Pa);Pa={};this.AWf=(Pa["RibbonCommand.Copy"]=-911352779,Pa["RibbonCommand.Cut"]=-1985798686,Pa);Pa={};this.sEd=(Pa["-911352779"]=
"RibbonCommand.Copy",Pa["-1985798686"]="RibbonCommand.Cut",Pa);Pa={};this.zWf=(Pa["InputManager.InputMethod.NotDefined"]=-1,Pa["InputManager.InputMethod.Unknown"]=0,Pa["InputManager.InputMethod.Keyboard"]=1,Pa["InputManager.InputMethod.Mouse"]=2,Pa["InputManager.InputMethod.Touch"]=3,Pa["InputManager.InputMethod.CrossSlide"]=9,Pa);this.fja={};Pa={};this.yWf=(Pa["FrameMode.None"]=0,Pa["FrameMode.Reading"]=1,Pa["FrameMode.Edit"]=2,Pa);this.p0a={};Pa={};this.CWf=(Pa["UILocation.Unknown"]=0,Pa["UILocation.UpperRibbon"]=
1,Pa["UILocation.Ribbon"]=2,Pa["UILocation.QAT"]=3,Pa["UILocation.Jewel"]=4,Pa["UILocation.NavigationPane"]=5,Pa["UILocation.KeyboardShortcut"]=6,Pa["UILocation.StatusBar"]=7,Pa["UILocation.Dialog"]=8,Pa["UILocation.Floatie"]=9,Pa["UILocation.NotificationBar"]=10,Pa["UILocation.StandaloneCuiRoot"]=11,Pa["UILocation.TaskPane"]=12,Pa["UILocation.HeroDock"]=13,Pa["UILocation.SingleLineRibbon"]=14,Pa["UILocation.MultilineRibbon"]=15,Pa["UILocation.Overflow"]=16,Pa["UILocation.TellMe"]=17,Pa["UILocation.FarPeripheralControls"]=
18,Pa["UILocation.ContextMenu"]=19,Pa["UILocation.DialogMenu"]=20,Pa["UILocation.Header"]=21,Pa["UILocation.FileMenu"]=22,Pa["UILocation.Toolbar"]=26,Pa["UILocation.Canvas"]=30,Pa);this.lr={};this.$=V;this.fja.notDefined="InputManager.InputMethod.NotDefined";this.fja.unknown="InputManager.InputMethod.Unknown";this.fja.keyboard="InputManager.InputMethod.Keyboard";this.fja.mouse="InputManager.InputMethod.Mouse";this.fja.touch="InputManager.InputMethod.Touch";this.fja.crossSlide="InputManager.InputMethod.CrossSlide";
this.p0a.none="FrameMode.None";this.p0a.reading="FrameMode.Reading";this.p0a.edit="FrameMode.Edit";this.lr.unknown="UILocation.Unknown";this.lr.upperRibbon="UILocation.UpperRibbon";this.lr.ribbon="UILocation.Ribbon";this.lr.QAT="UILocation.QAT";this.lr.jewel="UILocation.Jewel";this.lr.navigationPane="UILocation.NavigationPane";this.lr.keyboardShortcut="UILocation.KeyboardShortcut";this.lr.statusBar="UILocation.StatusBar";this.lr.dialog="UILocation.Dialog";this.lr.floatie="UILocation.Floatie";this.lr.notificationBar=
"UILocation.NotificationBar";this.lr.standaloneCuiRoot="UILocation.StandaloneCuiRoot";this.lr.taskPane="UILocation.TaskPane";this.lr.heroDock="UILocation.HeroDock";this.lr.singleLineRibbon="UILocation.SingleLineRibbon";this.lr.multilineRibbon="UILocation.MultilineRibbon";this.lr.overflow="UILocation.Overflow";this.lr.tellMe="UILocation.TellMe";this.lr.farPeripheralControls="UILocation.FarPeripheralControls";this.lr.header="UILocation.Header";this.lr.fileMenu="UILocation.FileMenu";this.lr.contextMenu=
"UILocation.ContextMenu";this.lr.dialogMenu="UILocation.DialogMenu";this.lr.toolbar="UILocation.Toolbar";this.lr.canvas="UILocation.Canvas";this.yIb.range="SourceItemType.Range";this.yIb.art="SourceItemType.Art"}function dc(V,Pa){this.sbc=qc.EwaSettings.getBooleanFeatureGate(gg.a.M0b,!1);this.FKa=qc.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CopyPasteWFEIncreasedLimits",!1);this.$=V;this.gridView=Pa}function Nc(V){this.pasteParameters=null;this.pasteParameters=V}function Pc(V,Pa){this.content=
this.destinationRange=null;this.destinationRange=V;this.content=Pa}function Fd(V,Pa,Ib){this.destinationRange=this.sourceRange=null;this.pasteFlags=0;this.sourceRange=V;this.destinationRange=Pa;this.pasteFlags=Ib}function Ea(V,Pa,Ib,wc,nd,Bd,yd,re){re=void 0===re?null:re;yd=V.Ra(1,void 0===yd?null:yd);yd.pasteParameters=Pa;return bf.i(V,"Paste",yd,Ib,wc,nd,Bd,64,re)}function Xa(V,Pa,Ib,wc,nd,Bd,yd,re){re=void 0===re?null:re;yd=V.Ra(1,void 0===yd?null:yd);yd.copyParameters=Pa;return bf.i(V,"Copy",
yd,Ib,wc,nd,Bd,0,re)}function hc(V,Pa,Ib,wc,nd,Bd,yd,re,xe){xe=void 0===xe?null:xe;re=V.Ra(9,re);re.destinationRange=Pa;re.source=Ib;return bf.i(V,"PasteString",re,wc,nd,Bd,yd,64,xe)}function Xb(V,Pa,Ib,wc,nd,Bd,yd,re){re=void 0===re?null:re;yd=V.Ra(1,yd);yd.pasteHtmlParameters=Pa;return bf.i(V,"PasteHtmlContent",yd,Ib,wc,nd,Bd,64,re)}function Ic(){this.qYa=this.Hqe=null}function Qc(V,Pa,Ib,wc,nd,Bd,yd,re,xe){xe=void 0===xe?null:xe;var Re=Db.call(this)||this;Re.pasteShortcutManager=null;Re.z3e=qc.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.ClearCopyPasteAntsOnStartEditAsync",
!1)&&qc.EwaSettings.YG();Re.FKa=qc.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CopyPasteWFEIncreasedLimits",!1);Re.LYf=null;Re.s4a=!1;Re.i3e=qc.EwaSettings.isChangeGateEnabled("OfficeVSO:5747219_BlockModifyingProtectedRangeOnProtectedSheet");Re.$=V;Re.Fi=Ib;Re.gridView=vf.g(V);Re.vs=nd;Re.gXh=Bd;Re.TJ=Pa;Re.V_b=wc;Re.getStringifiedError=xe?xe:copyPasteInfra.getStringifiedError;Re.uSf=1===re;Re.Xj();Re.copyPasteShortcutDialogFactory=Re.$.ea.Ea(85,void 0);fc.ULS.shipAssertTag(24388233,
0,!!Re.copyPasteShortcutDialogFactory,"CopyPasteInfrastructure.ctor: this.copyPasteShortcutDialogFactory shouldn't be null.");yd||(fc.ULS.sendTraceTag(37033877,0,50,"CopyPasteInfrastructure.ctor: userId is null, using default userId."),yd=Qc.u0g);Re.userHash=Yg.a.Dv(yd);Re.Ihi="CultureTag: "+xf.a.instance.Yob+" HASH: ";Re.TJ.addMetadataChangeListener(Qc.Rff,Object(ld.a)(Re,Re.Qtd,"onMetadataChanged"));Re.Zod=Re.$.Ba.MaxCopyPasteLength;Re.WLa=Re.FKa?qc.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.CopyPasteHtmlImportMaxLength",
Re.$.Ba.CopyPasteMaxPayloadLength):Pd.a.WLa;Re.jo=qc.EwaSettings.getBooleanFeatureGate(gg.a.BNa,!1);Re.jo&&V.ea.ub(478,function(Tf){Re.pasteShortcutManager=Tf});Re.z3e&&(Re.LYf=Td.a(function(){Re.Ysf()},1,Re.$.ma,"CopyPasteInfrastructure.OnStartEditInternal",!0));return Re}function Cb(V){if(!V)return"null";var Pa=[];V=Ml(V.get());for(var Ib=V.next();!Ib.done;Ib=V.next())Ib=Ib.value,Ib=String.format("{0}({1})",Ib.clipboardDataFormat,Ib.data.length),Array.add(Pa,Ib);Pa.sort();return Pa.join(",")}function $c(V){switch(V){case 0:return"None";
case 2:return"Art";case 1:return"Range";default:return"Unknown"}}function ae(V,Pa){return V?Pa&&Pa.Ba?V.sessionId!==Pa.Ba.UserSessionId:(fc.ULS.shipAssertTag(40162717,0,!1,"ewaControl shouldn't be null"),!1):(fc.ULS.shipAssertTag(40162716,0,!1,"copyContext shouldn't be null"),!1)}function Mc(){}function Hd(){}function Nd(){}function ge(V,Pa,Ib,wc){this.$=V;this.originalDestinations=Pa;this.R4c=Ib;this.e9f=wc;this.cig=this.originalDestinations;this.rfg="PasteRecoveryUI"}function Ed(V){this.parameters=
null;this.parameters=V}function Zc(V){return V&&(V=V.getCachedMetadata())&&V.lastCopy?V.lastCopy:null}function he(V){return V.clipboardItems&&(V=V.clipboardItems.getItem(Pb.L_h),!Uf.a.na(V)&&"1"===V)?!0:!1}function Ke(V){return Ue(V)&&!(void 0===V.clipboardItems||null===V.clipboardItems)&&!!V.clipboardItems.getItem(Pb.png)&&Uf.a.na(V.clipboardItems.getItem(Pb.zV))}function Ue(V){return V.clipboardItems&&(V=V.clipboardItems.getItem(Pb.X2h),!Uf.a.na(V)&&"1"===V)?!0:!1}function Pb(){}function kb(){}
function yb(V){return!!V&&Object.getType(V)===Ma}function Ma(V,Pa,Ib,wc,nd){wc=Zd.call(this,wc,nd)||this;fc.ULS.shipAssertTag(595185880,0,!!Pa&&0<Pa.length,"RangeSourceItem.ctor: ranges should not be null or empty");wc.$=V;wc.ranges=Pa;wc.sheetName=Ib;return wc}function jd(V,Pa,Ib,wc,nd){Ib=Zd.call(this,Ib,wc)||this;Ib.activeFloatingObjectControlId=V;Ib.sheetName=Pa;Ib.type=nd;return Ib}function Zd(V,Pa){this.sessionStateId=V;this.sessionId=Pa;this.toJSON=Object(ld.a)(this,this.Fqh,"generateCustomJsonForLogging")}
function Zb(V,Pa,Ib,wc,nd){var Bd=V.Stopwatch,yd={};yd.a=nd;yd.e=Bd.id;yd.c="RearrangeRowColumn";yd.b="mouse";yd.d=V.OperationId.toString();yd.f=Ib.toString();yd.g=wc.toString();yd.h=Pa.toString();yd.i=V.DragDropIsShiftKeyDown;yd.j=!0;yd.o=Bd.Gc;yd.q=!1;yd.r=V.CopyPasteTargetType.toString();yd.s=V.EncounteredDeploymentErrors;return yd}function wb(V){V=Se.call(this,V)||this;fc.ULS.sendTraceTag(539760657,0,50,"ClipboardReadPermissionAskDialog.ClipboardReadPermissionAskDialog");V.lc=0;V.Dc(1,xf.a.instance.da(2146));
var Pa=xf.a.instance.da(2144),Ib=V.J3();V.initializeAndShow(Pa,Object(ld.a)(V,V.cMg,"clipboardReadPermissionAskDialogHandler"),Ib);return V}function gc(){this.pb=null}function uc(){this.rfb=this.ROb=this.Gw=null}function id(V,Pa,Ib,wc,nd){this.Gw=V;this.Dfb=Pa;this.zfb=Ib;this.A6d=void 0===wc?null:wc;this.Nhb=void 0===nd?null:nd}function Wc(){this.pb=null}function pd(V){this.hc=V}function Yd(){this.hae=0;this.lUa=Array(5);this.lUa[0]=10;this.lUa[1]=15;this.lUa[2]=50;this.lUa[3]=100;this.lUa[4]=200}
function be(V,Pa,Ib,wc,nd){this.l6b=!1;this.hpb=null;this.Oa=V;this.yVa=Pa;this.ZRb=Ib;this.A0=wc;this.izc=nd}function me(){this.LDf=this.zIf=this.bYf=this.yec=this.instance=null}function Gd(V,Pa,Ib){this.Oa=V;this.Me=Pa;this.pPb=Ib}function Rd(){this.completed=this.sRi=!1}function Yf(){this.H9d=this.e4d=this.RUd=!0;this.SWi=this.QFi=null;this.oji=!1;this.locale=null;this.E0f={}}function mg(){}function zf(){this.wRb=this.QOb=null}function Ce(){this.pb=null}function ne(V,Pa){if(void 0===V||null===
V||void 0===Pa||null===Pa)throw Error.argumentNull("appSettingsManager/clientRequestManager");this.yb=V;this.Ug=Pa;this.VKc=this.ze=null}function Bf(){this.EAe=this.l4f=this.ut=0;this.FAe=this.m4f=this.QFa="";this.DLc=this.Ada=2}function Le(V,Pa){this.pAc=0;this.MZb=null;this.Sfb=new Ae(V,Pa);this.yb=V;Pa=V.Wa("HostAuthType");this.PCa=V.ta("OcpsIsEnabled")&&V.ta("IsO365CommercialHost")&&!(void 0===Pa||null===Pa)&&"aad"===Pa.toLowerCase();this.b5d=vd.b(V.Wa("OcpsDefaultSettings")||"{}");this.Jgb=this.e8b();
Pa=this.yb.xy("ServicesControlsMicrosoftControllerServicesList")?this.yb.zx("ServicesControlsMicrosoftControllerServicesList")||[]:[];this.JNb=new Xd.a;for(var Ib=0;Ib<Pa.length;Ib++)this.JNb.add(Pa[Ib]);this.PCa&&!V.ta("IsAnonymousUser")&&V.ta("SideCarIsEnabled")?this.MZb=this.Osj():this.MZb=this.Yma(this.PCa,this.Pta("/afhs/CloudPolicySettings.ashx"),Object(ld.a)(this,this.XDi,"parseCloudPolicySettingsResponse"));this.MZb.then(function(){return null}).catch(function(wc){fc.ULS.sendTraceTag(50622685,
3004,10,JSON.stringify(wc))})}function gd(){this.ControllerConnectedServicesFeatureNames=this.PolicySettings=null}function $b(){}function Fc(V,Pa){this.PolicySettings=null;this.ExpirationTime=0;this.PolicySettings=V.PolicySettings;V=new Date;V.setMinutes(V.getMinutes()+Pa);this.ExpirationTime=V.getTime()}function Vc(V,Pa,Ib,wc,nd){var Bd=this;Ib=void 0===Ib?null:Ib;wc=void 0===wc?null:wc;nd=void 0===nd?null:nd;this.dta=this.bSb=this.F7d=this.Soa=this.eTb=null;this.Sfb=new Ae(V,Pa);this.yb=V;this.wfg=
V.qd("LicensingMaxRetryAttempts",0);this.uFc=V.ta("IsO365ConsumerHost");this.tFc=V.ta("IsO365CommercialHost");this.HPb=V.ta("PremiumUpsellIsEnabled");this.nWd=Ib;this.Nae=wc;this.Oa=nd;this.Roa=V.ta("LicensingIsEnabled");this.PCa=V.ta("OcpsIsEnabled")&&this.tFc;this.XMc=V.ta("ShowPrivacyDialog")&&!!wc;this.u0d=V.ta("IsAnonymousUser");this.d5c=new Promise(function(yd){yd(!1)});this.Rza=new Promise(function(yd){yd(!0)});this.cta=new Uc.a(Vd.a.Dl());this.RTb=this.yb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.SupportUserConsentBasedFeaturesInAFH",
!1);this.S2d=this.lCh();this.Oid()&&!this.u0d?(void 0!==hb.AFrameworkApplication.za&&null!==hb.AFrameworkApplication.za&&(this.eTb=hb.AFrameworkApplication.za.bB,void 0!==this.eTb&&null!==this.eTb&&(this.Soa=this.eTb.yi("WebServiceCall","ApplicationFeatureHelperService"))),this.dta=this.lPd()):this.dta=new Promise(function(yd){yd({})});this.dta.catch(function(yd){fc.ULS.sendTraceTag(42513088,3004,10,JSON.stringify(yd))});this.RTb&&(this.HPb=!1,this.isFeatureEnabled("FreemiumUpsell",!0).then(function(yd){Bd.HPb=
Bd.yb.ta("PremiumUpsellIsEnabled")&&yd;return null}))}function ud(V,Pa,Ib){this.featureName=null;this.isEnabled=!1;this.tierName=0;this.featureName=V;this.isEnabled=Pa;this.tierName=Ib}function Ge(V,Pa){this.vqj=3E5;if(void 0===V||null===V||void 0===Pa||null===Pa)throw Error.argumentNull("appSettingsManager/clientRequestManager");this.yb=V;this.JMb=new Uc.a(Vd.a.Dl());this.Sfb=new Ae(V,Pa);void 0!==xc.a.Wnd&&null!==xc.a.Wnd&&void 0!==xc.a.vfc&&null!==xc.a.vfc&&0<xc.a.vfc&&(V=new ce,V.Token=xc.a.Wnd,
V.ExpirationTime=xc.a.vfc,this.JMb.ja("loki",V))}function ce(){this.Token=null;this.ExpirationTime=0}function Ae(V,Pa){this.yb=V;this.Ug=Pa}function Ob(){this.message=null;this.Q$b=0}b.r(F);var ac=b(0),fc=b(15),Uc=b(797),Vd=b(786),ld=b(37),Od=b(82),De;(function(V){V[V.applicationFeatureHelperHandler=0]="applicationFeatureHelperHandler";V[V.cloudPolicySettings=1]="cloudPolicySettings";V[V.alternateAuthToken=2]="alternateAuthToken"})(De||(De={}));Object(ac.b)("ApplicationFeatureHelperRequestType",De);
Object(ac.a)(Ob,"HttpRequstToPromiseRejectData",null,[]);var Yb=b(93),sa=b(228);Ae.prototype.hZc=function(V,Pa,Ib,wc,nd,Bd,yd,re){var xe=this;wc=void 0===wc?null:wc;nd=void 0===nd?null:nd;Bd=void 0===Bd?null:Bd;yd=void 0===yd?null:yd;re=void 0===re?null:re;var Re=De[Ib],Tf=Re+"RequestFailure";Yb.Health.instance.recordKpiUsage(Tf,0,"jpittsdirects",null);return new Promise(function(ag,Qg){fc.ULS.sendTraceTag(50622688,3004,50,"HttpRequestToPromiseUtility.CreateHttpResponsePromise: Initializing HttpRequest {0}.",
Re);var Rg=null!=yd?yd:xe.yb.qd("ApplicationFeatureHelperRequestQueueTimeout",15E3),Hh=null!=re?re:xe.yb.qd("ApplicationFeatureHelperRequestSentTimeout",3E4);xe.Ug.J8(V,1,null,xe.TAh(Ib,wc),Bd,!1,1,function(Fg){fc.ULS.sendTraceTag(50622689,3004,50,"HttpRequestToPromiseUtility.CreateHttpResponsePromise: HttpRequest {0} Succeeded.",Re);try{if(void 0===Fg||null===Fg||void 0===Fg.data||null===Fg.data||void 0===Fg.data.pe||null===Fg.data.pe){Yb.Health.instance.recordKpiFailure(Tf,"Invalid RequestSucceededEventArgs",
!1,!0,null);var Xg=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: args or args.Data or args.Data.ResponseData is null or undefined request {0}",Re);Qg(xe.Usb(Xg,Fg))}else if(Fg.data.httpStatus!==sa.a.bO){Yb.Health.instance.recordKpiFailure(Tf,"HttpStatusCode_"+Fg.data.httpStatus.toString(),!1,!0,null);var cg=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: ApplicationFeatureHelper Service token generation returned unexpected response code {0}, request {1}",
Fg.data.httpStatus,Re);Qg(xe.Usb(cg,Fg))}else{void 0!==nd&&null!==nd&&void 0!==Fg.data.responseHeaders&&null!==Fg.data.responseHeaders&&nd(Fg.data.responseHeaders);var Mh=Pa(Fg.data.pe);if(Mh)fc.ULS.sendTraceTag(50622690,3004,50,"HttpRequestToPromiseUtility.CreateHttpResponsePromise: Successfully parsed response for request {0}",Re),ag(Mh);else{Yb.Health.instance.recordKpiFailure(Tf,"Parse Failure",!1,!0,null);var Nh=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: Failed to parse response for request {0}",
Re);Qg(xe.Usb(Nh,Fg))}}}catch(zd){Yb.Health.instance.recordKpiFailure(Tf,"Unexpected Failure",!1,!0,null),Xg=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: Exception {0} for request {1}",zd,Re),Qg(xe.Usb(Xg,Fg))}},function(Fg){fc.ULS.sendTraceTag(50622691,3004,10,"HttpRequestToPromiseUtility.CreateHttpResponsePromise: HttpRequest {0} failed.",Re);if(Fg.data){Yb.Health.instance.recordKpiFailure(Tf,"HttpStatusCode_"+Fg.data.httpStatus.toString(),!1,!0,null);var Xg=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: Request Failed: HttpStatus - {0}, ResponseData - {1} for Request - {2}",
Fg.data.httpStatus,Fg.data.pe||"No Data",Re)}else Yb.Health.instance.recordKpiFailure(Tf,"Invalid RequestFailedEventArgs",!1,!0,null),Xg=String.format("HttpRequestToPromiseUtility.CreateHttpResponsePromise: args or args.Data is null or undefined for request {0}",Re);Qg(xe.Usb(Xg,Fg))},null,void 0,void 0,Rg,Hh)})};Ae.prototype.Usb=function(V,Pa){var Ib=new Ob;Ib.message=V;Ib.Q$b=Pa&&Pa.data?Pa.data.httpStatus:-1;return Ib};Ae.prototype.TAh=function(V,Pa){var Ib={};Ib["x-UserDataSignature"]=this.yb.Wa("UserDataSignature");
Ib["x-LicensingIsEnabled"]=this.yb.ta("LicensingIsEnabled").toString();Ib["x-CacheIsEnabled"]=this.yb.ta("LicensingRedisIsEnabled").toString();Ib["x-OcpsIsEnabled"]=this.yb.ta("OcpsIsEnabled").toString();Ib["x-LicensingAADIdIsEnabled"]=this.yb.ta("LicensingAadIdIsEnabled").toString();V||(Ib["x-LicenseCheckOnTenantEnabled"]=this.yb.ta("LicensingForSafeLinksIsEnabled").toString(),Ib["x-SupportUserConsentDependentFeatures"]=this.yb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.SupportUserConsentBasedFeaturesInAFH",
!1).toString(),Ib["x-AFHUserConsentGroupValue"]=this.yb.getIntFeatureGate("Microsoft.Office.SharedOnline.AFHUserConsentGroupValue",0).toString(),Ib["x-UseShellServiceForUserConsentGroup"]=this.yb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.UseShellServiceForUserConsentGroup",!1).toString(),Ib["x-UseSALForLicensing"]=this.yb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.UseSALForLicensingAFHS",!1).toString(),Ib["x-SMBUserLicensingEnabled"]=this.yb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.SMBUserLicensingEnabled",
!1).toString());if(Pa){V=Ml(Pa.keys);for(var wc=V.next();!wc.done;wc=V.next())wc=wc.value,Ib[wc]=Pa.oa(wc)}return Ib};Object(ac.a)(Ae,"HttpRequestToPromiseUtility",null,[]);var hb=b(5),cc;(function(V){V[V.loki=0]="loki";V[V.augloopACLP=1]="augloopACLP"})(cc||(cc={}));Object(ac.b)("AlternateAuthSupportApp",cc);var xc=b(839),vd=b(41);Object(ac.a)(ce,"WacAlternateAuthToken",null,[]);Ge.prototype.xth=function(){var V=null;this.JMb.tb(cc[0])&&(V=this.JMb.oa(cc[0]));return void 0===V||null===V||this.Akd(V)?
this.Akh():Promise.resolve(V.Token)};Ge.prototype.Akd=function(V){return V.ExpirationTime-Date.now()<this.vqj};Ge.prototype.Akh=function(){var V=this,Pa=new Uc.a(Vd.a.Dl());Pa.ja("X-AlternateAuthApp",cc[0]);return this.Sfb.hZc(this.Pta("/afhs/AlternateAuthHelperHandler.ashx"),Object(ld.a)(this,this.TDi,"parseAlternateAuthTokenResponse"),2,Pa).then(function(Ib){fc.ULS.sendTraceTag(545821456,3004,50,"AlternateAuthHelper:FetchNewUserDataSignatureToken: Retrieved WacAlternateAuthToken for {0}",cc[0]);
V.JMb.ja(cc[0],Ib);return Ib.Token},function(Ib){Ib=Object(Od.a)(Ob,Ib);fc.ULS.sendTraceTag(545604827,3004,10,"AlternateAuthHelper:FetchNewUserDataSignatureToken: Error: {0}, status code: {1}",Ib.message,Ib.Q$b);return null})};Ge.prototype.TDi=function(V){var Pa=vd.d(V).xu;fc.ULS.sendTraceTag(545821457,3004,Pa?50:10,"ParseAlternateAuthTokenResponse: fetched WacAlternateAuthToken from {0}",V);return Pa};Ge.prototype.Pta=function(V){return String.format("{0}{1}?{2}",this.yb.Wa("WebServiceBase"),V,hb.AFrameworkApplication.hj)};
Object(ac.a)(Ge,"AlternateAuthHelper",null,[200]);var Xd=b(403);Object(ac.a)(ud,"FeatureStateChangeArgs",null,[]);var Je=b(277),ff=b(24),Ye=b(113),Pe=b(194),wf;(function(V){V[V.Enabled=0]="Enabled";V[V.Disabled=1]="Disabled"})(wf||(wf={}));Object(ac.b)("FeatureState",wf);var lf=b(88),kg=b(29),Bg=b(176);Vc.prototype.lCh=function(){for(var V=this.yb.xy("AllLicensedFeatures")?this.yb.zx("AllLicensedFeatures"):[],Pa=new Xd.a,Ib=0;Ib<V.length;Ib++)Pa.add(V[Ib]);return Pa};Vc.prototype.Oid=function(){return this.tFc||
this.uFc};Vc.prototype.lPd=function(V,Pa){var Ib=this;V=void 0===V?0:V;Pa=void 0===Pa?!1:Pa;fc.ULS.sendTraceTag(51185368,3004,50,"ApplicationFeatureHelper_TryInitializeLicensing: forceRefresh = {0}",Pa);var wc=this.UYc();wc&&(wc.set("retryAttempt",V.toString()),wc.set("forceRefresh",Pa.toString()),wc.set("isO365ConsumerHost",this.uFc.toString()),wc.set("isO365CommercialHost",this.tFc.toString()),wc.set("isFreemiumUpsellEnabled",this.HPb.toString()));Yb.Health.instance.recordKpiUsageForAlertableKpi("AFHSLicensingFailedRequest",
"waclicensing",wc);Yb.Health.instance.recordKpiUsage("AFHSLicensingSuccessfulRequest",1,"waclicensing",wc);void 0!==this.Soa&&null!==this.Soa&&this.Soa.start();var nd=null;Pa&&(nd=new Uc.a(Vd.a.Dl()),nd.ja("x-LicensingForceRefresh","true"));this.F7d=new Date;return(this.Roa?this.Sfb.hZc(this.Pta("/afhs/ApplicationFeatureHelperHandler.ashx"),Object(ld.a)(this,this.WDi,"parseApplicationFeatureHelperResponse"),0,nd,Object(ld.a)(this,this.ZIi,"processApplicationFeatureHelperResponseHeaders"),["Date"]):
Promise.resolve({})).then(function(Bd){var yd=Object.assign(new Bg.a,{durationMs:Ib.WVf()});yd.extendedProperties=wc;yd.extendedProperties&&Bd&&(yd.extendedProperties.set("featureCount",Ye.a.count(Bd).toString()),yd.extendedProperties.set("licensingTestFeatureEnabled",("LicensingTestFeature"in Bd).toString()),yd.extendedProperties.set("msoPremiumBadgeEnabled",("MsoPremiumBadge"in Bd).toString()),Ib.bSb&&yd.extendedProperties.set("fromCache",(Ib.bSb<Ib.F7d).toString()));Yb.Health.instance.recordKpiSuccess("AFHSLicensingSuccessfulRequest",
yd);return Bd},function(Bd){var yd=Object.assign(new Bg.a,{durationMs:Ib.WVf()}),re=Object(Od.a)(Ob,Bd);if(!re)return fc.ULS.sendTraceTag(51491471,3004,10,"ApplicationFeatureHelper_TryInitializeLicensing: Invalid cast to HttpRequestToPromiseRejectData"),Yb.Health.instance.recordKpiFailure("AFHSLicensingFailedRequest","InvalidCastToHttpRequestToPromiseRejectData",!1,!0,yd),new Promise(function(xe,Re){Re(Bd)});yd.extendedProperties=wc;yd.extendedProperties&&yd.extendedProperties.set("status",re.Q$b.toString());
Yb.Health.instance.recordKpiFailure("AFHSLicensingFailedRequest","RequestFailed",!1,!0,yd);return 408===re.Q$b&&++V<=Ib.wfg?Ib.lPd(V):new Promise(function(xe,Re){Re(re)})})};Vc.prototype.WDi=function(V){(V=vd.b(V))?(fc.ULS.sendTraceTag(50436170,3004,50,"ParseApplicationFeatureHelperResponse: Successfully fetched features"),fc.ULS.sendTraceTag(50938594,3004,50,"{0}",V)):fc.ULS.sendTraceTag(50436171,3004,10,"ParseApplicationFeatureHelperResponse: ApplicationFeatureHelper Service returned a null feature set");
return V.Features};Vc.prototype.Pta=function(V){var Pa=String.format("{0}{1}",this.yb.Wa("WebServiceBase"),V);this.yb.xy("ApplicationFeatureHelperHttpCachingEnabled")&&this.yb.ta("ApplicationFeatureHelperHttpCachingEnabled")&&(V=Vc.e8b(this.yb))&&0<V.length&&(this.RTb&&(V+="ucbf"),Pa=new Je.QueryStringBuilder(Pa),Pa.Ym("afhskey",V),Pa=Pa.toString());return Pa};Vc.prototype.isFeatureEnabled=function(V,Pa){var Ib=this;if(!this.PCa&&!this.XMc&&!this.Roa)return this.Rza;fc.ULS.sendTraceTag(42513091,3004,
50,"ApplicationFeatureHelper.IsFeatureEnabled: Call made to check if feature: {0} is enabled.",V);if("ConnectedServices"===V){var wc=this.PCa?this.nWd.mJ("ControllerConnectedServicesEnabled"):this.Rza,nd=this.XMc?this.Nae.getSettings().then(function(re){return 2!==re.ut},function(){return Pa}):this.Rza;return wc.then(function(re){return re?nd:Ib.d5c})}wc=null;wc=this.PCa?this.nWd.isFeatureEnabled(V):this.Rza;var Bd=null;Bd=this.Roa?this.l1h(V,Pa):this.Rza;var yd=null;yd=this.XMc?this.Nae.isFeatureEnabled(V):
this.Rza;return wc.then(function(re){return re?yd.then(function(xe){return xe?Bd:Ib.d5c}):Ib.d5c}).then(function(re){Ib.kcf(V,re);return re},function(re){Ib.kcf(V,Pa,re);return Pa})};Vc.prototype.kcf=function(V,Pa,Ib){Ib=void 0===Ib?null:Ib;var wc=this.UYc();wc&&(wc.set("FeatureName",V),wc.set("IsEnabled",Pa.toString()));Ib?(V=Object.assign(new Bg.a,{extendedProperties:wc}),Yb.Health.instance.recordKpiFailure("AFHFeatureStatus","CanNotDetermineFeatureStatus",!1,!0,V)):Yb.Health.instance.recordKpiUsage("AFHFeatureStatus",
0,"jpittsdirects",wc)};Vc.prototype.getFeatureTier=function(V,Pa){var Ib=this;if(!this.Roa)return new Promise(function(wc){wc(2)});fc.ULS.sendTraceTag(42804871,3004,50,"ApplicationFeatureHelper.GetFeatureTier: Call made to get Feature's Tier.",V);return this.dta.then(function(wc){return Ib.X8b(V,wc,Pa)},function(){return Pa})};Vc.prototype.isFreemiumUpsellEnabled=function(){return this.HPb&&this.uFc&&!this.u0d};Vc.prototype.launchUpsellExperience=function(V,Pa){Pa=void 0===Pa?null:Pa;fc.ULS.sendTraceTag(594564814,
3004,50,String.format("ApplicationFeatureHelper_LaunchUpsellExperience: Launching upsell experience for experienceId: {0}",V));var Ib=this.UYc();Ib&&(Ib.set("experienceId",V),Pa&&Ib.set("campaignId",Pa));Yb.Health.instance.recordKpiUsage("AFHCLaunchUpsellSuccess",1,"waclicensing",Ib);if(Ib=lf.a.instance.Uh("Common.IInProductMessagingUIManager")){var wc=Object(ld.a)(this,this.XMh,"handleDimeTaskComplete");Ib.saf(V,wc,Pa)}else fc.ULS.sendTraceTag(594367561,3004,15,"InProductMessaging was not initialized"),
Yb.Health.instance.recordKpiFailure("AFHCLaunchUpsellSuccess","InProductMessagingNotInitialized",!1,!0,null),Pa={},this.Oa.Pe(kg.a.m6b,2,(Pa.experience=V,Pa))};Vc.prototype.$Na=function(V,Pa){if(!this.Roa)return null;if(!V||!Pa)return fc.ULS.sendTraceTag(594564813,3004,10,"ApplicationFeatureHelper_RegisterFeatureStateChangeCallback: Invalid input."),null;var Ib=Pe.a.create().toString();this.cta.tb(V)||this.cta.ja(V,new Uc.a(Vd.a.Dl()));this.cta.oa(V).add(Ib,Pa);fc.ULS.sendTraceTag(594564812,3004,
50,String.format("ApplicationFeatureHelper_RegisterFeatureStateChangeCallback: registered callback {0} for feature {1}",Ib,V));return Ib};Vc.prototype.lBd=function(V,Pa){this.Roa&&(V&&this.cta.tb(V)?Pa&&Pe.a.isValid(Pa)?this.cta.oa(V).tb(Pa)?(fc.ULS.sendTraceTag(594564808,3004,50,String.format("ApplicationFeatureHelper_RemoveFeatureStateChangeCallback: Removing callback {0} for feature {1}",Pa,V)),this.cta.oa(V).remove(Pa)):fc.ULS.sendTraceTag(594564809,3004,15,String.format("ApplicationFeatureHelper_RemoveFeatureStateChangeCallback: callbackId {0} not registered for feature {1} ",
Pa,V)):fc.ULS.sendTraceTag(594564810,3004,10,String.format("ApplicationFeatureHelper_RemoveFeatureStateChangeCallback: invalid callbackId {0} for feature {1}",Pa,V)):fc.ULS.sendTraceTag(594564811,3004,10,String.format("ApplicationFeatureHelper_RemoveFeatureStateChangeCallback: invalid or non registered featureName {0}",V)))};Vc.prototype.X8b=function(V,Pa,Ib){return this.RTb?V in Pa?Pa[V].LicenseTier:Ib:V in Pa?this.sEi(Pa[V],Ib):Ib};Vc.prototype.sEi=function(V,Pa){switch(V.toLowerCase()){case "unknown":return 0;
case "basic":return 1;case "premium":return 2;default:return Pa}};Vc.prototype.XMh=function(){var V=this;fc.ULS.sendTraceTag(594367560,3004,50,"ApplicationFeatureHelper_HandleDimeTaskComplete");this.dta.then(function(Pa){V.SCf(Pa)}).catch(function(){V.SCf({})})};Vc.prototype.SCf=function(V){var Pa=this;fc.ULS.sendTraceTag(594051087,3004,50,"ApplicationFeatureHelper_RefreshLicensingAndNotifyUpdatedFeatures");var Ib=this.lPd(0,!0);Ib.then(function(wc){Pa.dta=Ib;Ye.a.count(wc)>Ye.a.count(V)?Yb.Health.instance.recordKpiSuccess("AFHCLaunchUpsellSuccess",
null):Yb.Health.instance.recordKpiFailure("AFHCLaunchUpsellSuccess","FeatureCountNotIncreased",!1,!0,null);for(var nd=Ml(Pa.cta.keys),Bd=nd.next();!Bd.done;Bd=nd.next())if(Bd=Bd.value,Bd in wc){var yd=Pa.X8b(Bd,wc,0);Bd in V?Pa.X8b(Bd,V,0)!==yd&&Pa.wrd(Bd,!0,yd):Pa.wrd(Bd,!0,yd)}else Bd in V&&Pa.wrd(Bd,!1,Pa.X8b(Bd,V,0))}).catch(function(wc){Yb.Health.instance.recordKpiFailure("AFHCLaunchUpsellSuccess","LicensingRefreshFailed",!1,!0,null);fc.ULS.sendTraceTag(594051086,3004,10,JSON.stringify(wc))})};
Vc.prototype.wrd=function(V,Pa,Ib){fc.ULS.sendTraceTag(594051085,3004,50,"ApplicationFeatureHelper_NotifyFeatureStateChanged: Notify feature state changed callbacks for feature {0}, {1}, {2}",V,Pa,Ib);Pa=new ud(V,Pa,Ib);Ib=this.cta.oa(V);Ib=Ml(Ib);for(var wc=Ib.next();!wc.done;wc=Ib.next()){wc=wc.value;try{wc.value(Pa)}catch(nd){fc.ULS.sendTraceTag(594051084,3004,10,String.format("ApplicationFeatureHelper_NotifyFeatureStateChanged: Exception when calling registered callback: feature: {0} callbackId: {1}, exception {2}",
V,wc.key,nd.message))}}};Vc.prototype.Ke=function(V,Pa){var Ib=this;if(this.Roa){var wc=this.S2d.contains(V),nd=!0,Bd="",yd=!1;return this.dta.then(function(re){V in re?(re=re[V],Bd=wf[re.FeatureState],nd=1!==re.FeatureState):nd=!wc;Ib.rcf(V,wc,Bd,yd,Pa,nd);return nd},function(){yd=!0;wc&&(nd=Pa);Ib.rcf(V,wc,Bd,yd,Pa,nd);return nd})}return this.Rza};Vc.prototype.rcf=function(V,Pa,Ib,wc,nd,Bd){fc.ULS.sendTraceTag(557389507,3004,50,"featureName : {0}, isLicenseControlledFeature={1}, encounteredError = {2}, featureData={3}, fallbackValue={4}, isAllowed={5}",
V,Pa,wc,Ib,nd,Bd)};Vc.prototype.l1h=function(V,Pa){if(this.RTb)return this.Ke(V,Pa);if(this.Roa){if(this.S2d.contains(V))return this.dta.then(function(Ib){return V in Ib},function(){return Pa});fc.ULS.sendTraceTag(590385821,3004,50,"ApplicationFeatureHelper_IsFeatureAllowedByUserLicense: Feature '{0}' requested while not in the licensed features set.",V)}return this.Rza};Vc.prototype.ZIi=function(V){try{V&&"Date"in V&&(this.bSb=new Date(V.Date),fc.ULS.sendTraceTag(578863817,3004,50,"ProcessApplicationFeatureHelperResponseHeaders Date {0}",
this.bSb.toString()))}catch(Pa){fc.ULS.sendTraceTag(578863818,3004,10,"ProcessApplicationFeatureHelperResponseHeaders Exception {0}",Pa)}};Vc.prototype.UYc=function(){try{return new Map}catch(V){return null}};Vc.prototype.WVf=function(){if(void 0!==this.Soa&&null!==this.Soa){var V=this.Soa.Gc;this.Soa.stop();return V}return null};Vc.e8b=function(V){try{if(ff.a.Xmj){var Pa=V.Wa("UserDataSignature").split(".");if(1<Pa.length){var Ib=window.self.atob(Pa[1]),wc=JSON.parse(Ib).LocalStorageKey;if(void 0!==
wc&&null!==wc&&0<wc.length)return wc}}}catch(nd){fc.ULS.sendTraceTag(578863816,3004,10,"GetLocalStorageCacheKey exception {0}",nd.toString())}return null};Object(ac.a)(Vc,"ApplicationFeatureHelper",null,[201]);var Qf=b(210);Object(ac.a)(Fc,"CloudPolicySettingsCacheData",null,[]);var Ug=b(935),Kf=b(370),Of=b(217);$b.oUf=function(){return hb.AFrameworkApplication.ha.ta("SideCarIsEnabled")?$b.bpc&&$b.Xgd?new Promise(function(V){V(!0)}):new Promise(function(V,Pa){$b.bpc=Of.a.create(hb.AFrameworkApplication.ha.Wa("SideCarUrl"));
Kf.a.j3($b.bpc);$b.bpc.NX(function(Ib,wc){($b.Xgd=wc.succeeded)?V(wc.succeeded):Pa(wc.succeeded)})}):new Promise(function(V){V(!1)})};$b.Xgd=!1;$b.bpc=null;Object(ac.a)($b,"SideCarLoader",null,[]);Object(ac.a)(gd,"CloudPolicySettingsData",null,[]);Le.prototype.mJ=function(V,Pa){Pa=void 0===Pa?!0:Pa;if(!this.PCa){var Ib=this;return new Promise(function(yd){yd(Ib.Isb(V))})}var wc=this,nd=this,Bd=this.MZb.then(function(yd){try{var re=null;yd.PolicySettings&&"unknown"in yd.PolicySettings&&(re=yd.PolicySettings.unknown);
if(re){if(V in re&&void 0!==re[V]&&null!==re[V])return new Promise(function(Re){Re("0"!==re[V])});var xe=V.toLowerCase();if(xe in re&&void 0!==re[xe]&&null!==re[xe])return new Promise(function(Re){Re("0"!==re[xe])});fc.ULS.sendTraceTag(51512667,3004,50,"Policy"+V+" not found, using default");return new Promise(function(Re){Re(wc.Isb(V))})}return new Promise(function(Re){Re(wc.Isb(V))})}catch(Re){return fc.ULS.sendTraceTag(50622686,3004,10,"Failed to get "+V+" policy value. Error Message: {0}",Re.message),
wc.handleError(Re.toString(),Pa,wc.Isb(V))}},function(yd){return nd.handleError(yd,Pa,nd.Isb(V))});Bd.then(function(yd){fc.ULS.sendTraceTag(50651667,3004,50,"CloudPolicySettingsHelper.GetBooleanPolicySetting: policy: {0}, value: {1}",V,yd);return null});return Bd};Le.prototype.isFeatureEnabled=function(V,Pa){Pa=void 0===Pa?!0:Pa;if(this.yb.getBooleanFeatureGate("Microsoft.Office.SharedOnline.UseApplicationFeatureHelperAPIForFeedbackAndSurvey",!1))return this.n1h(V,Pa);var Ib=new Promise(function(nd){nd(!0)}),
wc="";this.JNb.contains(V)&&(wc="ControllerConnectedServicesEnabled",Ib=this.mJ(wc,Pa));Ib.then(function(nd){fc.ULS.sendTraceTag(50651668,3004,50,"CloudPolicySettingsHelper.IsFeatureEnabled: Feature: {0}, enabled or not: {1}, by policy: {2}",V,nd,wc);return null});return Ib};Le.prototype.n1h=function(V,Pa){Pa=void 0===Pa?!0:Pa;var Ib=new Promise(function(nd){nd(!0)}),wc="";"mso_sendASmile"===V?wc="Enabled":"Survey"===V||"FloodgateSurvey"===V?wc="SurveyEnabled":this.JNb.contains(V)&&(wc="ControllerConnectedServicesEnabled");
""!==wc&&(Ib=this.mJ(wc,Pa));Ib.then(function(nd){fc.ULS.sendTraceTag(558187080,3004,50,"CloudPolicySettingsHelper.IsFeatureEnabledV2: Feature: {0}, enabled or not: {1}, by policy: {2}",V,nd,wc);return null});return Ib};Le.prototype.handleError=function(V,Pa,Ib){return Pa?new Promise(function(wc){wc(Ib)}):new Promise(function(wc,nd){nd(V)})};Le.prototype.Yma=function(V,Pa,Ib){var wc=this;if(!V)return Promise.resolve(new gd);var nd=!1,Bd=null;Yb.Health.instance.recordKpiUsage("GetCloudPolicySettings",
1,"jpittsdirects",null);var yd=this.EYc("GetCloudPolicySettings");return(new Promise(function(re,xe){if(void 0!==wc.Jgb&&null!==wc.Jgb&&0<wc.Jgb.length){var Re=wc.ysj();if(void 0!==Re&&null!==Re){nd=!0;re(Re);return}}wc.Sfb.hZc(Pa,Ib,1,null,Object(ld.a)(wc,wc.cJi,"processCloudPolicySettingsResponseHeaders"),["CheckIn-Interval"],wc.yb.qd("CloudPolicySettingsRequestQueueTimeout",15E3),wc.yb.qd("CloudPolicySettingsRequestSentTimeout",3E4)).then(function(Tf){fc.ULS.sendTraceTag(51662933,3004,50,"Retrieved CloudPolicySettingsData from OCPS");
wc.ntj(Tf);re(Tf);return Tf},function(Tf){xe(Tf);return null})})).then(function(re){var xe=wc.ltc(yd);yd=xe.stopwatch;Bd=xe.returnValue;(xe=wc.xs())&&xe.set("FromCache",nd.toString());xe=Object.assign(new Bg.a,{durationMs:Bd,extendedProperties:xe});Yb.Health.instance.recordKpiSuccess("GetCloudPolicySettings",xe);return re})};Le.prototype.Osj=function(){return $b.oUf().then(function(){fc.ULS.sendTraceTag(593282845,3004,50,"CloudPolicySettingsHelper - Retrieving CloudPolicySettingsData Promise from Sidecar");
return sidecar.cloudPolicy.GetCloudPolicySettingsData()})};Le.prototype.Pta=function(V){return String.format("{0}{1}",this.yb.Wa("WebServiceBase"),V)};Le.prototype.XDi=function(V){var Pa=vd.d(V).xu;fc.ULS.sendTraceTag(50622687,3004,Pa?50:10,"ParseCloudPolicySettingsResponse: fetched CloudPolicySettingsData from {0}",V);return Pa};Le.prototype.cJi=function(V){try{if(void 0!==V&&null!==V&&"CheckIn-Interval"in V){var Pa=parseInt(V["CheckIn-Interval"]);void 0!==Pa&&null!==Pa&&0<Pa&&(this.pAc=Pa)}}catch(Ib){fc.ULS.sendTraceTag(51662934,
3004,10,"ProcessCloudPolicySettingsResponseHeaders Exception {0}",Ib)}};Le.prototype.Isb=function(V){return V in this.b5d?"0"!==this.b5d[V]:!0};Le.prototype.ysj=function(){try{var V=Ug.a.instance.getItem(this.Jgb);if(void 0===V||null===V)return fc.ULS.sendTraceTag(51662936,3004,50,"TryGetCloudPolicySettingsDataFromCache data from LocalStorage is null"),null;fc.ULS.sendTraceTag(51662937,3004,50,"TryGetCloudPolicySettingsDataFromCache retrieved data {0} from LocalStorage",V);var Pa=JSON.parse(V);if(void 0===
Pa||null===Pa)return fc.ULS.sendTraceTag(51662938,3004,15,"TryGetCloudPolicySettingsDataFromCache data from LocalStorage is null after parsing"),null;if(void 0===Pa.ExpirationTime||null===Pa.ExpirationTime)return fc.ULS.sendTraceTag(51662939,3004,15,"TryGetCloudPolicySettingsDataFromCache ExpirationTime from LocalStorage is null after parsing"),null;if((new Date(Pa.ExpirationTime)).getTime()<Date.now())return fc.ULS.sendTraceTag(51662940,3004,50,"TryGetCloudPolicySettingsDataFromCache Cache is expired"),
null;var Ib=new gd;Ib.PolicySettings=Pa.PolicySettings;Ib.ControllerConnectedServicesFeatureNames=new Qf.a;this.yb.xy("ServicesControlsMicrosoftControllerServicesList")&&this.yb.zx("ServicesControlsMicrosoftControllerServicesList");for(var wc=Ml(this.JNb),nd=wc.next();!nd.done;nd=wc.next())Ib.ControllerConnectedServicesFeatureNames.add(nd.value);fc.ULS.sendTraceTag(51662941,3004,50,"TryGetCloudPolicySettingsDataFromCache data from LocalStorage retrieved");return Ib}catch(Bd){return fc.ULS.sendTraceTag(51662942,
3004,10,"TryGetCloudPolicySettingsDataFromCache exception {0}",Bd.toString()),null}};Le.prototype.ntj=function(V){try{if(void 0===V||null===V||void 0===V.PolicySettings||null===V.PolicySettings)fc.ULS.sendTraceTag(51662944,3004,15,"TrySetCloudPolicySettingsDataIntoCache data/PolicySettings is null");else if(0>=this.pAc)fc.ULS.sendTraceTag(51662945,3004,15,"TrySetCloudPolicySettingsDataIntoCache _checkInInterval is Invalid");else{var Pa=new Fc(V,this.pAc),Ib=JSON.stringify(Pa);fc.ULS.sendTraceTag(51662946,
3004,50,"TrySetCloudPolicySettingsDataIntoCache data to cache {0}",Ib);Ug.a.instance.setItem(this.Jgb,Ib);fc.ULS.sendTraceTag(51662947,3004,50,"TrySetCloudPolicySettingsDataIntoCache set data to cache")}}catch(wc){fc.ULS.sendTraceTag(51662976,3004,10,"TrySetCloudPolicySettingsDataIntoCache exception {0}",wc.toString())}};Le.prototype.e8b=function(){var V=Vc.e8b(this.yb);return V&&0<V.length?"OCPS"+V:null};Le.prototype.xs=function(){try{return new Map}catch(V){return null}};Le.prototype.EYc=function(V){var Pa=
lf.a.instance.Uh("Microsoft.Office.Telemetry.Usage.IStopwatchBuilder");return void 0!==Pa&&null!==Pa?Pa.Ic("WebServiceCall",V):null};Le.prototype.ltc=function(V){if(void 0!==V&&null!==V){var Pa=V.Gc;V.stop();return{returnValue:Pa,stopwatch:null}}return{returnValue:null,stopwatch:V}};Object(ac.a)(Le,"CloudPolicySettingsHelper",null,[198]);Bf.prototype.clone=function(){var V=new Bf;V.ut=this.ut;V.l4f=this.l4f;V.EAe=this.EAe;V.QFa=this.QFa;V.m4f=this.m4f;V.FAe=this.FAe;V.Ada=this.Ada;V.DLc=this.src;
return V};Bf.prototype.serialize=function(V){V=void 0===V?null:V;var Pa={};if(!V||V.contains(Bf.rMa))Pa[Bf.rMa]=this.ut;if(!V||V.contains(Bf.Yzb))Pa[Bf.Yzb]=this.QFa;if(!V||V.contains(Bf.Zzb))Pa[Bf.Zzb]=this.Ada;return JSON.stringify(Pa)};Bf.create=function(V,Pa){Pa=void 0===Pa?null:Pa;var Ib=new Bf;Ib.DLc=V;void 0!==Pa&&null!==Pa&&(Bf.rMa in Pa&&(Ib.ut=Pa[Bf.rMa]),Bf.Yzb in Pa&&(Ib.QFa=Pa[Bf.Yzb]),Bf.Zzb in Pa&&(Ib.Ada=Pa[Bf.Zzb]));return Ib};Bf.deserialize=function(V,Pa){try{var Ib=JSON.parse(V);
if(void 0!==Ib&&null!==Ib)return Bf.create(Pa,Ib);fc.ULS.sendTraceTag(50860946,306,10,"UserPrivacySettings Deserialize: Unable to convert {0} to dict",V);throw Error.argument("settingsData");}catch(wc){throw fc.ULS.sendTraceTag(50860947,306,10,"UserPrivacySettings Deserialize Exception = {0}",wc.toString()),wc;}};Jl.Object.defineProperties(Bf.prototype,{src:{configurable:!0,enumerable:!0,get:function(){return this.DLc}}});Bf.rMa="CCS";Bf.Yzb="CCSTime";Bf.Zzb="OfficePrivacyRoamedNoticeShown";Object(ac.a)(Bf,
"UserPrivacySettings",null,[]);var hh=b(135);ne.prototype.Pta=function(V){var Pa=String.format("{0}RoamingServiceHandler.ashx?action=",this.yb.appSettings.RoamingServiceHandlerWebServiceBase||"");Pa=new Sys.StringBuilder(Pa);Pa.append(V);Pa.append("&");Pa.append(hb.AFrameworkApplication.hj);return Pa.toString()};ne.prototype.executeRequest=function(V,Pa,Ib,wc){return this.Ug.gVb(V,Pa,void 0===wc?null:wc,null,Ib,"33",!1,null,6E4)};ne.prototype.saveSettings=function(V){var Pa=this;return new Promise(function(Ib,
wc){try{if(void 0===Pa.ze||null===Pa.ze||void 0===V||null===V)fc.ULS.sendTraceTag(51258443,3004,15,"SaveUserPrivacySettings: Can't determine setting changes to save"),wc("Can't determine setting changes to save");else{var nd=Pa.ze.ut!==V.ut;if(2===Pa.ze.src&&nd)Pa.l1i(V),Ib(!0);else{var Bd=Pa.f5i(V);if(void 0===Bd||null===Bd||!Bd.length)fc.ULS.sendTraceTag(50917389,3004,15,"SaveUserPrivacySettings: returning since nothing changed"),wc("No changes to save");else if(1===Pa.ze.src)Ib(Pa.q0f(Bd));else if(!Pa.ze.src){fc.ULS.sendTraceTag(51258444,
3004,50,"UserPrivacySettingsHelper: SaveSettings to Roaming {0}",Bd);var yd=Pa.executeRequest(Pa.Pta("saveUserPrivacySettings"),2,"SaveUserPrivacySettingsRequest",Bd);yd.continueWith(function(){if(yd.Dh||yd.ng)fc.ULS.sendTraceTag(50860929,3004,10,"SaveUserPrivacySettings: Roaming Request Cancelled/Failed"),Ib(!1);else{var re=yd.result;void 0!==re.Qg&&null!==re.Qg&&void 0!==re.Qg.data&&null!==re.Qg.data&&re.Qg.data.httpStatus===sa.a.bO?(fc.ULS.sendTraceTag(51258445,3004,50,"SaveUserPrivacySettings: Roaming Request Succeeded"),
Ib(!0)):(fc.ULS.sendTraceTag(51258446,3004,10,"SaveUserPrivacySettings: Roaming Request Failed"),Ib(!1))}})}}}}catch(re){fc.ULS.sendTraceTag(50860930,3004,10,"SaveUserPrivacySettings: Exception = {0}",re.toString()),Ib(!1)}})};ne.prototype.f5i=function(V){if(void 0===this.ze||null===this.ze||void 0===V||null===V)throw Error.invalidOperation("User Privacy settings have not been initialized");var Pa=new Qf.a;V.src?1===V.src&&this.ze.ut!==V.ut&&Pa.add(Bf.rMa):(this.ze.ut!==V.ut&&(Pa.add(Bf.rMa),Pa.add(Bf.Yzb)),
this.ze.Ada!==V.Ada&&Pa.add(Bf.Zzb));return Pa.count?V.serialize(Pa):(fc.ULS.sendTraceTag(50860931,3004,50,"SaveUserPrivacySettings: returning since nothing changed"),null)};ne.prototype.getSettings=function(){if(!this.VKc){var V=this;this.VKc=new Promise(function(Pa){try{V.ze?Pa(V.ze.clone()):V.Hsj().then(function(Ib){V.ze=Ib;Pa(V.ze.clone());return null},function(){V.Fsj().then(function(Ib){V.ze=Ib;Pa(V.ze.clone());return null},function(){V.Gsj().then(function(Ib){V.ze=Ib;Pa(V.ze.clone());return null},
function(){fc.ULS.sendTraceTag(50967430,3004,10,"UserPrivacySettings TryGetSettingsFromQueryParams returned an error)");V.ze=new Bf;Pa(V.ze.clone());return null});return null});return null})}catch(Ib){fc.ULS.sendTraceTag(50860932,3004,10,"UserPrivacySettings GetSettings: Exception = {0}",Ib.toString()),V.ze=new Bf,Pa(V.ze.clone())}})}return this.VKc};ne.prototype.Hsj=function(){var V=this;return new Promise(function(Pa,Ib){try{var wc=-1!==window.location.href.indexOf("&wd_pn=2");if(V.yb.ta("PrivacyDialogShouldCheckRoaming")||
wc){var nd=V.executeRequest(V.Pta("getUserPrivacySettings"),1,"GetUserPrivacySettingsRequest");nd.continueWith(function(){try{if(nd.Dh||nd.ng)fc.ULS.sendTraceTag(50860934,3004,10,"UserPrivacySettings TryGetSettingsFromRoaming: Request failure");else{var Bd=nd.result;if(Bd&&Bd.Qg&&Bd.Qg.data)if(Bd.Qg.data.httpStatus!==sa.a.bO)fc.ULS.sendTraceTag(50860936,3004,10,"UserPrivacySettings TryGetSettingsFromRoaming: Received error response {0}",Bd.Qg.data.httpStatus);else{if(Bd.Qg.data.pe){Pa(ne.parse(Bd.Qg.data.pe,
0));fc.ULS.sendTraceTag(51258447,3004,50,"UserPrivacySettings TryGetSettingsFromRoaming: Success, Settings {0}",Bd.Qg.data.pe);return}fc.ULS.sendTraceTag(50860937,3004,10,"UserPrivacySettings TryGetSettingsFromRoaming: ResponseData is null")}else fc.ULS.sendTraceTag(50860935,3004,10,"UserPrivacySettings TryGetSettingsFromRoaming: Data is null");Ib("UserPrivacySettings TryGetSettingsFromRoaming Request Faillure")}}catch(yd){fc.ULS.sendTraceTag(50860938,3004,10,"UserPrivacySettings TryGetSettingsFromRoaming Exception handling request {0}",
yd.toString()),Ib("UserPrivacySettings TryGetSettingsFromRoaming Request Exception")}})}else fc.ULS.sendTraceTag(50860933,3004,50,"UserPrivacySettings TryGetSettingsFromRoaming: Roaming should not be used"),Ib("Roaming should not be used")}catch(Bd){fc.ULS.sendTraceTag(50860939,3004,10,"TryGetSettingsFromRoaming Exception = {0}",Bd.toString()),Ib("UserPrivacySettings TryGetSettingsFromRoaming Exception")}})};ne.prototype.Fsj=function(){var V=this;return new Promise(function(Pa,Ib){try{var wc=hh.a.get("WacUPToggleState"),
nd=null;void 0!==wc&&null!==wc&&0<wc.length&&(nd=decodeURIComponent(wc));if(void 0!==nd&&null!==nd&&0<nd.length){var Bd=ne.parse(nd,1);fc.ULS.sendTraceTag(51258448,3004,50,"TryGetSettingsFromCookie: UserPrivacySettings retrieved from cookie {0}",Bd.toString());Pa(Bd)}else{var yd=Bf.create(1),re=new Qf.a;re.add(Bf.rMa);var xe=yd.serialize(re);V.q0f(xe)?(fc.ULS.sendTraceTag(51258449,3004,50,"TryGetSettingsFromCookie: UserPrivacySettings initialized and retrieved from cookie {0}",xe),Pa(yd)):(fc.ULS.sendTraceTag(51258450,
3004,15,"TryGetSettingsFromCookie: Failure initializing cookie with settings {0}",xe),Ib("UserPrivacySettings TryGetSettingsFromCookie Failure in TrySaveSettingsToCookie"))}}catch(Re){fc.ULS.sendTraceTag(50860941,3004,10,"TryGetSettingsFromCookie from Cookie Exception = {0}",Re.toString()),Ib("UserPrivacySettings TryGetSettingsFromCookie Eception")}})};ne.prototype.Gsj=function(){return new Promise(function(V){try{var Pa=-1!==window.location.href.indexOf("&wdccsoff=1"),Ib=Bf.create(2);Pa?(Ib.ut=2,
hb.AFrameworkApplication.lze(),fc.ULS.sendTraceTag(51258451,3004,50,"TryGetSettingsFromQueryParams: Retrieved from query param {0}",Ib.toString())):(Ib.ut=1,fc.ULS.sendTraceTag(51258452,3004,50,"TryGetSettingsFromQueryParams: Initialized with query param as data source for {0}",Ib.toString()));V(Ib)}catch(wc){fc.ULS.sendTraceTag(50967431,3004,50,"TryGetSettingsFromCookie from Query Params Exception = {0}",wc.toString()),Pa=Bf.create(2),Pa.ut=1,V(Pa)}})};ne.prototype.l1i=function(V){fc.ULS.sendTraceTag(51258453,
3004,50,"UserPrivacySettingsHelper: SaveSettingsToQueryParam");2===V.ut?hb.AFrameworkApplication.lze():hb.AFrameworkApplication.c8g();fc.ULS.sendTraceTag(51258454,3004,50,"SaveSettingsToQueryParam saved settings = {0}",V)};ne.prototype.q0f=function(V){try{fc.ULS.sendTraceTag(51258455,3004,50,"UserPrivacySettingsHelper: TrySaveSettingsToCookie Saving settings {0}",V);var Pa=this.yb.Wa("PrivacyCookieDomain")||"";if(!Pa||!Pa.length)throw Error.invalidOperation("PrivacyCookieDomain is null or empty");
fc.ULS.sendTraceTag(51258456,3004,50,"SaveUserPrivacySettings to Cookie {0}",V);return hh.a.dId("WacUPToggleState",V,hh.a.KZ,"/",Pa)}catch(Ib){return fc.ULS.sendTraceTag(50860942,3004,50,"SaveUserPrivacySettings to Cookie Exception = {0}",Ib.toString()),!1}};ne.prototype.isFeatureEnabled=function(V){var Pa=this;return this.getSettings().then(function(Ib){for(var wc=Pa.yb.xy("ServicesControlsMicrosoftControllerServicesList")?Pa.yb.zx("ServicesControlsMicrosoftControllerServicesList"):[],nd=new Xd.a,
Bd=0;Bd<wc.length;Bd++)nd.add(wc[Bd]);return nd.contains(V)?2!==Ib.ut:!0},function(){fc.ULS.sendTraceTag(50860945,3004,10,"Failed to get privacy setting for feature {0}",V);return!0})};ne.parse=function(V,Pa){try{return fc.ULS.sendTraceTag(50860943,3004,50,"Parsing user privacy settings {0} from {1}",V,Pa),Bf.deserialize(V,Pa)}catch(Ib){throw fc.ULS.sendTraceTag(50860944,3004,10,"GetUserPrivacySettings Exception = {0}",Ib.toString()),Ib;}};Object(ac.a)(ne,"UserPrivacySettingsHelper",null,[199]);var Eg=
b(274);Ce.prototype.$h=function(V){var Pa=this;this.pb=V;this.pb.register(198,"Common.App.ApplicationFeatureHelper.ICloudPolicySettingsHelper").Ac().Lc(function(){return new Le(hb.AFrameworkApplication.ha,hb.AFrameworkApplication.Md)});this.pb.register(199,"Common.App.ApplicationFeatureHelper.IUserPrivacySettingsHelper").Ac().Lc(function(){return new ne(hb.AFrameworkApplication.ha,hb.AFrameworkApplication.Md)});this.pb.register(200,"Common.App.ApplicationFeatureHelper.IAlternateAuthHelper").Ac().Lc(function(){return new Ge(hb.AFrameworkApplication.ha,
hb.AFrameworkApplication.Md)});this.pb.register(201,"Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper").Ac().Lc(function(){return new Vc(hb.AFrameworkApplication.ha,hb.AFrameworkApplication.Md,Pa.pb.resolve("Common.App.ApplicationFeatureHelper.ICloudPolicySettingsHelper"),Pa.pb.resolve("Common.App.ApplicationFeatureHelper.IUserPrivacySettingsHelper"),hb.AFrameworkApplication.Hb)})};Ce.prototype.init=function(){var V=this;hb.AFrameworkApplication.ha.Xv(function(){var Pa=V.pb.resolve("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper");
hb.AFrameworkApplication.ha.ta("LicensingIsEnabled")&&(Pa.isFeatureEnabled("LicensingTestFeature",!1).then(function(Ib){fc.ULS.sendTraceTag(42513092,3004,50,"ApplicationFeatureHelperPackage.Init: LicensingTestFeature returned IsFeatureEnabled as {0}. IsAnonymousUser : {1}.",Ib,hb.AFrameworkApplication.ha.Wa("IsAnonymousUser"));return null}),Pa.getFeatureTier("LicensingTestFeature",0).then(function(Ib){fc.ULS.sendTraceTag(42804872,3004,50,"ApplicationFeatureHelperPackage.Init: LicensingTestFeature returned GetFeatureTier as {0}. IsAnonymousUser : {1}.",
Ib,hb.AFrameworkApplication.ha.Wa("IsAnonymousUser"));return null}));V.pb.resolve("Common.App.ApplicationFeatureHelper.IAlternateAuthHelper");V.toj()})};Ce.prototype.dispose=function(){};Ce.prototype.toj=function(){try{hb.AFrameworkApplication.ha.ta("SideCarIsEnabled")&&$b.oUf().then(function(V){fc.ULS.sendTraceTag(594057429,3004,50,"Sidecar Loader attempted to load Sidecar.  SideCarIsAvailable:{0}",V);return V})}catch(V){}};Ce.main=function(){Eg.a.instance.oj(new Ce)};Jl.Object.defineProperties(Ce.prototype,
{name:{configurable:!0,enumerable:!0,get:function(){return"Common.App.ApplicationFeatureHelper.ApplicationFeatureHelperPackage"}}});Object(ac.a)(Ce,"ApplicationFeatureHelperPackage",null,[8,9]);var ng=b(162),eg=b(1194),Yg=b(30),Ud=b(52);zf.prototype.Iai=function(){this.QOb||(fc.ULS.sendTraceTag(21030598,324,50,"InProductMessagingDependenciesLoad usage"),this.QOb=Ud.Task.WAA(zf.Nai(),zf.Fai()),this.QOb.continueWith(function(V){fc.ULS.sendTraceTag(21030599,324,10,"{0}",Yg.a.h9c(V.Kg))},5));return this.QOb};
zf.prototype.Kai=function(){if(!this.wRb)try{fc.ULS.sendTraceTag(39978390,324,50,"InProductMessagingFreemiumDependenciesLoad usage"),this.wRb=Ud.Task.WAA(zf.z2c(Of.a.create(hb.AFrameworkApplication.ha.Wa("DimeUrl"),null,null))),this.wRb.continueWith(function(V){fc.ULS.sendTraceTag(39978391,324,10,"{0}",Yg.a.h9c(V.Kg))},5)}catch(V){fc.ULS.sendTraceTag(594874951,324,10,"{0}",Yg.a.h9c(V))}return this.wRb};zf.Nai=function(){var V=zf.Z8b("inproductmessaging.js");V=Of.a.create(V,null,null);return zf.z2c(V)};
zf.Fai=function(){var V=zf.Z8b("inproductmessaging.css");V=new eg.a(V);return zf.z2c(V)};zf.Z8b=function(V){return ng.a.e_b(String.format("ipm/{0}",V))};zf.z2c=function(V){Kf.a.j3(V);return V.o5a};Object(ac.a)(zf,"DependencyDownloader",null,[490]);mg.hDi="inProductMessagingOverlayDiv";mg.PFi="PlayButtonImage";mg.RWi="ReplayButtonImage";Object(ac.a)(mg,"Constants",null,[]);Yf.prototype.b9i=function(){this.ree(mg.PFi,this.QFi);this.ree(mg.RWi,this.SWi)};Yf.prototype.ree=function(V,Pa){Pa&&(this.E0f[V]=
Pa)};Jl.Object.defineProperties(Yf.prototype,{tAg:{configurable:!0,enumerable:!0,get:function(){return this.RUd},set:function(V){this.RUd=V}},xii:{configurable:!0,enumerable:!0,get:function(){return this.e4d},set:function(V){this.e4d=V}},vgj:{configurable:!0,enumerable:!0,get:function(){return this.H9d},set:function(V){(this.H9d=V)&&this.b9i()}}});Object(ac.a)(Yf,"FirstRunExperienceUISettings",null,[489]);Object(ac.a)(Rd,"FirstRunExperienceViewData",null,[488]);var Tc=b(185),qg=b(111);Gd.prototype.Rg=
function(){this.Oa.Jf(kg.a.nnh,qg.a.frame,Object(ld.a)(this,this.lnh,"firstRunExperienceHandler"),64);this.Oa.$b(kg.a.YKe,qg.a.frame,Object(ld.a)(this,this.$Sh,"inProductMessagingTabHandler"));this.Oa.$b(kg.a.XKe,qg.a.frame,Object(ld.a)(this,this.ZSh,"inProductMessagingShiftTabHandler"));this.Oa.$b(kg.a.L2g,qg.a.frame,Object(ld.a)(this,this.M2g,"dimeLaunchHandler"));this.Oa.$b(kg.a.aHf,qg.a.frame,Tc.ActionManager.Wf);this.Oa.$b(kg.a.pXi,qg.a.frame,Tc.ActionManager.Wf);this.Oa.$b(kg.a.qXi,qg.a.frame,
Tc.ActionManager.Wf);this.Me&&this.Me.updateCommandUI()};Gd.prototype.lnh=function(V,Pa,Ib,wc,nd){2===Ib&&this.pPb.k$h(nd);return 32};Gd.prototype.M2g=function(V,Pa,Ib,wc,nd){2===Ib&&this.pPb.i$h(nd);return 32};Gd.prototype.$Sh=function(V,Pa,Ib){return 2===Ib?this.pPb.Vpd():32};Gd.prototype.ZSh=function(V,Pa,Ib){return 2===Ib?this.pPb.Tpd():32};Object(ac.a)(Gd,"InProductMessagingActor",null,[]);Object(ac.a)(me,"DimeExperienceUISettings",null,[]);var Lg=b(242),de=b(584);be.prototype.FVh=function(V){Lg.apiExtensionExists("getHeaderApi")?
V.isFeatureEnabled("MsoPremiumBadge",!0).then(function(Pa){var Ib=V.isFreemiumUpsellEnabled();Ib&&(appChrome.getHeaderApi().then(function(wc){wc.updatePremiumStatus(Pa,Ib);return null}),V.$Na("MsoPremiumBadge",function(wc){appChrome.getHeaderApi().then(function(nd){nd.updatePremiumStatus(wc.isEnabled,Ib);return null})}));return null}):fc.ULS.sendTraceTag(593859840,324,10,"getHeaderApi not available")};be.prototype.k$h=function(V){var Pa=this;this.ZRb.Iai().continueWith(function(){Pa.yVa.Phj(V)})};
be.prototype.i$h=function(V){function Pa(){}var Ib="gopremium",wc=null;V?(V.experience&&""!==Object(Od.a)(String,V.experience)&&(Ib=Object(Od.a)(String,V.experience)),V.onTaskComplete&&(Pa=V.onTaskComplete),V.campaignId&&""!==Object(Od.a)(String,V.campaignId)&&(wc=Object(Od.a)(String,V.campaignId))):fc.ULS.sendTraceTag(51675402,324,50,"Experience not given, using default experience");this.saf(Ib,Pa,wc)};be.prototype.saf=function(V,Pa,Ib){var wc=this;Ib=void 0===Ib?null:Ib;if(this.l6b&&this.hpb){var nd=
{};nd.experience=V||"gopremium";nd.campaignId=Ib||de.b(this.A0,this.izc,Object(Od.a)(String,nd.experience),!0);this.Oa.processAction(kg.a.aHf,2);fc.ULS.sendTraceTag(51675403,324,50,"Launching Freemium Upsell dialog: "+nd.experience);try{var Bd=Object.assign(new me,{instance:this.hpb,yec:nd,bYf:Pa||function(){},zIf:function(yd){fc.ULS.sendTraceTag(51675405,324,50,"Dime launch result: "+yd.status)},LDf:function(){fc.ULS.sendTraceTag(51675406,324,10,"Dime launch error");wc.l6b=!1;wc.hpb=null}});this.yVa.$fj(Bd)}catch(yd){fc.ULS.sendTraceTag(51675407,
324,10,"Dime launch error: "+yd.message),this.l6b=!1,this.hpb=null,V={},this.Oa.Pe(kg.a.m6b,2,(V.experience=nd.experience,V))}}else fc.ULS.sendTraceTag(39978392,324,10,"FreemiumUpsellDialogDependencies not loaded"),nd={},this.Oa.Pe(kg.a.m6b,2,(nd.experience=V,nd))};be.prototype.hbf=function(){var V=this;this.ZRb.Kai().continueWith(function(){try{var Pa=Yg.a.un(hb.AFrameworkApplication.uiCulture),Ib=de.c(V.A0);if(Ib){Pa={partnerId:Ib,language:Pa};Pa.sessionId=hb.AFrameworkApplication.userSessionId;
Pa.authHint=hb.AFrameworkApplication.ha.Wa("UserPrincipalName");var wc=hb.AFrameworkApplication.ha.Wa("Puid")||"";""!==wc&&(Pa.userInfo={puid:wc});V.hpb=new Dime(Pa);V.l6b=!0;fc.ULS.sendTraceTag(592721856,324,50,"Dime initialized")}else fc.ULS.sendTraceTag(51675409,324,15,"App not supported")}catch(nd){fc.ULS.sendTraceTag(51675410,324,10,"FreemiumUpsellDialogDependencies failed: "+nd.message)}},3)};be.prototype.Vpd=function(){return this.yVa.Vpd()};be.prototype.Tpd=function(){return this.yVa.Tpd()};
Object(ac.a)(be,"InProductMessagingUIManager",null,[487]);Yd.prototype.Init=function(V){this.hae=V};Yd.prototype.SendTrace=function(V,Pa){fc.ULS.sendTraceTag(34182235,this.hae,this.lUa[V],"{0}",Pa)};Object(ac.a)(Yd,"DefaultNetworkingManager",null,[511]);var tg=b(275),ve=b(369),tf=b(100);pd.prototype.Phj=function(V){V&&(InProductMessaging.Networking.NetworkingMgr=new Yd,InProductMessaging.Networking.NetworkingMgr.Init(387),InProductMessaging.Init(V.vgj,V.xii,V.tAg,V.oji,V.locale,Object(ld.a)(this,
this.Oqi,"onDismissFirstRunExperience"),V.E0f),this.tPa(mg.hDi,!0))};pd.prototype.$fj=function(V){var Pa=this;if(V&&V.instance&&V.yec){var Ib=document.getElementById("wacDimeContainer");Ib||(Ib=document.createElement("div"),Ib.id="wacDimeContainer",document.body.appendChild(Ib));hb.AFrameworkApplication.ha.ta("DimeFocusManagerIsEnabled")&&this.tPa("wacDimeContainer",!1);V.yec.parentElementId="wacDimeContainer";V.instance.launch(V.yec,V.bYf).then(function(wc){Pa.gEb();document.body.removeChild(Ib);
V.zIf(wc)}).catch(function(wc){Pa.gEb();document.body.removeChild(Ib);V.LDf(wc)})}else throw Error.argument("DimeExperienceUISettings");};pd.prototype.tPa=function(V,Pa){if(this.hc&&V&&(V=document.getElementById(V),this.vVh(V),V=this.hc.tJ("InProductMessagingFocusId"))){var Ib=this.hc.ri;Ib&&"InProductMessagingFocusId"===Ib.name||this.hc.cN("InProductMessagingFocusId",!1);Pa&&this.WBf(V.scope)}};pd.prototype.vVh=function(V){var Pa=!1;Pa=void 0===Pa?!0:Pa;var Ib=this.hc.Wh("InProductMessagingFocusId");
Ib.parent=tg.AFrame.HO;var wc=new ve.DOMFocusListing(function(){return V});wc.fOa=Pa;wc.xn(3);wc.xn(2);wc.xn(4);Pa=this.hc.uga(function(){return V},Ib,wc);Pa.bEb();Pa.eV=!0;Pa.IFa=!0};pd.prototype.WBf=function(V){V.Kk(tf.FocusManager.instance().j1);V.Kk(tf.FocusManager.instance().k1);V.bindAction(tf.FocusManager.instance().j1,kg.a.YKe);V.bindAction(tf.FocusManager.instance().k1,kg.a.XKe)};pd.prototype.gEb=function(){this.hc&&(this.hc.I5("InProductMessagingFocusId"),this.hc.jOa("InProductMessagingFocusId"))};
pd.prototype.Oqi=function(V,Pa){this.gEb();V=Object.assign(new Rd,{completed:V,sRi:Pa});hb.AFrameworkApplication.Hb.Pe(kg.a.knh,2,V)};pd.prototype.Vpd=function(){var V=document.activeElement,Pa=this.hc.PP();return V&&Pa&&Pa.mf&&V===Pa.mf.lo?(Pa.mf.ql(V),Pa.vwa()?32:8):4};pd.prototype.Tpd=function(){var V=document.activeElement,Pa=this.hc.PP();return V&&Pa&&Pa.mf&&V===Pa.mf.firstElement?(Pa.mf.ql(V),Pa.gMa()?32:8):4};Object(ac.a)(pd,"InProductMessagingUIWrapper",null,[483]);var lg=b(144);Wc.prototype.$h=
function(V){V.register(zf,"Common.App.InProductMessaging.DependencyDownloader").as("Common.App.InProductMessaging.IDependencyDownloader").Ac().Lc(function(){return new zf});V.register(pd,"Common.App.InProductMessaging.InProductMessagingUIWrapper").as("Common.IInProductMessagingUIWrapper").Ac().Lc(function(){return new pd(tf.FocusManager.instance())});V.register(be,"Common.App.InProductMessaging.InProductMessagingUIManager").as("Common.IInProductMessagingUIManager").Ac().Lc(function(){return new be(hb.AFrameworkApplication.Hb,
V.resolve("Common.IInProductMessagingUIWrapper"),V.resolve("Common.App.InProductMessaging.IDependencyDownloader"),hb.AFrameworkApplication.za.Za.Xk,hb.AFrameworkApplication.za.Za.qMa)});V.register(Gd,"Common.App.InProductMessaging.InProductMessagingActor").Ac().Lc(function(){return new Gd(hb.AFrameworkApplication.Hb,hb.AFrameworkApplication.za,V.resolve("Common.IInProductMessagingUIManager"))});V.register(Yf,"Common.App.InProductMessaging.FirstRunExperienceUISettings").as("Common.IFirstRunExperienceUISettings").Ac().Lc(function(){return new Yf});
V.register(Rd,"Common.App.InProductMessaging.FirstRunExperienceViewData").as("Common.IFirstRunExperienceViewData").Ac().Lc(function(){return new Rd});this.pb=V};Wc.prototype.init=function(){var V=this;this.pb.resolve("Common.App.InProductMessaging.InProductMessagingActor").Rg();hb.AFrameworkApplication.ha.Xv(function(){hb.AFrameworkApplication.za.Za.isReactSharedHeaderUxEnabled&&lg.a.get_instance().en(15,function(){V.pb.yc("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper").execute(function(Pa){V.pb.resolve("Common.App.InProductMessaging.InProductMessagingUIManager").FVh(Pa)})});
hb.AFrameworkApplication.ha.ta("FreemiumUpsellShowDialogIsEnabled")&&de.a()&&!ff.a.sA&&1!==hb.AFrameworkApplication.za.Za.Xk&&V.pb.yc("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper").execute(function(Pa){Pa.isFeatureEnabled("MsoPremiumBadge",!0).then(function(Ib){!Ib&&Pa.isFreemiumUpsellEnabled()&&V.pb.resolve("Common.App.InProductMessaging.InProductMessagingUIManager").hbf();return null})})})};Wc.prototype.dispose=function(){};Wc.main=function(){Eg.a.instance.oj(new Wc)};Jl.Object.defineProperties(Wc.prototype,
{name:{configurable:!0,enumerable:!0,get:function(){return"Common.App.InProductMessaging"}}});Object(ac.a)(Wc,"InProductMessagingPackage",null,[8,9]);id.prototype.D4c=function(V){var Pa=new Sys.StringBuilder(this.Gw.tFb);Pa.append("RoamingServiceHandler.ashx?action=");Pa.append("getFirstRunExperienceSettings");Pa.append("&");Pa.append(this.V$c(V));Pa.append("&");Pa.append(hb.AFrameworkApplication.hj);hb.AFrameworkApplication.Md.Wl(Pa.toString(),1,null,null,!0,2,Object(ld.a)(this,this.SIa,"getRequestSuccessCallback"),
Object(ld.a)(this,this.xia,"getRequestFailureCallback"),null)};id.prototype.E4c=function(V){var Pa=new Sys.StringBuilder(this.Gw.tFb);Pa.append("RoamingServiceHandler.ashx?action=");Pa.append("saveFirstRunExperienceSettings");Pa.append("&");Pa.append(hb.AFrameworkApplication.hj);Pa=Pa.toString();V=vd.c(V);hb.AFrameworkApplication.Md.Wl(Pa,2,V,null,!0,4,Object(ld.a)(this,this.hHi,"postRequestSuccessCallback"),Object(ld.a)(this,this.wNa,"postRequestFailureCallback"),null)};id.prototype.SIa=function(V){var Pa=
!1,Ib=null;try{if(0<V.data.pe.length){var wc=Object(Od.a)(Object,vd.a(V.data.pe)),nd=wc?wc[this.Gw.FQc]:null;nd&&(Ib=Object(Od.a)(Object,vd.a(nd.toString())))}Pa=!0}catch(Bd){this.xia(null)}Pa&&this.Dfb&&this.Dfb(V.data,Ib)};id.prototype.xia=function(V){this.zfb&&this.zfb(V?V.data:null)};id.prototype.hHi=function(V){this.A6d&&this.A6d(V?V.data:null)};id.prototype.wNa=function(V){this.Nhb&&this.Nhb(V?V.data:null)};id.prototype.V$c=function(V){for(var Pa=new Sys.StringBuilder("requestedsettings="),
Ib=0;Ib<V.count;Ib++)Pa.append(V.oa(Ib)),Ib<V.count-1&&Pa.append(";");return Pa.toString()};Object(ac.a)(id,"FirstRunExperienceRequestHandler",null,[]);uc.prototype.lKd=function(V){V?(this.Gw=V,this.n3h()&&(fc.ULS.sendTraceTag(51675532,306,50,"Initiating call to get FRE data for current user from Roaming Settings Service"),V=new Qf.a,V.add(this.Gw.FQc),this.ROb=new id(this.Gw,Object(ld.a)(this,this.SIa,"getRequestSuccessCallback"),Object(ld.a)(this,this.xia,"getRequestFailureCallback"),null,Object(ld.a)(this,
this.wNa,"postRequestFailureCallback")),this.ROb.D4c(V)),(this.Gw.Rwb||hb.AFrameworkApplication.ha.getBooleanFeatureGate("Microsoft.Office.SharedOnline.FirstRunExperienceUITest",!1))&&this.mKd()):fc.ULS.sendTraceTag(51675531,306,10,"Invalid launcherSettings")};uc.prototype.n3h=function(){try{if(this.Gw.Rwb)return!0;if(!hb.AFrameworkApplication.ha.getBooleanFeatureGate("Microsoft.Office.SharedOnline.FirstRunExperienceEnabled",!0)||hb.AFrameworkApplication.ha.ta("IsAnonymousUser"))return!1;if(this.Gw.t0h||
this.Gw.G4a||hb.AFrameworkApplication.ha.ta("IsO365ConsumerHost"))return!0;var V=hb.AFrameworkApplication.ha.Wa("FlightId");return-1!==(V?V.toString().toLowerCase():"").indexOf("firstrunexperienceui")}catch(Pa){fc.ULS.sendTraceTag(576582624,306,10,"Error checking setting {0}",Pa?Pa.toString():null)}return!1};uc.prototype.rKf=function(V){var Pa={},Ib={};Ib.FREDisplayedDate=(new Date).toUTCString();Ib.VersionDisplayed=V;Ib.RemindMeLater=!1;Pa[this.Gw.FQc]=vd.c(Ib);fc.ULS.sendTraceTag(51675533,306,50,
"Initiating call to save FRE data for current user from Roaming Settings Service");this.ROb&&this.ROb.E4c(Pa)};uc.prototype.SIa=function(V,Pa){V=V?+V.u2-+V.qE:-1;V>this.Gw.mJf?fc.ULS.sendTraceTag(51675534,306,50,"Call to Roaming Settings Service took {0}ms. This is more than the {1}ms threshold. A new attempt will be made next time the user starts a new session.",V,this.Gw.mJf):Pa?this.Nej(Pa)?(fc.ULS.sendTraceTag(51675536,306,50,"FRE data already exists for current user. FRE UI should be displayed again. User selected 'Remind me later' option more than {0} hours ago.",
this.Gw.Xff),this.mKd()):fc.ULS.sendTraceTag(51675537,306,100,"Current user has already seen this version of the FRE. No further action required."):(fc.ULS.sendTraceTag(51675535,306,50,"No FRE data found for current user. FRE UI should be displayed."),this.mKd())};uc.prototype.xia=function(V){fc.ULS.sendTraceTag(51675541,306,10,"First Run Experience failed to GET data from Roaming Settings Service with status: {0}",V?V.httpStatus:-1)};uc.prototype.wNa=function(V){fc.ULS.sendTraceTag(51675542,306,
10,"First Run Experience failed to POST data to Roaming Settings Service with status: {0}",V?V.httpStatus:-1)};uc.prototype.mKd=function(){var V=this,Pa=lf.a.instance.Uh("Common.ISystemInitiatedFeedback");Pa?this.iTf(Pa):(fc.ULS.sendTraceTag(51675543,306,50,"Error resolving ISystemInitiatedFeedback"),hb.AFrameworkApplication.ha.getBooleanFeatureGate("Microsoft.Office.SharedOnline.FirstRunExperienceUIResolveFuture",!0)&&((Pa=lf.a.instance.yc("Common.ISystemInitiatedFeedback"))?Pa.execute(function(Ib){V.iTf(Ib)}):
fc.ULS.sendTraceTag(539494111,306,50,"Error resolving ISystemInitiatedFeedback Future")))};uc.prototype.iTf=function(V){if(V){var Pa=this.Gw.Anh;Pa&&(hb.AFrameworkApplication.Zja(Pa),hb.AFrameworkApplication.qyb(Pa));fc.ULS.sendTraceTag(51675544,306,50,"Attempting to display First Run Experience UI using floodgate.",Pa);V.logActivity("ShowFirstRunExperienceUIV2",null);window.addEventListener?(this.rfb=Object(ld.a)(this,this.Iri,"onFirstRunExperienceCampaignEvent"),window.addEventListener("FGWebSurfaceEvent",
this.rfb,!0),window.addEventListener("FRELaunchedEvent",this.rfb,!0)):(fc.ULS.sendTraceTag(51675545,306,50,"FRE V2 UI triggered. Attempting to save FRE data."),this.rKf(this.Gw.currentVersion))}else fc.ULS.sendTraceTag(539494112,306,50,"Invalid ISystemInitiatedFeedback")};uc.prototype.Iri=function(V){if(V){var Pa=V.detail;V=V.type;var Ib=this.Gw&&this.Gw.campaignId?this.Gw.campaignId.split("-")[0]:null;if("FRELaunchedEvent"===V||Ib&&Pa&&Pa.id&&-1!==Pa.id.indexOf(Ib))Pa.success&&(fc.ULS.sendTraceTag(51675546,
306,50,"FRE V2 UI has been launched. Attempting to save FRE data."),this.rKf(this.Gw.currentVersion)),window.removeEventListener&&(window.removeEventListener("FGWebSurfaceEvent",this.rfb,!0),window.removeEventListener("FRELaunchedEvent",this.rfb,!0))}};uc.prototype.Nej=function(V){return"RemindMeLater"in V&&"FREDisplayedDate"in V&&"true"===V.RemindMeLater.toString()&&(+new Date-+new Date(V.FREDisplayedDate.toString()))/36E5>this.Gw.Xff?!0:!1};Object(ac.a)(uc,"FirstRunExperienceLauncher",null,[457]);
gc.prototype.$h=function(V){this.pb=V;this.pb.register(457,"Common.App.FirstRunExperienceLauncher.IFirstRunExperienceLauncher").Ac().Lc(function(){return new uc})};gc.prototype.init=function(){};gc.prototype.dispose=function(){};gc.main=function(){Eg.a.instance.oj(new gc)};Jl.Object.defineProperties(gc.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return"Common.App.FirstRunExperienceLauncher"}}});Object(ac.a)(gc,"FirstRunExperienceLauncherPackage",null,[8,9]);var Og=b(211),Fa=b(346),
lb=b(371),pc=b(349),qc=b(1),Md=b(36),Pd=b(10),ee=b(522),xf=b(16),Se=ee.a;Cm(wb,Se);wb.prototype.J3=function(){var V={};V.id=this.xc;var Pa=xf.a.instance.da(2145);V.DialogMessage=Pa;return V};wb.prototype.cMg=function(){fc.ULS.sendTraceTag(539760656,0,50,"ClipboardReadPermissionAskDialog OK button pressed")};Jl.Object.defineProperties(wb.prototype,{xc:{configurable:!0,enumerable:!0,get:function(){return"ClipboardReadPermissionAskDialog"}}});Object(ac.a)(wb,"ClipboardReadPermissionAskDialog",ee.a,[]);
var cf=b(50);Zd.prototype.x4e=function(V){return V?this.sessionStateId===V.sessionStateId&&this.sessionId===V.sessionId:!1};Zd.prototype.isFromCurrentSession=function(V){return this.sessionId===V.Ba.UserSessionId};Zd.prototype.Fqh=function(){var V={};V.SourceItem=this.toString();return V};Object(ac.a)(Zd,"SourceItem",null,[]);Cm(jd,Zd);jd.prototype.isEqual=function(V){return V&&Object.getType(V)===jd?this.x4e(V)&&this.activeFloatingObjectControlId===V.activeFloatingObjectControlId&&this.sheetName===
V.sheetName:!1};jd.prototype.toString=function(){return this.type.toString()};Object(ac.a)(jd,"ArtSourceItem",Zd,[]);var dh;(function(V){V[V.valid=0]="valid";V[V.notPairwiseDisjoint=1]="notPairwiseDisjoint";V[V.cutNotSupportedInDiscontinuousSelection=2]="cutNotSupportedInDiscontinuousSelection";V[V.notValidForm=3]="notValidForm";V[V.temporarilyBlockedCopy=4]="temporarilyBlockedCopy"})(dh||(dh={}));Object(ac.b)("CopySourceValidationOptions",dh);var df=b(46);Cm(Ma,Zd);Ma.prototype.isEqual=function(V){return V&&
Object.getType(V)===Ma?this.x4e(V)&&df.Q(this.ranges,V.ranges)&&this.sheetName===V.sheetName:!1};Ma.prototype.toString=function(){return df.i(this.ranges,",",this.$,!1)};Object(ac.a)(Ma,"RangeSourceItem",Zd,[]);kb.Vzj="PasteError_FailedToReadFromClipboard_UserHashMismatchError";Object(ac.a)(kb,"ExpectedErrorNames",null,[]);Pb.zV="text/plain";Pb.html="text/html";Pb.png="image/png";Pb.yN="data/shadow-workbook";Pb.X2h="metadata/is-last-copy-was-external";Pb.L_h="metadata/is-last-copy-was-external-XLO-source";
Pb.CKg="metadata/chrome-extension-id";Pb.jYc="copyId";Pb.svg="metadata/additional-signature-data-attributes";Object(ac.a)(Pb,"ClipboardDataFormat",null,[]);var Uf=b(7),bf=b(81);Ed.prototype.getParameters=function(){return this.parameters};Object(ac.a)(Ed,"MacroRecorderRangeCopyCutCellsInsertedPayload",null,[115]);var If=b(45),vf=b(20),Dg=b(34);ge.prototype.sIa=function(){return ge.JEi};ge.prototype.cyh=function(){return this.R4c&&1===this.R4c.length?this.dyh(this.R4c[0]):null};ge.prototype.dyh=function(V){var Pa=
vf.g(this.$),Ib=Pa.$a.fk(V),wc=Pa.Mg(V,Ib);Pa=Pa.rtl;if(!wc)return null;V=vf.g(this.$).Yf(Ib);var nd=V.pn;if(!nd.oe(wc))return null;wc=nd.Of(wc);var Bd=wc.topLeft.y,yd=wc.bottomRight.y,re=Pa?wc.bottomRight.x:wc.topLeft.x;wc=Pa?wc.topLeft.x:wc.bottomRight.x;var xe=new If.a(wc+(Pa?-81:81),yd+38+6);if(nd.NYa(xe))return this.n1a(V,nd,Ib,wc,yd,Pa?12:-3,66);xe=new If.a(wc+(Pa?-81:81),yd);if(nd.NYa(xe))return this.n1a(V,nd,Ib,wc,yd,Pa?20:3,22);xe=new If.a(wc,yd+38+6);if(nd.NYa(xe))return this.n1a(V,nd,Ib,
wc,yd,-81+(Pa?18:0),66);wc=new If.a(re+(Pa?81:-81),yd);if(nd.NYa(wc))return this.n1a(V,nd,Ib,re,yd,-81+(Pa?12:-6),22);yd=new If.a(re,Bd-38-6);return nd.NYa(yd)?this.n1a(V,nd,Ib,re,Bd,Pa?15:0,16):this.n1a(V,nd,Ib,Pa?nd.topLeft.x:nd.bottomRight.x,nd.bottomRight.y,-81+(Pa?15:-6),22)};ge.prototype.n1a=function(V,Pa,Ib,wc,nd,Bd,yd){var re=vf.g(this.$),xe=re.rtl;V=Sys.UI.DomElement.getLocation(V.domElement);wc=new Sys.UI.Point(wc+(xe?0:V.x)-Pa.topLeft.x,nd+V.y-Pa.topLeft.y);xe&&(re=re.view.visibleArea,
wc.x=re.bottomRight.x-re.topLeft.x-wc.x,2===Ib||4===Ib)&&(wc.x+=Pa.bottomRight.x);wc=Dg.a(this.$).NIa(wc);return new Sys.UI.Point(wc.x+Bd,wc.y+yd)};Jl.Object.defineProperties(ge.prototype,{rvg:{configurable:!0,enumerable:!0,get:function(){return this.e9f}},D$h:{configurable:!0,enumerable:!0,get:function(){return this.rfg}},TOi:{configurable:!0,enumerable:!0,get:function(){return this.cig}}});ge.JEi=["PasteRecoveryUI"];Object(ac.a)(ge,"PasteRecoveryUI",null,[606]);var Pf=b(79),gg=b(306);Nd.hng="ActiveSelection";
Nd.yN="ShadowWorkbook";Nd.D7f="GVML";Nd.zV="PlainText";Nd.html="Html";Nd.CBg="Bitmap";Object(ac.a)(Nd,"PayloadType",null,[]);Hd.yij="Slice4";Hd.zij="Slice5";Hd.Aij="Slice6";Object(ac.a)(Hd,"SliceName",null,[]);Mc.cli="NotCalled";Mc.success="Success";Mc.failed="Failed";Object(ac.a)(Mc,"SucceededPopulatingSystemClipboardOptions",null,[]);var Sb=b(351),Hc=b(874),ed;(function(V){V[V.valid=0]="valid";V[V.destinationRangesIsEmpty=1]="destinationRangesIsEmpty";V[V.discontinuousSelectionNotSupportPasteFromExternal=
2]="discontinuousSelectionNotSupportPasteFromExternal";V[V.discontinuousSelectionNotSupportPasteCrossSession=3]="discontinuousSelectionNotSupportPasteCrossSession";V[V.multipleSourcesAndMultipleDestinationsAreNotSupported=4]="multipleSourcesAndMultipleDestinationsAreNotSupported";V[V.multipleDestinationsAreNotMultiplyOfSourceRange=5]="multipleDestinationsAreNotMultiplyOfSourceRange";V[V.sourceAndDestinationAreOverlapping=6]="sourceAndDestinationAreOverlapping";V[V.copySourceNotValid=7]="copySourceNotValid";
V[V.cutNotSupportedInDiscontinuousSelection=8]="cutNotSupportedInDiscontinuousSelection";V[V.pasteLinkNotSupportMultipleDestination=9]="pasteLinkNotSupportMultipleDestination";V[V.temporarilyBlockedPaste=10]="temporarilyBlockedPaste";V[V.unknown=100]="unknown"})(ed||(ed={}));Object(ac.b)("PasteValidationOptions",ed);var Id=b(365),hf=b(160),Hf=b(58),Cg=b(43),uf=b(141),ih=b(35),qa=b(127),tb=b(148),rc=b(335),kd=b(27),Td=b(461),qe=b(9),Ne=b(273),Ja=b(106),ob=b(155),Nb=b(133),Jc=b(593),bd=b(107),Yc=b(333),
Db=Md.a;Cm(Qc,Db);Qc.prototype.Ftg=function(V){this.addHandler(Qc.Gud,V)};Qc.prototype.NUi=function(V){this.removeHandler(Qc.Gud,V)};Qc.prototype.copy=function(V){V.stopwatch=this.$.Zb.Ic("UserAction",cf.b().ji(V.ribbonCommandInfo.command)+"ClientSide");if(this.jo){var Pa=Hf.GetServiceTaskFactory.Xa(this.$.ea,478,479,0,"Microsoft.Office.Excel.WebUI.Client.Clipboard.IPasteShortcutManager"),Ib=this;ih.TaskExtensions.Da(Pa,function(){Ib.pasteShortcutManager=Pa.result},this.ma,3)}var wc=!!Zc(this.TJ);
qc.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CrossAppShadowWorkbookPaste",!1)&&!ff.a.rA&&(this.s4a=!1);this.Fv("Copy/before/"+Fa.a[V.ribbonCommandInfo.method],!1,void 0,!0,V.copyPasteTargetType).catch(function(){});var nd=-1985798686===V.ribbonCommandInfo.command;if(1===this.gridView.Ze&&(nd=this.vs.M3e(this.gridView.ga.ya.selectedRanges,nd))){var Bd=Qc.qQg(nd);this.Fxa(Bd,dh[nd],!1);return Promise.reject(!1)}V.userHash=this.userHash;V.id=Pe.a.create().toString();var yd=this,re=this;
return this.V_b.onCopy(V).then(function(xe){xe.isAsyncCopy||V.stopwatch.stop();yd.pasteIndicationManager.KAe();fc.ULS.sendTraceTag(24150883,0,50,"CopyPasteInfrastructure.OnCopy: Copy operation finished successfully. {0}",Sb.d(V));yd.Ybi(xe,wc);!V.isFormatPainter&&yd.jo&&(yd.pasteShortcutManager?yd.pasteShortcutManager.i8g():fc.ULS.shipAssertTag(537507984,0,!1,"Copy: pasteShortcutManager is null."));return Promise.resolve(!0)},function(xe){var Re=!1,Tf="none",ag=Qc.Wob,Qg=!0,Rg=-1,Hh=Qc.copyErrorName+
Qc.lHa,Fg=!1,Xg=null;if(xe){Xg=xe.copyContext;Rg=xe.reason;Hh+=Qc.zIa(xe);Uf.a.na(xe.message)||(ag=xe.message);var cg=Qc.pQg(xe);if(cg)if(3===cg.copyErrorName)Re=!0,ag=Tf="Async Copy canceled by the user.",Qg=!1;else if(kd.a.Fq(cg.ewaErrors))if(ag=re.I7b(cg.ewaErrors),kd.a.dh(cg.ewaErrors,Qc.operationSucceededWithAlert))Fg=Re=!0;else if(kd.a.dh(cg.ewaErrors,Qc.pasteDataLimitHit)||kd.a.dh(cg.ewaErrors,Qc.copyThrottlingError))Re=!0;13===xe.reason?(Re=!0,Qg=!1):11===xe.reason&&(Qg=!1)}Re?fc.ULS.sendTraceTag(36304157,
0,15,"CopyPasteInfrastructure.OnCopy: Copy operation failed with an expected error. clearStateNeeded: {0}, Friendly message: {1}, Error Message: {2}, CommandParameters: {3}",Qg,Tf,xe?re.getStringifiedError(xe):"null",Sb.d(V)):fc.ULS.sendTraceTag(24150912,0,10,"CopyPasteInfrastructure.OnCopy: Copy operation failed with an unexpected error. clearStateNeeded: {0}, Error Message: {1}, CommandParameters: {2}",Qg,xe?re.getStringifiedError(xe):"null",Sb.d(V));Qg&&re.Fv("Copy/fail/"+Fa.a[V.ribbonCommandInfo.method],
!0,void 0,void 0,V.copyPasteTargetType).catch(function(){});re.Xbi(V,Re,ag,Hh,Rg,Fg,Xg);return Promise.reject(xe)})};Qc.prototype.paste=function(V){var Pa=this;V.stopwatch=this.$.Zb.Ic("UserAction",cf.b().ji(V.ribbonCommandInfo.command)+"ClientSide");qc.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CrossAppShadowWorkbookPaste",!1)&&!ff.a.rA&&(fc.ULS.sendTraceTag(539303945,0,50,"CopyPasteInfrastructure.OnPaste: Cross-app shadow workbook paste is enabled"),this.s4a=!1,V.clipboardPicklingApiDataFormatsToRead=
[Pb.yN]);vf.g(this.$).Ui&&vf.g(this.$).Ui.Xca(this.B$c(V.ribbonCommandInfo.command),V.stopwatch.id);if(V.isPasteCommandFromRecoveryUI){var Ib=this.$.ea.Ea(406,void 0);var wc=lb.a.clone(Ib.Rld);Ib=Ib.Dld;V.pasteRecoveryCachedClipboardItems=Ib?Ib[Qc.HEi]:null}else wc=lb.a.clone(this.gridView.ga.ya.selectedRanges);V.originalDestinations=wc;V.expandDestinations=this.GTc(V.originalDestinations,V.commandType);if(this.UTc(V.commandType,V.expandDestinations)||this.GHg())return V.userHash=this.userHash,V.id=
Pe.a.create().toString(),qc.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.PerfImpactExperimentForAsyncApi",!1)&&!ff.a.rA&&(V.clipboardReadPermissionPromptShown=!1,V.clipboardAsyncApiDataFormatsToRead=[Pb.zV+"Async"],this.V_b.shouldShowClipboardReadPermissionDialog().then(function(nd){nd&&(V.clipboardReadPermissionPromptShown=!0,new wb(Pa.$));return Promise.resolve(!0)},function(){return Promise.resolve(!0)})),this.V_b.onPaste(V).then(function(nd){return Pa.Sic(nd,V)},function(nd){return Pa.jBb(V,
nd)});this.i3e&&this.$.Re(927125067,Pf.a.Yb,30,null);fc.ULS.sendTraceTag(24150913,0,15,'CopyPasteInfrastructure.OnPaste: paste was triggered but the estimated destination range is not editable, do nothing. ExpandDestinations: {0}, CommandType: {1}, copyPasteTargetType="{2}"',df.i(V.expandDestinations,",",this.$,!1),V.commandType,V.copyPasteTargetType);return Promise.resolve(!0)};Qc.prototype.B$c=function(V){if(qc.EwaSettings.isChangeGateEnabled("OfficeVSO:4313497_PasteOptionPerfTelemetry"))switch(V){case 1804571062:return 6;
case -185374993:return 7;case 1766348718:return 8}return 3};Qc.prototype.GHg=function(){return!!vf.g(this.$).ga.Sa.activeFloatingObjectControlId&&this.$.qt(null,!1,470)};Qc.prototype.Fxb=function(){var V=Zc(this.TJ);return V&&V.commandParameters?V.commandParameters.copyPasteTargetType:0};Qc.prototype.W2h=function(){return!!Zc(this.TJ)&&ae(Zc(this.TJ),this.$)};Qc.prototype.Fv=function(V,Pa,Ib,wc,nd){var Bd=this;Ib=void 0===Ib?!1:Ib;wc=void 0===wc?!1:wc;nd=void 0===nd?0:nd;try{this.jo&&this.pasteShortcutManager&&
this.pasteShortcutManager.m2b();var yd=nd,re=this.B9h();if(!wc&&2===re)return fc.ULS.sendTraceTag(36304158,0,50,"CopyPasteInfrastructure.ClearState clipboard won't be cleared as there's art in the clipboard. clearClipboardContent = '{0}', isExplicit = '{1}', isForce = '{2}', Current CCP operation copyPasteTargetType = '{3}', LastCopyPasteTargetType = '{4}'",Pa,Ib,wc,nd,re),Promise.reject(null);yd||(yd=re);var xe=this.$.Zb.Ic("UserAction","ClearCopyState"),Re=xe.id;fc.ULS.sendTraceTag(24150914,0,50,
"CopyPasteInfrastructure.ClearState clear clipboard state. clearClipboardContent = '{0}', isExplicit = '{1}', isForce = '{2}', Current CCP operation copyPasteTargetType = '{3}', LastCopyPasteTargetType = '{4}'",Pa,Ib,wc,nd,re);this.vs.eub();this.YLi();return this.V_b.onCancelCopy(Pa).then(function(){Pa&&qc.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CrossAppShadowWorkbookPaste",!1)&&!ff.a.rA&&(Bd.s4a=!1);xe.stop();Bd.Zbf(V,Re,!0,Ib,Pa,"","",xe.Gc,yd);return Promise.resolve(!0)},function(Tf){fc.ULS.sendTraceTag(24150915,
0,15,"CopyPasteInfrastructure.ClearState: error during call to copyPasteFlowManager.OnClear(). error: {0}",Tf?Bd.getStringifiedError(Tf):"null");xe.stop();var ag=Qc.UHg+Qc.lHa,Qg=Qc.Wob;Tf&&(ag+=Qc.zIa(Tf),Uf.a.na(Tf.message)||(Qg=Tf.message));Bd.Zbf(V,Re,!1,Ib,Pa,Qg,ag,xe.Gc,yd);return Promise.reject(Tf)})}catch(Tf){return Promise.reject(null)}};Qc.prototype.xZb=function(V,Pa,Ib,wc,nd){Ib=void 0===Ib?!1:Ib;wc=void 0===wc?!1:wc;nd=void 0===nd?0:nd;return wc||!qc.EwaSettings.ka(710)||this.Y4g()?this.Fv(V,
Pa,Ib,wc,nd):(fc.ULS.sendTraceTag(574465173,0,50,"CopyPasteInfrastructure.ClearStateOnlyIfClipboardHasContentFromSameSession clipboard won't be cleared as there is no content in the clipboard from the current session"),Promise.reject(null))};Qc.prototype.Fxa=function(V,Pa,Ib){fc.ULS.sendTraceTag(590705172,0,50,"CopyPasteInfrastructure.PopupDiscontinuousSelectionErrorDialog: Blocked CCP due to discontinuous selection, reason: {0}",Pa);if(qc.EwaSettings.isChangeGateEnabled("OfficeVSO:5352069_ReportDiscontinousCCPErrorsAsQos")){var wc=
new bd.a;wc.ja("reason",Pa);Jc.a(ob.a.discontinuousSelectionBlocking,[Ib?Nb.a.DEi:Nb.a.eRg],!0,!0,!1,!1,wc)}V=kd.a.Ad(1,1,721,V,0,371863010,"DiscontinuousSelectionBlocking");qc.EwaSettings.rC()?new rc.a(this.$,V):(V=new tb.ErrorDialog(this.$,V),V.initialize(),V.Bf())};Qc.prototype.B9h=function(){var V=Zc(this.TJ);return V&&V.sourceItem?Object.getType(V.sourceItem)===jd?2:1:0};Qc.prototype.dragDropCells=function(V,Pa,Ib,wc,nd){var Bd=this;nd=void 0===nd?!1:nd;V.stopwatch=this.$.Zb.Ic("UserAction",
"DragDropClientSide");this.Fv("DragDrop/before/"+Fa.a[V.ribbonCommandInfo.method],!1,void 0,void 0,V.copyPasteTargetType).catch(function(){});var yd=nd?2:1,re=0;re=nd?4:wc?256:128;var xe={encounteredDeploymentErrors:!1};xe.commandParameters=V;V.userHash=this.userHash;V.id=Pe.a.create().toString();return this.vs.pasteRange(V.ribbonCommandInfo,df.q(Pa,this.$),df.q(Ib,this.$),yd,re,[V.stopwatch],xe,!1).then(function(){fc.ULS.sendTraceTag(36975680,0,50,'CopyPasteInfrastructure.DragDropCells: success. copyPasteTargetType="{0}"',
V.copyPasteTargetType);Bd.gridView.ga.selectionType=-1;Bd.pnd(V,yd,Pa,Ib,xe);return Promise.resolve(!0)},function(Re){fc.ULS.sendTraceTag(36975681,0,10,'CopyPasteInfrastructure.DragDropCells: {0}, copyPasteTargetType="{1}"',Re?Bd.getStringifiedError(Re):"null",V.copyPasteTargetType);return Bd.Xsd(Re,V,yd,Pa,Ib,xe)})};Qc.prototype.t5g=function(V,Pa,Ib,wc,nd){var Bd=this;nd=void 0===nd?!1:nd;V.stopwatch=this.$.Zb.Ic("UserAction","DragDropReplaceClientSide");this.xZb("DragDropReplace/before/"+Fa.a[V.ribbonCommandInfo.method],
!1,void 0,void 0,V.copyPasteTargetType).catch(function(){});var yd=nd?2:1,re=0;re=nd?4:wc?256:128;var xe={encounteredDeploymentErrors:!1};xe.commandParameters=V;qc.EwaSettings.getBooleanFeatureGate(gg.a.zpb,!1)&&(V.isDragInsert=!1);V.userHash=this.userHash;V.id=Pe.a.create().toString();return this.vs.pasteRange(V.ribbonCommandInfo,df.q(Pa,this.$),df.q(Ib,this.$),yd,re,[V.stopwatch],xe,!1).then(function(){fc.ULS.sendTraceTag(540386466,0,50,'CopyPasteInfrastructure.DragDropReplaceCells: success. copyPasteTargetType="{0}"',
V.copyPasteTargetType);Bd.gridView.ga.selectionType=-1;Bd.pnd(V,yd,Pa,Ib,xe);return Promise.resolve(!0)},function(Re){fc.ULS.sendTraceTag(540386465,0,10,'CopyPasteInfrastructure.DragDropReplaceCells: {0}, copyPasteTargetType="{1}"',Re?Bd.getStringifiedError(Re):"null",V.copyPasteTargetType);return Bd.Xsd(Re,V,yd,Pa,Ib,xe)})};Qc.prototype.r5g=function(V,Pa,Ib,wc,nd){var Bd=this;nd=void 0===nd?!1:nd;V.stopwatch=this.$.Zb.Ic("UserAction","DragDropInsertClientSide");this.xZb("DragDropInsert/before/"+
Fa.a[V.ribbonCommandInfo.method],!1,void 0,void 0,V.copyPasteTargetType).catch(function(){});var yd=nd?2:1,re=df.K(this.GTc([Ib],yd)),xe=this.$.fa.sa.sheetName,Re=this.$.fa.sa.sheetName,Tf=df.v(Pa,this.$);Tf.SheetName=xe;var ag=df.v(re,this.$);ag.SheetName=Re;var Qg=re.isRow||Pa.isRow||wc?1:0;var Rg={encounteredDeploymentErrors:!1};V.isDragInsert=!0;Rg.commandParameters=V;V.userHash=this.userHash;V.id=Pe.a.create().toString();wc=new Promise(function(Fg,Xg){Bd.executeInsertCopiedCutCellsOperation(Tf,
ag,nd,Qg,V.ribbonCommandInfo,function(cg){Rg.requestTelemetryData=cg.RequestTelemetryData;cg.Errors&&0<cg.Errors.length?Xg(new Hc.a(21,cg.Errors)):Fg(!0)},function(cg){cg=qa.a.Eg(cg.data);Xg(new Hc.a(21,cg))}).continueWith(function(){nd?Bd.vs.eub():Bd.xZb("DragDropInsert/success/"+Fa.a[V.ribbonCommandInfo.method],!0)})});var Hh=this;return Yc.c(wc.then(function(){fc.ULS.sendTraceTag(537518867,0,50,'CopyPasteInfrastructure.DragDropInsertCells: success. copyPasteTargetType="{0}"',V.copyPasteTargetType);
Bd.gridView.ga.selectionType=-1;Bd.pnd(V,yd,Pa,Ib,Rg);return Promise.resolve(!0)},function(Fg){fc.ULS.sendTraceTag(537518866,0,10,'CopyPasteInfrastructure.DragDropInsertCells: {0}, copyPasteTargetType="{1}"',Fg?Hh.getStringifiedError(Fg):"null",V.copyPasteTargetType);return Hh.Xsd(Fg,V,yd,Pa,Ib,Rg)})).CWR(function(){return!0})};Qc.prototype.fXh=function(V,Pa){var Ib=this,wc=Zc(this.TJ);if(!wc)return fc.ULS.sendTraceTag(25518403,0,50,"InsertCopiedCutCells: CopyContext must not be null or undefined"),
Ud.Task.Ua(!1);if(!yb(wc.sourceItem))return fc.ULS.sendTraceTag(36824457,0,50,"InsertCopiedCutCells: CopyContext must be a Range"),Ud.Task.Ua(!1);var nd=wc.sourceItem;if(!nd)return fc.ULS.shipAssertTag(25518404,0,!!nd,"InsertCopiedCutCells: rangeSourceItem must not be null or undefined"),Ud.Task.Ua(!1);if(!nd.isFromCurrentSession(this.$))return fc.ULS.sendTraceTag(34981187,0,50,"InsertCopiedCutCells: rangeSourceItem is from a different session"),Ud.Task.Ua(!1);if(1<nd.ranges.length)return fc.ULS.sendTraceTag(595185888,
0,50,"InsertCopiedCutCells: multiple source ranges are not supported"),this.Fxa(2091,"InsertCopiedCutCells",!0),Ud.Task.Ua(!1);wc=df.K(nd.ranges);var Bd=this.gridView.ga.ya.Xd.clone();V=df.K(this.GTc([Bd],V));var yd=this.P$e();nd=nd.sheetName;Bd=this.$.fa.sa.sheetName;var re=df.v(wc,this.$);re.SheetName=nd;var xe=df.v(V,this.$);xe.SheetName=Bd;return(V.Yh||wc.Yh?Ud.Task.Ua(0):V.isRow||wc.isRow?Ud.Task.Ua(1):this.gXh.e0b(this.$,vf.g(this.$).rtl)).CWR(function(Re){return Ib.executeInsertCopiedCutCellsOperation(re,
xe,yd,Re.result,Pa)}).continueWith(function(){yd?Ib.vs.eub():Ib.Fv("InsertCopiedCutCells/success/"+Fa.a[Pa.method],!0)})};Qc.prototype.Xhd=function(){var V=Zc(this.TJ),Pa=this.gridView.ga.ya.Eh;return!!V&&yb(V.sourceItem)&&Pa&&1===V.sourceItem.ranges.length};Qc.prototype.P$e=function(){return this.Q$e(-911352779)};Qc.prototype.qec=function(){return this.Q$e(-1985798686)};Qc.prototype.UTc=function(V,Pa){var Ib=new uf.a(this.$.Aa),wc=36===V,nd=Ib.Ke(4);V=2===this.Fxb()&&Ib.Ke(1);wc=wc&&nd;Ib=!this.i3e||
!Ib.vj||!this.qec()||!uf.a.M2b(Pa,vf.g(this.$));return wc||V||this.$.qt(Pa,!0)&&Ib};Qc.prototype.Rbc=function(V,Pa){return this.vs.Rbc(V,Pa)};Qc.prototype.dispose=function(){Db.prototype.dispose.call(this);this.sm();this.TJ.removeMetadataChangeListener(Qc.Rff)};Qc.prototype.n1c=function(V,Pa,Ib,wc,nd,Bd){if(!this.OLg(V.commandParameters.ribbonCommandInfo.command))return V.cseStatus=2,!1;if(Bd&&Pa.oe(wc))return V.cseStatus=4,!1;if(Ib!==nd)return V.cseStatus=6,!1;if(qc.EwaSettings.isChangeGateEnabled("OfficeVSO:5593878_PasteCSE_CCPErrorTests")){if(wc.width%
Pa.width||wc.height%Pa.height)return V.cseStatus=16,!1;if(Bd&&1!==wc.XO&&wc.XO!==Pa.XO)return V.cseStatus=17,!1}Pa=Pa.Of(this.gridView.Ph);wc=wc.Of(this.gridView.Ph);if(!Pa||!wc)return V.cseStatus=7,!1;nd=df.v(Pa,this.$);nd.SheetName=Ib;Ib=this.Fi.GEi(this.gridView,nd,df.v(wc,this.$),V.commandParameters.ribbonCommandInfo.command,V.commandParameters.stopwatch);1===Ib&&(Bd&&(this.Fi.MVc(Pa,!1),this.Fi.MVc(Pa,!0)),-185374993===V.commandParameters.ribbonCommandInfo.command&&vf.g(this.$).KLi(),this.pasteIndicationManager.Zcd(V.commandParameters.id),
this.tpc(V.commandParameters.expandDestinations,V.commandParameters.isPasteCommandFromRecoveryUI),this.tqe("DoPasteClientEstimation/"+Fa.a[V.commandParameters.ribbonCommandInfo.method],V));V.cseStatus=Ib;return 1===Ib};Qc.prototype.exf=function(){this.copyPasteShortcutDialogFactory.create(this.$).showDialog(!0,!1,!1,Object(ld.a)(this,this.Ldi,"logShortcutDialogAndRestoreFocus"))};Qc.prototype.udi=function(V,Pa,Ib,wc){V=Zb(V,Pa,Ib,wc,this.$.Ba.UserSessionId);V.k=!0;cf.b().Se(45,V,!0)};Qc.prototype.Axi=
function(V,Pa,Ib,wc,nd){var Bd=!1,yd=!1,re=Qc.Wob,xe=Qc.OAe+Qc.lHa;V&&(xe+=Qc.zIa(V),kd.a.Fq(V.ewaErrors)?(re=this.I7b(V.ewaErrors),kd.a.dh(V.ewaErrors,[-103190598])&&(Bd=!0)):V.message&&(re=V.message));yd||(yd=this.qhd(V));Pa=Zb(Pa,Ib,wc,nd,this.$.Ba.UserSessionId);Pa.k=!1;Pa.l=yd;Pa.n=re;Pa.p=xe;Pa.q=Bd;cf.b().Se(45,Pa,!0);return Promise.reject(V)};Qc.prototype.OLg=function(V){switch(V){case 237279923:case 808159687:return gg.a.c4h;case -185374993:return!0;case 1804571062:return!0;default:return!1}};
Qc.prototype.Q$e=function(V){var Pa=Zc(this.TJ);if(!Pa)return!1;var Ib=Pa.sourceItem;return Ib&&!Ib.isFromCurrentSession(this.$)?(fc.ULS.sendTraceTag(34981188,0,50,"CopyPasteInfrastructure.LastOperationWasCopyCut: Last copy operation was from a different session."),!1):Pa.commandParameters.ribbonCommandInfo.command===V};Qc.prototype.Y4g=function(){var V=Zc(this.TJ);return V?(V=V.sourceItem)&&!V.isFromCurrentSession(this.$)?(fc.ULS.sendTraceTag(574465172,0,50,"CopyPasteInfrastructure.DoesClipboardHaveCopiedOrCutContent: Last copy/cut operation was from a different session."),
!1):!0:!1};Qc.prototype.executeInsertCopiedCutCellsOperation=function(V,Pa,Ib,wc,nd,Bd,yd){function re(){return new Ed(xe)}Bd=void 0===Bd?null:Bd;yd=void 0===yd?null:yd;var xe={};xe.InsertDirection=wc;xe.SourceRange=V;xe.DestRange=Pa;xe.CopyCutOperation=Ib?0:1;var Re=this.$.ra.xa;return Id.a(this.$.userOperationManager,function(Tf,ag,Qg){Tf=Bd?Ne.b(Tf,Bd):Tf;ag=yd?Ne.a(ag,yd):ag;var Rg=Re.Ra(41,null);Rg.insertCopiedCutCellsParameters=xe;return bf.i(Re,"InsertCopiedCutCells",Rg,Tf,ag,Qg,null,4)},function(Tf){return new hf.a(104,
0,Tf,void 0,re)},nd)};Qc.prototype.Qtd=function(V){this.lcj(V)&&(this.vs.eub(),fc.ULS.sendTraceTag(38922268,0,50,"CopyPasteInfrastructure.OnMetadataChanged: found that cut/copy operation was preformed in another session therefore removed the highlight in this session."))};Qc.prototype.lcj=function(V){return V&&V.lastCopy?ae(V.lastCopy,this.$):!0};Qc.prototype.NPe=function(V,Pa,Ib,wc,nd){var Bd={};Bd.a=this.$.Ba.UserSessionId;Bd.e=V.stopwatch.id;Bd.c=cf.b().ji(V.ribbonCommandInfo.command);Bd.b=Fa.a[V.ribbonCommandInfo.method];
Bd.d=V.id;Bd.f=Ib.toString();Bd.g=wc.toString();Bd.h=Pa.toString();Bd.o=V.stopwatch.Gc;Bd.q=!1;Bd.r=V.copyPasteTargetType.toString();Bd.s=nd.encounteredDeploymentErrors;qc.EwaSettings.getBooleanFeatureGate(gg.a.zpb,!1)&&(Bd.i=nd.commandParameters.dragDropIsShiftKeyDown,Bd.j=nd.commandParameters.isDragInsert);return Bd};Qc.prototype.pnd=function(V,Pa,Ib,wc,nd){V=this.NPe(V,Pa,Ib,wc,nd);V.k=!0;cf.b().Se(45,V,!0)};Qc.prototype.cci=function(V,Pa,Ib,wc,nd,Bd,yd,re,xe){V=this.NPe(V,Pa,Ib,wc,xe);V.k=!1;
V.l=nd;V.n=Bd;V.p=yd;V.q=re;cf.b().Se(45,V,!0)};Qc.prototype.Zbf=function(V,Pa,Ib,wc,nd,Bd,yd,re,xe){var Re={};Re.a=this.$.Ba.UserSessionId;Re.b=Pa;Re.c=V;Re.f=Ib;Re.e=wc;Re.d=nd;Re.g=Bd;Re.h=yd;Re.i=re;Re.j=xe.toString();cf.b().Se(46,Re,!0)};Qc.prototype.Ybi=function(V,Pa){V=this.lPe(V.commandParameters,V);V.l=!0;V.j=Pa;cf.b().Se(43,V,!0)};Qc.prototype.Xbi=function(V,Pa,Ib,wc,nd,Bd,yd){V=this.lPe(V,yd);V.l=!1;V.m=Pa;V.o=Ib;V.y=wc;V.x=nd;V.z=Bd;cf.b().Se(43,V,!0);fc.ULS.sendTraceTag(42768481,0,15,
"CopyPasteInfrastructure.LogCopyFailedTelemetry: ErrorName={0},ErrorReason={1},IsExpectedError={2},IsSucceededWithAlert={3},ErrorMessage={4}",V.y,V.x,V.m,V.z,V.o)};Qc.prototype.lPe=function(V,Pa){var Ib={};Ib.a=this.$.Ba.UserSessionId;Ib.f=V.stopwatch.id;Ib.g=V.id;Ib.c=cf.b().ji(V.ribbonCommandInfo.command);Ib.b=Fa.a[V.ribbonCommandInfo.method];Ib.q=V.stopwatch.Gc;Ib.bd=Qc.S6b();Ib.bg=V.copyPasteHandlerName;Ib.bj=void 0===V.ribbonCommandInfo.qf||null===V.ribbonCommandInfo.qf?null:pc.a[V.ribbonCommandInfo.qf];
Ib.bq=V.uploadToClipService;Ib.br=V.floatingObjectType;Ib.s=V.copyPasteTargetType.toString();Ib.bc=$c(V.copyPasteTargetType);Ib.z=!1;if(Pa){Ib.bk=Pa.id;Ib.bl=Pa.serverRequestTimeInMs;Pa.requestTelemetryData&&(Ib.bm=Pa.requestTelemetryData.EcsOperationDuration,Ib.bn=Pa.requestTelemetryData.EcsRequestDuration,Ib.bo=Pa.requestTelemetryData.WfeRequestDuration);Ib.d=Pa.sourceItem?Pa.sourceItem.toString():null;Ib.e=-1;if(yb(Pa.sourceItem)){Ib.e=0;V=Ml(Pa.sourceItem.ranges);for(var wc=V.next();!wc.done;wc=
V.next())Ib.e+=wc.value.XO}Ib.h=Pa.isAsyncCopy;Ib.i=Pa.isFromCache;Ib.k=Pa.isSelectionAllowed;Ib.r=Pa.plainTextPayloadSize;Ib.u=Pa.htmlPayloadSize;Ib.v=Pa.htmlSizeExceedsLimit;Ib.w=Pa.copyTotalSizeExceedsLimit;Ib.t=Pa.shadowWorkbookPayloadSize;Ib.p=Pa.clientSideCopyTime;Ib.ba=Pa.encounteredDeploymentErrors;Ib.bb=Pa.shadowWorkbookSizeExceedsLimit;Ib.be=Pa.syncClipboardItemsKeys;Ib.bf=Pa.asyncClipboardItemsKeys;Ib.bh=this.Jte(Pa.succeededPopulatingSystemClipboardSync);Ib.bi=this.Jte(Pa.succeededPopulatingSystemClipboardAsync)}return Ib};
Qc.prototype.tpc=function(V,Pa){Pa=void 0===Pa?!1:Pa;if(!this.gridView.isEditing&&!this.gridView.wi){var Ib=this.gridView.ga.ya,wc=!Pa&&1===V.length&&df.Q(V,Ib.selectedRanges),nd=wc?Ib.activeCell:V[0].topLeft;V[0].contains(nd)||(fc.ULS.shipAssertTag(570770703,0,!1,"CopyPasteInfrastructure.SelectPastedRange: SelectedRanges {0}, IndexOfActiveRange {1}, ActiveCell {2}, calculatedDestinationRanges {3}, keepThePreviousActiveCell {4}, newActiveCell {5}, isPasteCommandFromRecoveryUI {6}",Ib.selectedRanges,
Ib.pA,Ib.activeCell,V,wc,nd,Pa),nd=V[0].topLeft);this.gridView.ga.dD(V,0,nd,0,void 0,Ja.a.iRg)}};Qc.prototype.bTe=function(V,Pa){var Ib={};Ib.a=this.$.Ba.UserSessionId;Ib.g=V.stopwatch.id;Ib.t=V.stopwatch.Gc;Ib.bz=!1;Pa&&(Ib.bv=Pa.id,Ib.bw=Pa.serverRequestTimeInMs,Ib.n=Pa.commandParameters.clipboardFormatReadTimes,Ib.o=Pa.commandParameters.clipboardFormatReadStatus,Ib.p=Pa.commandParameters.clipboardReadPermissionPromptShown,Ib.q=Pa.commandParameters.asyncApiReadTimedOut,Pa.requestTelemetryData&&
(Ib.cb=Pa.requestTelemetryData.EcsOperationDuration,Ib.cc=Pa.requestTelemetryData.EcsRequestDuration,Ib.cd=Pa.requestTelemetryData.WfeRequestDuration));Ib.x=V.copyPasteTargetType.toString();Ib.bl=$c(V.copyPasteTargetType);Ib.br=V.copyPasteHandlerName;Ib.i=df.i(V.expandDestinations,",",this.$,!1);Ib.h=df.i(V.originalDestinations,",",this.$,!1);Ib.e=V.id;Ib.d=V.commandType;Ib.c=cf.b().ji(V.ribbonCommandInfo.command);Ib.b=Fa.a[V.ribbonCommandInfo.method];Ib.bf=!1;Ib.bg=!1;Ib.bp=Qc.S6b();Ib.bt=void 0===
V.ribbonCommandInfo.qf||null===V.ribbonCommandInfo.qf?null:pc.a[V.ribbonCommandInfo.qf];Ib.cj=V.isPasteCommandFromEnterShortcut;if(Ib.ca=V.isPasteCommandFromRecoveryUI)Ib.cf=V.pasteRecoveryUndoStopwatch.id,Ib.cg=V.pasteRecoveryUndoStopwatch.Gc;if(Pa){if((V=Pa.copyContextSnapshot)&&!Pa.wasLastCopyExternal){Ib.f=V.commandParameters.id;Ib.j=V.sourceItem.toString();Ib.k=-1;if(yb(V.sourceItem)){Ib.k=0;for(var wc=Ml(V.sourceItem.ranges),nd=wc.next();!nd.done;nd=wc.next())Ib.k+=nd.value.XO}Ib.bg=1===V.commandParameters.commandType}else Pa.clipboardItems?
Ib.f=Pa.clipboardItems.getItem(Pb.jYc):fc.ULS.sendTraceTag(50647260,0,50,"CopyPasteInfrastructure.GetPasteUsageData: pasteContext.ClipboardItems is null");Ib.bz=Pa.pasteRecoveryUIDisplayed;Ib.ci=Pa.cseStatus}else fc.ULS.sendTraceTag(50647261,0,50,"CopyPasteInfrastructure.GetPasteUsageData: pasteContext is null");return Ib};Qc.prototype.hdi=function(V,Pa,Ib,wc,nd,Bd,yd,re,xe){V=this.bTe(V,re);V.l=!1;V.m=Pa;V.s=Ib;V.bc=wc;V.be=nd;V.bd=Bd;V.bf=yd;re?(V.y=Ue(re)||!re.copyContextSnapshot,V.bi=!V.y&&ae(re.copyContextSnapshot,
this.$),V.bj=re.shadowWorkbookSizeExceedsLimit,V.v=re.shadowWorkbookPayloadSize,V.w=re.htmlPayloadSize,V.bq=Cb(re.clipboardItems),V.bb=re.activeSelectionType,V.bs=re.isSameSession,V.bn=re.payloadOrigin,V.bo=re.payloadType,V.bu=re.externalAppSource,V.bx=re.indicationDisplayScheduled,V.by=re.pasteIndicationDisplayStatus):V.bi=ae(xe,this.$);cf.b().Se(44,V,!0);fc.ULS.sendTraceTag(42768482,0,15,"CopyPasteInfrastructure.LogPasteFailedTelemetry: ErrorName={0},ErrorReason={1},IsExpectedError={2},IsSucceededWithAlert={3},ErrorMessage={4}",
V.be,V.bd,V.m,V.bf,V.s)};Qc.prototype.idi=function(V){var Pa=this.bTe(V.commandParameters,V);Pa.y=V.wasLastCopyExternal;Pa.l=!0;Pa.u=V.plainTextPayloadSize;Pa.v=V.shadowWorkbookPayloadSize;Pa.w=V.htmlPayloadSize;Pa.z=V.isClipboardDataContainShadowWorkbook;Pa.ba=V.isShadowWorkbookParsedSuccessfully;Pa.bb=V.activeSelectionType;Pa.bc=V.pasteResult;Pa.bh=V.encounteredDeploymentErrors;Pa.bj=V.shadowWorkbookSizeExceedsLimit;Pa.bk=he(V);Pa.bq=Cb(V.clipboardItems);Pa.bs=V.isSameSession;Pa.bn=V.payloadOrigin;
Pa.bo=V.payloadType;Pa.bu=V.externalAppSource;Pa.bx=V.indicationDisplayScheduled;Pa.by=V.pasteIndicationDisplayStatus;Pa.bm=V.clipboardItems?V.clipboardItems.getItem(Pb.CKg):null;Pa.bi=!V.isSameSession&&!V.wasLastCopyExternal;cf.b().Se(44,Pa,!0)};Qc.prototype.Xj=function(){this.$.Aa.Vf(Object(ld.a)(this,this.Ii,"onActiveSheetChanged"));this.$.Aa.Osg(Object(ld.a)(this,this.vic,"onItemDeleting"));this.$.userOperationManager.CB(Object(ld.a)(this,this.NQ,"onQueueItemChanged"));this.$.Nk(Object(ld.a)(this,
this.sd,"onWorkbookOpened"));vf.g(this.$).Hc.Cm(Object(ld.a)(this,this.BBb,"onStartEdit"))};Qc.prototype.sm=function(){this.$&&this.$.Aa&&(this.$.Aa.wg(Object(ld.a)(this,this.Ii,"onActiveSheetChanged")),this.$.Aa.eUi(Object(ld.a)(this,this.vic,"onItemDeleting")));this.$&&this.$.userOperationManager&&this.$.userOperationManager.WC(Object(ld.a)(this,this.NQ,"onQueueItemChanged"));this.gridView&&this.gridView.Hc&&this.gridView.Hc.mm(Object(ld.a)(this,this.BBb,"onStartEdit"))};Qc.prototype.jBb=function(V,
Pa){var Ib=null,wc=!1,nd=null,Bd="UnknownFailure",yd=-1,re=Qc.Wob,xe=Qc.pasteErrorName+Qc.lHa,Re=!1;this.pasteIndicationManager.Zcd(V.id);var Tf=Zc(this.TJ);(V.clearStateOnFinish||V.clearSystemClipboard)&&this.Fv("Paste/fail/"+Fa.a[V.ribbonCommandInfo.method],!0,void 0,void 0,V.copyPasteTargetType).catch(function(){});if(Pa){yd=Pa.reason;xe+=Qc.zIa(Pa);Uf.a.na(Pa.message)||(re=Pa.message);if(Ib=Qc.CQg(Pa))if(1===Ib.pasteErrorName)wc=!0,Bd="CopyPasteLengthTooLongPopup",re=nd="The pasted content is too long. Popup a dialog to the user.",
fc.ULS.sendTraceTag(25216992,0,15,'CopyPasteInfrastructure.OnPasteFailed: {0}, copyPasteTargetType="{1}"',nd,V.copyPasteTargetType),Ib=kd.a.Ad(1,0,26,662,0,1306609195,"CopyPasteOversizeError"),qc.EwaSettings.rC()?new rc.a(this.$,Ib):(Ib=new tb.ErrorDialog(this.$,Ib),Ib.initialize(),Ib.Bf());else if(7===Ib.pasteErrorName)wc=!0,Bd="No-Op",re=nd="The shadow workbook is not ready yet and an async copy failed to populate the clipboard. Do nothing (by the spec)",fc.ULS.sendTraceTag(33948251,0,15,'CopyPasteInfrastructure.OnPasteFailed: {0}, copyPasteTargetType="{1}"',
nd,V.copyPasteTargetType);else if(8===Ib.pasteErrorName)wc=!0,Bd="UseShortcutsPopup",re=nd="Unable to paste content from the system clipboard. Popup dialog to the user.",fc.ULS.sendTraceTag(25216994,0,15,'CopyPasteInfrastructure.OnPasteFailed: {0}, copyPasteTargetType="{1}"',nd,V.copyPasteTargetType),this.exf();else if(18===Ib.pasteErrorName){wc=!0;Bd="PasteExternalNotSupportMultipleSelectionPopup";re="Paste external not support multiple selection.";nd="Unknown";var ag=2091;100!==Ib.validationFailureReason&&
(nd=ed[Ib.validationFailureReason],ag=Qc.Cte(Ib.validationFailureReason));this.Fxa(ag,nd,!0)}else 20===Ib.pasteErrorName||19===Ib.pasteErrorName?(wc=!0,20===Ib.pasteErrorName?(Bd="PasteAcrossSessionNotSupportMultipleSelectionPopup",re="Paste across session does not support multiple selection."):(Bd="PasteInSameSessionNotSupportMultipleSelectionPopup",re="This kind of multiple selection is not supported for same session paste."),nd="Unknown",ag=2091,100!==Ib.validationFailureReason&&(nd=ed[Ib.validationFailureReason],
ag=Qc.Cte(Ib.validationFailureReason)),Ib=6===Ib.validationFailureReason,this.UTc(V.commandType,V.expandDestinations)&&Ib&&this.tpc(V.expandDestinations),this.Fxa(ag,nd,!0)):6===Ib.pasteErrorName?(wc=!0,Bd="No-Op",re=nd="Paste Formatting/Transpose is not yet a supported operation on System Clipboard based content",fc.ULS.sendTraceTag(36263241,0,15,'CopyPasteInfrastructure.OnPasteFailed: {0}, copyPasteTargetType="{1}"',nd,V.copyPasteTargetType)):17===Ib.pasteErrorName?(wc=!0,Bd="No-Op",re=nd="Paste text on Art is not yet a supported operation",
fc.ULS.sendTraceTag(0,0,15,'CopyPasteInfrastructure.OnPasteFailed: {0}, copyPasteTargetType="{1}"',nd,V.copyPasteTargetType)):16===Ib.pasteErrorName?(wc=!0,Bd="No-Op",re=nd="Paste has failed because the previous copy has failed",fc.ULS.sendTraceTag(40147082,0,15,'CopyPasteInfrastructure.OnPasteFailed: {0}, copyPasteTargetType="{1}", error={2}',nd,V.copyPasteTargetType,this.getStringifiedError(Ib))):kd.a.Fq(Ib.ewaErrors)?(kd.a.Z8(Ib.ewaErrors)||kd.a.dh(Ib.ewaErrors,kd.a.l9b())?(wc=!0,Bd="CommunicationError",
nd=kd.a.fd(Ib.ewaErrors),fc.ULS.sendTraceTag(36304159,0,15,'CopyPasteInfrastructure.OnPasteFailed: {0} copyPasteTargetType="{1}"',re,V.copyPasteTargetType)):kd.a.dh(Ib.ewaErrors,Qc.y1i)?(wc=!0,Bd="SavingWorkbookError",nd=kd.a.fd(Ib.ewaErrors),fc.ULS.sendTraceTag(36304160,0,15,'CopyPasteInfrastructure.OnPasteFailed: {0} copyPasteTargetType="{1}"',re,V.copyPasteTargetType)):kd.a.dh(Ib.ewaErrors,Qc.operationSucceededWithAlert)&&(Re=wc=!0,Bd="OperationSucceededWithAlert",nd=kd.a.fd(Ib.ewaErrors),fc.ULS.sendTraceTag(36304161,
0,15,'CopyPasteInfrastructure.OnPasteFailed: {0} copyPasteTargetType="{1}"',re,V.copyPasteTargetType)),wc||(re=this.I7b(Ib.ewaErrors),wc=this.qhd(Pa))):11===Ib.pasteErrorName&&(wc=!0,Bd="No-Op",re="Paste has failed because user try copy cross-session oart object");15===Pa.reason&&(wc=!0,Bd="No-Op",re="Rejecting deferred paste there is metadata update without copy context. Usually it means that copy canceled before finished.");Uf.a.equals(xe,kb.Vzj,!1)&&(wc=!0,Bd="No-Op",re="User hash of the copy is different then the user hash of the paste during cross-session copy-paste. Do nothing.")}wc||
fc.ULS.sendTraceTag(24150916,0,10,'CopyPasteInfrastructure.OnPasteFailed: {0}, copyPasteTargetType="{1}"',Pa?this.getStringifiedError(Pa):"null",V.copyPasteTargetType);this.hdi(V,wc,re,Bd,xe,yd,Re,Pa.pasteContext,Tf);return Promise.reject(Pa)};Qc.prototype.Sic=function(V,Pa){fc.ULS.sendTraceTag(24150917,0,50,'CopyPasteInfrastructure.OnPasteSuccess: paste succeed. copyPasteTargetType="{0}"',Pa.copyPasteTargetType);this.pasteIndicationManager.Zcd(Pa.id);if(this.MEi(Pa.copyPasteTargetType,V)){qc.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CrossAppShadowWorkbookPaste",
!1)&&!ff.a.rA&&V.wasLastCopyExternal&&V.payloadType===Nd.yN&&(this.s4a=!0);var Ib=null;V.pastedRange&&V.pastedRange.Ranges&&0<V.pastedRange.Ranges.length?Ib=df.g(V.pastedRange.Ranges):V.wasLastCopyExternal||(Ib=Pa.expandDestinations);this.h3i(V,Ib);if(this.eej(V,Ib)){var wc=lb.a.clone(Pa.originalDestinations);Ib=1028===Pa.commandType?lb.a.clone(Pa.expandDestinations):lb.a.clone(Ib);var nd=null;V.wasLastCopyExternal&&(Pa.isKeyboardEvent||Pa.isPasteCommandFromRecoveryUI)&&(nd={},nd=(nd.PasteRecoveryCachedClipboardItems=
V.clipboardItems,nd));V.pasteRecoveryUIDisplayed=!0;var Bd=new ge(this.$,wc,Ib,nd),yd=Hf.GetServiceTaskFactory.Xa(this.$.ea,406,405,0,"Microsoft.Office.Excel.WebUI.Client.RecoveryUI.IRecoveryUIController");ih.TaskExtensions.Da(yd,function(){var re=yd.result;re.BBg(Bd);re.phj(Pa.ribbonCommandInfo.method)},this.ma,3)}}this.tqe("Paste/success/"+Fa.a[Pa.ribbonCommandInfo.method],V);this.idi(V);this.uSf&&(!Pa.isKeyboardEvent||he(V))&&this.$.fa.gh.get(66)&&(fc.ULS.sendTraceTag(42824788,0,15,"CopyPasteInfrastructure.OnPasteSuccess: show localStorage disable notification"),
this.uSf=!1,this.aSg());return Promise.resolve(!0)};Qc.prototype.eej=function(V,Pa){return!Pa||1!==Pa.length||V.commandParameters.clearSystemClipboard||V.commandParameters.clearStateOnFinish||V.commandParameters.skipClipboardAccess?!1:Ue(V)&&(Pa=V.clipboardItems.getItem(Pb.zV),V=V.clipboardItems.getItem(Pb.html),void 0===Pa||null===Pa||Pa.length>this.Zod||void 0===V||null===V||V.length>this.WLa)?(fc.ULS.sendTraceTag(576811736,0,50,"CopyPasteInfrastructure.ShouldShowPasteRecoveryUI: Not showing PasteRecoveryUI for external copy."),
!1):!0};Qc.prototype.MEi=function(V,Pa){return 1===V||Pa.payloadType===Nd.zV||qc.EwaSettings.ka(164)&&Pa.payloadType===Nd.html||qc.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CrossAppShadowWorkbookPaste",!1)&&!ff.a.rA&&Pa.payloadType===Nd.yN};Qc.prototype.tqe=function(V,Pa){var Ib=this,wc;(function(){var nd=Ib.K_h(Pa);wc=nd.kFa;return nd})().returnValue&&this.Fv(V,wc,void 0,void 0,Pa.commandParameters.copyPasteTargetType).catch(function(){})};Qc.prototype.Ldi=function(V,Pa){fc.ULS.sendTraceTag(37364764,
0,50,"CopyPasteInfrastructure.LogShortcutDialogAndRestoreFocus: Got shortcut dialog, user pressed [{0}]. userPressedExtensionLink={1}",V,Pa);this.gridView.focus()};Qc.prototype.Xsd=function(V,Pa,Ib,wc,nd,Bd){fc.ULS.sendTraceTag(24150918,0,10,"CopyPasteInfrastructure.OnDragAndDropCellsFailed: {0}",V?this.getStringifiedError(V):"null");var yd=!1,re=!1,xe=!1,Re=Qc.Wob,Tf=Qc.OAe+Qc.lHa;V&&(Tf+=Qc.zIa(V),kd.a.Fq(V.ewaErrors)?(Re=this.I7b(V.ewaErrors),kd.a.dh(V.ewaErrors,Qc.operationSucceededWithAlert)&&
(yd=!0),kd.a.dh(V.ewaErrors,Qc.dragDropNonEmptyRange)&&(re=xe=!0)):V.message&&(Re=V.message));xe||(xe=this.qhd(V));re?this.gridView.ga.selectionType=-1:this.vs.WOi(nd);this.cci(Pa,Ib,wc,nd,xe,Re,Tf,yd,Bd);return Promise.reject(V)};Qc.prototype.GTc=function(V,Pa){var Ib=V,wc=this.ZBh();wc&&wc.ranges&&(Ib=this.vs.RGg(Pa,wc.ranges,V));return Ib};Qc.prototype.ZBh=function(){var V=Zc(this.TJ);return V&&yb(V.sourceItem)?V.sourceItem:null};Qc.prototype.YLi=function(){this.raiseEvent(Qc.Gud,null)};Qc.prototype.h3i=
function(V,Pa){var Ib=V.commandParameters.originalDestinations;Pa&&(df.Q(this.gridView.ga.ya.selectedRanges,Ib)?(this.tpc(Pa),fc.ULS.sendTraceTag(24150919,0,50,"CopyPasteInfrastructure.SelectPastedRangeIfNeeded: select paste range, range: {0}",qe.HelperMethods.tlb(Pa))):V.commandParameters.isPasteCommandFromRecoveryUI?(this.tpc(Pa,!0),fc.ULS.sendTraceTag(577279757,0,50,"CopyPasteInfrastructure.SelectPastedRangeIfNeeded: select paste range for IsPasteCommandFromRecoveryUI, range: {0}, active cell: {1}",
Pa,Pa[0].topLeft)):fc.ULS.sendTraceTag(24150920,0,50,"CopyPasteInfrastructure.SelectPastedRangeIfNeeded: user change his selection during paste operation. don't change selection. originalPasteDestinations: {0}",qe.HelperMethods.tlb(Ib)))};Qc.prototype.K_h=function(V){if(V.isPlainTextPaste||V.isHtmlPaste||Ke(V))return{returnValue:!0,kFa:!1};var Pa=V.copyContextSnapshot;if(V.commandParameters.clearStateOnFinish)return{returnValue:!0,kFa:!0};if(Pa&&yb(Pa.sourceItem)){var Ib=Pa.sourceItem;if(!Ib.isFromCurrentSession(this.$))return{returnValue:!1,
kFa:!0};Pa=-1985798686===Pa.commandParameters.ribbonCommandInfo.command;if(!(1<Ib.ranges.length||1<V.commandParameters.expandDestinations.length)){var wc=df.K(Ib.ranges);V=df.K(V.commandParameters.expandDestinations);var nd=this.$.fa.sa.sheetName;Ib=Ib.sheetName;if(Ib===nd&&V.equals(wc))return{returnValue:!1,kFa:!0};if(Ib===nd&&V.Of(wc))return{returnValue:!0,kFa:!1}}return{returnValue:Pa,kFa:!0}}return{returnValue:!1,kFa:!0}};Qc.prototype.sd=function(V,Pa){Pa.LJ||Pa.Yg||this.Fv("OnWorkbookOpened",
!1).catch(function(){})};Qc.prototype.Ii=function(V,Pa){V=Zc(this.TJ);var Ib=this.vs.Tsb(V);Ib&&(Pa.sa&&Pa.sa.sheetName===Ib.sheetName&&Ib.isFromCurrentSession(this.$)?this.vs.l_e(Ib.ranges,V.commandParameters.commandType):this.vs.eub())};Qc.prototype.vic=function(V,Pa){V=Zc(this.TJ);(V=this.vs.Tsb(V))&&Pa.item&&Pa.item.sheetName===V.sheetName&&V.isFromCurrentSession(this.$)&&this.Fv("OnItemDeleting",!1).catch(function(){})};Qc.prototype.BBb=function(V,Pa){this.z3e?this.LYf(V,Pa):this.Ysf()};Qc.prototype.Ysf=
function(){var V=Zc(this.TJ);(V=this.vs.Tsb(V))&&V.isFromCurrentSession(this.$)&&this.Fv("OnStartEdit",!1).catch(function(){})};Qc.prototype.NQ=function(V,Pa){1===Pa.QC&&Pa.Sh.operation.flags&2&&this.Fv("OnQueueItemChanged/ItemRemoved",!1).catch(function(){})};Qc.prototype.I7b=function(V){V=kd.a.Ryh(V,Qc.lHa);return this.Ihi+Yg.a.Dv(V).toString()};Qc.prototype.qhd=function(V){V=Qc.zIa(V);return!Uf.a.na(V)&&Uf.a.j_a(V,Qc.Hhi)};Qc.prototype.aSg=function(){var V=kd.a.Ad(1,2,313,314,ff.a.Oo?315:ff.a.IJ?
316:317,530046625,"ActivateLocalStorage"),Pa=Hf.GetServiceTaskFactory.Xa(this.$.ea,5,4,0,"Microsoft.Office.Excel.WebUI.Client.BusinessBar.IBusinessBarManager");ih.TaskExtensions.Da(Pa,function(){Pa.result.tg(41,V)},this.ma,3)};Qc.prototype.Jte=function(V){return void 0===V||null===V?Mc.cli:V?Mc.success:Mc.failed};Qc.CQg=function(V){var Pa=V.innerError;return Pa&&Pa.pasteErrorName?V.innerError:null};Qc.pQg=function(V){var Pa=V.innerError;return Pa&&Pa.copyErrorName?V.innerError:null};Qc.zIa=function(V){var Pa=
"";if(!V)return Qc.Mxe;Uf.a.na(V.errorName)||(Pa=V.errorName,V.innerError&&(Pa+=Qc.lHa+Qc.zIa(V.innerError)));Uf.a.na(Pa)&&(Pa=V&&!Uf.a.na(V.name)?V.name:Qc.Mxe);return Pa};Qc.S6b=function(){Qc.qIb||(Cg.a.y6e()?Qc.qIb=Hd.Aij:Cg.a.Jid()?Qc.qIb=Hd.zij:Qc.qIb=Hd.yij);return Qc.qIb};Qc.Cte=function(V){switch(V){case 7:case 1:return 2098;case 5:return 2095;case 6:return 2094;case 8:case 3:case 2:case 4:case 9:case 10:return 2091;default:return fc.ULS.shipAssertTag(593850376,0,!1,"CopyPasteInfrastructure.ConvertPasteValidationOptionToJsStringId: no case for validationOptions = {0}",
V),2098}};Qc.qQg=function(V){switch(V){case 3:return 2092;case 1:return 2093;case 2:case 4:return 2091;default:return fc.ULS.shipAssertTag(593850375,0,!1,"CopyPasteInfrastructure.ConvertCopySourceValidationOptionToJsStringId: no case for validationOptions = {0}",V),2098}};Jl.Object.defineProperties(Qc.prototype,{pasteIndicationManager:{configurable:!0,enumerable:!0,get:function(){return this.$.ea.Ea(373,void 0)}}});Qc.Rff="EwaJsMetadataChangeListenerId";Qc.Gud="cpiOSC";Qc.u0g="cpiDID";Qc.Wob="Unknown";
Qc.Mxe="UnknownError";Qc.lHa="_";Qc.OAe="DragAndDropError";Qc.pasteErrorName="PasteError";Qc.UHg="CancelError";Qc.copyErrorName="CopyError";Qc.Hhi="MergedCellOverlap";Qc.HEi="PasteRecoveryCachedClipboardItems";Qc.y1i=[1352631530,1679665408];Qc.operationSucceededWithAlert=[-103190598];Qc.pasteDataLimitHit=[1306609195];Qc.copyThrottlingError=[-386183710];Qc.dragDropNonEmptyRange=[563945982];Qc.qIb=null;Object(ac.a)(Qc,"CopyPasteInfrastructure",Md.a,[596,597,7]);Object(ac.a)(Ic,"ClipboardPlatformInitializationResult",
null,[]);var mc=b(787),le=b(4);Object(ac.a)(Fd,"MacroRecorderPasteRangePayload",null,[115]);Pc.prototype.getContent=function(){return this.content};Object(ac.a)(Pc,"MacroRecorderPasteStringPayload",null,[115]);var hd=b(63);Object(ac.a)(Nc,"MacroRecorderPastePayload",null,[115]);var of=b(599),Rc=b(519),Kc=b(193),yg=b(334);dc.prototype.copy=function(V,Pa,Ib,wc,nd){function Bd(xe,Re,Tf){var ag={CopyPasteTargetType:1};ag.SourceRanges=V;ag.CopyOperationId=Pa.id;fc.ULS.sendTraceTag(545400160,0,50,"CopyPasteInfrastructure.Copy served from CopyPasteProxy : {0}, CopyOperationId : {1}",
yd.FKa,ag.CopyOperationId);return yd.FKa?Xa(yd.$.ra.ix,ag,Ne.b(xe,Ib),wc?Ne.a(Re,wc):Re,Tf,Pa.ribbonCommandInfo,re,nd):Xa(yd.$.ra.xa,ag,Ne.b(xe,Ib),wc?Ne.a(Re,wc):Re,Tf,Pa.ribbonCommandInfo,re,nd)}var yd=this;wc=void 0===wc?null:wc;nd=void 0===nd?null:nd;var re=this.$.ra.xa.dc();qc.EwaSettings.wc()?this.$.userOperationManager.oc(new hf.a(505,0,Bd,80),Pa.ribbonCommandInfo):this.$.userOperationManager.oc(new Rc.a(505,0,Bd,16),Pa.ribbonCommandInfo)};dc.prototype.Vvf=function(V,Pa,Ib,wc,nd,Bd){var yd=
this;return new Promise(function(re,xe){var Re=Bd.commandParameters.stopwatch.Gc,Tf=2;20===Bd.commandParameters.commandType&&(Tf=16);36===Bd.commandParameters.commandType&&(Tf=32);Cg.a.Jid()&&68===Bd.commandParameters.commandType&&(Tf=64);Cg.a.Vkd(yd.$)&&1028===Bd.commandParameters.commandType&&(Tf=1024);var ag=null;Bd.copyContextSnapshot&&Bd.copyContextSnapshot.commandParameters&&(ag=Bd.copyContextSnapshot.commandParameters.id);dc.mGd(yd.$,V,wc,Pa,Ib,null,function(Qg){dc.D9b(Qg,Bd,re,xe,Re,yd.$)},
function(Qg){Bd.serverRequestTimeInMs=Bd.commandParameters.stopwatch.Gc-Re;Qg=qa.a.Eg(Qg.data);xe(new Hc.a(5,Qg))},nd,Tf,ag,Bd.commandParameters.id)})};dc.prototype.pasteRange=function(V,Pa,Ib,wc,nd,Bd,yd,re){var xe=this;return new Promise(function(Re,Tf){var ag=yd.commandParameters.stopwatch.Gc;dc.v4i(xe.$,V,Pa,Ib,wc|-5&nd,function(Qg){dc.D9b(Qg,yd,Re,Tf,ag,xe.$)},function(Qg){yd.serverRequestTimeInMs=yd.commandParameters.stopwatch.Gc-ag;Qg=qa.a.Eg(Qg.data);Tf(new Hc.a(5,Qg))},Bd,re)})};dc.prototype.vJi=
function(V,Pa,Ib,wc,nd,Bd,yd){var re=this;return new Promise(function(xe,Re){if(Uf.a.na(Pa))xe("");else if(Pa.length>re.WLa){var Tf=yd.clipboardItems.getItem(Pb.zV),ag=-1;void 0!==Tf&&null!==Tf&&(ag=Tf.length);fc.ULS.sendTraceTag(42071712,0,15,"CopyPasteInfrastructure.ProcessPasteHtml copy paste length too long. clipboardHtml.Length: {0}, MaxHtmlImportLength: {1}, PlainTextLength: {2}",Pa.length,re.WLa,ag);Re(new Hc.a(1))}else Tf=function(Qg,Rg,Hh){re.$.Ss();var Fg=yd.commandParameters.stopwatch.Gc;
Qg=Ne.b(Qg,function(Nh){dc.D9b(Nh,yd,xe,Re,Fg,re.$,Pa)});Rg=Ne.a(Rg,function(Nh){yd.serverRequestTimeInMs=yd.commandParameters.stopwatch.Gc-Fg;Nh=qa.a.Eg(Nh.data);Re(new Hc.a(3,Nh))});var Xg=re.$.ra.xa.dc(),cg=df.v(V,re.$),Mh={};Mh.SourceHtml=Pa;Mh.DestinationRanges=cg?df.s(cg):null;Mh.CopyOperationId=Ib;Mh.PasteId=wc;fc.ULS.sendTraceTag(545400159,0,50,"CopyPasteInfrastructure.ProcessPasteHtml served from CopyPasteProxy : {0}. PasteId : {1}",re.FKa,Mh.PasteId);return re.FKa?Xb(re.$.ra.ix,Mh,Qg,Rg,
Hh,null,Xg,Bd):Xb(re.$.ra.xa,Mh,Qg,Rg,Hh,null,Xg,Bd)},Tf=qc.EwaSettings.wc()?new hf.a(204,0,Tf,65):new Rc.a(204,0,Tf,1),re.$.userOperationManager.oc(Tf,nd)})};dc.prototype.wJi=function(V,Pa,Ib,wc,nd){var Bd=this;return new Promise(function(yd,re){fc.ULS.sendTraceTag(51505037,0,50,"CopyPasteInfrastructure.ProcessPasteText profiling trace: method start. pasteContext.Id={0}",nd.id);Uf.a.na(Pa)||(Pa=Uf.a.trimEnd(Pa,"\n","\r"));fc.ULS.sendTraceTag(51505038,0,50,"CopyPasteInfrastructure.ProcessPasteText profiling trace: after clipboardText.TrimEnd. pasteContext.Id={0}",
nd.id);if(Uf.a.na(Pa))yd("");else{var xe=Bd.Zod;if(Pa.length>xe)fc.ULS.sendTraceTag(24150921,0,15,"CopyPasteInfrastructure.ProcessPasteText copy paste length too long. clipboardText.Length: {0}, MaxCopyPasteLength: {1}",Pa.length,xe),re(new Hc.a(1));else{var Re=df.v(V,Bd.$);fc.ULS.sendTraceTag(51505039,0,50,"CopyPasteInfrastructure.ProcessPasteText profiling trace: before treatAsLink calculation. pasteContext.Id={0}",nd.id);xe=!Bd.$.fa.isNamedObjectViewMode&&-1===Pa.indexOf("\n")&&-1===Pa.indexOf("\t");
fc.ULS.sendTraceTag(51505040,0,50,"CopyPasteInfrastructure.ProcessPasteText profiling trace: before isLink check. pasteContext.Id={0}. treatAsLink={1}",nd.id,xe);xe=xe&&Uf.a.X5e(Pa);fc.ULS.sendTraceTag(51505041,0,50,"CopyPasteInfrastructure.ProcessPasteText profiling trace: after treatAsLink calculation. pasteContext.Id={0}. treatAsLink={1}",nd.id,xe);var Tf=Bd.$.ra.xa.dc();if(xe){var ag=526;fc.ULS.sendTraceTag(51505042,0,50,"CopyPasteInfrastructure.ProcessPasteText profiling trace: before FixUpUrl. pasteContext.Id={0}",
nd.id);var Qg=Kc.a.k6c(Pa);fc.ULS.sendTraceTag(51505043,0,50,"CopyPasteInfrastructure.ProcessPasteText profiling trace: after FixUpUrl. pasteContext.Id={0}",nd.id);var Rg=df.s(Re);xe=function(Fg,Xg,cg){var Mh=nd.commandParameters.stopwatch.Gc;Fg=Ne.b(Fg,function(Nh){fc.ULS.sendTraceTag(51668560,0,50,"CopyPasteInfrastructure.ProcessPasteText profiling trace: on ApplyHyperlink successCallback. pasteContext.Id={0}",nd.id);nd.requestTelemetryData=Nh.RequestTelemetryData;nd.serverRequestTimeInMs=nd.commandParameters.stopwatch.Gc-
Mh;Nh.Errors&&0<Nh.Errors.length?re(new Hc.a(2,Nh.Errors)):yd(Pa)});Xg=Ne.a(Xg,function(Nh){nd.serverRequestTimeInMs=nd.commandParameters.stopwatch.Gc-Mh;Nh=qa.a.Eg(Nh.data);re(new Hc.a(2,Nh))});Bd.$.Ss();fc.ULS.sendTraceTag(51668561,0,50,"CopyPasteInfrastructure.ProcessPasteText profiling trace: before ApplyHyperlink. pasteContext.Id={0}",nd.id);return bf.c(Bd.$.ra.xa,Rg,Pa,Qg,!1,!1,63,Fg,Xg,cg,V,Tf,wc)};var Hh=function(){return new of.a(Rg,Pa,Qg)}}else ag=180,xe=function(Fg,Xg,cg){Bd.$.Ss();var Mh=
nd.commandParameters.stopwatch.Gc;Fg=Ne.b(Fg,function(Nh){fc.ULS.sendTraceTag(51668562,0,50,"CopyPasteInfrastructure.ProcessPasteText profiling trace: on PasteString successCallback. pasteContext.Id={0}",nd.id);dc.D9b(Nh,nd,yd,re,Mh,Bd.$,Pa)});Xg=Ne.a(Xg,function(Nh){nd.serverRequestTimeInMs=nd.commandParameters.stopwatch.Gc-Mh;Nh=qa.a.Eg(Nh.data);re(new Hc.a(4,Nh))});fc.ULS.sendTraceTag(51668563,0,50,"CopyPasteInfrastructure.ProcessPasteText profiling trace: before PasteString. pasteContext.Id={0}",
nd.id);return hc(Bd.$.ra.xa,Re,Pa,Fg,Xg,cg,null,Tf,wc)},Hh=function(){return new Pc(Re,Pa)};fc.ULS.sendTraceTag(51668564,0,50,"CopyPasteInfrastructure.ProcessPasteText profiling trace: before UserNonBlockingWebMethodOperation. pasteContext.Id={0}",nd.id);xe=qc.EwaSettings.wc()?new hf.a(ag,0,xe,65,Hh):new Rc.a(ag,0,xe,1,Hh);fc.ULS.sendTraceTag(51668565,0,50,"CopyPasteInfrastructure.ProcessPasteText profiling trace: returning. pasteContext.Id={0}",nd.id);Bd.$.userOperationManager.oc(xe,Ib)}}})};dc.prototype.l_e=
function(V,Pa){Pa=[1===Pa?4:5];this.gridView.Sb.Zu(yg.a.zW(hd.d(this.$.sa),V),Pa,!0);this.gridView.Sb.Wr(Pa);this.gridView.Sb.update(!0)};dc.prototype.eub=function(){var V=[4,5];this.gridView.Sb.ll(V);this.gridView.Sb.qm(null,V);1===this.gridView.ga.Ze&&this.gridView.Wr()};dc.prototype.RGg=function(V,Pa,Ib){var wc=[];Ib=Ml(Ib);for(var nd=Ib.next();!nd.done;nd=Ib.next())Array.add(wc,this.UGg(V,Pa,nd.value));return wc};dc.prototype.UGg=function(V,Pa,Ib){fc.ULS.shipAssertTag(595185887,0,!!Pa,"CopyPasteUtils.CalculateSingleImpactedRange: sourceArray shouldn't be null");
fc.ULS.shipAssertTag(595185886,0,0<Pa.length,"CopyPasteUtils.CalculateSingleImpactedRange: sourceArray length shouldn't be zero");var wc=0,nd=0,Bd=new Xd.a,yd=new Xd.a;Pa=Ml(Pa);for(var re=Pa.next();!re.done;re=Pa.next()){re=re.value;var xe=String.format("{0}_{1}",re.left,re.right),Re=String.format("{0}_{1}",re.top,re.bottom);yd.contains(xe)||(yd.add(xe),nd+=re.width);Bd.contains(Re)||(Bd.add(Re),wc+=re.height)}if(36===V)return Ib.isSingle?dc.OIe(nd,wc,Ib):Ib.clone();516===V&&(V=wc,wc=nd,nd=V);V=
!(Ib.width%nd)&&!(Ib.height%wc);Bd=Ib.v4&&!(Ib.height%wc);Ib.Haa&&!(Ib.width%nd)||Bd?Ib=dc.OIe(nd,wc,Ib):V?Ib=Ib.clone():(Ib=Ib.clone(),Ib.bottom=Math.min(Pd.a.Gh,Ib.top+wc-1),Ib.right=Math.min(Pd.a.Qh,Ib.left+nd-1));return Ib};dc.prototype.wyg=function(V,Pa,Ib,wc,nd,Bd,yd,re,xe,Re,Tf){if(!wc||!wc.length)return 1;if(1<wc.length){if(!this.sbc&&Bd)return 3;if(Re)return 0;if(re)return 9;if(xe)return 8;if(Tf)return 2;if(1<Pa.length)return 4;var ag=Pa[0];if(!yd&&!lb.a.all(wc,function(Qg){return Qg.isSingle||
!(Qg.width%ag.width)&&!(Qg.height%ag.height)}))return 5;if((!this.sbc||!Bd)&&Uf.a.equals(V,Ib,!0))for(nd=Ml(nd),V=nd.next();!V.done;V=nd.next())if(V=V.value,V.oe(ag)&&!V.equals(ag))return 6}else if(Pa&&0<Pa.length){if(this.M3e(Pa,xe))return 7;if(1<Pa.length){if(!this.sbc&&Bd)return 3;if((!this.sbc||!Bd)&&Uf.a.equals(V,Ib,!0))for(V=Ml(Pa),Pa=V.next();!Pa.done;Pa=V.next())if(Pa=Pa.value,Ib=nd[0],Pa.oe(Ib)&&!Pa.equals(Ib))return 6}}return 0};dc.prototype.M3e=function(V,Pa){if(!V||1>=V.length)return 0;
if(Pa)return 2;if(!df.S(V))return 1;Pa=new mc.a(Vd.a.Dl());for(var Ib=Ml(V),wc=Ib.next();!wc.done;wc=Ib.next()){wc=wc.value;for(var nd=Ml(V),Bd=nd.next();!Bd.done;Bd=nd.next()){Bd=Bd.value;var yd=wc.top===Bd.top&&wc.bottom===Bd.bottom,re=wc.left===Bd.left&&wc.right===Bd.right,xe=Math.max(wc.left,Bd.left)<Math.min(wc.right,Bd.right);if(Math.max(wc.top,Bd.top)<Math.min(wc.bottom,Bd.bottom)&&!yd||xe&&!re)return 3;Pa.add(String.format("{0}-{1}-{2}-{3}",wc.top,wc.bottom,Bd.left,Bd.right));Pa.add(String.format("{0}-{1}-{2}-{3}",
Bd.top,Bd.bottom,wc.left,wc.right))}}V=Ml(V);for(Ib=V.next();!Ib.done;Ib=V.next())Ib=Ib.value,Pa.remove(String.format("{0}-{1}-{2}-{3}",Ib.top,Ib.bottom,Ib.left,Ib.right));return 0<Pa.count?3:0};dc.prototype.WOi=function(V){var Pa=this.gridView.ga;Pa.updateSelection(V,V.topLeft,0);Pa.selectionType=-1};dc.prototype.Tsb=function(V){if(V&&V.sourceItem){if(!yb(V.sourceItem))return null;if((V=V.sourceItem)&&df.bb(V.ranges,!0))return V}return null};dc.prototype.Rbc=function(V,Pa){fc.ULS.shipAssertTag(33863620,
0,!!V,"CopyPasteUtils.IsFromKeyboardShortcut: commandInfo shouldn't be null");return Pa&&le.a.PH in Pa||V.tabName?!1:1===V.method};dc.v4i=function(V,Pa,Ib,wc,nd,Bd,yd,re,xe){function Re(){return new Fd(Ib,wc,nd)}function Tf(Qg,Rg,Hh){V.Ss();var Fg=V.ra.xa;Qg=Ne.b(Qg,Bd);Rg=Ne.a(Rg,yd);var Xg=re;Xg=void 0===Xg?null:Xg;var cg=Fg.Ra(9,ag);cg.sourceRanges=Ib;cg.destinationRanges=wc;cg.flags=nd;return bf.i(Fg,"PasteRange",cg,Qg,Rg,Hh,null,64,Xg)}var ag=V.ra.xa.dc(xe);xe=qc.EwaSettings.wc()?new hf.a(506,
0,Tf,65,Re):new Rc.a(506,0,Tf,1,Re);V.userOperationManager.oc(xe,Pa)};dc.D9b=function(V,Pa,Ib,wc,nd,Bd,yd){yd=void 0===yd?null:yd;fc.ULS.sendTraceTag(51668566,0,50,"CopyPasteInfrastructure.HandlePasteResult profiling trace: on HandlePasteResult start. pasteContext.Id={0}",Pa.id);Pa.requestTelemetryData=V.RequestTelemetryData;Pa.serverRequestTimeInMs=Pa.commandParameters.stopwatch.Gc-nd;kd.a.eh(V.Errors)?kd.a.X8(V.Errors)?(Pa&&(Pa.encounteredDeploymentErrors=!0),fc.ULS.sendTraceTag(36538329,0,15,"CopyPasteUtils.HandlePasteServerResponse: Got deployment errors - keeping promise unfulfilled until we replay the operation. errors: {0}",
kd.a.fd(V.Errors))):wc(new Hc.a(5,V.Errors)):V.Result?(wc=!!V&&!!V.RequestTelemetryData,vf.g(Bd).Ui.fka(Pa.commandParameters.stopwatch.id,V.StateId,wc?V.RequestTelemetryData.EcsOperationDuration:0,wc?V.RequestTelemetryData.EcsRequestDuration:0,wc?V.RequestTelemetryData.WfeRequestDuration:0),Pa.pastedRange=V.Result.SheetMultiRange,fc.ULS.sendTraceTag(51668568,0,50,"CopyPasteInfrastructure.HandlePasteResult profiling trace: resolving promise ewaResult.Result is not null. pasteContext.Id={0}",Pa.id),
Ib(!0)):(fc.ULS.sendTraceTag(51668567,0,50,"CopyPasteInfrastructure.HandlePasteResult profiling trace: resolving promise when ewaResult.Result is null. pasteContext.Id={0}",Pa.id),Ib(yd?yd:!0))};dc.mGd=function(V,Pa,Ib,wc,nd,Bd,yd,re,xe,Re,Tf,ag){function Qg(){return new Nc(Fg)}function Rg(Xg,cg,Mh){V.Ss();return Ea(V.ra.xa,Fg,Ne.b(Xg,yd),Ne.a(cg,re),Mh,Bd,Hh,xe)}var Hh=V.ra.xa.dc(),Fg=dc.hWg(Ib,wc,nd,Re,Tf,ag);Ib=qc.EwaSettings.wc()?new hf.a(503,0,Rg,65,Qg):new Rc.a(503,0,Rg,1,Qg);V.userOperationManager.oc(Ib,
Pa)};dc.hWg=function(V,Pa,Ib,wc,nd,Bd){var yd={};yd.ShadowWorkbookBase64=V.shadowWorkbookBase64;yd.SourceRanges={};yd.SourceRanges.Ranges=Array(1);yd.SourceRanges.Ranges[0]={};yd.SourceRanges.Ranges[0].FirstRow=V.rangeRowStart;yd.SourceRanges.Ranges[0].LastRow=V.rangeRowEnd;yd.SourceRanges.Ranges[0].FirstColumn=V.rangeColumnStart;yd.SourceRanges.Ranges[0].LastColumn=V.rangeColumnEnd;qc.EwaSettings.getBooleanFeatureGate(gg.a.M0b,!1)?Ib?yd.DestinationRanges=df.u(Ib.SheetName,Ib.NamedObjectName,df.g(Ib.Ranges)):
(fc.ULS.sendTraceTag(542722242,0,15,"CopyPasteInfrastructure.CreatePasteParameters: multiRangeDestination is null"),yd.DestinationRanges=null):yd.DestinationRanges=Pa?df.s(Pa):null;yd.CopyPasteTargetType=1;yd.PasteType=wc;yd.CopyOperationId=nd;yd.PasteId=Bd;yd.SourceClientPath=V.sourceClientPath;yd.SourceSheetName=V.sourceSheetName;yd.SourceWorkbookName=V.sourceWorkbookName;if(!V.originalSourceRangesCountExceedsLimit&&V.originalSourceRanges&&0<V.originalSourceRanges.length&&1024===wc){yd.OriginalSourceMultiRange=
{};Pa=Array(V.originalSourceRanges.length);for(Ib=0;Ib<Pa.length;++Ib)Pa[Ib]={},Pa[Ib].FirstRow=V.originalSourceRanges[Ib][0],Pa[Ib].FirstColumn=V.originalSourceRanges[Ib][1],Pa[Ib].LastRow=V.originalSourceRanges[Ib][2],Pa[Ib].LastColumn=V.originalSourceRanges[Ib][3];yd.OriginalSourceMultiRange.Ranges=Pa}return yd};dc.OIe=function(V,Pa,Ib){Ib=Ib.clone();Ib.height<Pa&&(Ib.bottom=Math.min(Pd.a.Gh,Ib.top+Pa-1));Ib.width<V&&(Ib.right=Math.min(Pd.a.Qh,Ib.left+V-1));return Ib};Jl.Object.defineProperties(dc.prototype,
{Zod:{configurable:!0,enumerable:!0,get:function(){fc.ULS.sendTraceTag(51505284,0,50,"CopyPasteUtils.MaxCopyPasteLength returning BootstrapContext.MaxCopyPasteLength. MaxCopyPasteLength={0}",this.$.Ba.MaxCopyPasteLength);return this.$.Ba.MaxCopyPasteLength}},WLa:{configurable:!0,enumerable:!0,get:function(){return this.FKa?qc.EwaSettings.getIntFeatureGate("Microsoft.Office.Excel.CopyPasteHtmlImportMaxLength",this.$.Ba.CopyPasteMaxPayloadLength):Pd.a.WLa}}});Object(ac.a)(dc,"CopyPasteUtils",null,[595]);
var nf=b(495),Kg;(function(V){V[V.range=0]="range";V[V.art=1]="art"})(Kg||(Kg={}));Object(ac.b)("SourceItemType",Kg);var jg=b(25),zg=b(92);xb.prototype.serializeSourceItem=function(V){var Pa={};if(V&&Object.getType(V)===Ma)Pa.sheetName=V.sheetName,Pa.topArray=lb.a.map(V.ranges,function(Ib){return Ib.top}),Pa.leftArray=lb.a.map(V.ranges,function(Ib){return Ib.left}),Pa.bottomArray=lb.a.map(V.ranges,function(Ib){return Ib.bottom}),Pa.rightArray=lb.a.map(V.ranges,function(Ib){return Ib.right}),Pa.sessionStateId=
V.sessionStateId,Pa.sessionId=V.sessionId,Pa.sourceItemType=this.EMf(0);else if(V&&Object.getType(V)===jd)Pa.activeFloatingObjectControlId=V.activeFloatingObjectControlId,Pa.sheetName=V.sheetName,Pa.sessionStateId=V.sessionStateId,Pa.sessionId=V.sessionId,Pa.floatingObjectType=this.X4i(V.type),Pa.sourceItemType=this.EMf(1);else return fc.ULS.shipAssertTag(25217025,0,!1,"EnvironmentSerializationHelper.SerializeSourceItem: sourceItem shouldn't be null."),null;return JSON.stringify(Pa)};xb.prototype.serializeCommandParameters=
function(V){if(!V)return fc.ULS.shipAssertTag(25217024,0,!1,"EnvironmentSerializationHelper.Serialize: commandParameters shouldn't be null."),null;var Pa={};Pa.id=V.id;Pa.commandType=V.commandType;Pa.copyPasteTargetType=V.copyPasteTargetType;V.ribbonCommandInfo&&(Pa.ribbonCommandName=this.e5i(V.ribbonCommandInfo.command),Pa.inputMethodName=this.Z4i(V.ribbonCommandInfo.method),Pa.frameModeName=this.Y4i(V.ribbonCommandInfo.mode),Pa.uiLocationName=this.i5i(V.ribbonCommandInfo.qf),Pa.tabName=V.ribbonCommandInfo.tabName);
return JSON.stringify(Pa)};xb.prototype.deserializeSourceItem=function(V){if(Uf.a.na(V))return null;try{var Pa=JSON.parse(V);if(!Pa)return fc.ULS.shipAssertTag(38847437,0,!1,"EnvironmentSerializationHelper.Deserialize: Json.Parse return null result."),null;var Ib=null;switch(this.u1g(Pa.sourceItemType)){case 0:Ib=new Ma(this.$,this.r1g(Pa),Pa.sheetName,Pa.sessionStateId,Pa.sessionId);break;case 1:Ib=new jd(Pa.activeFloatingObjectControlId,Pa.sheetName,Pa.sessionStateId,Pa.sessionId,this.o1g(Pa.floatingObjectType))}return Ib}catch(wc){return fc.ULS.sendTraceTag(38847438,
0,10,"EnvironmentSerializationHelper.DeserializeSourceItem: got exception while try to JSON.Parse string length: {0}, errror: {1}",V?V.length:0,wc),null}};xb.prototype.deserializeCommandParameters=function(V){if(Uf.a.na(V))return null;try{var Pa=JSON.parse(V);if(!Pa)return fc.ULS.shipAssertTag(38847439,0,!1,"EnvironmentSerializationHelper.DeserializeCommandParameters: Json.Parse return null result."),null;var Ib=Sb.a();Ib.id=Pa.id;Ib.ribbonCommandInfo=this.t1g(Pa);Ib.commandType=Pa.commandType;Ib.copyPasteTargetType=
Pa.copyPasteTargetType;return Ib}catch(wc){return fc.ULS.sendTraceTag(38847440,0,10,"EnvironmentSerializationHelper.DeserializeCommandParameters: got exception while try to JSON.Parse string length: {0}, errror: {1}",V?V.length:0,wc),null}};xb.prototype.r1g=function(V){var Pa=[];fc.ULS.shipAssertTag(595185885,0,!!V.topArray&&0<V.topArray.length,"EnvironmentSerializationHelper.DeserializeRanges: TopArray shouldn't be {0}.",V.topArray?"empty":"null");fc.ULS.shipAssertTag(595185884,0,!!V.leftArray&&
0<V.leftArray.length,"EnvironmentSerializationHelper.DeserializeRanges: LeftArray shouldn't be {0}.",V.leftArray?"empty":"null");fc.ULS.shipAssertTag(595185883,0,!!V.bottomArray&&0<V.bottomArray.length,"EnvironmentSerializationHelper.DeserializeRanges: BottomArray shouldn't be {0}.",V.bottomArray?"empty":"null");fc.ULS.shipAssertTag(595185882,0,!!V.rightArray&&0<V.rightArray.length,"EnvironmentSerializationHelper.DeserializeRanges: RightArray shouldn't be {0}.",V.rightArray?"empty":"null");if(!(V.topArray&&
V.leftArray&&V.bottomArray&&V.rightArray))return Pa;fc.ULS.shipAssertTag(595185881,0,V.topArray.length===V.bottomArray.length&&V.topArray.length===V.leftArray.length&&V.topArray.length===V.rightArray.length,"EnvironmentSerializationHelper.DeserializeRanges: The length of TopArray({0}), BottomArray({1}), LeftArray({2}), RightArray({3}) should be the same.",V.topArray.length,V.bottomArray.length,V.leftArray.length,V.rightArray.length);for(var Ib=Math.min(V.topArray.length,V.bottomArray.length,V.leftArray.length,
V.rightArray.length),wc=0;wc<Ib;wc++)Array.add(Pa,new jg.Range(V.topArray[wc],V.leftArray[wc],V.bottomArray[wc],V.rightArray[wc],!1,!1));return Pa};xb.prototype.t1g=function(V){return new zg.a(this.s1g(V.ribbonCommandName),this.q1g(V.inputMethodName),this.p1g(V.frameModeName),this.v1g(V.uiLocationName),V.tabName)};xb.prototype.e5i=function(V){return void 0!==V&&null!==V&&V.toString()in this.sEd?this.sEd[V.toString()]:(fc.ULS.shipAssertTag(25217028,0,!1,"EnvironmentSerializationHelper.SerializeRibbonCommand expected to get RibbonCommand.Copy({0}) or RibbonCommand.Cut({1}) but got {2}",
-911352779,-1985798686,V),this.sEd["-911352779"])};xb.prototype.s1g=function(V){return!Uf.a.na(V)&&V in this.AWf?this.AWf[V]:(fc.ULS.shipAssertTag(25217029,0,!1,"EnvironmentSerializationHelper.DeserializeRibbonCommand: expected to get RibbonCommand.Copy({0}) or RibbonCommand.Cut({1}) but got {2}",-911352779,-1985798686,V),-911352779)};xb.prototype.Z4i=function(V){return void 0!==V&&null!==V&&Fa.a[V]in this.fja?this.fja[Fa.a[V]]:(fc.ULS.shipAssertTag(25217030,0,!1,"EnvironmentSerializationHelper.SerializeInputMethod: got unexpected value {0}",
V),this.fja.unknown)};xb.prototype.q1g=function(V){return!Uf.a.na(V)&&V in this.zWf?this.zWf[V]:(fc.ULS.shipAssertTag(25217031,0,!1,"EnvironmentSerializationHelper.DeserializeInputMethod: got unexpected value {0}",V),0)};xb.prototype.Y4i=function(V){return void 0!==V&&null!==V&&nf.a[V]in this.p0a?this.p0a[nf.a[V]]:(fc.ULS.shipAssertTag(25217032,0,!1,"EnvironmentSerializationHelper.SerializeFrameMode: got unexpected value {0}",V),this.p0a.edit)};xb.prototype.p1g=function(V){return!Uf.a.na(V)&&V in
this.yWf?this.yWf[V]:(fc.ULS.shipAssertTag(25217033,0,!1,"EnvironmentSerializationHelper.DeserializeFrameMode: got unexpected value {0}",V),2)};xb.prototype.EMf=function(V){return void 0!==V&&null!==V&&Kg[V]in this.yIb?this.yIb[Kg[V]]:(fc.ULS.shipAssertTag(25217034,0,!1,"EnvironmentSerializationHelper.SerializeSourceItemType: got unexpected value {0}",V),this.yIb.range)};xb.prototype.u1g=function(V){return!Uf.a.na(V)&&V in this.BWf?this.BWf[V]:(fc.ULS.shipAssertTag(25217035,0,!1,"EnvironmentSerializationHelper.DeserializeSourceItemType: got unexpected value {0}",
V),0)};xb.prototype.X4i=function(V){return void 0!==V&&null!==V&&V.toString()in this.pRc?this.pRc[V.toString()]:(fc.ULS.shipAssertTag(36229127,0,!1,"EnvironmentSerializationHelper.SerializeArtSourceItemType: got unexpected value {0}",V),this.pRc["99"])};xb.prototype.o1g=function(V){return!Uf.a.na(V)&&V in this.xWf?this.xWf[V]:(fc.ULS.shipAssertTag(36229128,0,!1,"EnvironmentSerializationHelper.DeserializeArtSourceItemType: got unexpected value {0}",V),99)};xb.prototype.i5i=function(V){return void 0!==
V&&null!==V&&pc.a[V]in this.lr?this.lr[pc.a[V]]:(fc.ULS.shipAssertTag(36229129,0,!1,"EnvironmentSerializationHelper.SerializeUILocation: got unexpected value {0}",V),this.lr.ribbon)};xb.prototype.v1g=function(V){return!Uf.a.na(V)&&V in this.CWf?this.CWf[V]:(fc.ULS.shipAssertTag(36229130,0,!1,"EnvironmentSerializationHelper.DeserializeUILocation: got unexpected value {0}",V),2)};Object(ac.a)(xb,"EnvironmentSerializationHelper",null,[]);eb.aKf="SameSession";eb.Gwe="CrossSession";eb.Daf="LegacyCrossSession";
eb.external="External";Object(ac.a)(eb,"PayloadOrigin",null,[]);pb.prototype.shouldWaitForCopyToComplete=function(){return!1};pb.prototype.onDeferredPasteStarted=function(){};pb.prototype.onDeferredPasteCompleted=function(){};pb.prototype.beforePaste=function(){};pb.prototype.Ysj=function(V){var Pa=null;try{var Ib=V.getItem(Pb.yN);if(Uf.a.na(Ib))return{returnValue:!1,L_:Pa};Pa=JSON.parse(Ib);return{returnValue:this.K7h(Pa),L_:Pa}}catch(wc){return fc.ULS.sendTraceTag(539303949,0,50,"BaseCopyPasteHandler.TryParseRangeShadowWorkbookPayload: Exception caught: "+
wc),{returnValue:!1,L_:Pa}}};pb.prototype.K7h=function(V){return!!V&&(!Uf.a.na(V.shadowWorkbookBase64)||V.shadowWorkbookSizeExceedsLimit)&&void 0!==V.rangeRowStart&&void 0!==V.rangeRowEnd&&void 0!==V.rangeColumnStart&&void 0!==V.rangeColumnEnd};pb.prototype.kkc=function(V){V.wasLastCopyExternal=!0;if(qc.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CrossAppShadowWorkbookPaste",!1)&&!ff.a.rA&&516!==V.commandParameters.commandType&&1028!==V.commandParameters.commandType){var Pa=this.Ysj(V.clipboardItems);
var Ib=Pa.L_;if(Pa.returnValue)return V.isShadowWorkbookParsedSuccessfully=!0,this.EEi(V,Ib)}return 516!==V.commandParameters.commandType&&36!==V.commandParameters.commandType?qc.EwaSettings.ka(164)&&20!==V.commandParameters.commandType&&(Ib=V.clipboardItems.getItem(Pb.html),void 0!==Ib&&null!==Ib&&!Uf.a.na(Ib)&&Ib.trim()!==this.sRc&&(Ib.startsWith("<")||ff.a.Pf&&Ib.startsWith("\n<")))?(Pa=V.clipboardItems.getItem(Pb.jYc),this.CEi(V,Ib,void 0===Pa?null:Pa)):this.Rvf(V):Promise.reject(new Hc.a(6))};
pb.prototype.EEi=function(V,Pa){fc.ULS.sendTraceTag(539303948,0,50,"BaseCopyPasteHandler.PasteFromExternalByShadowWorkbook: Pasting shadow workbook from system clipboard");V.pasteResult="SystemClipboardShadowWorkbookPaste";V.payloadType=Nd.yN;V.payloadOrigin=eb.external;V.shadowWorkbookPayloadSize=Qa(Pa);V.shadowWorkbookSizeExceedsLimit=gb(Pa);var Ib=null,wc=null,nd=V.commandParameters.originalDestinations;qc.EwaSettings.getBooleanFeatureGate(gg.a.M0b,!1)?Ib=df.r(nd,this.$):wc=df.v(df.K(nd),this.$);
Pa.hasOwnProperty("originalSourceRangesCountExceedsLimit")&&(V.originalSourceRangesCountExceedsLimit=Pa.originalSourceRangesCountExceedsLimit);if(V.shadowWorkbookSizeExceedsLimit)return fc.ULS.sendTraceTag(539303947,0,15,"BaseCopyPasteHandler.PasteFromExternalByShadowWorkbook: shadow workbook length({0}) is over the limit({1}). reject the paste request. ShadowWorkbookSizeExceedsLimit: {2}",V.shadowWorkbookPayloadSize,Pd.a.Vfc,Pa.shadowWorkbookSizeExceedsLimit),Promise.reject(new Hc.a(1));fc.ULS.sendTraceTag(539303946,
0,50,"BaseCopyPasteHandler.PasteFromExternalByShadowWorkbook: trigger Paste request. PasteOperationId={0}",V.commandParameters.id);return this.vs.Vvf(V.commandParameters.ribbonCommandInfo,wc,Ib,Pa,[V.commandParameters.stopwatch],V)};pb.prototype.Rvf=function(V){var Pa=V.clipboardItems.getItem(Pb.zV);if(void 0!==Pa&&null!==Pa&&Pa.trim()===this.sRc)return Promise.reject(new Hc.a(7));void 0!==Pa&&null!==Pa&&(V.plainTextPayloadSize=Pa.length);V.isPlainTextPaste=!0;V.pasteResult="SystemClipboardPaste";
V.payloadOrigin=he(V)?eb.Daf:eb.external;V.payloadType=Nd.zV;fc.ULS.sendTraceTag(39186568,0,50,"BaseRangeCopyPasteHandler.PasteByPlainText: trigger ProcessPasteText request. pasteContext.Id={0}, PasteOperationId={1}",V.id,V.commandParameters.id);Pa=this.vs.wJi(df.K(V.commandParameters.originalDestinations),Pa,V.commandParameters.ribbonCommandInfo,[V.commandParameters.stopwatch],V);fc.ULS.sendTraceTag(51668559,0,50,"BaseRangeCopyPasteHandler.PasteByPlainText: returned from ProcessPasteText. pasteContext.Id={0}",
V.id);return Pa};pb.prototype.CEi=function(V,Pa,Ib){V.htmlPayloadSize=Pa.length;V.isHtmlPaste=!0;V.pasteResult="SystemClipboardHtmlPaste";V.payloadType=Nd.html;V.payloadOrigin=he(V)?eb.Daf:eb.external;fc.ULS.sendTraceTag(42071711,0,50,"BaseRangeCopyPasteHandler.PasteByHtml: trigger ProcessPasteHtml request. PasteOperationId={0}",V.commandParameters.id);return this.vs.vJi(df.K(V.commandParameters.originalDestinations),Pa,Ib,V.commandParameters.id,V.commandParameters.ribbonCommandInfo,[V.commandParameters.stopwatch],
V)};pb.prototype.gwe=function(V){var Pa={};V&&(Pa.shadowWorkbookBase64=V.ShadowWorkbookBase64,Pa.shadowWorkbookSizeExceedsLimit=V.ShadowWorkbookSizeExceedsLimit,Pa.originalSourceRangesCountExceedsLimit=V.OriginalSourceRangesCountExceedsLimit,Pa.originalSourceRangesCount=V.OriginalSourceRangesCount,Pa.shadowWorkbookBlockedSize=V.ShadowWorkbookBlockedSize);return Pa};pb.prototype.J4f=function(V,Pa){var Ib=Ue(V),wc=32===(V.commandParameters.commandType&32),nd=1024===(V.commandParameters.commandType&
1024),Bd=!1,yd=null,re=null,xe=!1;if(!Ib){Bd=-1985798686===V.commandParameters.ribbonCommandInfo.command;var Re=V.copyContextSnapshot;if(Pa)xe=!Re.sourceItem.isFromCurrentSession(this.$);else if(Re=this.vs.Tsb(Re))yd=Re.ranges,re=Re.sheetName,xe=!V.isSameSession}return this.vs.wyg(re,yd,this.$.sa.sheetName,V.commandParameters.originalDestinations,V.commandParameters.expandDestinations,xe,wc,nd,Bd,Pa,Ib)};Jl.Object.defineProperties(pb.prototype,{name:{configurable:!0,enumerable:!0,get:function(){return this._name}},
sRc:{configurable:!0,enumerable:!0,get:function(){return this.Rm.Ya(5)}}});Object(ac.a)(pb,"BaseCopyPasteHandler",null,[633,634,635]);Ub.prototype.getValue=function(V){return this.key&&this.key.isEqual(V)?this.createClipboardItems(this.clipboardItems):null};Ub.prototype.setValue=function(V,Pa){this.key=V;this.clipboardItems=this.createClipboardItems(Pa)};Ub.prototype.createClipboardItems=function(V){var Pa=this.q9.create(),Ib=V.getItem(Pb.zV);Ib&&Pa.setItem(Pb.zV,Ib);(Ib=V.getItem(Pb.yN))&&Pa.setItem(Pb.yN,
Ib);(V=V.getItem(Pb.html))&&Pa.setItem(Pb.html,V);return Pa};Object(ac.a)(Ub,"CopyCache",null,[]);var hg=b(70);Cm(Mb,pb);Mb.prototype.getSourceItem=function(){var V=lb.a.clone(this.gridView.ga.ya.selectedRanges);return new Ma(this.$,V,this.$.fa.sa.sheetName,this.$.fa.zf,this.$.Ba.UserSessionId)};Mb.prototype.beforeSerialize=function(V){var Pa=this;V.isSelectionAllowed=!1;V.isAsyncCopy=!1;V.isFromCache=!1;V.encounteredDeploymentErrors=!1;V.plainTextPayloadSize=0;V.shadowWorkbookPayloadSize=0;V.htmlPayloadSize=
0;V.clientSideCopyTime=0;var Ib=new uf.a(this.$.Aa),wc=V.sourceItem;V.isSelectionAllowed=lb.a.all(wc.ranges,function(nd){return Pa.isSelectionAllowed(Ib,nd)});V.isSelectionAllowed&&this.vs.l_e(wc.ranges,V.commandParameters.commandType)};Mb.prototype.PKa=function(V){return this.gridView.Ha.VG()&&vf.i(this.gridView,V)};Mb.prototype.aFi=function(V,Pa,Ib,wc){var nd=!1;1===Ib.ranges.length&&1===wc.length?qc.EwaSettings.isChangeGateEnabled("OfficeVSO:5470715_Paste_Instantaneous")&&(nd=this.hRg.n1c(V,df.K(Ib.ranges),
Ib.sheetName,df.K(V.commandParameters.expandDestinations),this.$.fa.sa.sheetName,1===Pa.commandParameters.commandType)):V.cseStatus=5;nd&&vf.g(this.$).Ui.S_(V.commandParameters.stopwatch.id,hg.BasicTelemetryCalculator.bQ);return this.KEi(V,Ib,df.u(this.$.sa.sheetName,null,wc),Pa.commandParameters.commandType,nd)};Mb.prototype.isSelectionAllowed=function(V,Pa){return V.x4a(Pa,this.gridView)};Mb.prototype.KEi=function(V,Pa,Ib,wc,nd){Pa=df.u(Pa.sheetName,null,Pa.ranges);V.pasteResult="SameSessionPaste";
V.payloadOrigin=eb.aKf;V.payloadType=Nd.hng;fc.ULS.sendTraceTag(37003422,0,50,"BaseRangeCopyPasteHandler.PasteSameSession: trigger PasteRange request. PasteOperationId={0}",V.commandParameters.id);return this.vs.pasteRange(V.commandParameters.ribbonCommandInfo,Pa,Ib,wc,V.commandParameters.commandType,[V.commandParameters.stopwatch],V,nd)};Object(ac.a)(Mb,"BaseRangeCopyPasteHandler",pb,[]);var bh=b(32);Hb.prototype.onDeferredPasteStarted=function(V){this.JT.tb(V.id)||this.JT.add(V.id,!0);if(0<this.JT.count){var Pa=
Hf.GetServiceTaskFactory.Xa(this.$.ea,5,4,0,"Microsoft.Office.Excel.WebUI.Client.BusinessBar.IBusinessBarManager");ih.TaskExtensions.Da(Pa,function(){Pa.result.tg(28,null)},this.$.ma,3)}};Hb.prototype.onDeferredPasteCompleted=function(V){var Pa=0<this.JT.count;this.JT.tb(V.id)&&this.JT.remove(V.id);if(Pa&&!this.JT.count){var Ib=Hf.GetServiceTaskFactory.Xa(this.$.ea,5,4,0,"Microsoft.Office.Excel.WebUI.Client.BusinessBar.IBusinessBarManager");ih.TaskExtensions.Da(Ib,function(){Ib.result.removeEntry(28)},
this.$.ma,3)}};Object(ac.a)(Hb,"DeferredPasteTracker",null,[]);var Nf;(function(V){V[V.none=0]="none";V[V.loadClipboardFromServerFailed=1]="loadClipboardFromServerFailed";V[V.loadCopiedDataFromServerFailed=2]="loadCopiedDataFromServerFailed";V[V.asyncCopyCanceled=3]="asyncCopyCanceled";V[V.loadCopiedArtDataFromServerFailed=4]="loadCopiedArtDataFromServerFailed"})(Nf||(Nf={}));Object(ac.b)("CopyErrorType",Nf);var fe=b(1041),ch=b(1195),Wg=fe.a;Cm(Jb,Wg);Object(ac.a)(Jb,"CopyInnerError",fe.a,[]);Cm(Va,
Mb);Va.prototype.serialize=function(V){var Pa=V.sourceItem,Ib={},wc=this.iYc.getValue(Pa);if(wc)Ib.synchronousResult=wc,V.isFromCache=!0,V.clientSideCopyTime=V.commandParameters.stopwatch.Gc;else{var nd=null,Bd=df.F(Pa.ranges);if(!Cg.a.v5e()&&this.PKa(Bd)){fc.ULS.sendTraceTag(26035413,0,50,"AcrossSessionRangeCopyPasteHandler.Serialize: All data is loaded prepare the data in the client side.");Bd=this.clipboardRangeFactory.create(Bd);try{nd=Bd.toString(),wc=this.q9.create(),wc.setItem(Pb.zV,nd),this.iYc.setValue(Pa,
wc),Ib.synchronousResult=wc,V.clientSideCopyTime=V.commandParameters.stopwatch.Gc}finally{Bd&&Bd.dispose()}}else V.isAsyncCopy=!0,Ib.synchronousResult=this.q9.create(),Ib.synchronousResult.setItem(Pb.zV,this.sRc);Ib.asynchronousResult=this.K8c(V,Pa,nd)}V.syncClipboardItemsKeys=Cb(Ib.synchronousResult);return Ib};Va.prototype.shouldWaitForCopyToComplete=function(V){if(!V||!V.copyContextSnapshot)return fc.ULS.sendTraceTag(39084501,0,50,"AcrossSessionRangeCopyPasteHandler.ShouldWaitForCopyToComplete: pasteContext or pasteContext.CopyContextSnapshot is not define, return false."),
!1;fc.ULS.shipAssertTag(41562511,0,!!this.$.Ba,"AcrossSessionRangeCopyPasteHandler.ShouldWaitForCopyToComplete: this.EwaControl.BootstrapContext shouldn't be null");if(V.copyContextSnapshot.sessionId===this.$.Ba.UserSessionId)return fc.ULS.sendTraceTag(41562513,0,50,"AcrossSessionRangeCopyPasteHandler.ShouldWaitForCopyToComplete: Same session copy scenario, return false."),!1;fc.ULS.sendTraceTag(41562514,0,50,"AcrossSessionRangeCopyPasteHandler.ShouldWaitForCopyToComplete: returning true");return!0};
Va.prototype.onDeferredPasteStarted=function(V){this.JT.onDeferredPasteStarted(V)};Va.prototype.onDeferredPasteCompleted=function(V){this.JT.onDeferredPasteCompleted(V)};Va.prototype.deserialize=function(V){V.isClipboardDataContainShadowWorkbook=!(void 0===V.clipboardItems.getItem(Pb.yN)||null===V.clipboardItems.getItem(Pb.yN));if(vf.g(this.$).ga.Ze&326)return Ue(V)&&(V.wasLastCopyExternal=!0),Promise.reject(new Hc.a(17));var Pa=this.J4f(V,!1);if(Pa)return Promise.reject(new Hc.a(Ue(V)?18:V.isSameSession?
19:20,void 0,void 0,void 0,Pa));var Ib=V.copyContextSnapshot,wc=this.vs.Tsb(Ib);if(Ue(V))return this.kkc(V);Pa=V.commandParameters.originalDestinations;if(wc&&V.isSameSession)return this.aFi(V,Ib,wc,Pa);if(516!==V.commandParameters.commandType){wc=this.Xsj(V.clipboardItems);Ib=wc.L_;if(wc.returnValue){V.isShadowWorkbookParsedSuccessfully=!0;var nd=wc=null;qc.EwaSettings.getBooleanFeatureGate(gg.a.M0b,!1)?wc=df.r(Pa,this.$):nd=df.v(df.K(Pa),this.$);return this.AEi(V,nd,wc,Ib)}if(V.isClipboardInaccessible)return Promise.reject(new Hc.a(8));
if(36!==V.commandParameters.commandType)return this.Rvf(V)}return Promise.reject(new Hc.a(6))};Va.prototype.beforePaste=function(V){this.$.ea.Ea(373,void 0).U1i(V);V.indicationDisplayScheduled=!0};Va.prototype.ssj=function(V){if(!(V&&V.SourceRanges&&V.SourceRanges.Ranges&&V.SourceRanges.Ranges.length&&(V.OriginalSourceRangesCountExceedsLimit||V.OriginalSourceMultiRange&&V.OriginalSourceMultiRange.Ranges&&V.OriginalSourceMultiRange.Ranges.length)))return{returnValue:!1,L_:null};var Pa=V.SourceRanges.Ranges[0];
var Ib=null;if(Uf.a.na(V.ShadowWorkbookBase64)&&!V.ShadowWorkbookSizeExceedsLimit)return{returnValue:!1,L_:Ib};Ib=this.gwe(V);Ib.rangeRowStart=Pa.FirstRow;Ib.rangeRowEnd=Pa.LastRow;Ib.rangeColumnStart=Pa.FirstColumn;Ib.rangeColumnEnd=Pa.LastColumn;Ib.sourceClientPath=V.SourceClientPath;Ib.sourceSheetName=V.SourceSheetName;Ib.sourceWorkbookName=V.SourceWorkbookName;if(!V.OriginalSourceRangesCountExceedsLimit)for(V=V.OriginalSourceMultiRange.Ranges,Ib.originalSourceRanges=Array(V.length),Pa=0;Pa<V.length;++Pa)Ib.originalSourceRanges[Pa]=
[V[Pa].FirstRow,V[Pa].FirstColumn,V[Pa].LastRow,V[Pa].LastColumn];return{returnValue:!0,L_:Ib}};Va.prototype.Xsj=function(V){var Pa=null;V=V.getItem(Pb.yN);if(Uf.a.na(V))return{returnValue:!1,L_:Pa};Pa=JSON.parse(V);return{returnValue:this.J7h(Pa),L_:Pa}};Va.prototype.J7h=function(V){return!!V&&(!Uf.a.na(V.shadowWorkbookBase64)||V.shadowWorkbookSizeExceedsLimit)&&void 0!==V.rangeRowStart&&void 0!==V.rangeRowEnd&&void 0!==V.rangeColumnStart&&void 0!==V.rangeColumnEnd};Va.prototype.AEi=function(V,Pa,
Ib,wc){fc.ULS.shipAssertTag(33863617,0,!!wc,"AcrossSessionRangeCopyPasteHandler.PasteAcrossSessions: shadowWorkbookPayload shouldn't be null");hb.AFrameworkApplication.uQ("Microsoft.Office.Excel.Server.Flighting.IDenyListNewCopyPasteExperienceAcrossSessions");V.pasteResult="CrossSessionPaste";V.payloadOrigin=eb.Gwe;V.payloadType=Nd.yN;V.shadowWorkbookPayloadSize=Qa(wc);V.shadowWorkbookSizeExceedsLimit=gb(wc);wc.hasOwnProperty("originalSourceRangesCountExceedsLimit")&&(V.originalSourceRangesCountExceedsLimit=
wc.originalSourceRangesCountExceedsLimit);if(V.shadowWorkbookSizeExceedsLimit)return fc.ULS.sendTraceTag(34415003,0,15,"AcrossSessionRangeCopyPasteHandler.PasteAcrossSessions: shadow workbook length({0}) is over the limit({1}). reject the paste request. ShadowWorkbookSizeExceedsLimit: {2}",V.shadowWorkbookPayloadSize,Pd.a.Vfc,wc.shadowWorkbookSizeExceedsLimit),Promise.reject(new Hc.a(1));if(1028===V.commandParameters.commandType&&V.originalSourceRangesCountExceedsLimit)return fc.ULS.sendTraceTag(572617859,
0,15,"AcrossSessionRangeCopyPasteHandler.PasteAcrossSessions: Original source ranges count({0}) is over the limit({1}). Reject the paste request. OriginalSourceRangesCountExceedsLimit: {2}",wc.originalSourceRangesCount,Pd.a.qgi,wc.originalSourceRangesCountExceedsLimit),Promise.reject(new Hc.a(1));fc.ULS.sendTraceTag(33863619,0,50,"AcrossSessionRangeCopyPasteHandler.PasteAcrossSessions: trigger Paste request. PasteOperationId={0}",V.commandParameters.id);return this.vs.Vvf(V.commandParameters.ribbonCommandInfo,
Pa,Ib,wc,[V.commandParameters.stopwatch],V)};Va.prototype.K8c=function(V,Pa,Ib){var wc=this;fc.ULS.shipAssertTag(41805027,0,!!V,"AcrossSessionRangeCopyPasteHandler.GetCopiedDataFromServer: copyContext shouldn't be null");var nd=V.commandParameters.stopwatch.Gc;return new Promise(function(Bd,yd){fc.ULS.sendTraceTag(26035421,0,50,"AcrossSessionRangeCopyPasteHandler.GetCopiedDataFromServer: issue request to the server to get the copied data for copy Id: {0}",V.id);var re=df.u(Pa.sheetName,null,Pa.ranges);
wc.vs.copy(re,V.commandParameters,function(xe){V.requestTelemetryData=xe.RequestTelemetryData;V.serverRequestTimeInMs=V.commandParameters.stopwatch.Gc-nd;if(kd.a.eh(xe.Errors))kd.a.X8(xe.Errors)?(V.encounteredDeploymentErrors=!0,fc.ULS.sendTraceTag(36538326,0,15,"AcrossSessionRangeCopyPasteHandler.GetCopiedDataFromServer: Got deployment errors - keeping promise unfulfilled until we replay the operation. errors: {0}. copy Id: {1}",kd.a.fd(xe.Errors),V.id)):(fc.ULS.sendTraceTag(26035419,0,10,"AcrossSessionRangeCopyPasteHandler.GetCopiedDataFromServer: GetCopiedDataFromServer failed. errors: {0}. copy Id: {1}",
kd.a.fd(xe.Errors),V.id),yd(new Jb(2,xe.Errors)));else if(fc.ULS.sendTraceTag(26035418,0,50,"AcrossSessionRangeCopyPasteHandler.GetCopiedDataFromServer: GetCopiedDataFromServer succeed for copy Id: {0}",V.id),V.markForCancellation)yd(new Jb(3,xe.Errors));else{xe=xe.Result;var Re=xe.PlainTextResult;void 0!==Ib&&null!==Ib&&(Re=Ib);void 0!==Re&&null!==Re&&(V.plainTextPayloadSize=Re.length);var Tf=wc.q9.create(),ag=wc.ssj(xe);var Qg=ag.L_;ag.returnValue&&(V.shadowWorkbookPayloadSize=Qa(Qg),V.shadowWorkbookSizeExceedsLimit=
gb(Qg),V.originalSourceRangesCountExceedsLimit=xe.OriginalSourceRangesCountExceedsLimit,Qg=JSON.stringify(Qg),Tf.setItem(Pb.yN,Qg));Tf.setItem(Pb.zV,Re);Cg.a.v5e()&&(Re=xe.HtmlResult,V.htmlSizeExceedsLimit=xe.HtmlSizeExceedsLimit,void 0!==Re&&null!==Re&&(V.htmlPayloadSize=Re.length),Tf.setItem(Pb.html,Re));V.copyTotalSizeExceedsLimit=xe.CopyTotalSizeExceedsLimit;Tf.setItem(Pb.jYc,V.commandParameters.id);wc.iYc.setValue(Pa,Tf);V.asyncClipboardItemsKeys=Cb(Tf);Bd(Tf)}},function(xe){V.serverRequestTimeInMs=
V.commandParameters.stopwatch.Gc-nd;xe=qa.a.Eg(xe.data);fc.ULS.sendTraceTag(26035420,0,10,"AcrossSessionRangeCopyPasteHandler.GetCopiedDataFromServer: GetCopiedDataFromServer failed. errors: {0}. copy Id: {1}",kd.a.fd(xe),V.id);yd(new Jb(2,xe))},[V.commandParameters.stopwatch])})};Object(ac.a)(Va,"AcrossSessionRangeCopyPasteHandler",Mb,[]);Object(ac.a)(Da,"CopyArtRequest",null,[]);Object(ac.a)(wa,"PasteArtRequest",null,[]);Wa.prototype.BOh=function(V){if(this.d4h(V.QLa)){fc.ULS.sendTraceTag(37364047,
5,50,"PasteArtRequestManager.HandleRequest: Enqueued paste request as a result of rapid paste on same destination: {0}",V.QLa);var Pa=this.ZEb.oa(V.QLa);this.ZEb.ja(V.QLa,V);var Ib=Pa.promise;Pa.M5e=!1;return this.G8g(V,Ib)}this.ZEb.ja(V.QLa,V);return this.v$h(V)};Wa.prototype.d4h=function(V){return this.ZEb.tb(V)};Wa.prototype.v$h=function(V){var Pa=this;return new Promise(function(Ib,wc){V.promise=Pa.WWa.Qvf(V).then(function(nd){Ib(null);return Pa.Sic(V,nd)},function(nd){wc(null);return Pa.jBb(nd)})})};
Wa.prototype.G8g=function(V,Pa){var Ib=this;return new Promise(function(wc,nd){V.promise=Pa.then(function(Bd){Ib.Vxj(V,Bd);return Ib.WWa.Qvf(V).then(function(yd){wc(null);return Ib.Sic(V,yd)},function(yd){nd(null);return Ib.jBb(yd)})},function(Bd){return Ib.jBb(Bd)})})};Wa.prototype.Sic=function(V,Pa){V.M5e&&(this.nLg(V.QLa),this.QFd(V,Pa));return this.XJi(Pa)};Wa.prototype.nLg=function(V){this.ZEb.remove(V)};Wa.prototype.QFd=function(V,Pa){var Ib=this.lHh();V.QLa===Ib&&this.WWa.QFd(V.destination,
Pa,V.item.type)};Wa.prototype.lHh=function(){var V=vf.g(this.$).ga.Sa.activeFloatingObjectControlId;V||(V=df.v(vf.g(this.$).ga.ya.activeCell,this.$),V=V.FirstRow+"_"+V.FirstColumn);return V};Wa.prototype.Vxj=function(V,Pa){V.destination=null;V.Dye=Pa};Object(ac.a)(Wa,"PasteArtRequestManager",null,[]);var qd=b(184),fd=b(116),kh=b(103);Cm(La,pb);La.prototype.getSourceItem=function(){fc.ULS.shipAssertTag(36227297,0,!!this.ga.Sa.activeFloatingObjectControlId,"Expecting a floating object to be currently selected for copy");
fc.ULS.sendTraceTag(39682266,0,50,"ArtCopyPasteHandler.GetSourceItem: Creating ArtSourceItem with FloatingObjectId=[{0}]",this.ga.Sa.activeFloatingObjectControlId);return new jd(this.ga.Sa.activeFloatingObjectControlId,this.gC.fa.sa.sheetName,this.gC.fa.zf,this.gC.Ba.UserSessionId,this.ga.Sa.nc.floatingObject.type)};La.prototype.beforeSerialize=function(V){V&&V.commandParameters?(V?(V.isAsyncCopy=!1,V.isSelectionAllowed=!1,V.isFromCache=!1,V.plainTextPayloadSize=0,V.shadowWorkbookPayloadSize=0,V.htmlPayloadSize=
0,V.htmlSizeExceedsLimit=!1,V.clientSideCopyTime=0,V.encounteredDeploymentErrors=!1,V.shadowWorkbookSizeExceedsLimit=!1,V.originalSourceRangesCountExceedsLimit=!1,V.copyTotalSizeExceedsLimit=!1):fc.ULS.sendTraceTag(36701969,0,10,"CommonCopyPasteUtils.InitializeCopyContext: copyContext is null."),V.commandParameters.copyPasteTargetType=2):fc.ULS.sendTraceTag(36227298,0,10,"ArtCopyPasteHandler.BeforeSerialize: copyContext or copyContext.CommandParameters is null.")};La.prototype.serialize=function(V){var Pa=
V.sourceItem,Ib={};if(!Pa)return fc.ULS.sendTraceTag(36227299,0,10,"ArtCopyPasteHandler.Serialize: artSourceItem should not be null"),Ib;if(!this.G6h())return fc.ULS.sendTraceTag(36824456,0,50,"ArtCopyPasteHandler.Serialize: Unsupported floating object type. This will clear the clipboard"),Ib;fc.ULS.sendTraceTag(39682267,0,50,"ArtCopyPasteHandler.Serialize: Serializing ArtSourceItem with FloatingObjectId=[{0}]",Pa.activeFloatingObjectControlId);this.fxd();var wc=this.hYc.getValue(Pa);if(wc)Ib.synchronousResult=
wc,V.isFromCache=!0,V.isAsyncCopy=!1,V.clientSideCopyTime=V.commandParameters.stopwatch.Gc,1===V.commandParameters.commandType&&this.gC.Re(2045211913,V.commandParameters.ribbonCommandInfo.method,V.commandParameters.ribbonCommandInfo.qf,null);else{V.isFromCache=!1;V.isAsyncCopy=!0;wc=this.q9.create();if(qc.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CopyChartsToPPTOEnabled",!1)&&V.commandParameters.uploadToClipService){var nd={};nd["data-clipservice-ccpid"]=V.commandParameters.id;nd["data-pkey"]=
V.commandParameters.pKey;nd["data-clipservice-type"]=V.commandParameters.clipServiceDataType;nd["data-clipservice-count"]=V.commandParameters.objectCount.toString();nd["data-clipservice-dc"]=V.commandParameters.clipServiceDataCenter;nd["data-clipservice-client"]=this.dMg;nd["data-TimeStamp"]=(new Date).toUTCString();nd["data-clipservice-version"]=this.eMg;wc.setItem(Pb.svg,JSON.stringify(nd))}Ib.synchronousResult=this.Pog(wc);Ib.asynchronousResult=this.K8c(V,Pa,wc)}V.syncClipboardItemsKeys=Cb(Ib.synchronousResult);
return Ib};La.prototype.Pog=function(V){fc.ULS.shipAssertTag(39977874,0,!!this.ga.Sa.nc,"Expecting a floating object to be currently selected for copy");V||(V=this.q9.create());var Pa=this.ga.Sa.nc.yrb();Uf.a.na(Pa)||(Pa=String.format("<img src='{0}'>",Pa),V.setItem(Pb.html,Pa));return V};La.prototype.fxd=function(){var V=this.ga.Sa.nc;this.vlb.fxd(fd.a.knb(V.floatingObject),fd.a.gMg(V.xt))};La.prototype.shouldWaitForCopyToComplete=function(){fc.ULS.sendTraceTag(41562515,0,50,"ArtCopyPasteHandler.ShouldWaitForCopyToComplete: returning true");
return!0};La.prototype.onDeferredPasteStarted=function(V){this.JT.onDeferredPasteStarted(V)};La.prototype.onDeferredPasteCompleted=function(V){this.JT.onDeferredPasteCompleted(V)};La.prototype.deserialize=function(V){var Pa=Ue(V),Ib=null,wc=null,nd=!1;if(!Pa){Ib=V.copyContextSnapshot;wc=Ib.sourceItem;if(!wc)return Promise.reject(new Hc.a(10));nd=wc.isFromCurrentSession(this.gC)}var Bd=this.J4f(V,!0);if(Bd)return Promise.reject(new Hc.a(Pa?18:nd?19:20,void 0,void 0,void 0,Bd));if(Pa)return this.kkc(V);
if(!nd&&!La.k0h(wc))return V=String.format("User attempted to paste art of type [{0}] between sessions.",wc.type),fc.ULS.sendTraceTag(36229120,0,50,V),Promise.reject(new Hc.a(11,void 0,void 0,V));if(Ib.isAsyncSerializeFailed)return Promise.reject(new Hc.a(16,void 0,void 0,"Last async serialize failed, therefore no current shadow workbook payload to paste"));try{var yd=V.clipboardItems.getItem(Pb.yN);var re=JSON.parse(yd)}catch(xe){return fc.ULS.sendTraceTag(38102659,0,10,"ArtCopyPasteHandler.Deserialize: Failed to parse shadow workbook JSON with exception: {0}",
copyPasteInfra.getStringifiedError(xe)),Promise.reject(new Hc.a(12,void 0,xe))}re.floatingObjectId!==wc.activeFloatingObjectControlId?fc.ULS.sendTraceTag(40134681,0,10,"ArtCopyPasteHandler.Deserialize: FloatingObjectId mismatch! Deserializing with artSourceItem.ActiveFloatingObjectControlId=[{0}], shadowWorkbookPayload.FloatingObjectId=[{1}]",wc.activeFloatingObjectControlId,re.floatingObjectId):fc.ULS.sendTraceTag(39682268,0,50,"ArtCopyPasteHandler.Deserialize: Deserializing with artSourceItem.ActiveFloatingObjectControlId=[{0}], shadowWorkbookPayload.FloatingObjectId=[{1}]",
wc.activeFloatingObjectControlId,re.floatingObjectId);if(!re||Uf.a.na(re.shadowWorkbookBase64))return Promise.reject(new Hc.a(13,void 0,void 0,String.format("shadowWorkbookPayload is null = {0}",!re)));V.isShadowWorkbookParsedSuccessfully=!0;V.shadowWorkbookPayloadSize=Qa(re);V.shadowWorkbookSizeExceedsLimit=gb(re);V.payloadOrigin=nd?eb.aKf:eb.Gwe;V.payloadType=Nd.D7f;if(gb(re))return V=String.format("Shadow workbook size [{0}] is over the limit [{1}]. ShadowWorkbookSizeExceedsLimit: {2}",V.shadowWorkbookPayloadSize,
Pd.a.Vfc,re.shadowWorkbookSizeExceedsLimit),fc.ULS.sendTraceTag(36304156,0,15,"ArtCopyPasteHandler.Deserialize: {0}",V),Promise.reject(new Hc.a(1,void 0,void 0,V));Ib=Pa=null;vf.g(this.gC).ga.Ze&326?Ib=vf.g(this.gC).ga.Sa.activeFloatingObjectControlId:Pa=this.gC.sa&&this.gC.sa.activeCell?df.v(this.gC.sa.activeCell,this.gC):df.v(df.K(V.commandParameters.originalDestinations),this.gC);nd=null;if(this.vlb.YRf(wc))try{nd=this.vlb.n1c()}catch(xe){fc.ULS.sendTraceTag(37857494,0,10,"ArtCopyPasteHandler.Deserialize: Exception encountered while performing client-side estimation. Exception: {0}",
copyPasteInfra.getStringifiedError(xe))}return this.BEi.BOh(new wa(V.commandParameters.ribbonCommandInfo,Pa,Ib,V.commandParameters.commandType,[V.commandParameters.stopwatch],re,wc,V,nd))};La.prototype.kkc=function(V){V.wasLastCopyExternal=!0;if(V.clipboardItems.getItem("image/png")){var Pa=V.commandParameters.stopwatch.Gc;V.payloadType=Nd.CBg;var Ib={};return Yc.b(this.gC.Re(1403967063,V.commandParameters.ribbonCommandInfo.method,V.commandParameters.ribbonCommandInfo.qf,(Ib.dataUrl=V.clipboardItems.getItem("image/png"),
Ib))).then(function(wc){V.serverRequestTimeInMs=V.commandParameters.stopwatch.Gc-Pa;return wc?Promise.resolve(null):Promise.reject(new Hc.a(15))},function(){V.serverRequestTimeInMs=V.commandParameters.stopwatch.Gc-Pa;return Promise.reject(new Hc.a(15))})}fc.ULS.shipAssertTag(39965841,0,!1,"Should not paste external content that is not image via ArtCopyPasteHandler");return pb.prototype.kkc.call(this,V)};La.prototype.G6h=function(){var V=vf.g(this.gC).ga;return V.Sa.activeFloatingObjectControlId&&
V.Sa.nc&&V.Sa.nc.floatingObject?V.Sa.nc.floatingObject.HMd():!1};La.prototype.K8c=function(V,Pa,Ib){var wc=this;return new Promise(function(nd,Bd){var yd=V.commandParameters.stopwatch.Gc;fc.ULS.sendTraceTag(41562516,0,50,"ArtCopyPasteHandler.GetCopiedDataFromServer: issue request to the server to get the copied data...");wc.WWa.aRg(new Da(Pa.activeFloatingObjectControlId,V.commandParameters,function(re){V.requestTelemetryData=re.RequestTelemetryData;V.serverRequestTimeInMs=V.commandParameters.stopwatch.Gc-
yd;if(kd.a.eh(re.Errors))kd.a.X8(re.Errors)?(V.encounteredDeploymentErrors=!0,fc.ULS.sendTraceTag(36538327,0,15,"ArtCopyPasteHandler.GetCopiedDataFromServer: Got deployment errors - keeping promise unfulfilled until we replay the operation. errors: {0}",kd.a.fd(re.Errors))):(fc.ULS.sendTraceTag(36229122,0,10,"ArtCopyPasteHandler.GetCopiedDataFromServer: GetCopiedDataFromServer failed. errors: {0}",kd.a.fd(re.Errors)),Bd(new Jb(4,re.Errors)));else if(fc.ULS.sendTraceTag(36229121,0,50,"ArtCopyPasteHandler.GetCopiedDataFromServer: GetCopiedDataFromServer succeeded for FloatingObjectId=[{0}].",
Pa.activeFloatingObjectControlId),V.markForCancellation)Bd(new Jb(3,re.Errors));else{kd.a.Fq(re.Errors)&&fc.ULS.sendTraceTag(39688195,0,50,"ArtCopyPasteHandler.GetCopiedDataFromServer: Server messages present. Errors: {0}",kd.a.fd(re.Errors));var xe=re.Result;if(xe){xe=wc.gwe(xe);xe.floatingObjectId=Pa.activeFloatingObjectControlId;V.shadowWorkbookPayloadSize=Qa(xe);V.shadowWorkbookSizeExceedsLimit=gb(xe);try{var Re=JSON.stringify(xe)}catch(Tf){Bd(new Hc.a(14,void 0,Tf,String.format("Failed to stringify shadow workbook: copyContext.ShadowWorkbookPayloadSize: [{0}], shadowWorkbookPayload.FloatingObjectId: [{1}]",
V.shadowWorkbookPayloadSize,xe.floatingObjectId)));return}fc.ULS.shipAssertTag(41537862,0,!!Ib,"Expecting syncClipboardItems to be defined");Ib.setItem(Pb.yN,Re);1===V.commandParameters.commandType&&(wc.HHi(Pa.type,Pa.activeFloatingObjectControlId,re.StateId),wc.deleteFloatingObject(Pa.activeFloatingObjectControlId,Pa.type));wc.hYc.setValue(Pa,Ib);V.asyncClipboardItemsKeys=Cb(Ib);nd(Ib)}else fc.ULS.sendTraceTag(36508684,0,50,"ArtCopyPasteHandler.GetCopiedDataFromServer: Result form server returned null, copied item id: {0}",
Pa.activeFloatingObjectControlId),nd(wc.hYc.getValue(Pa))}},V.commandParameters.commandType,Pa.type,function(re){V.serverRequestTimeInMs=V.commandParameters.stopwatch.Gc-yd;re=qa.a.Eg(re.data);1===V.commandParameters.commandType&&wc.WWa.Xtj(Pa.type,Pa.activeFloatingObjectControlId);fc.ULS.sendTraceTag(36229123,0,10,"ArtCopyPasteHandler.GetCopiedDataFromServer: GetCopiedDataFromServer failed. errors: {0}",kd.a.fd(re));Bd(new Jb(4,re))},[V.commandParameters.stopwatch]))})};La.prototype.deleteFloatingObject=
function(V,Pa){V=qd.a.Cy(Pa,V);if(V=kh.a(this.gC).Cp(V))kh.a(this.gC).deleteFloatingObject(V,14,!0),vf.g(this.gC).ga.Sa.XB=null};La.prototype.HHi=function(V,Pa,Ib){var wc=this.gC.ea.Ea(277,void 0);if(wc){var nd=null;V=qd.a.Cy(V,Pa);(V=kh.a(this.gC).Cp(V))&&V.Di&&(nd=V.Di.block);if(nd){var Bd=V.floatingObject.Lg();wc.XUb(function(){return!nd.Ri.tb(Bd)},Ib,"CutArt")}}};La.k0h=function(V){return 1===V.type||5===V.type};Object(ac.a)(La,"ArtCopyPasteHandler",pb,[]);var Lf=b(55);Cm(Gc,Nc);Object(ac.a)(Gc,
"MacroRecorderPasteArtPayload",Nc,[]);nc.prototype.JTh=function(V,Pa,Ib,wc,nd,Bd,yd){var re=this;Bd=void 0===Bd?null:Bd;yd=void 0===yd?null:yd;var xe=this.$.ra.xa.dc(),Re=null,Tf={CopyPasteTargetType:2};Tf.FloatingObjectId=V;Tf.CopyOperationId=Ib.id;Ib.floatingObjectType=Pa;qc.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CopyChartsToPPTOEnabled",!1)&&(Tf.UploadToClipService=Ib.uploadToClipService,Tf.PKey=Ib.pKey,Tf.ClipServiceDataCenter=Ib.clipServiceDataCenter);var ag=0;2===nd?(nd=505,
ag=16,Re=function(Qg,Rg,Hh){return Xa(re.$.ra.xa,Tf,Ne.b(Qg,wc),Bd?Ne.a(Rg,Bd):Rg,Hh,Ib.ribbonCommandInfo,xe,yd)}):(nd=179,Re=function(Qg,Rg,Hh){re.B4g(Pa,V);re.$.Ss();var Fg=re.$.ra.xa;Qg=Ne.b(Qg,wc);Rg=Bd?Ne.a(Rg,Bd):Rg;var Xg=Ib.ribbonCommandInfo,cg=yd;cg=void 0===cg?null:cg;var Mh=Fg.Ra(1,void 0===xe?null:xe);Mh.copyParameters=Tf;return bf.i(Fg,"Cut",Mh,Qg,Rg,Hh,Xg,0,cg)});qc.EwaSettings.wc()?this.$.userOperationManager.oc(new hf.a(nd,0,Re,ag|64),Ib.ribbonCommandInfo):this.$.userOperationManager.oc(new Rc.a(nd,
0,Re,ag),Ib.ribbonCommandInfo)};nc.prototype.B4g=function(V,Pa){var Ib=qd.a.Cy(V,Pa);(Ib=kh.a(this.$).Cp(Ib))?(vf.g(this.$).ga.Sa.jG(Ib),Ib.isVisible=!1):fc.ULS.sendTraceTag(37790621,0,50,"ArtCopyPasteUtils.DoCutClientEstimation: floatingObjectcontrol is null. FloatingObjectType : {0}, FloatingObjectId: {1}",V,Pa)};nc.prototype.Xtj=function(V,Pa){V=qd.a.Cy(V,Pa);if(V=kh.a(this.$).Cp(V))V.isVisible=!0};nc.prototype.aRg=function(V){this.JTh(V.floatingObjectId,V.ZQg,V.commandParameters,V.gr,V.EZg,V.p3,
V.uRd)};nc.prototype.jUh=function(V,Pa,Ib,wc,nd,Bd,yd,re,xe){var Re=this;re=void 0===re?null:re;xe=void 0===xe?!0:xe;return new Promise(function(Tf,ag){var Qg=Bd.commandParameters.stopwatch.Gc;Re.mGd(V,nd,Pa,Ib,function(Rg){Bd.requestTelemetryData=Rg.RequestTelemetryData;Bd.serverRequestTimeInMs=Bd.commandParameters.stopwatch.Gc-Qg;if(kd.a.X8(Rg.Errors))Bd&&(Bd.encounteredDeploymentErrors=!0),fc.ULS.sendTraceTag(36538328,0,15,"ArtCopyPasteUtils.PasteArt: Got deployment errors - keeping promise unfulfilled until we replay the operation. errors: {0}",
kd.a.fd(Rg.Errors));else if(kd.a.eh(Rg.Errors))fc.ULS.sendTraceTag(36459652,0,10,"ArtCopyPasteUtils.PasteArt: PasteArt failed. errors: {0}",kd.a.fd(Rg.Errors)),ag(new Hc.a(9,Rg.Errors));else if(Rg.Result){var Hh=Rg.Result;fc.ULS.sendTraceTag(36229124,0,50,"ArtCopyPasteUtils.PasteArt: PasteArt succeeded.");Re.VHi(yd,Hh.FloatingObjectId,Rg.StateId);Tf(nc.jed(Hh.FloatingObjectId))}else fc.ULS.sendTraceTag(36229125,0,10,"ArtCopyPasteUtils.PasteArt: PasteArt failed, result returned from server is null."),
ag(new Hc.a(9,Rg.Errors))},function(Rg){Bd.serverRequestTimeInMs=Bd.commandParameters.stopwatch.Gc-Qg;Rg=qa.a.Eg(Rg.data);fc.ULS.sendTraceTag(36229126,0,10,"ArtCopyPasteUtils.PasteArt: PasteArt failed. errors: {0}",kd.a.fd(Rg));ag(new Hc.a(9,Rg))},wc,re,xe)})};nc.prototype.VHi=function(V,Pa,Ib){var wc=this,nd=this.$.ea.Ea(277,void 0);if(nd){var Bd=qd.a.Cy(V,nc.jed(Pa));nd.XUb(function(){return!!kh.a(wc.$).Cp(Bd)},Ib,"PasteArt")}};nc.prototype.EPd=function(V,Pa){Uf.a.na(Pa)||this.vlb.EPd(V,qd.a.Cy(V.type,
Pa))};nc.prototype.Qvf=function(V){var Pa=this;return this.jUh(V.ribbonCommandInfo,V.destination,V.Dye,V.uRd,V.L_,V.pasteContext,V.item.type,V.Eqe,V.item.isFromCurrentSession(this.$)).then(function(Ib){return Ib},function(Ib){Pa.EPd(V.item,V.Eqe);return Promise.reject(Ib)})};nc.prototype.QFd=function(V,Pa,Ib){V||(V=df.v(vf.g(this.$).ga.ya.activeCell,this.$));vf.g(this.$).Wcc(df.D(V),1)?kh.a(this.$).Rla(Ib,Pa,!0):vf.g(this.$).ga.Sa.hFa(V,Pa,Ib).continueWith(function(wc){wc.result?fc.ULS.sendTraceTag(36459653,
5,50,"ArtCopyPasteUtils.SelectPastedObject: Selection succeeded in async manner for object ID [{0}]",Pa):fc.ULS.sendTraceTag(36459654,5,10,"ArtCopyPasteUtils.SelectPastedObject: Selection failed in async manner for object ID [{0}]",Pa)})};nc.prototype.mGd=function(V,Pa,Ib,wc,nd,Bd,yd,re,xe){function Re(){if(xe){var Hh=Lf.a.gi(Lf.a.Oc(Rg));Hh.FloatingObjectId=Pa.floatingObjectId;Rg.DestinationRanges||(Hh.DestinationRanges=df.p(ag.$.Aa.sa.sheetName,"",0,0,0,0));return new Gc(Hh,xe,0,0)}return new Gc(Rg,
xe,0,0)}function Tf(Hh,Fg,Xg){re||ag.$.Ss();return Ea(ag.$.ra.xa,Rg,Ne.b(Hh,nd),Ne.a(Fg,Bd),Xg,null,Qg,yd)}var ag=this;xe=void 0===xe?!0:xe;var Qg=this.$.ra.xa.dc(),Rg={};Rg.ShadowWorkbookBase64=Pa.shadowWorkbookBase64;Rg.FloatingObjectId=wc;Rg.DestinationRanges=Ib?df.s(Ib):null;Rg.CopyPasteTargetType=2;Rg.ClientEstimationFloatingObjectId=re;Ib=qc.EwaSettings.wc()?new hf.a(503,0,Tf,void 0,Re):new Rc.a(503,0,Tf,void 0,Re);Ib.flags=qc.EwaSettings.wc()?65:1;this.$.userOperationManager.oc(Ib,V)};nc.jed=
function(V){return String.format("{0}.{{{1}}}",V.length+2,V.toUpperCase())};Object(ac.a)(nc,"ArtCopyPasteUtils",null,[610]);var te=b(234);Bb.prototype.fxd=function(V,Pa){this.Hra=V;this.fYc=Pa};Bb.prototype.n1c=function(){if(!this.Hra||!this.fYc)return fc.ULS.sendTraceTag(37857495,0,15,"ArtPasteClientEstimation.DoPasteClientEstimation: copiedFloatingObjectControl and/or copiedEffectsExtents is null, aborting client side estimation."),"";var V=fd.a.knb(new qd.a(this.Hra));V.Id=nc.jed(Pe.a.create().toString());
V.Version=-1;V.Name="";V.IsClientEstimation=!0;var Pa=this.sVh(V);if(!Pa)return null;var Ib=new qd.a(V);Pa.block.Ri.add(Ib);Ib.eFb();var wc=kh.a(this.$);wc.c0b(Ib,Pa);Pa=wc.Cp(qd.a.LAh(V));!Pa||Pa.floatingObject.zKa||Pa.floatingObject.UKa||Pa.pPa(this.fYc);wc.Rla(V.Type,V.Id,!0);return V.Id};Bb.prototype.YRf=function(V){return qc.EwaSettings.ka(226)&&V.isFromCurrentSession(this.$)&&!vf.g(this.$).rtl&&!vf.g(this.$).$a.lj};Bb.prototype.EPd=function(V,Pa){this.YRf(V)&&(V=kh.a(this.$).Cp(Pa))&&(fc.ULS.sendTraceTag(38012936,
5,50,"ArtPasteClientEstimation.UndoPasteClientEstimation: undoing client-side estimation. Removing floating object with ID: [{0}] of type [{1}]",Pa,V.floatingObject.type),kh.a(this.$).deleteFloatingObject(V,15,!0),V.Di&&V.R8a(V.Di,!1))};Bb.prototype.sVh=function(V){if(!V)return fc.ULS.sendTraceTag(37857496,0,15,"ArtPasteClientEstimation.InitializeFloatingObjectLocation: Called with null FloatingObjectData."),null;if(vf.g(this.$).ga.Sa.activeFloatingObjectControlId){var Pa=vf.g(this.$).ga.Sa.XB.floatingObject;
V.OriginDeltaX=Pa.offsetX+this.x7a;V.OriginDeltaY=Pa.offsetY+this.x7a;V.AbsoluteLeft+=this.x7a;V.AbsoluteTop+=this.x7a;V.AbsoluteRight+=this.x7a;V.AbsoluteBottom+=this.x7a;V.ZOrder=Pa.wz+1;return vf.g(this.$).ga.Sa.XB.Di}if(!this.$.sa||!this.$.sa.activeCell)return fc.ULS.sendTraceTag(37857497,0,15,"ArtPasteClientEstimation.InitializeFloatingObjectLocation: ActiveItem/ActiveCell is null - cannot perform estimation for grid paste."),null;var Ib=this.$.sa.activeCell;Pa=vf.g(this.$).q0(Ib);if(!Pa)return fc.ULS.sendTraceTag(37857498,
0,15,"ArtPasteClientEstimation.InitializeFloatingObjectLocation: gridViewBlock for range {0} is null.",Ib.toString()),null;var wc=qe.HelperMethods.JIa(Pa.domElement,Pa.sj.domElement);Ib=Pa.gridView.Mg(Ib,2);if(!wc||!Ib)return fc.ULS.sendTraceTag(37857499,0,15,"ArtPasteClientEstimation.InitializeFloatingObjectLocation: blockPositionRelativeToGridOrigin is null: {0}. cellPositionRelativeToGridOrigin is null: {1} .",!wc,!Ib),null;V.OriginDeltaX=Ib.topLeft.x-wc.x;V.OriginDeltaY=Ib.topLeft.y-wc.y;V.AbsoluteLeft=
Ib.topLeft.x;V.AbsoluteTop=Ib.topLeft.y;V.AbsoluteRight=V.AbsoluteLeft+Math.abs(this.Hra.AbsoluteRight-this.Hra.AbsoluteLeft);V.AbsoluteBottom=V.AbsoluteTop+Math.abs(this.Hra.AbsoluteBottom-this.Hra.AbsoluteTop);V.ZOrder=this.Hra.ZOrder+100;return new te.a(Pa.gridView.Ha.Qk(Pa.hashCode),Pa.hashCode)};Object(ac.a)(Bb,"ArtPasteClientEstimation",null,[609]);Tb.prototype.create=function(){var V=window.clipboardPlatform;return V?V.createClipboardItems():null};Object(ac.a)(Tb,"ClipboardItemsFactory",null,
[608]);cb.undefined="Undefined";Object(ac.a)(cb,"CCPTelemetryConsts",null,[]);Ga.cells="Cells";Ga.floatingObject="FloatingObject";Ga.unknown="Unknown";Object(ac.a)(Ga,"ActiveSelection",null,[]);ic.G3g="DisplayNotInvoked";ic.e1c="Displayed";ic.fIi="PrerequisitesNotReady";Object(ac.a)(ic,"PasteIndicationDisplayStatus",null,[]);var Wd=b(109);sc.prototype.getCopyFlowHandler=function(V){var Pa=this.Nwh(vf.g(this.$).Ze);V.commandParameters.copyPasteHandlerName=Pa.name;return Pa};sc.prototype.getPasteFlowHandler=
function(V){var Pa=V.copyContextSnapshot;Pa=Ke(V)?this.oRc:Ue(V)?this.dzd:Pa&&Pa.sourceItem&&Object.getType(Pa.sourceItem)===jd?this.oRc:this.dzd;V.commandParameters.copyPasteHandlerName=Pa.name;return Pa};sc.prototype.initializePasteContext=function(V){if(V&&(V.isSameSession=!1,V.isShadowWorkbookParsedSuccessfully=!1,V.pasteResult=cb.undefined,V.payloadOrigin=cb.undefined,V.payloadType=cb.undefined,V.encounteredDeploymentErrors=!1,V.shadowWorkbookSizeExceedsLimit=!1,V.originalSourceRangesCountExceedsLimit=
!1,V.activeSelectionType=this.Qsh(),V.indicationDisplayScheduled=!1,V.pasteIndicationDisplayStatus=ic.G3g,V.copyContextSnapshot)){var Pa=V.copyContextSnapshot,Ib=yb(Pa.sourceItem),wc=Pa.sourceItem;var nd=!!wc&&Object.getType(wc)===jd;wc=0;var Bd=!1;Ib?(Bd=Pa.sourceItem,V.isSameSession=Bd.isFromCurrentSession(this.$),wc=1,Bd=this.e4h(Bd,V)):nd&&(V.isSameSession=Pa.sourceItem.isFromCurrentSession(this.$),wc=2);if(V.copyContextSnapshot.commandParameters){nd=-1985798686===Pa.commandParameters.ribbonCommandInfo.command;
var yd=V.commandParameters;var re=this.$;Pa?re&&re.Ba?Pa=Pa.sessionId===re.Ba.UserSessionId:(fc.ULS.shipAssertTag(40162715,0,!1,"ewaControl shouldn't be null"),Pa=!1):(fc.ULS.shipAssertTag(40162714,0,!1,"copyContext shouldn't be null"),Pa=!1);yd.clearSystemClipboard=Pa&&nd&&Ib&&!Bd;V.commandParameters.copyPasteTargetType=wc}}};sc.prototype.getSessionId=function(){return this.$.Ba.UserSessionId};sc.prototype.e4h=function(V,Pa){var Ib=Wd.b(V.ranges,function(wc){return wc.Yh})&&Wd.b(Pa.commandParameters.originalDestinations,
function(wc){return 1!==wc.top});return Wd.b(V.ranges,function(wc){return wc.isRow})&&Wd.b(Pa.commandParameters.originalDestinations,function(wc){return 1!==wc.left})||Ib};sc.prototype.Nwh=function(V){switch(V){case 1:return this.dzd;case 64:case 4:case 2:case 256:return this.oRc;default:throw Error.invalidOperation("Unsupported selection");}};sc.prototype.Qsh=function(){return vf.g(this.$).ga.Ze&470?Ga.floatingObject:1===vf.g(this.$).ga.Ze?Ga.cells:Ga.unknown};Jl.Object.defineProperties(sc.prototype,
{dzd:{configurable:!0,enumerable:!0,get:function(){if(!this.AJc){var V=this.$.ea.Ea(254,!0);V&&(this.AJc=new Va(this.$,V,new Tb))}return this.AJc}},oRc:{configurable:!0,enumerable:!0,get:function(){if(!this.qzc&&this.$.ea.Ea(254,!0)){var V=new Bb(this.$);this.qzc=new La(this.$,new Tb,new nc(this.$,V),V)}return this.qzc}}});Object(ac.a)(sc,"ExcelCopyPasteApplicationHost",null,[594]);var mh=b(139),ug=ee.a;Cm(tc,ug);tc.prototype.Nh=function(V){this.Ko=new mh.a;var Pa=xf.a.instance.da(16);V=this.J3(V);
this.initializeAndShow(Pa,Object(ld.a)(this,this.hXh,"insertCopiedCutCellsDialogHandler"),V)};tc.prototype.J3=function(V){var Pa={};return Pa.id=this.xc,Pa.isRtl=V,Pa};tc.prototype.hXh=function(V,Pa){1===V?(V=tc.R2g[Pa[tc.Q2g]],fc.ULS.sendTraceTag(545124621,0,50,"InsertCopiedCutCellsDialog.InsertCopiedCutCellsDialogHandler OK button pressed with valid input, shift direction = {0}",V?"Vertical":"Horizontal"),this.Ko.setResult(V)):(fc.ULS.sendTraceTag(545124620,0,50,"InsertCopiedCutCellsDialog.InsertCopiedCutCellsDialogHandler cancel button pressed"),
this.Ko.Xt())};Jl.Object.defineProperties(tc.prototype,{xc:{configurable:!0,enumerable:!0,get:function(){return"InsertCopiedCutCellsDialog"}}});tc.Q2g="direction";var ki={};tc.R2g=(ki.Vertical=1,ki.Horizontal=0,ki);Object(ac.a)(tc,"InsertCopiedCutCellsDialog",ee.a,[]);Oc.prototype.e0b=function(V,Pa){return(new tc(V,Pa)).Ko.task};Object(ac.a)(Oc,"InsertCopiedCutCellsDialogFactory",null,[593]);var Hg=b(86),Mg=b(44),Eh=b(42);td.prototype.KAe=function(){var V=this;this.Zkc||(fc.ULS.sendTraceTag(592528332,
0,50,"PasteIndicationManager.DownloadPrerequisitesIfNeeded: Trying to get appChrome"),this.gridView.$.HG(function(Pa){Pa.lIa(0).then(function(){V.Zkc=!0})}))};td.prototype.U1i=function(V){var Pa=this,Ib=V.commandParameters.id;fc.ULS.sendTraceTag(593781649,0,50,"PasteIndicationManager.ScheduleDisplay: pasteCommandId = {0}, cancelCtx is null = {1}, PrerequisitesDownloaded = {2}",Ib,!this.xr,this.Zkc);this.KAe();this.d1b=Ib;Ib=!this.qhf();if(!this.xr||Ib)this.Pne(),this.xr=Mg.a.instance.create(function(){Pa.F3g(V)},
void 0===V.timeoutToShowSpinnerInMs||null===V.timeoutToShowSpinnerInMs?100:V.timeoutToShowSpinnerInMs,Eh.a.FEi);this.t1=V.commandParameters.originalDestinations};td.prototype.F3g=function(V){this.Zkc?(this.display(V.commandParameters.originalDestinations),V.pasteIndicationDisplayStatus=ic.e1c):(fc.ULS.sendTraceTag(592528331,0,50,"PasteIndicationManager.DisplayIfPossible: Prerequisites were not ready, skipping display"),this.hide(),V.pasteIndicationDisplayStatus=ic.fIi)};td.prototype.display=function(V){fc.ULS.sendTraceTag(593781648,
0,50,"PasteIndicationManager.Display: started");this.gridView.Sb.Zu(yg.a.zW(hd.d(this.gridView.$.sa),V),td.lkc,!0);this.gridView.Sb.Wr(td.lkc)};td.prototype.Zcd=function(V){fc.ULS.sendTraceTag(593781647,0,50,"PasteIndicationManager.HideForPasteId: pasteCommandId = {0}, currentPasteCommandId = {1}",V,this.d1b);V&&Uf.a.equals(V,this.d1b,!1)&&this.hide()};td.prototype.hide=function(V){this.t1&&(void 0===V?0:V)&&this.qhf()&&fc.ULS.sendTraceTag(575010144,0,15,"PasteIndicationManager.Hide: Triggered by a SelectionChanged event while indication is (or will be) active but active range did not change");
this.d1b="";this.Pne();this.t1=null;this.gridView.Sb.ll(td.lkc);this.gridView.Sb.qm(null,td.lkc)};td.prototype.qhf=function(){return df.Q(this.gridView.ga.ya.selectedRanges,this.t1)};td.prototype.Pne=function(){this.xr&&(Hg.a.Ia(this.xr),this.xr=null)};td.prototype.dispose=function(){this.hide();this.gridView.ga.bF(Object(ld.a)(this,this.hide,"hide"))};td.lkc=[30];Object(ac.a)(td,"PasteIndicationManager",null,[592,7]);var Gh=b(1006),qi=b(48),Bh=Og.a;Cm(kc,Bh);kc.prototype.create=function(){var V=
this,Pa=qi.a.tQ([53,54],4,this.vb,void 0,void 0,void 0,kc.dPa),Ib=Hf.GetServiceTaskFactory.create(this.$.ea,18,this.$.ma,this.vb,"Microsoft.Office.Excel.WebUI.Client.IFormatCellsAction");ih.TaskExtensions.Da(ih.TaskExtensions.Fe([Ib,Pa],this.ma),function(){var wc=new Gh.a,nd=null;V.ROg(wc).then(function(Bd){nd=Bd.Hqe;var yd=copyPasteInfra.createCopyPasteInfra(nd,new sc(V.$),wc,V.$);fc.ULS.shipAssertTag(24970909,0,!!V.$.Ba,"CopyPasteInfrastructureFactory.Create: this.ewaControl.BootstrapContext should not be null");
fc.ULS.shipAssertTag(24970910,0,!!V.$.Ba&&!!V.$.Ba.DocumentHostInfo,"CopyPasteInfrastructureFactory.Create: this.ewaControl.BootstrapContext.DocumentHostInfo should not be null");var re=nd.getMetadataManager();V.Jb(new Qc(V.$,re,Ib.result,yd,new dc(V.$,vf.g(V.$)),new Oc,V.$.Ba.DocumentHostInfo.UserId,nd.getInitializationError()));Bd.qYa?fc.ULS.sendTraceTag(41731933,0,50,"CopyPasteInfrastructureFactory.Create: Initialize CCP infra succeed. SliceName={0}, StrategyType={1}, StrategyCapabilities={2}, IsBestStrategyTypeInitialized={3}, InfraLoadTimeMS={4}",
Qc.S6b(),Bd.qYa.dataClipboardStrategyType,JSON.stringify(Bd.qYa.dataClipboardCapabilities),Bd.qYa.clipboardStrategiesToInitialize[0].clipboardStrategyType===Bd.qYa.dataClipboardStrategyType,void 0!==window.bsqmXLSPageLoadStartTime&&null!==window.bsqmXLSPageLoadStartTime?(Date.now()-window.bsqmXLSPageLoadStartTime.getTime()).toString():"-1"):fc.ULS.shipAssertTag(41731932,0,!1,"CopyPasteInfrastructureFactory.Create: initResult.ClipboardPlatformEnvironmentInitializationInfo should not be null")},function(Bd){fc.ULS.shipAssertTag(38847436,
0,!1,"CopyPasteInfrastructureFactory.Create: error during call to clipboardPlatformEnvironment.Init(). Copy Paste operations will not be available in this session. SliceName: {0} error: {1}",Qc.S6b(),Bd?copyPasteInfra.getStringifiedError(Bd):"null")})},this.ma,3)};kc.prototype.dispose=function(){Bh.prototype.dispose.call(this)};kc.prototype.ROg=function(V){var Pa=null,Ib=window.clipboardPlatform;Ib&&(Pa=Ib.getClipboardPlatformEnvironment());if(!Pa)return fc.ULS.shipAssertTag(24970911,0,!1,"CopyPasteInfrastructureFactory.ConfigureClipboardPlatformEnvironment: getClipboardPlatformEnvironment should have returned a valid object"),
Promise.reject(null);Ib=this.$.Ba;var wc=[Ib.OfficeOnlineChromeExtensionId,Ib.ChromeClipboardAccessExtensionId],nd=this.Rm.Ya(5),Bd=this.$.lg.get(57),yd=!Bd&&this.$.lg.get(5),re=this.$.fa.mc;re&&(re.inWebPart||re.inViewerFromWebPart||re.isDivSyndicated)&&(yd=!1);Bd=this.Lvh(yd,!Bd);fc.ULS.shipAssertTag(40380624,0,!!Ib.DocumentHostInfo,"CopyPasteInfrastructureFactory.ConfigureClipboardPlatformEnvironment: bootstrapContext.DocumentHostInfo should not be null");return Pa.init(this.$,V,wc,Ib.SharedClipboardHostingApp,
Ib.SharedClipboardHostingApps,Ib.SharedClipboardHostingEnvironments,Ib.SharedClipboardOverrideOrigin,Ib.SharedClipboardSchemaVersion,Ib.SharedClipboardExpirationInMinutes,Ib.ClipboardPromiseTimeoutInMinutes,nd,Ib.MachineCluster,new xb(this.$),Bd,Ib.DocumentHostInfo.UserId,Ib.ClipboardTtlInMS,qc.EwaSettings.ka(319),Ib.UserSessionId).then(function(xe){return Object.assign(new Ic,{Hqe:Pa,qYa:xe})},function(xe){return Promise.reject(xe)})};kc.prototype.Lvh=function(V,Pa){var Ib=[];V&&Pa&&Array.add(Ib,
this.eYg());Pa&&(Array.add(Ib,this.SZc(7)),Array.add(Ib,this.SZc(0)));V&&Array.add(Ib,this.rve());Array.add(Ib,{clipboardStrategyType:4});fc.ULS.sendTraceTag(39978242,0,50,"CopyPasteInfrastructureFactory.GetClipboardStrategiesInitList: create clipboard stratgy initialization list: isBrowserStorageAllowed={0}, isSystemClipboardAllowed={1}, result = {2}",V,Pa,Ib?Ib.join(","):"[]");return Ib};kc.prototype.rve=function(){var V=this.$.Ba,Pa={clipboardStrategyType:5};Pa.sessionId=V.UserSessionId;Pa.useSharedClipboardIframe=
!0;Pa.sharedClipboardHostingApp=V.SharedClipboardHostingApp;Pa.sharedClipboardHostingApps=V.SharedClipboardHostingApps;Pa.sharedClipboardHostingEnvironments=V.SharedClipboardHostingEnvironments;Pa.sharedClipboardOverrideOrigin=V.SharedClipboardOverrideOrigin;Pa.sharedClipboardSchemaVersion=V.SharedClipboardSchemaVersion;Pa.sharedClipboardExpirationInMinutes=V.SharedClipboardExpirationInMinutes;Pa.wacCluster=V.MachineCluster;return Pa};kc.prototype.eYg=function(){var V={clipboardStrategyType:6};V.localStorageStrategyParameters=
this.rve();V.systemClipboardStrategyParameters=this.SZc(0);return V};kc.prototype.SZc=function(V){var Pa={};Pa.clipboardStrategyType=V;Pa.skipFilesIfPlainTextExists=!0;return Pa};kc.la=function(V){V.ea.La(373,new td(V));V.ea.La(kc.dPa,new kc(V))};kc.dPa=255;Object(ac.a)(kc,"CopyPasteInfrastructureFactory",Og.a,[]);var Cf=b(12),Yh=b(120),aa=b(13),ab=Md.a;Cm(vb,ab);vb.prototype.dispose=function(){this.sm();this.nk=this.Jt=this.$=null;this.statusBarManager&&(this.statusBarManager.UC(this),this.statusBarManager=
null)};vb.prototype.Km=function(){return this.wSf};vb.prototype.Mq=function(V,Pa){if("QueryPasteShortcutEnabledLabel"!==V&&!Array.contains(vb.wlj,V))return!1;var Ib=this.jo();"QueryPasteShortcutEnabledLabel"===V?(Pa.Visible=Ib,fc.ULS.sendTraceTag(537507983,0,100,"PasteShortcutManager.ExecuteRootCommand: Setting visible to {0} for commandId {1}",Ib,V)):(Pa.Visible=!Ib,fc.ULS.sendTraceTag(537507982,0,100,"PasteShortcutManager.ExecuteRootCommand: Setting visible to {0} for commandId {1}",!Ib,V));return!0};
vb.prototype.i8g=function(){this.Xj();this.raiseEvent("pasteShortcutStatusChanged")};vb.prototype.m2b=function(){this.sm();this.raiseEvent("pasteShortcutStatusChanged")};vb.prototype.jo=function(){return this.R2c};vb.prototype.np=function(V){this.addHandler("pasteShortcutStatusChanged",V)};vb.prototype.Kp=function(V){this.removeHandler("pasteShortcutStatusChanged",V)};vb.prototype.Xj=function(){if(!this.jo()){this.R2c=!0;vf.g(this.$).Ej.Cm(Object(ld.a)(this,this.tze,"disablePressEnterToPasteOnEditStarted"));
this.nk.la("blur",Object(ld.a)(this,this.Z2g,"disablePressEnterToPasteOnDocumentHidden"));var V=this.$.ea.Ea(65,void 0);V&&V.s2&&V.s2.registerForCommentEvents(Object(ld.a)(this,this.sze,"disablePressEnterToPasteOnCommentsEvent"));this.Jt.St(aa.a.Rb,this.$.domElement,Object(ld.a)(this,this.onKeyDown,"onKeyDown"),!0)}};vb.prototype.sm=function(){if(this.jo()){this.R2c=!1;vf.g(this.$).Ej.mm(Object(ld.a)(this,this.tze,"disablePressEnterToPasteOnEditStarted"));this.nk.detach("blur");var V=this.$.ea.Ea(65,
void 0);V&&V.s2&&V.s2.unregisterForCommentEvents(Object(ld.a)(this,this.sze,"disablePressEnterToPasteOnCommentsEvent"));this.Jt.kv(aa.a.Rb,this.$.domElement,Object(ld.a)(this,this.onKeyDown,"onKeyDown"),!0)}};vb.prototype.tze=function(){this.m2b()};vb.prototype.Z2g=function(){this.m2b()};vb.prototype.sze=function(V){10===V&&this.m2b()};vb.prototype.onKeyDown=function(V){if(13===V.Ga.keyCode){V=new zg.a(237279923,1,2,6,null);var Pa={};this.$.Na.Xb(V,(Pa.SkipClipboardAccess=!0,Pa.EnterToPaste=!0,Pa));
return!0}return!1};vb.wlj=["QuerySheetNumberButton","QueryWorkbookStatisticsButton"];Object(ac.a)(vb,"PasteShortcutManager",Md.a,[480,155,156,7]);var Rb=b(124),Cc=Og.a;Cm(Ab,Cc);Ab.prototype.create=function(){var V=this.$;this.Jb(V.ea.Ea(478,void 0)||this.$.ea.La(478,new vb(V,Yh.KeyInputManager.instance,Rb.a.instance.VB())))};Ab.la=function(V){V.ea.La(479,new Ab(V))};Object(ac.a)(Ab,"PasteShortcutManagerFactory",Og.a,[]);zc.prototype.isEnabled=function(){if(hb.AFrameworkApplication.ha?hb.AFrameworkApplication.ha.ta("IsAnonymousUser"):
1)return!1;var V=hb.AFrameworkApplication.Kb?Object(Od.a)(String,hb.AFrameworkApplication.Kb.AudienceGroup):"";return"Unknown"!==V&&"Automation"!==V};Jl.Object.defineProperties(zc.prototype,{FQc:{configurable:!0,enumerable:!0,get:function(){return"Excel"}},campaignId:{configurable:!0,enumerable:!0,get:function(){return"aed9de6b-d4e7-4878-988a-9dfec66fed9e"}},version:{configurable:!0,enumerable:!0,get:function(){return 1}},currentVersion:{configurable:!0,enumerable:!0,get:function(){return 0}},t0h:{configurable:!0,
enumerable:!0,get:function(){return this.isEnabled()&&this.$.ka(352)}},G4a:{configurable:!0,enumerable:!0,get:function(){return this.isEnabled()&&this.$.ka(354)}},Rwb:{configurable:!0,enumerable:!0,get:function(){return this.$.ka(353)}},Anh:{configurable:!0,enumerable:!0,get:function(){return null}},Xff:{configurable:!0,enumerable:!0,get:function(){return 24}},mJf:{configurable:!0,enumerable:!0,get:function(){return 4E3}},tFb:{configurable:!0,enumerable:!0,get:function(){return this.$.Ba.WebServiceBase||
""}}});Object(ac.a)(zc,"FirstRunExperienceLauncherSettings",null,[598]);ec.prototype.lKd=function(){this.ZKe&&this.ZKe.lKd(this.mnh)};Object(ac.a)(ec,"FirstRunExperienceManager",null,[478]);var Bc=Og.a;Cm(Za,Bc);Za.prototype.create=function(){this.Jb(this.$.ea.Ea(311,void 0)||this.ZTg())};Za.prototype.ZTg=function(){var V=new zc(this.$);V=new ec(lf.a.instance.resolve("Common.App.FirstRunExperienceLauncher.IFirstRunExperienceLauncher"),V);V.lKd();return V};Za.la=function(V){V.ea.La(312,new Za(V))};
Object(ac.a)(Za,"FirstRunExperienceManagerFactory",Og.a,[]);var Dd=b(57),Ee=Og.a;Cm(fb,Ee);fb.prototype.create=function(){this.Jb(this.$.ea.Ea(361,void 0)||this.KUg())};fb.prototype.KUg=function(){var V=this;this.ted=lf.a.instance.Uh("Common.IInProductMessagingUIManager");Dd.a.Nf.isReactSharedHeaderUxEnabled?lg.a.get_instance().en(16,function(){V.K1e()}):this.K1e();return this.ted};fb.prototype.K1e=function(){var V=this;lf.a.instance.yc("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper").execute(function(Pa){Pa.isFeatureEnabled("MsoPremiumBadge",
!0).then(function(Ib){!Ib&&Pa.isFreemiumUpsellEnabled()&&V.ted.hbf();return null})})};fb.la=function(V){V.ea.La(362,new fb(V))};Object(ac.a)(fb,"InProductMessagingManagerFactory",Og.a,[]);var we=b(800),Be=b(98),We=b(172);Object(ac.a)(E,"UploadBlobParameters",null,[]);var bg=b(112);ia.prototype.JBb=function(V){this.yj=V;if(!this.KZa){if(this.kRd){if(this.U5a&&ff.a.zE){this.MOb=V.K2b(Object(ld.a)(this,this.etd,"onFileChosen"));return}this.MOb=V.K2b(null);if(!this.mAa(this.MOb,V))return}this.finalizeUpload(V,
null)}};ia.prototype.etd=function(V){if(this.mAa(V,this.yj)){if(ff.a.zE||ff.a.Pf)this.MOb=V;this.finalizeUpload(this.yj,null)}};ia.prototype.zjc=function(){this.Oud&&this.Oud()};ia.prototype.OYi=function(){this.Dpa=0;this.kDa=this.ha.qd("Box4UploadRetryDelayStart",200);this.yj&&(this.yj.dispose(),this.yj=null)};Jl.Object.defineProperties(ia.prototype,{context:{configurable:!0,enumerable:!0,get:function(){return this.XR}},ha:{configurable:!0,enumerable:!0,get:function(){return this.yb}},retryCount:{configurable:!0,
enumerable:!0,get:function(){return this.Dpa}},mEd:{configurable:!0,enumerable:!0,get:function(){return this.kDa}}});Object(ac.a)(ia,"FileUploader",null,[]);var Ff=b(409),Ng=b(893),Sg=b(128);Cm(Kb,ia);Kb.prototype.bQe=function(V){switch(V){case 1:return CommonUIStrings.l_ImageUploadNoFileSpecified;case 2:return CommonUIStrings.l_ImageUploadUnsupportedFileType;default:return""}};Kb.prototype.H4f=function(V){return Kb.mAa(V,this.yKh())};Kb.prototype.yKh=function(){return Kb.Rae};Kb.prototype.mAa=function(V,
Pa){return(V=this.H4f(V))?(Pa&&Pa.ide(),2===V&&this.ki(0,this.bQe(V)),!1):!0};Kb.prototype.finalizeUpload=function(V,Pa){fc.ULS.sendTraceTag(36783360,322,50,"PictureUploader.FinalizeUpload");this.Oud=Pa;this.Agj();Ff.a.mark(5576);this.qRb=this.VH.Ic("LoadResource","PictureUploadTime")};Kb.prototype.ki=function(V,Pa){var Ib=new Sg.StandardDialog;Ib.lc=0;Ib.kz(V,CommonUIStrings.l_ImageUploadFailedTitle,Pa,null)};Kb.prototype.zjc=function(){fc.ULS.sendTraceTag(36783361,322,50,"PictureUploader.OnUploadComplete");
ia.prototype.zjc.call(this);this.qRb&&(this.qRb.stop(),this.qRb=null);this.sMg()};Kb.prototype.Agj=function(){this.Ypa=(new Ng.a).create();this.Ypa.message=CommonUIStrings.l_ImageUploadWait;this.Ypa.lc=5;this.Ypa.Fu=!1;this.Ypa.iza(null,null,null)};Kb.prototype.sMg=function(){this.Ypa&&(this.Ypa.close(),this.Ypa=null)};Kb.jQh=function(V,Pa){V=Yg.a.un(V);for(var Ib=0;Ib<Pa.length;++Ib)if(V.endsWith(Pa[Ib]))return!0;return!1};Kb.mAa=function(V,Pa){Pa=void 0===Pa?null:Pa;Pa||(Pa=Kb.Rae);return V?Kb.jQh(V,
Pa)?0:2:1};Jl.Object.defineProperties(Kb.prototype,{VH:{configurable:!0,enumerable:!0,get:function(){return hb.AFrameworkApplication.za.bB}}});Kb.Rae=".jpg .jpeg .png .gif .bmp .tif .tiff".split(" ");Object(ac.a)(Kb,"PictureUploader",ia,[]);var vg=b(671),vh=b(570),Ag=b(140),Aa=b(40),pa=b(1165),ub=Ag.a;Cm(Ua,ub);Ua.prototype.validate=function(){this.yj.rG||fc.ULS.sendTraceTag(25798091,322,10,"UploadFrame.FileInputElement is null");return this.yj.rG.value?!0:(Ua.kz(CommonUIStrings.l_FileUploadNoFileSpecified),
!1)};Ua.prototype.asi=function(V){this.kjg&&(this.yj=this.WPf(V,this.MTb))};Ua.prototype.bBi=function(){this.yj&&this.yj.rG&&(this.kZd||(this.yj.uQi(Object(ld.a)(this,this.etd,"onFileChosen")),this.kZd=!0),this.yj.LJe())};Ua.prototype.etd=function(V){this.KUa.uploadStatusLabel=V;this.Qvc(this.titleText,Object(ld.a)(this,this.Fac,"insertDialogHandler"),this.KUa)};Ua.prototype.Fac=function(V){1===V&&this.isEnabled()?Ua.cy&&this.yj.rG&&!this.yj.rG.value?(this.KUa.uploadStatusLabel=CommonUIStrings.l_FileUploadNoFileSpecified,
this.Qvc(this.titleText,Object(ld.a)(this,this.Fac,"insertDialogHandler"),this.KUa)):(this.kub(),this.MTb.finalizeUpload(this.yj,Object(ld.a)(this,this.dispose,"dispose"))):V||this.hide()};Ua.prototype.XPf=function(){this.yCc=!1;this.yj=this.WPf(document.getElementById("uploadFrameContainer"),this.MTb);hb.AFrameworkApplication.ha.ta("InsertPictureDialogFocusLoopFixIsEnabled")&&(this.yfa=Object(ld.a)(this,this.Pud,"onUploadFrameLoad"),Aa.a.addHandler(this.yj.iFrame,"load",this.yfa));this.yj.rG||fc.ULS.sendTraceTag(25798092,
322,15,"UploadFrame.FileInputElement is null");this.czf()};Ua.prototype.Pud=function(){this.czf()};Ua.prototype.czf=function(){if(this.yj&&!this.yCc){var V=this.yj.rG;V&&(Aa.a.addHandler(V,aa.a.Rb,Object(ld.a)(this,this.onKeyDown,"onKeyDown")),V=[V],this.Xm=V.concat.apply(V,this.Xm),this.U2f(),this.yCc=!0)}};Ua.prototype.dispose=function(){if(this.yj&&!Ua.cy){var V=this.yj.rG;V&&Aa.a.removeHandler(V,aa.a.Rb,Object(ld.a)(this,this.onKeyDown,"onKeyDown"));this.yfa&&Aa.a.removeHandler(this.yj.iFrame,
"load",this.yfa)}this.yj=null;ub.prototype.dispose.call(this)};Ua.prototype.U2f=function(){if(0<this.Xm.length){var V=new pa.a(this.Xm),Pa=tf.FocusManager.instance().PP();Pa&&(this.Xm[0].focus(),Pa.mf=V,Pa.eV=!0)}};Ua.prototype.onKeyDown=function(V){4!==tf.FocusManager.instance().ezf(V)&&V.preventDefault()};Ua.kz=function(V){var Pa=document.getElementById("errorText");Pa.innerText=V;Pa.style.display="inline-block"};Jl.Object.defineProperties(Ua.prototype,{xzj:{configurable:!0,enumerable:!0,get:function(){return this.MTb}}});
Jl.Object.defineProperties(Ua,{cy:{configurable:!0,enumerable:!0,get:function(){return hb.AFrameworkApplication.za.Za.Ju&&hb.AFrameworkApplication.za.Za.w7e}}});Object(ac.a)(Ua,"InsertFileDialog",Ag.a,[]);Jl.Object.defineProperties(va,{Mf:{configurable:!0,enumerable:!0,get:function(){return Ag.a.jj(va.Oj,CommonUIStrings.l_ImageUploadDialogText,CommonUIStrings.l_ImageUploadNoFileSpecified)}}});va.Oj="<div class='WACDialogRow' id='block1'> <label id='labelText' class='WACDialogLabel' >{0}</label> </div> <div class='WACDialogRowNoBreak' id='block2'> <div id='uploadFrameContainer'></div> <div class='WACDialogError' id='errorText' role='alert'>{1}</div> </div>";
Object(ac.a)(va,"InsertImageDialogHtml",null,[]);Cm(Ia,Ua);Ia.prototype.validate=function(){this.yj.rG||fc.ULS.sendTraceTag(25798095,322,10,"UploadFrame.FileInputElement is null");var V=Object(Od.a)(Kb,this.xzj),Pa=V.H4f(this.yj.rG.value);return Pa?(Ua.kz(V.bQe(Pa)),!1):!0};Jl.Object.defineProperties(Ia.prototype,{iUb:{configurable:!0,enumerable:!0,get:function(){return CommonUIStrings.l_ImageUploadButtonText}},titleText:{configurable:!0,enumerable:!0,get:function(){return CommonUIStrings.l_ImageUploadingTitle}},
r2g:{configurable:!0,enumerable:!0,get:function(){return va.Mf}}});Object(ac.a)(Ia,"InsertImageDialog",Ua,[]);var xd=b(573),oe=b(87),sf=b(186),ef=b(75),fh=b(413);qb.prototype.H1e=function(){this.YR=Pe.a.create().toString();this.kpa?this.F2c():this.bie()};qb.prototype.URg=function(V){this.Rn=document.createElement("iframe");this.Rn.className=V;this.Rn.id=V;this.NZd&&(this.Rn.style.visibility="visible",this.Rn.style.height="30px",this.Rn.setAttribute("frameborder","0"));this.yfa=Object(ld.a)(this,this.Pud,
"onUploadFrameLoad");Aa.a.addHandler(this.Rn,"load",this.yfa)};qb.prototype.K2b=function(V){var Pa=this;hb.AFrameworkApplication.za.RCb();if(!this.yq)return fc.ULS.sendTraceTag(25798093,322,50,"_fileInput is null"),"";Aa.a.addHandler(this.yq,"change",function(){Pa.Vkh(V)});za(Object(ld.a)(this,this.LJe,"fileInputClick"),1,"DoFileOpenDialog");return this.yq.value};qb.prototype.Vkh=function(V){V&&V(this.yq.value)};qb.prototype.Wkh=function(){this.KOb&&(this.KOb.innerText=this.pRe())};qb.prototype.uQi=
function(V){var Pa=this;Aa.a.addHandler(this.yq,"change",function(){V(Pa.pRe())})};qb.prototype.pRe=function(){var V=null;if(this.yq.value){var Pa=this.yq.value,Ib=Pa.lastIndexOf("\\");0<Ib&&(V=Pa.substring(Ib+1,Pa.length))}return V?V:""};qb.prototype.LJe=function(){try{fc.ULS.sendTraceTag(35939520,322,50,"UploadFrame.FileInputClick - Clicking on File input element."),this.yq.click()}catch(V){throw fc.ULS.sendTraceTag(36783331,322,10,"UploadFrame.FileInputClick Exception: {0}",V.message),V;}};qb.prototype.mmj=
function(){this.T5h()?this.MWf():(this.$Qd(),this.es.submit())};qb.prototype.T5h=function(){return(this.teg||this.kpa)&&!(void 0===window.self.FormData||null===window.self.FormData)};qb.prototype.xMf=function(V){if(V){var Pa=this.jue();this.Pg=new XMLHttpRequest;this.Pg.open("POST",Pa);this.Pg.setRequestHeader("X-CorrelationId",this.YR);this.rci(V);this.Pg.onreadystatechange=Object(ld.a)(this,this.jna,"uploadResponseReceived");this.Pg.send(V)}};qb.prototype.rci=function(V){if(!ff.a.sA&&V.get){var Pa=
V.get("ImageId");V=window.self.navigator;var Ib={};Pa=(Ib.CorrelationId=this.YR,Ib.Canary=hb.AFrameworkApplication.canary,Ib.ImageNodeId=Pa,Ib);V&&(V=V.connection?V.connection:V.mozConnection?V.mozConnection:V.webkitConnection?V.webkitConnection:null)&&(Pa.effectiveType=V.effectiveType,Pa.downlink=V.downlink,Pa.type=V.type,Pa.rtt=V.rtt);fc.ULS.sendTraceTag(573345858,322,50,"LogFileUploadStatistics: FileUpload {0}",Pa)}};qb.prototype.MWf=function(){try{this.$Qd();fc.ULS.sendTraceTag(594888409,322,
50,"SubmitFormWithRequest is preparing to send an upload request");var V=new (Type.parse("FormData"))(this.es);this.xMf(V)}catch(Pa){fc.ULS.sendTraceTag(594888407,322,10,"SubmitFormWithRequest failed to send the request with exception "+Pa.message),this.c7a(null)}};qb.prototype.LWf=function(V){try{if(this.$Qd(),fc.ULS.sendTraceTag(594888406,322,50,"SubmitFormWithBlob is preparing to send an upload request"),this.IAj(V)){this.LOb=V;this.es.contains(this.yq)&&this.es.removeChild(this.yq);var Pa=new (Type.parse("FormData"))(this.es);
Pa.append("applicationfileInput",V.blob,V.filename);this.xMf(Pa)}else this.c7a(null)}catch(Ib){fc.ULS.sendTraceTag(591267743,322,10,"SubmitFormWithBlob failed to send the request with exception "+Ib.message),this.c7a(null)}};qb.prototype.IAj=function(V){return V&&void 0!==V.blob&&null!==V.blob&&void 0!==V.filename&&null!==V.filename&&""!==V.filename?void 0===window.self.FormData||null===window.self.FormData?(fc.ULS.sendTraceTag(578380442,322,10,"FormData isn't supported"),!1):!0:(V=V?String.format("[isNull: false] [blobIsNullorEmpty: {0}] [filenameIsNullOrEmpty: {1}]",
void 0===V.blob||null===V.blob,void 0===V.filename||null===V.filename||""===V.filename):"[isNull: true] [blobIsNullorEmpty: false] [filenameIsNullOrEmpty: false]",fc.ULS.sendTraceTag(578380441,322,10,String.format("Content of the blob is empty {0}",V)),!1)};qb.prototype.jna=function(){if(4===this.Pg.readyState)if(200===this.Pg.status){fc.ULS.sendTraceTag(594888405,322,50,"UploadResponseReceived received a successful response. CorrelationId: {0}",this.YR);var V=this.Pg.getResponseHeader("X-NewKey"),
Pa=this.x_h(this.Pg),Ib=!1;if(void 0!==V&&null!==V&&Pa&&(Ib=this.yAj(V),!this.RMc&&Ib)){fc.ULS.sendTraceTag(594888404,322,50,"UploadResponseReceived resubmitting the upload request with a fresh canary. correlationId: {0}",this.YR);this.RMc=!0;void 0!==this.LOb&&null!==this.LOb?this.LWf(this.LOb):this.MWf();return}fc.ULS.sendTraceTag(594888403,322,50,"UploadResponseReceived processing the response [retried: {0}] [canaryInvalid: {1}] [gotNewCanary: {2}] [canaryRenewed: {3}] [CorrelationId: {4}]",this.RMc,
Pa,!(void 0===V||null===V),Ib,this.YR);this.c7a(this.Pg.responseText)}else fc.ULS.sendTraceTag(42874946,322,15,"Upload request failed with status: {0} [isResponseNull: {1}] [correlationId: {2}]",this.Pg.status,this.Pg.responseText?!1:!0,this.YR),this.c7a(null)};qb.prototype.x_h=function(V){try{var Pa=vd.a(V.responseText).Responses;if(void 0!==Pa&&null!==Pa&&1===Pa.length){var Ib=Pa[0];if(void 0!==Ib&&null!==Ib&&2===Ib.length&&28===Ib[1].StatusCode)return!0}}catch(wc){}return!1};qb.prototype.yAj=function(V){fh.a.Y1f(V);
return hb.AFrameworkApplication.canary!==V?!1:!0};qb.prototype.$Qd=function(){this.SMc||(this.SMc=new Date)};qb.prototype.dispose=function(){this.ym||(this.kpa?this._parent.removeChild(this.es):(this._parent.removeChild(this.Rn),Aa.a.removeHandler(this.Rn,"load",this.yfa),this.yfa=null),this.xCc&&(Aa.a.removeHandler(this.yq,"change",this.xCc),this.xCc=null),this.MJe&&(this.lfb&&(Aa.a.removeHandler(this.yq,"change",this.lfb),this.lfb=null),this.KOb=null),this.yq=this.es=this._parent=this.Rn=null,this.ym=
!0,this.SMc=null,fc.ULS.sendTraceTag(25798094,322,50,"UploadFrame disposed"))};qb.prototype.delayedDispose=function(){this.dispose()};qb.prototype.zUg=function(V){if(this.es){var Pa;(Pa=this.es.querySelector("input[name=__REQUESTDIGEST]"))?Pa.value=V:(Pa=this.lZc(),Pa.type="hidden",Pa.id="__REQUESTDIGEST",Pa.name="__REQUESTDIGEST",Pa.value=V,this.es.appendChild(Pa))}};qb.prototype.lZc=function(){return this.kpa?document.createElement("input"):this.Rn.contentWindow.document.createElement("input")};
qb.prototype.Pud=function(){try{if(!this.Rn.contentWindow.document.body)return}catch(wc){this.hPh();return}if(!(this._initialized||this.U5a&&ff.a.zE))this.F2c();else if(!this.U5a||!ff.a.zE||this.a3h){var V=ff.a.tf?this.Rn.contentWindow.document.body.innerText:this.c4f?this.Rn.contentWindow.document.body.firstChild.innerText:this.Rn.contentWindow.document.body.firstChild.innerHTML;var Pa=this.Rn.contentWindow.document.body.innerText.toLowerCase(),Ib=0<=Pa.indexOf("responses")||0<=Pa.indexOf("wopisrc");
Pa=0<=Pa.indexOf("http error");!Ib&&Pa&&fc.ULS.sendTraceTag(42551183,322,15,"Couldn't obtain a valid response but the frame contains: "+this.Rn.contentWindow.document.body.innerText);this.c7a(V)}};qb.prototype.F2c=function(){if(!this._initialized){var V=this.da("uploadForm"),Pa=this.da("fileInput"),Ib=this.jue();this.eUg();this.es.id=V;this.es.method="post";this.es.encoding="multipart/form-data";this.es.action=Ib;this.yq.type="file";this.PTd&&(this.yq.accept=this.PTd,this.QVd&&(this.yq.capture=this.QVd));
this.yq.id=Pa;this.yq.name=Pa;this.vwg&&(this.yq.multiple=!0);!this.MJe||ff.a.tf||ff.a.IJ||(this.lfb=Object(ld.a)(this,this.Wkh,"fileInputChangedHandleAccessibility"),Aa.a.addHandler(this.yq,"change",this.lfb),this.KOb=oe.a.Zhe(this.es,this.yq,"InputFileDescription"));this.NZd&&(this.kpa||(V=this.Rn.contentWindow.document.body,V.style.margin="0",V.style.overflow="hidden"),V=hb.AFrameworkApplication.za,this.yq.style.fontFamily=V.g0,this.yq.style.fontSize=V.fvc,this.yq.style.margin="0");(V=document.getElementById("__REQUESTDIGEST"))&&
this.zUg(V.value);this.es.appendChild(this.yq);this._initialized=!0;this.aeg(this)}};qb.prototype.eUg=function(){if(this.kpa)this.es=document.createElement("form"),this._parent.appendChild(this.es),this.yq=document.createElement("input");else{this.es=this.Rn.contentWindow.document.createElement("form");var V=this.Rn.contentWindow.document;V.body.appendChild(this.es);this.yq=V.createElement("input")}};qb.prototype.bie=function(){this._parent.appendChild(this.Rn);this.U5a&&ff.a.zE&&this.F2c()};qb.prototype.jue=
function(){var V=new Je.QueryStringBuilder(this.RJe);hb.AFrameworkApplication.Zjb(V);this.Q5i(V);V=V.toString();if(ff.a.Pf||ff.a.zE||ff.a.IJ)V=ef.a.Frb(V);return V};qb.prototype.ide=function(){var V=new bg.a(2,1,0,Object(ld.a)(this,this.delayedDispose,"delayedDispose"),4);hb.AFrameworkApplication.$j.sh(V)};Jl.Object.defineProperties(qb.prototype,{IIf:{configurable:!0,enumerable:!0,get:function(){return this.vig}},sessionId:{configurable:!0,enumerable:!0,get:function(){return this.SKc}},iFrame:{configurable:!0,
enumerable:!0,get:function(){return this.Rn}},rG:{configurable:!0,enumerable:!0,get:function(){return this.yq}},U5a:{configurable:!0,enumerable:!0,get:function(){return hb.AFrameworkApplication.ha?hb.AFrameworkApplication.ha.ta("NativeFileOpenDialogIsEnabled"):!1}},MJe:{configurable:!0,enumerable:!0,get:function(){return hb.AFrameworkApplication.ha?hb.AFrameworkApplication.ha.ta("FileInputDescriptionAccessibilityIsEnabled"):!1}},a3h:{configurable:!0,enumerable:!0,get:function(){return this.kpa?!1:
sf.a(this.Rn.contentWindow.location.pathname,this.RJe,0)}},vwg:{configurable:!0,enumerable:!0,get:function(){return!ff.a.sA&&hb.AFrameworkApplication.ha?hb.AFrameworkApplication.ha.getBooleanFeatureGate("Microsoft.Office.WordOnline.MultipleImageInsertFromLocalIsEnabled",!1)&&hb.AFrameworkApplication.ha.ta("AllowMultipleImageInsertFromLocalDevice"):!1}}});Object(ac.a)(qb,"UploadFrame",null,[7]);Cm(Ta,qb);Ta.prototype.da=function(V){return V};Ta.prototype.Q5i=function(V){fc.ULS.shipAssertTag(33863626,
0,!!this.sessionId,"SessionId shouldn't be null.");qa.a.KQc(V,this.$.Ba);V.I8(Pd.a.sessionId,this.sessionId);var Pa=vf.g(this.$).ga;Pa=df.o(Pa.ya.z3,this.$);V.I8(Pd.a.pKi,this.$.Aa.sa.name);V.I8(Pd.a.oKi,Pa.FirstRow.toString());V.I8(Pd.a.nKi,Pa.FirstColumn.toString())};Ta.prototype.hPh=function(){this.IIf("ServerUploadError")};Ta.prototype.c7a=function(V){this.IIf(V)};Ta.j1h=function(V){return Uf.a.na(V)||Uf.a.equals(V,"ServerUploadError",!1)};Object(ac.a)(Ta,"UploadFrameWrapper",qb,[]);Cm(db,Ia);
db.prototype.WPf=function(V,Pa){return new Ta(V,Object(ld.a)(Pa,Pa.JBb,"onUploadFrameInitialized"),Object(ld.a)(Pa,Pa.jna,"uploadResponseReceived"),this.ha,!0,this.$)};db.prototype.dispose=function(){this.vvc();this.Hu=this.ywc=null;Ia.prototype.dispose.call(this)};db.prototype.hide=function(){Ia.prototype.hide.call(this);this.$.Db.MJ=!1};db.prototype.validate=function(){var V=this.ywc.KRd(this.yj.rG.value,this.ywc.W_f(this.yj));return V?(V=this.ywc.f9c(V).Description,this.nQd(V),this.sMd(),!1):!0};
db.prototype.isEnabled=function(){return!0};db.prototype.nQd=function(V){this.$T.innerHTML=V};db.prototype.DU=function(){this.$T=document.getElementById("errorText");this.$T.style.display="inline-block";this.vza=!1;this.nQd("");this.GGa.style.maxWidth=this.GGa.currentStyle.minWidth};db.prototype.sMd=function(){this.Hu.qa(aa.a.click,this.yj.rG,Object(ld.a)(this,this.IQ,"onDialogInteraction"));this.Hu.qa(aa.a.Rb,this.yj.rG,Object(ld.a)(this,this.IQ,"onDialogInteraction"));this.vza=!0};db.prototype.vvc=
function(){this.vza&&(this.Hu.Ca(aa.a.click,this.yj.rG,Object(ld.a)(this,this.IQ,"onDialogInteraction")),this.Hu.Ca(aa.a.Rb,this.yj.rG,Object(ld.a)(this,this.IQ,"onDialogInteraction")),this.vza=!1)};db.prototype.IQ=function(){this.nQd("");this.vvc();return!1};Object(ac.a)(db,"InsertImageDialogWrapper",Ia,[]);ta.prototype.getSheetName=function(){return this.sheetName};Object(ac.a)(ta,"MacroRecorderPictureInsertedPayload",null,[115]);Cm(ua,Kb);ua.prototype.jna=function(V){this.uSd.stop();this.eXb.cancel();
if(Ta.j1h(V))this.zuc?this.uXe(4):(V=new vg.a(0,2,null,null,!1,null,null,null),V.status=8,this.UOd(new vh.a(V),null,"InsertPictureWebMethod")),fc.ULS.sendTraceTag(33863624,0,50,"Http Error occurred, isTimeoutError: {0}",this.zuc);else{var Pa=ua.KAj(V);Pa?(fc.ULS.sendTraceTag(34193863,0,50,"Server returned error, response: {0}",V),this.uXe(Pa)):this.UOh(V)}this.zjc();this.dispose()};ua.prototype.dispose=function(){Hg.a.Ia(this.eXb);this.yj&&this.yj.ide();this.yj=this.eXb=this.wb=null};ua.prototype.Bri=
function(V){this.mAa(V,this.yj)&&this.finalizeUpload(this.yj,null)};ua.prototype.JBb=function(V){fc.ULS.sendTraceTag(544815180,0,50,"Upload frame initialized");this.yj=V;if(!this.KZa){if(this.kRd){if(ua.Bne()||this.U5a&&ff.a.zE){V.K2b(Object(ld.a)(this,this.Bri,"onFileChosen$2"));return}var Pa=V.K2b(null);if(!this.mAa(Pa,V))return}this.finalizeUpload(V,null)}};ua.prototype.finalizeUpload=function(V,Pa){var Ib=this;Kb.prototype.finalizeUpload.call(this,V,Pa);Id.a(this.$.userOperationManager,function(wc,
nd){Ib.gr=wc;Ib.o$=nd;Ib.uSd.start();Ib.eXb.Zq();Ib.zuc=!1;Ib.o_f(V);return Ib.FNi(V)},function(wc){function nd(){return new ta(yd,Ib.pwd?Ib.pwd:"")}var Bd={};Ib.$.gk(Bd);var yd=Bd.SheetName;wc=qc.EwaSettings.wc()?new hf.a(510,0,wc,72,nd):new Rc.a(510,0,wc,8,nd);wc.APa(function(){return!0});wc.je=Ib.je;return wc},this.je)};ua.prototype.FNi=function(V){function Pa(){wc.hv(!0)}var Ib=this;if(!this.$)return fc.ULS.sendTraceTag(572269585,0,50,"ReadPictureAsDataURLTask: EwaControl is null"),Ud.Task.Ua(!0);
if(!this.$.vaa)return Ud.Task.Ua(!0);var wc=new mh.a,nd=new FileReader;V=V.rG.files[0];nd.onload=function(){Ib.pwd=nd.result;wc.hv(!0)};nd.onerror=Pa;nd.onabort=Pa;nd.readAsDataURL(V);return wc.task};ua.prototype.W_f=function(V){var Pa=-1;(V=V.rG)&&V.files&&0<V.files.length&&(Pa=V.files[0].size);return Pa};ua.prototype.KRd=function(V,Pa){var Ib=ua.UQg(Kb.mAa(V));Ib?6===Ib&&this.cei(V):-1!==Pa&&(fc.ULS.sendTraceTag(34193864,0,50,"Validating picture, pictureSize: {0}, maxAllowedSize: {1}, remainingWorkbookSize: {2}",
Pa,this.Xod,this.$.fa.U$e),Pa>this.Xod?Ib=3:Pa>this.$.fa.U$e&&(Ib=7));fc.ULS.sendTraceTag(34193865,0,50,"Validated file on client, validation result: {0}",Ib);return Ib};ua.prototype.mAa=function(V,Pa){return(V=this.KRd(V,this.W_f(Pa)))?(this.KZa||1===V||this.tTf(V),!1):!0};ua.prototype.o_f=function(V){V.mmj()};ua.prototype.f9c=function(V){var Pa=0,Ib=1,wc=-1100324317,nd="InsertPictureUnknownError",Bd=null;switch(V){case 1:Pa=1680;Ib=0;wc=940870981;nd="InsertPictureNoFileSelected";break;case 3:Ib=
0;wc=1250467391;nd="InsertPicturePictureTooBig";Bd=String.format(xf.a.instance.Eb(170),this.igi.toLocaleString());break;case 6:Pa=1684;Ib=0;wc=1380041209;nd="InsertPictureUnsupportedFormat";break;case 7:Pa=1681;Ib=0;wc=-903115058;nd="InsertPictureExceedWorkbookSize";break;case 4:Pa=1682;Ib=0;wc=1218352119;nd="InsertPictureUploadTimeout";break;case 5:Pa=1683,Ib=0,wc=1979899005,nd="InsertPictureServiceNonDeterministicError"}V=ua.Ad(Pa,Ib,wc,nd);Bd&&(V.Description=Bd);return V};ua.prototype.showDialog=
function(){ua.Bne()?(this.KZa=!1,this.yj=new Ta(this.$.domElement,Object(ld.a)(this,this.JBb,"onUploadFrameInitialized"),Object(ld.a)(this,this.jna,"uploadResponseReceived"),this.ha,!1,this.$,!0)):(fc.ULS.sendTraceTag(34193866,0,50,"Showing Insert Picture dialog"),!this.Rwb&&(ff.a.Iu||ff.a.zE&&72>ff.a.Mpe)?(this.KZa=!1,this.yj=new Ta(this.$.domElement,Object(ld.a)(this,this.JBb,"onUploadFrameInitialized"),Object(ld.a)(this,this.jna,"uploadResponseReceived"),this.ha,!1,this.$)):(this.KZa=!0,this.yj=
(new db(this,this.$,this.ha)).yj))};ua.prototype.UOh=function(V){var Pa={};try{if(Pa=Lf.a.gi(V),cf.b().AB(this.uSd.id,Pa.ServerCorrelationId,"actions","ServerActions"),!kd.a.eh(Pa.Errors)&&Pa.Result){this.$.fa.FW(Pa.StateId,"PictureUploaderWrapper.UploadResponseReceived");var Ib=Pa.Result;kh.a(this.$).Rla(1,Ib);var wc=this.$.ea.Ea(277,void 0);wc&&wc.wOc(this.$,1,Pa.Result,Pa,"InsertPicture");fc.ULS.sendTraceTag(34193867,0,50,"Insert picture completed successfully :)")}}catch(nd){fc.ULS.sendTraceTag(25801035,
0,50,"PictureUploaderWrapper.HandleSuccessCallback: got exception while try to JSON.Parse string length: {0}, errror: {1}",V?V.length:-1,nd)}this.Wuc(Pa,null,"InsertPictureWebMethod")};ua.prototype.uXe=function(V){V={Errors:[this.f9c(V)]};this.Wuc(V,null,"InsertPictureWebMethod")};ua.prototype.Wuc=function(V,Pa,Ib){this.gr(V,Pa,Ib)};ua.prototype.UOd=function(V,Pa,Ib){this.o$(V,Pa,Ib)};ua.prototype.tTf=function(V){V=this.f9c(V);qc.EwaSettings.rC()?new rc.a(this.$,V):(new tb.ErrorDialog(this.$,V)).Bf()};
ua.prototype.xAi=function(){this.zuc=!0};ua.prototype.cei=function(V){var Pa=this.$.Ba.InsertPicturUnsupportedExtensionsForLogging;V=Yg.a.un(V);for(var Ib=0;Ib<Pa.length;++Ib)if(V.endsWith(Pa[Ib])){fc.ULS.sendTraceTag(34193868,0,50,"Insert picture blocked invalid extension: {0}",Pa[Ib]);break}};ua.KAj=function(V){return Uf.a.na(V)||Uf.a.equals(V,Pd.a.insertPictureUnknownError,!0)?2:Uf.a.equals(V,Pd.a.insertPictureNoFileSelectedError,!0)?1:Uf.a.equals(V,Pd.a.rXh,!0)?3:Uf.a.equals(V,Pd.a.sXh,!0)?5:
0};ua.Ad=function(V,Pa,Ib,wc){return kd.a.Ad(1,0,0,V,Pa,Ib,wc)};ua.UQg=function(V){switch(V){case 1:return 1;case 2:return 6}return 0};ua.Bne=function(){return qc.EwaSettings.isChangeGateEnabled("OfficeVSO:5329840_InsertPictureOpenFileBrowserDirectly")&&void 0!==window.self.FormData&&null!==window.self.FormData?!0:!1};Jl.Object.defineProperties(ua.prototype,{$:{configurable:!0,enumerable:!0,get:function(){return this.wb}},igi:{configurable:!0,enumerable:!0,get:function(){return this.Xod/1024/1024}}});
Object(ac.a)(ua,"PictureUploaderWrapper",Kb,[7]);Cm(Ra,ua);Ra.prototype.UOd=function(V,Pa,Ib){ua.prototype.UOd.call(this,V,Pa,Ib);this.$_.setException(Error.create("DataUrlUploaderWrapper.TriggerFailedCallback: File upload request failed"))};Ra.prototype.Wuc=function(V,Pa,Ib){ua.prototype.Wuc.call(this,V,Pa,Ib);kd.a.eh(V.Errors)?this.$_.setException(Error.create(String.format("DataUrlUploaderWrapper.TriggerSuccessCallback: File upload request returned with errors: {0}",kd.a.fd(V.Errors)))):this.$_.setResult(!0)};
Ra.prototype.o_f=function(V){var Pa=new E(this.aac.name,this.aac);V.LWf(Pa)};Ra.Rqh=function(V){var Pa=V.split(",");V=0<=Pa[0].indexOf("base64")?window.self.atob(Pa[1]):window.self.decodeURI(Pa[1]);Pa=Pa[0].split(":")[1].split(";")[0];for(var Ib=new Uint8Array(V.length),wc=0;wc<V.length;wc++)Ib[wc]=V.charCodeAt(wc);V=new Blob([Ib],{type:Pa});V.name="Image.png";return V};Object(ac.a)(Ra,"DataUrlUploaderWrapper",ua,[]);var jh=b(576),oh=b(303),Ph=b(177),Zg=b(169),ig=b(91),Sh=b(1232),Ch=Sh.a;Cm(ca,Ch);
ca.prototype.nmc=function(V,Pa){this.isEnabled()&&this.XDa(this.targetOrigin)&&(this.vn(V),this.km(V,Pa))};Object(ac.a)(ca,"InsertMediaCrossDocumentMessenger",Sh.a,[545,391,7]);Object(ac.a)(Ha,"OnlineMediaSearchResult",null,[]);var mf=b(305),Sd=Ag.a;Cm(Gb,Sd);Gb.prototype.ogj=function(V){var Pa=this;this.ccc=!1;this.showDialog(this.$n,null);this.Qua=document.getElementById(this.hi("InsertMediaFrame"));if(!this.Qua)throw this.ata(this.$lb),Error.invalidOperation("Couldn't get InsertMediaIframe.");
var Ib=document.getElementById(this.hi("WACDialogPanel"));Ib&&Ib.setAttribute(oe.a.Wd,oe.a.RWa);Ib=document.createElement("div");Ib.id="KeepFocusStartDiv";Ib.tabIndex=0;Ib.className="keep-focus-start";this.Qua.parentNode.insertBefore(Ib,this.Qua.parentNode.firstChild);Ib=document.createElement("div");Ib.id="KeepFocusDiv";Ib.tabIndex=0;Ib.className="keep-focus";this.Qua.parentNode.appendChild(Ib);$addHandler(this.GGa,"keydown",Object(ld.a)(this,this.wld,"keyDownHandler"));this.Qua.src=this.S1e;this.Qua.frameBorder=
"0";Ib=document.getElementById(this.hi("WACDialogButtonPanel"));if(!Ib)throw Error.invalidOperation("Couldn't get WACDialogButtonPanel.");Ib.className="display-none";Ib=document.getElementById(this.hi("WACDialogTitleText"));if(!Ib)throw Error.invalidOperation("Couldn't get WACDialogTitleText.");Ib.className="display-none";2===this.yff&&(document.getElementById(this.hi("WACDialogTitlePanel")).className="display-none",document.getElementById(this.hi("WACDialogBodyPanel")).className="padding-zero");
tf.FocusManager.instance().PP().scope.pQ=!0;this.WQ=new ca(this.Qua.contentWindow,this.S1e);this.WQ.nmc(Ph.a.Vog,function(wc){Pa.Hni(wc,Object(ld.a)(V,V.jna,"uploadResponseReceived"))});this.WQ.nmc(Ph.a.insert,function(){Pa.Aui(Object(ld.a)(V,V.jna,"uploadResponseReceived"))});this.WQ.nmc(Ph.a.dUc,Object(ld.a)(this,this.Goi,"onCancelDialog"));2!==this.yff||this.s2g||(this.WQ.nmc(Ph.a.m$h,Object(ld.a)(this,this.hvi,"onLaunchM365Upsell")),this.Zxb=this.blb.$Na("MsoPremiumStockImages",function(wc){fc.ULS.sendTraceTag(556328527,
0,50,"OnCompleteM365Upsell: Upsell completed from stock images");if(wc.isEnabled){var nd={};Pa.WQ.Yj(Ph.a.qzj,(nd.LicenseTier=wc.toString(),nd))}else fc.ULS.sendTraceTag(556328526,0,10,"OnCompleteM365Upsell: Upsell completed but license tier didn't upgrade.")}))};Gb.prototype.dispose=function(){this.Iya=null;this.blb&&this.Zxb&&this.blb.lBd("MsoPremiumStockImages",this.Zxb);this.WQ&&(this.WQ.dispose(),this.WQ=null);Sd.prototype.dispose.call(this)};Gb.prototype.hide=function(){Sd.prototype.hide.call(this);
ig.a.Aqc(this.$)};Gb.prototype.Hni=function(V,Pa){V=V&&V.Values?(V=V.Values)?Object.assign(new Ha,{Action:V.action||"",Caption:V.caption||"",ContentType:V.contentType||"",FileExtension:V.extension||"",PageUrl:V.pageUrl||"",SourceUrl:V.sourceUrl||"",ThumbnailUrl:V.thumbnailUrl||"",LicenseUrl:V.licenseUrl||"",LicenseDisplayName:V.licenseDisplayName||"",Height:V.height||0,Width:V.width||0}):null:null;V&&(Array.add(this.Iya,V),this.ccc&&(fc.ULS.sendTraceTag(556864803,0,50,"InsertMediaDialog.OnAddItem: Insert Message handling was pending"),
Pa(this.Iya),this.ccc=!1,this.ata(this.$lb)))};Gb.prototype.Goi=function(){this.ata(this.$lb)};Gb.prototype.Aui=function(V){this.Iya&&0<this.Iya.length?this.Iya.length<=this.che?(V(this.Iya),this.ata(this.$lb)):(this.kz(),fc.ULS.sendTraceTag(557160267,0,10,"OnInsert : Tried to insert more than allowed limit of items."),Array.clear(this.Iya)):this.ccc=!0};Gb.prototype.wld=function(V){V.keyCode===Sys.UI.Key.tab&&("KeepFocusDiv"!==V.target.id||V.shiftKey?"KeepFocusStartDiv"===V.target.id&&V.shiftKey&&
(V.preventDefault(),document.getElementById("KeepFocusDiv").focus()):(V.preventDefault(),document.getElementById("KeepFocusStartDiv").focus()))};Gb.prototype.NUg=function(){var V=document.createElement("div");V.id="InsertMediaDialog";V.className=qc.EwaSettings.getBooleanFeatureGate("Microsoft.Office.ExcelOnline.InsertMediaDialog.ZoomFixHorizonalScroll",!0)?"insert-media-dialog":"insert-media-dialog-old";var Pa=document.createElement("div");Pa.id="InsertMediaPanel";Pa.className=qc.EwaSettings.getBooleanFeatureGate("Microsoft.Office.ExcelOnline.InsertMediaDialog.ZoomFixCancelButton",
!0)?"insert-media-panel":"insert-media-panel-old";var Ib=document.createElement("iframe");Ib.id="InsertMediaFrame";Ib.className="insert-media-frame";V.appendChild(Pa);Pa.appendChild(Ib);return mf.b(V)};Gb.prototype.hvi=function(){this.blb&&(this.blb.launchUpsellExperience("stockimages"),fc.ULS.sendTraceTag(556328525,0,50,"OnLaunchM365Upsell: Launched Dime Upsell flow"))};Gb.prototype.kz=function(){var V=kd.a.Ad(1,0,0,0,0,466721363,"InsertPictureExceededAllowedCount");V.Description=String.format(xf.a.instance.Eb(195),
this.che.toLocaleString());qc.EwaSettings.rC()?new rc.a(this.$,V):(new tb.ErrorDialog(this.$,V)).Bf()};Jl.Object.defineProperties(Gb.prototype,{B3:{configurable:!0,enumerable:!0,get:function(){return Zg.a.c2b+"/InsertMediaDialog"}},canBePreempted:{configurable:!0,enumerable:!0,get:function(){return!1}}});Object(ac.a)(Gb,"InsertMediaDialog",Ag.a,[]);var Gf=b(458),Wf=b(373);Cm(nb,Kb);nb.prototype.jna=function(V){var Pa=this;if(V){for(var Ib=Array(V.length),wc=0;wc<V.length;wc++){var nd=V[wc];Ib[wc]=
{};Ib[wc].SourceUrl=nd.SourceUrl;Yg.a.mva(nd.LicenseUrl)&&Yg.a.mva(nd.PageUrl)&&(Ib[wc].LicenseUrl=nd.LicenseUrl,Ib[wc].LicenseDisplayName=nd.LicenseDisplayName,Ib[wc].PageUrl=nd.PageUrl);Ib[wc].AltText=-2053056795===this.je.command?nd.Caption:""}var Bd=-2009825598===this.je.command?"bing":"M365";wc=vf.g(this.$);var yd=df.o(wc.ga.ya.activeCell,this.$);Id.a(this.$.userOperationManager,function(re,xe,Re){return bf.L(Pa.$.ra.xa,yd,Ib,Bd,Ne.b(re,Object(ld.a)(Pa,Pa.Zwi,"onPictureUploadSuccess")),Ne.a(xe,
Object(ld.a)(Pa,Pa.Ywi,"onPictureUploadFailed")),Re,null)},function(re){return new hf.a(595,0,re)},this.je);qe.HelperMethods.qZ?(wc=new Map,wc.set("MediaProvider",Bd),wc.set("ImagesCount",V.length.toString()),wc.set("TimeTakenToOpenDialog",this.odf.toString()),Yb.Health.instance.recordKpiUsage(Wf.a.oXh,1,Gf.a.fuc,wc)):fc.ULS.sendTraceTag(555033361,0,15,"OnlinePictureUploaderWrapper.UploadResponseReceived: KPI Usage not supported.");this.zjc()}else fc.ULS.sendTraceTag(556864836,0,10,"OnlinePictureUploaderWrapper.UploadResponseReceived: Response is null")};
nb.prototype.dispose=function(){this.$=null};nb.prototype.showDialog=function(){var V=this,Pa=null;Pa=this.$.Zb.Ic("UserAction","showOnlineImagesDialogTimeStopwatch");switch(this.je.command){case -2009825598:this.zfj();break;case -2053056795:this.Ihe.execute(function(Ib){Ib.isFeatureEnabled("MsoPremiumStockImages",!1).catch(function(wc){return fc.ULS.sendTraceTag(557200643,0,10,"OnlinePictureUploaderWrapper::ShowDialog - Failed to load the premium state from application feature helper: {0}",wc)}).then(function(wc){V.Afj(wc);
return null})})}Pa.stop();this.odf=Pa.Gc};nb.prototype.zfj=function(){var V=this.$.Ba.BingPictureEndpoint,Pa=jh.a.pJ(hb.AFrameworkApplication.lcid),Ib=Pe.a.create();Uf.a.na(V)?(fc.ULS.sendTraceTag(557200642,0,10,"OnlinePictureUploaderWrapper::ShowDialogForBingPictures - Can't access the Bing service endpoint"),this.$_.setException(Error.create("Failed to access the Bing service endpoint"))):(V=0<V.search(RegExp("insertmedia.bing.office.net","gi"))?String.format(V,1,1):String.format(V,1,hb.AFrameworkApplication.lcid,
Pa?Pa.name:"en-us",hb.AFrameworkApplication.buildVersion,Ib.toString(),1,this.$.Ba.DocumentHostInfo.LoggableUserId),this.e0b(V,1,-1,xf.a.instance.da(1686)))};nb.prototype.Afj=function(V){var Pa=this.$.Ba.M365PictureEndpoint,Ib=Pe.a.create();if(Uf.a.na(Pa))fc.ULS.sendTraceTag(557200641,0,10,"OnlinePictureUploaderWrapper::ShowDialogForStockImages - Can't access the M365 service endpoint"),this.$_.setException(Error.create("Failed to access the M365 service endpoint"));else{var wc=this.$.Ba.DocumentHostInfo.UserId;
wc=Uf.a.na(wc)?"0":Yg.a.Dv(wc).toString();var nd=this.Ihe.instance.isFreemiumUpsellEnabled();V=V?1:nd?0:-1;Ib=Ib.toString();nd=jh.a.pJ(hb.AFrameworkApplication.lcid).name;Pa=String.format(Pa,hb.AFrameworkApplication.lcid,nd,hb.AFrameworkApplication.buildVersion,Ib,1,wc,V,1);this.e0b(Pa,2,V,xf.a.instance.da(1685))}};nb.prototype.e0b=function(V,Pa,Ib,wc){try{(new Gb(this.$,V,lf.a.instance.Uh("Common.App.ApplicationFeatureHelper.IApplicationFeatureHelper"),Pa,Ib,wc)).ogj(this),this.$_.setResult(!0)}catch(nd){fc.ULS.sendTraceTag(557200640,
0,10,"OnlinePictureUploaderWrapper::CreateAndShowDialog failed [Exception : {0}] [MediaProvider : {1}] [DialogLicenseTier : {2}]",nd,Pa,Ib),this.$_.setException(nd)}};nb.prototype.Zwi=function(V){oh.a(V)?fc.ULS.sendTraceTag(556864833,0,10,"OnlinePictureUploaderWrapper.OnPictureUploadSuccess: Operation succeeded with errors. Errors: {0}",kd.a.fd(V.Errors)):(fc.ULS.sendTraceTag(556864835,0,50,"OnlinePictureUploaderWrapper.OnPictureUploadSuccess: Operation succeeded."),V.Result?kh.a(this.$).Rla(1,V.Result):
fc.ULS.sendTraceTag(556864834,0,10,"OnlinePictureUploaderWrapper.OnPictureUploadSuccess:Result.result is null"))};nb.prototype.Ywi=function(){fc.ULS.sendTraceTag(556864832,0,10,"OnlinePictureUploaderWrapper.OnPictureUploadFailed: Operation failed")};Object(ac.a)(nb,"OnlinePictureUploaderWrapper",Kb,[7]);sb.prototype.executeCommand=function(V,Pa,Ib){V=Pa.command;switch(V){case 1403967063:if(Ib&&"dataUrl"in Ib)return Pa=new mh.a,new Ra(this.$,null,Be.a.instance,hb.AFrameworkApplication.ha,Ib,Ib.dataUrl,
Pa),Pa.task;new ua(this.$,Pa,Be.a.instance,hb.AFrameworkApplication.ha,Ib);return Ud.Task.Ua(!0);case -2053056795:case -2009825598:return V=new mh.a,new nb(this.$,Pa,Be.a.instance,hb.AFrameworkApplication.ha,Ib,V),V.task;default:return We.a(V)}};sb.prototype.Jc=function(V,Pa){if(V=this.$.isEditMode)switch(Pa.command){case 1403967063:V=!0;break;case -2053056795:V=qc.EwaSettings.isChangeGateEnabled("OfficeVSO:5744839_InsertOnlinePictures");break;case -2009825598:V=(V=qc.EwaSettings.isChangeGateEnabled("OfficeVSO:5744839_InsertOnlinePictures"))&&
qc.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.InsertBingPictures",!1);break;default:V=!1}return V};sb.prototype.gd=function(){return!1};sb.prototype.$c=function(){return!1};Object(ac.a)(sb,"PictureCommandHandler",null,[159]);var f=we.a;Cm(ib,f);ib.prototype.Rd=function(){this.Hd([new sb(this.$)])};ib.la=function(V){we.a.ie(90,new ib(V))};Object(ac.a)(ib,"PictureCommandHandlerFactory",we.a,[]);var rb=b(514),oc=b(404),cd=b(74),$d=b(556),ze=b(598),He=$d.a;Cm(Oa,He);Oa.prototype.iId=function(V){this.Ioa!==
V&&(this.Ioa=V,this.qDb())};Oa.prototype.dispose=function(){this.gridView.Hc.mm(Object(ld.a)(this,this.ykf,"onCellTextEditStarted"));this.gridView.Hc.Qs(Object(ld.a)(this,this.xkf,"onCellTextEditEnded"));this.gridView=null;He.prototype.dispose.call(this)};Oa.prototype.qDb=function(){this.Zyd(this.Ioa)};Oa.prototype.xkf=function(){this.refresh()};Oa.prototype.ykf=function(){this.refresh()};Oa.prototype.refresh=function(){this.iId(!this.gridView.isEditing)};Jl.Object.defineProperties(Oa.prototype,{wA:{configurable:!0,
enumerable:!0,get:function(){return this.Ioa}},name:{configurable:!0,enumerable:!0,get:function(){return ze.a.cellEdit}}});Object(ac.a)(Oa,"CellEditSafeStatePublisher",$d.a,[]);Object(ac.a)(xa,"SafeStatePublisherState",null,[]);var Ie=b(646),Me=Md.a;Cm(na,Me);na.prototype.FVb=function(V){this.addHandler(na.LOa,V)};na.prototype.pnc=function(V){this.removeHandler(na.LOa,V)};na.prototype.bya=function(V,Pa){function Ib(Bd,yd){nd.wA=yd.wA;wc.bzd()}var wc=this,nd=new xa(V,Pa);this.MOa.add(nd);V.FVb(Ib);
nd.handler=Ib;this.bzd()};na.prototype.SPd=function(V){for(var Pa=null,Ib=Ml(this.MOa),wc=Ib.next();!wc.done;wc=Ib.next())if(wc=wc.value,wc.publisher===V){this.A1f(wc);Pa=wc;break}Pa&&(this.MOa.remove(Pa),this.bzd())};na.prototype.dispose=function(){for(var V=Ml(this.MOa),Pa=V.next();!Pa.done;Pa=V.next())this.A1f(Pa.value);this.MOa.clear();Me.prototype.dispose.call(this)};na.prototype.YTe=function(){for(var V=!0,Pa=Ml(this.MOa),Ib=Pa.next();!Ib.done&&(Ib=Ib.value,V=V&&Ib.wA,V);Ib=Pa.next());return V};
na.prototype.A1f=function(V){V.publisher.pnc(V.handler)};na.prototype.bzd=function(){var V=this.YTe();V!==this.Y$e&&(this.raiseEvent(na.LOa,new Ie.a(V)),this.Y$e=V)};Jl.Object.defineProperties(na.prototype,{Yuj:{configurable:!0,enumerable:!0,get:function(){return Wd.f(Wd.c(this.MOa.toArray(),function(V){return!V.wA}),function(V){return V.publisher.name})}}});na.LOa="SSC";Object(ac.a)(na,"ClientStateMonitor",Md.a,[]);var rg=b(6),pf=b(64),$g=$d.a;Cm(ma,$g);ma.prototype.iId=function(V){V!==this.Ioa&&
(this.Ioa=V,this.qDb())};ma.prototype.dispose=function(){pf.a(this.$).$mc(Object(ld.a)(this,this.Blf,"onCurrentActivityChanged"));this.D2a.Kp(Object(ld.a)(this,this.NM,"onIdleActivityStatusChanged"));this.L_d=null;$g.prototype.dispose.call(this)};ma.prototype.qDb=function(){this.Zyd(this.wA)};ma.prototype.refresh=function(){this.iId(1===this.D2a.At||pf.a(this.$).pi===this.D2a)};ma.prototype.NM=function(){this.refresh()};ma.prototype.Blf=function(){this.refresh()};Jl.Object.defineProperties(ma.prototype,
{wA:{configurable:!0,enumerable:!0,get:function(){return this.Ioa}},name:{configurable:!0,enumerable:!0,get:function(){return ze.a.D2a}},D2a:{configurable:!0,enumerable:!0,get:function(){return this.L_d}}});Object(ac.a)(ma,"IdleActivitySafeStatePublisher",$d.a,[]);var Df=b(307),Vf=b(3),og=cd.a;Cm(Sa,og);Sa.prototype.$c=function(){return!1};Sa.prototype.executeCommand=function(){return Ud.Task.Ua(!0)};Sa.prototype.Jc=function(V,Pa){return 1905775613===Pa.command};Sa.prototype.gd=function(){return!1};
Object(ac.a)(Sa,"ToggleMergeSuspensionSafeState",cd.a,[159]);var h=Md.a;Cm(oa,h);oa.prototype.np=function(V){this.addHandler(oa.Apd,V)};oa.prototype.Kp=function(V){this.removeHandler(oa.Apd,V)};oa.prototype.fw=function(){this.raiseEvent(oa.Apd)};oa.prototype.Km=function(V){return V===oa.uKi&&!!this.mergeSuspensionManager};oa.prototype.Mq=function(V,Pa){if(!this.Km(V))return!1;this.mergeSuspensionManager&&(Pa.LabelText=this.Wgc,Pa.On=this.Wqd);return!0};oa.prototype.dispose=function(){this.EJb&&(this.Na.T8a(this.EJb),
this.EJb.dispose(),this.EJb=null);this.mergeSuspensionManager&&(this.mergeSuspensionManager.A7a.CEb(Object(ld.a)(this,this.WAb,"onMergeCounterUpdated")),this.mergeSuspensionManager.Jga.pnc(Object(ld.a)(this,this.MMa,"onSafeStateChanged")),this.mergeSuspensionManager=null);this.statusBarManager&&(this.statusBarManager.UC(this),this.statusBarManager=null);this.Wgc=null;h.prototype.dispose.call(this)};oa.prototype.WAb=function(V,Pa){V=String.format("{0}{1}",Pa.Y4.Current===Pa.Y4.Pending?"\u26ad":"\u26ae",
Pa.Y4.Current);Uf.a.equals(this.Wgc,V,!1)||(this.Wgc=V,this.fw())};oa.prototype.MMa=function(V,Pa){V=Pa.wA;this.Wqd!==V&&(this.Wqd=V,this.fw())};oa.Apd="MSMSC";oa.uKi="QueryMergeSuspensionStatus";Object(ac.a)(oa,"MergeSuspensionIndicatorManager",Md.a,[155,156,7]);var e=b(1010),I=Sys.EventArgs;Cm(ba,I);Object(ac.a)(ba,"TogglePendingMergeBlockedByClientEventArgs",Sys.EventArgs,[]);var Z=b(1011),Ca=Md.a;Cm(R,Ca);R.prototype.tUh=function(){return Object(oc.a)(na,this.Jga)?Object(Od.a)(na,this.Jga).YTe():
!1};R.prototype.IVb=function(V){this.addHandler(R.mOd,V)};R.prototype.qnc=function(V){this.removeHandler(R.mOd,V)};R.prototype.Xtg=function(V){this.addHandler(R.Vlc,V)};R.prototype.bVi=function(V){this.removeHandler(R.Vlc,V)};R.prototype.ftg=function(V){this.addHandler(R.lgc,V)};R.prototype.wUi=function(V){this.removeHandler(R.lgc,V)};R.prototype.ZLi=function(){this.Xyd(1===this.getState())};R.prototype.dispose=function(){this.Jga.pnc(Object(ld.a)(this,this.MMa,"onSafeStateChanged"));this.Jga=null;
this.A7a.CEb(Object(ld.a)(this,this.WAb,"onMergeCounterUpdated"));this.A7a=null;Ca.prototype.dispose.call(this)};R.prototype.o8b=function(){return Object.assign(new e.a,{Current:this.AQ.Current,Pending:this.AQ.Pending,SuspensionStartTimestamp:this.AQ.SuspensionStartTimestamp})};R.prototype.getState=function(){return this.AQ.Pending===this.AQ.Current?0:this.wA?2:1};R.prototype.ZCf=function(V,Pa){var Ib=this.getState();this.wA=Pa;this.AQ.Pending===V.Pending&&this.AQ.Current===V.Current||this.raiseEvent(R.lgc);
this.AQ=V;V=this.getState();this.X5c(Ib,V)};R.prototype.X5c=function(V,Pa){V!==Pa&&(1===Pa?this.Xyd(!0):1===V&&this.Xyd(!1));2===Pa?this.raiseEvent(R.Vlc,new Z.a(this.AQ)):this.Z7g&&this.raiseEvent(R.Vlc,new Z.a(null))};R.prototype.jdi=function(V,Pa,Ib){qc.EwaSettings.isChangeGateEnabled("OfficeVSO:5782074_LogPendingMergesStatusChanged")&&(!V&&Pa?(V=1===Pa,fc.ULS.sendTraceTag(252760283,0,50,"MergeSuspensionState.LogPendingMergesStatusChanged: Pending changes exist. IsBlocking: {0} publisher: {1} counter: {2}",
V,V?this.Jga.Yuj.join(","):"",ha(this.AQ))):V&&!Pa&&fc.ULS.sendTraceTag(252760284,0,50,"MergeSuspensionState.LogPendingMergesStatusChanged: No pending changes. counter: {0}",ha(Ib)))};R.prototype.Xyd=function(V){this.raiseEvent(R.mOd,new ba(V))};R.prototype.WAb=function(V,Pa){if(this.$Cf){V=this.getState();var Ib=this.AQ;this.AQ=Pa.Y4;Pa=this.getState();this.jdi(V,Pa,Ib);this.raiseEvent(R.lgc);this.X5c(V,Pa)}else this.ZCf(Pa.Y4,this.wA)};R.prototype.MMa=function(V,Pa){this.$Cf?(V=this.getState(),
this.wA=Pa.wA,Pa=this.getState(),this.X5c(V,Pa)):this.ZCf(this.AQ,Pa.wA)};R.mOd="TPMBBC";R.Vlc="RFPMU";R.lgc="MCC";Object(ac.a)(R,"MergeSuspensionState",Md.a,[]);var Na=Md.a;Cm(ja,Na);ja.prototype.ykb=function(V){this.addHandler("MCU",V)};ja.prototype.CEb=function(V){this.removeHandler("MCU",V)};ja.prototype.JMa=function(V,Pa){Pa=void 0===Pa?"":Pa;var Ib=this.Z0.Current<V.Current||this.Z0.Pending<V.Pending;if(V.SuspensionStartTimestamp&&this.oec!==V.SuspensionStartTimestamp){if(this.oec>V.SuspensionStartTimestamp){Ib&&
fc.ULS.sendTraceTag(553736149,0,50,"PendingMergeMonitor.OnMergeCounterReceivedFromServer: skipping a higher stale counter received via {0}. S: {1}, C: {2}",Pa,ja.Zyb(V),ja.Zyb(this.Z0));return}Ib||fc.ULS.sendTraceTag(553736148,0,50,"PendingMergeMonitor.OnMergeCounterReceivedFromServer: recovering from a potentially stale counter. S: {0}, C: {1}",ja.Zyb(V),ja.Zyb(this.Z0))}else if(!Ib)return;qc.EwaSettings.isChangeGateEnabled("OfficeVSO:5745240_MergeSuspensionStartUnixTimeInMs")&&this.Xci(V,Pa);this.Z0=
V;this.AAf(V)};ja.prototype.dispose=function(){this.$.fa.xk(Object(ld.a)(this,this.Zpc,"sessionReloadEventHandler"));this.$.fa.WV(Object(ld.a)(this,this.Zpc,"sessionReloadEventHandler"));this.$.ra.Tt(Object(ld.a)(this,this.xAa,"webMethodSuccessEventHandler"));vf.g(this.$).Hc.Qs(Object(ld.a)(this,this.Twa,"onEditCellEnded"));var V=this.$.ea.Ea(292,void 0);V&&V.CEb(Object(ld.a)(this,this.$yb,"mergeCounterUpdatedEventHandler"));Na.prototype.dispose.call(this)};ja.prototype.AAf=function(V){V.Pending>
V.Current&&V.SuspensionStartTimestamp&&V.SuspensionStartTimestamp>this.oec&&(fc.ULS.sendTraceTag(554767494,0,50,"PendingMergeMonitor.RaiseMergeCounterUpdated: Merge suspension requested. MergeCounter: {0}",ha(V)),this.oec=V.SuspensionStartTimestamp);this.raiseEvent("MCU",new Z.a(V))};ja.prototype.Xci=function(V,Pa){V.SuspensionStartTimestampMs&&V.SuspensionStartTimestamp&&1<Math.abs(V.SuspensionStartTimestampMs/1E3-V.SuspensionStartTimestamp)&&fc.ULS.sendTraceTag(537985179,0,15,"PendingMergeMonitor.LogMergeCountUnixTimeMsInconsistency: Inconsistent merge counter in seconds {0} and ms {1} origin {2}",
V.SuspensionStartTimestamp,V.SuspensionStartTimestampMs,Pa)};ja.prototype.xAa=function(V,Pa){Pa&&Pa.od&&Pa.od.MergeCount&&(Uf.a.equals(Pa.od.SessionId,this.$.fa.sessionId,!1)?this.JMa(Pa.od.MergeCount,ja.I1c):fc.ULS.sendTraceTag(579737049,0,50,"Stale merge counter ({0}/{1})",Pa.od.MergeCount.Current,Pa.od.MergeCount.Pending))};ja.prototype.$yb=function(V,Pa){Pa&&Pa.Y4&&this.JMa(Pa.Y4,ja.vSd)};ja.prototype.Zpc=function(){this.lIf();this.AAf(this.Z0)};ja.prototype.lIf=function(){fc.ULS.sendTraceTag(588276808,
0,50,"PendingMergeMonitor.ResetMergeCounter : Last counter was {0}",ja.Zyb(this.Z0));this.Z0=Object.assign(new e.a,{Pending:0,Current:0,SuspensionStartTimestamp:null})};ja.prototype.Twa=function(V,Pa){Pa.ise&&this.Z0.SuspensionStartTimestamp&&fc.ULS.sendTraceTag(17318084,0,50,"PendingMergeMonitor.OnEditCellEnded: committed with counter {0}",ha(this.Z0))};ja.Zyb=function(V){return V?String.format("({0}/{1} @{2})",V.Current,V.Pending,V.SuspensionStartTimestamp):"null"};Jl.Object.defineProperties(ja.prototype,
{AQ:{configurable:!0,enumerable:!0,get:function(){return this.Z0}}});ja.vSd="PMM.RTC";ja.I1c="PMM.EwaResult";Object(ac.a)(ja,"PendingMergeMonitor",Md.a,[]);Object(ac.a)(X,"ClientRevisions",null,[]);var Vb=b(192),vc=b(26);L.prototype.YEi=function(V){var Pa=this;this.WPa(V)?(new mh.a).setResult(!0):(V=this.ZEi(V),this.Xua=!0,V.CWCT(function(){Pa.Rqi()},Vb.a.none,0,this.HN))};L.prototype.ZEi=function(V){var Pa=this.xa.dc();this.Ss();this.XKb=this.Vg.Lb;this.Exb=V;fc.ULS.sendTraceTag(554767493,0,50,"DoPendingMergeThrottlingStrategy.PerformAction: Sending DoPendingMerge {0} / {1} @{2}",
V.Current,V.Pending,V.SuspensionStartTimestamp);return ea(this.xa,null,function(){fc.ULS.sendTraceTag(588276806,0,10,"DoPendingMergeThrottlingStrategy.PerformAction: request failed {0} / {1} @{2}",V.Current,V.Pending,V.SuspensionStartTimestamp)},null,null,Pa)};L.prototype.WPa=function(V){return this.Xua?!0:this.YQc(V,this.Exb)&&+this.Vg.Lb-+this.XKb<this.$Eb};L.prototype.Rqi=function(){this.Xua=!1};L.prototype.YQc=function(V,Pa){return V||Pa?V&&Pa?V.Current===Pa.Current&&V.Pending===Pa.Pending&&V.SuspensionStartTimestamp===
Pa.SuspensionStartTimestamp:!1:!0};Object(ac.a)(L,"DoPendingMergeThrottler",null,[541]);Y.prototype.Qkb=function(V){return V};Object(ac.a)(Y,"ReturnNewestAggregatorStrategy",null,[560]);Cm(fa,Y);fa.prototype.Grb=function(V){return V};fa.prototype.xCb=function(V){if(!V||this.WPa(V)){var Pa=new mh.a;Pa.setResult(!0);return Pa.task}Pa=this.xa.dc();this.Ss();this.XKb=this.Vg.Lb;this.Exb=V;fc.ULS.sendTraceTag(554767493,0,50,"DoPendingMergeThrottlingStrategy.PerformAction: Sending DoPendingMerge {0}",ha(V));
this.ZOa&&this.ZOa.qBi();return ea(this.xa,null,function(){fc.ULS.sendTraceTag(588276806,0,10,"DoPendingMergeThrottlingStrategy.PerformAction: request failed {0}",ha(V))},null,null,Pa)};fa.prototype.WPa=function(V){return this.YQc(V,this.Exb)&&+this.Vg.Lb-+this.XKb<this.$Eb};fa.prototype.YQc=function(V,Pa){return V||Pa?V&&Pa?V.Current===Pa.Current&&V.Pending===Pa.Pending&&V.SuspensionStartTimestamp===Pa.SuspensionStartTimestamp:!1:!0};Object(ac.a)(fa,"DoPendingMergeThrottlingStrategy",Y,[540]);T.prototype.Jnd=
function(){fc.ULS.sendTraceTag(824467,0,50,"AggregateSelectionAdjustStats.LogResults: Didn't change {0} Adjusted {1} Divergence {2} NonContinuous {3} Erros {4}",this.oQc,this.nQc,this.h1c,this.erd,this.errors)};Object(ac.a)(T,"AggregateSelectionAdjustStats",null,[]);N.prototype.toString=function(){return String.format("active cell: {0} selection: {1}",this.activeCell.toString(),Wd.f(this.selectedRanges,function(V){return V.toString()}).join(","))};N.prototype.equals=function(V){return V?this.activeCell.equals(V.activeCell)&&
df.Q(this.selectedRanges,V.selectedRanges)&&this.sheetName===V.sheetName:!1};Jl.Object.defineProperties(N.prototype,{activeCell:{configurable:!0,enumerable:!0,get:function(){return this.BF}},selectedRanges:{configurable:!0,enumerable:!0,get:function(){return this.u8}},sheetName:{configurable:!0,enumerable:!0,get:function(){return this.rDa}}});Object(ac.a)(N,"Selection",null,[]);S.prototype.qBi=function(){this.Xfa=null;this.aja=this.tIa()};S.prototype.dispose=function(){this.gridView.Ha.Yq(Object(ld.a)(this,
this.Zg,"onBlockCacheConsistent"));qc.EwaSettings.isChangeGateEnabled("OfficeVSO:5769813_SelectionAdjustAggregateStats")&&this.Tkb.Jnd()};S.prototype.tIa=function(){var V=this.$.sa;return V&&V.activeCell&&V.selectedRanges&&V.sheetName?new N(V.activeCell,V.selectedRanges,V.sheetName):null};S.prototype.Zg=function(){if(this.Xfa)if(!this.aja)fc.ULS.sendTraceTag(538546441,0,10,"SelectionAdjustManager.OnBlockCacheConsistent: initialSheetName is null while adjustedSheetName isn't null");else if(!(this.$.fa.zf<
this.mlj))try{if(this.aja.equals(this.tIa()))if(1!==this.aja.selectedRanges.length){var V;(V=this.Tkb).erd=V.erd+1}else if(this.aja.equals(this.Xfa)){var Pa;(Pa=this.Tkb).oQc=Pa.oQc+1}else{var Ib;(Ib=this.Tkb).nQc=Ib.nQc+1;this.gridView.sU(this.Xfa.selectedRanges,0,this.Xfa.sheetName,null,this.Xfa.activeCell,null,null,0,Ja.a.p3i)}else{var wc;(wc=this.Tkb).h1c=wc.h1c+1;this.fXi()}}finally{this.aja=this.Xfa=null}};S.prototype.fXi=function(){if(this.gXi){var V=this.tIa();fc.ULS.sendTraceTag(538546440,
0,50,"SelectionAdjustManager.ReportDivergence: initial: {0} current: {1} adjusted: {2} sheetSameBetweenInitialAndAdjusted: {3} sheetSameBetweenInitialAndCurrent: {4}",this.aja.toString(),V?V.toString():"",this.Xfa.toString(),this.aja.sheetName===this.Xfa.sheetName,this.aja.sheetName===(V?V.sheetName:null))}};Object(ac.a)(S,"SelectionAdjustManager",null,[518,7]);var md=Md.a;Cm(W,md);W.prototype.dispose=function(){this.$.ra.lya(Object(ld.a)(this,this.yAa,"webServiceAdjustContextEventHandler"));Hg.a.Ia(this.rpb);
this.otc();this.jV.bVi(Object(ld.a)(this,this.Wqf,"onReadyForPendingMergesUpdated"));this.jV.qnc(Object(ld.a)(this,this.GBb,"onTogglePendingMergeBlockedByClient"));this.jV.wUi(Object(ld.a)(this,this.fpf,"onMergeCounterChanged"));this.jV=null;this.ZOa&&this.ZOa.dispose();md.prototype.dispose.call(this)};W.prototype.Wqf=function(V,Pa){this.mze?this.mAe.YEi(Pa.Y4):this.rpb&&this.iMf(Pa.Y4)};W.prototype.iMf=function(V){this.rpb.yCb(V)};W.prototype.GBb=function(V,Pa){Pa.uva?this.Lkj():this.otc()};W.prototype.fpf=
function(){this.hxb=0};W.prototype.Lkj=function(){this.otc();if(this.eze()){var V=this.jV.o8b();fc.ULS.sendTraceTag(539833802,0,50,"RequestController.StartKeepBlockingPendingMergesTimer: Prevented starting StartKeepBlockingPendingMergesTimer because of repeated failure in counter {0} fail count: {1}",ha(V),this.hxb)}else this.ixb=this.Kqa.create(Object(ld.a)(this,this.nMf,"sendKeepBlockingPendingMerges"),this.$Eb,Eh.a.ixb),this.S4a=this.Kqa.UB(Object(ld.a)(this,this.nMf,"sendKeepBlockingPendingMerges"),
this.f9h,Eh.a.S4a)};W.prototype.otc=function(){this.S4a&&(this.ixb.cancel(),this.S4a.cancel(),this.S4a=this.ixb=null)};W.prototype.nMf=function(){var V=this,Pa=this.jV.o8b();P(this.xa,null!=Pa.SuspensionStartTimestamp?Pa.SuspensionStartTimestamp:0,null,function(){V.Vui(Pa)},null,null,this.xa.dc())};W.prototype.Vui=function(V){var Pa=" fail count: "+this.hxb;this.hxb++;this.eze()&&this.otc();fc.ULS.sendTraceTag(542229773,0,10,"RequestController.OnKeepBlockingPendingMergesRequestFailed: request failed {0}{1}",
ha(V),Pa)};W.prototype.eze=function(){return this.hxb>W.xgi};W.prototype.yAa=function(V,Pa){if(Pa){Pa.Ukb.MergeCount=this.jV.o8b();var Ib=vf.g(this.$).Xhi();V=Ib.min;Ib=Ib.max;qc.EwaSettings.isChangeGateEnabled("OfficeVSO:5524817_LogOnMergeRaceCondition2")?Pa.Ukb.ClientRevisions=Object.assign(new X,{Min:V,Max:Ib,MaxFromBlockCache:vf.g(this.$).Ha.Pgi}):Pa.Ukb.ClientRevisions=Object.assign(new X,{Min:V,Max:Ib})}};W.xgi=5;Object(ac.a)(W,"RequestController",Md.a,[]);var Ld=cd.a;Cm(H,Ld);H.prototype.IVb=
function(V){this.Jea.IVb(V)};H.prototype.qnc=function(V){this.Jea&&this.Jea.qnc(V)};H.prototype.bya=function(V,Pa){this.jBa.bya(V,Pa)};H.prototype.SPd=function(V){this.jBa.SPd(V)};H.prototype.JMa=function(V,Pa){this.Ghb.JMa(V,void 0===Pa?"":Pa)};H.prototype.dispose=function(){this.oac&&(this.oac.dispose(),this.oac=null);this.jDd&&(this.jDd.dispose(),this.jDd=null);this.Jea&&(this.Jea.dispose(),this.Jea=null);this.Ghb.dispose();this.Ghb=null;this.jBa.dispose();this.jBa=null;this.$Xa&&(this.$Xa.dispose(),
this.$Xa=null);this.E2a&&(this.E2a.dispose(),this.E2a=null);this.$=null;Ld.prototype.dispose.call(this)};H.prototype.qDb=function(){this.Jea.ZLi()};H.prototype.uUh=function(V,Pa){this.jBa=new na;Pa?Object(oc.a)(ma,Pa)?this.bya(Pa,Object(Od.a)(ma,Pa).wA):Object(oc.a)(Oa,Pa)?this.bya(Pa,Object(Od.a)(Oa,Pa).wA):this.bya(Pa,!0):(this.$Xa=new Oa(V),this.E2a=new ma(V),this.bya(this.$Xa,this.$Xa.wA),this.bya(this.E2a,this.E2a.wA))};Jl.Object.defineProperties(H.prototype,{Jga:{configurable:!0,enumerable:!0,
get:function(){return this.jBa}},A7a:{configurable:!0,enumerable:!0,get:function(){return this.Ghb}},jV:{configurable:!0,enumerable:!0,get:function(){return this.Jea}}});Object(ac.a)(H,"MergeSuspensionManager",cd.a,[466,7]);var Jd=Og.a;Cm(C,Jd);C.prototype.create=function(){fc.ULS.sendTraceTag(577572893,0,50,"MergeSuspensionFactory.Create");this.Jb(this.Qc.ea.Ea(343,void 0)||this.Qc.ea.La(343,new H(this.Qc,Mg.a.instance)))};C.la=function(V){fc.ULS.sendTraceTag(577572894,0,50,"MergeSuspensionFactory.Attach");
V.ea.La(344,new C(V))};Object(ac.a)(C,"MergeSuspensionFactory",Og.a,[]);B.vai=3;B.connected=0;Object(ac.a)(B,"ConnectionStateConstants",null,[]);var je=b(104),qf=b(117),rf=b(39);J.prototype.fkf=function(V,Pa){this.blockedOperationsCount++;V=String.format("{0}_{1}_{2})",Pa.componentName,Pa.actionName,Pa.details);this.blockedActions[V]=this.blockedActions[V]?this.blockedActions[V]+1:1;this.isToastShown&&this.blockedUserOperationsWhileToastShown++};J.prototype.YNf=function(){this.durationMs=qf.a(vc.a.Ta,
this.startTime)};J.prototype.bud=function(V){var Pa=this;this.YNf();rf.a(V).nnc(Object(ld.a)(this,this.fkf,"onBlockedOperationDuringPartialInteractivity"));rf.a(V).vg.onc(Object(ld.a)(this,this.vba,"onToastShown"));V.ea.ub(291,function(Ib){Ib.Z8a(Object(ld.a)(Pa,Pa.pV,"onDocumentHidden"))});V.fa&&V.fa.Ff&&(V.fa.Ff.iGf(Object(ld.a)(this,this.Rud,"onUserNotActive")),this.wasUserActiveOnPIEnd=V.fa.Ff.Tq)};J.prototype.Xj=function(V){var Pa=this;rf.a(V).CVb(Object(ld.a)(this,this.fkf,"onBlockedOperationDuringPartialInteractivity"));
this.isToastShown?this.toastRaiser="Immediate":rf.a(V).vg.GPc(Object(ld.a)(this,this.vba,"onToastShown"));V.ea.ub(291,function(Ib){Pa.hasTabbedOut=Ib.mj;Ib.fEa(Object(ld.a)(Pa,Pa.pV,"onDocumentHidden"))});this.wasUserActiveOnPIStart&&V.fa.Ff.Sug(Object(ld.a)(this,this.Rud,"onUserNotActive"))};J.prototype.Rud=function(V){this.durationUntilUserInactive=je.getElapsedSeconds(this.startTime,vc.a.Ta.Lb);V.iGf(Object(ld.a)(this,this.Rud,"onUserNotActive"))};J.prototype.pV=function(){this.hasTabbedOut=!0};
J.prototype.vba=function(V,Pa){Pa.Jvf!==this.type||this.isToastShown||(this.durationUntilToastShownMs=qf.a(vc.a.Ta,this.startTime),this.toastRaiser=Pa.toastRaiser,this.isToastShown=!0)};Object(ac.a)(J,"PartialInteractivityData",null,[]);var Zf=b(1197);Cm(z,J);z.prototype.Rpi=function(V,Pa){this.swappedByOffline=Pa;this.bud(V)};z.prototype.g7i=function(V){this.errorDataDuringConnectivityIssuesMode=V};z.prototype.yOi=function(V){10>this.failedRequests.length&&(V=V+"_"+je.getElapsedSeconds(this.startTime,
vc.a.Ta.Lb).toString(),this.failedRequests.push(V))};Object(ac.a)(z,"ConnectivityIssuesData",J,[]);var Ef=b(164);x.a6g="DuringWork";x.connectivityIssues="ConnectivityIssues";x.offline="Offline";Object(ac.a)(x,"UnavailabilityTypes",null,[]);y.prototype.dispose=function(){this.$&&(rf.a(this.$).vg.hFf(Object(ld.a)(this,this.plf,"onConnectivityIssuesStatusChanged")),this.$.yf&&this.$.yf.gFf(Object(ld.a)(this,this.mlf,"onConnectivityIssuesBegan")));this.data&&this.$.ra.yf.jGf(Object(ld.a)(this,this.Vo,
"onWebMethodError"));this.$=null};y.prototype.plf=function(V,Pa){Pa.zO?(this.data=new z(vc.a.Ta.Lb,this.$,5===Pa.Kma,!!Pa.Kma,this.$.yf.disconnectionSource,this.Wse),this.lec=this.$.yf.gaf,this.$4c=1,this.$.ra.yf.Yug(Object(ld.a)(this,this.Vo,"onWebMethodError")),Ef.a(this.$).hPc(Object(ld.a)(this,this.pKf,"saveErrorDataDuringConnectivityIssuesMode"))):(this.data.Rpi(this.$,5===Pa.Kma),this.$.ra.yf.jGf(Object(ld.a)(this,this.Vo,"onWebMethodError")),this.data.lastFailedRequestToOnlineTimeGapSec=je.getElapsedSeconds(this.lec,
vc.a.Ta.Lb),qc.EwaSettings.isChangeGateEnabled("OfficeVSO:5690761_AvailabilityUTRDuringWork_7pzab_ConnectivityIssues")?cf.b().tGb(557682689,0,50,x.connectivityIssues,this.data.durationMs,"ConnectivityIssuesTelemetryManager.OnConnectivityIssuesEnded: this partial interactivity's info: {0}",Lf.a.Oc(this.data)):fc.ULS.sendTraceTag(557682689,0,50,"ConnectivityIssuesTelemetryManager.OnConnectivityIssuesEnded: this partial interactivity's info: {0}",Lf.a.Oc(this.data)),qc.EwaSettings.isChangeGateEnabled("OfficeVSO:5508233_ReportNetworkDownVeto")&&
this.data&&this.data.isToastShown&&Yb.Health.instance.recordQosError(ob.a.MLg,[Nb.a.Gec],!0,!1,!1,!1,null),Ef.a(this.$).VBd(Object(ld.a)(this,this.pKf,"saveErrorDataDuringConnectivityIssuesMode")),this.data=null)};y.prototype.pKf=function(V,Pa){this.data.g7i(Pa.ZT)};y.prototype.Vo=function(V,Pa){this.data.yOi(Pa.context.methodName);V=vc.a.Ta.Lb;Pa=je.getElapsedSeconds(this.lec,V);this.lec=V;Pa>this.data.longestDurationBetweenFailedRequestsSec&&(this.data.longestDurationBetweenFailedRequestsSec=Pa);
this.$4c++;this.data.averageDurationBetweenFailedRequestsSec=this.zGg(Pa)};y.prototype.zGg=function(V){var Pa=this.$4c-1;return(this.data.averageDurationBetweenFailedRequestsSec*(Pa-1)+V)/Pa};y.prototype.mlf=function(V,Pa){this.Wse=Pa.bsj};Object(ac.a)(y,"ConnectivityIssuesTelemetryManager",null,[7]);var sh=b(975),Jg=b(1241),gh=b(1196);A.prototype.dispose=function(){this.$&&(this.yJd&&this.$.ra&&0<this.Y5a.count&&this.$.ra.Tt(Object(ld.a)(this,this.Zh,"onWebMethodSuccess")),this.zJd&&(this.dMd("Dispose"),
this.$.fa.Ff.kya(Object(ld.a)(this,this.uba,"onThrottledUserActivity"))))};A.prototype.YTh=function(){qc.EwaSettings.ka(216)&&this.zHi();this.zJd&&this.AHi()};A.prototype.vUh=function(){this.Uzb=this.Vzb;this.Nld=0;var V={};if(!this.Y5a){this.Y5a=new Qf.a;var Pa=Jg.a.A7c(Object(ld.a)(this,this.LXi,"reportSampleTestResult"),"InitSampleMeasurement",this.$);Pa=Ml(Pa);for(var Ib=Pa.next();!Ib.done;Ib=Pa.next())Ib=Ib.value,V[Ib.Cdd]=Ib.baseUrl,this.Y5a.add(Ib)}V=Sys.Serialization.JavaScriptSerializer.serialize(V);
fc.ULS.sendTraceTag(573851739,0,50,"Init Network measurement: numberOfRequestToWaitPerNetworkMeasurement: {0}, numberOfRequestFromTheLastNetworkMeasurement: {1}, testParams: {2} ",this.Vzb,this.Uzb,V);0<this.Y5a.count&&this.$.ra.ls(Object(ld.a)(this,this.Zh,"onWebMethodSuccess"))};A.prototype.dlj=function(){for(var V=Ml(this.Y5a),Pa=V.next();!Pa.done;Pa=V.next())Pa.value.SEd()};A.prototype.U3i=function(){if(12E4>this.$.fa.Ff.lbb)for(var V=Ml(this.Qsc),Pa=V.next();!Pa.done;Pa=V.next())Pa.value.SEd();
else this.dMd("UserInactive")};A.prototype.LXi=function(V){V=Sys.Serialization.JavaScriptSerializer.serialize(V);fc.ULS.sendTraceTag(388821830,0,50,V)};A.prototype.bXi=function(V){if(V){var Pa=this.nXc[V.testIteration.toString()];Pa?Pa.push(V):(Pa=[V],this.nXc[V.testIteration.toString()]=Pa);if(Pa.length===this.xJf.length){Pa=Sys.Serialization.JavaScriptSerializer.serialize(Pa);if(this.$&&this.$.yf){if(V.EstimatedLatency=this.$.yf.Hke,this.$.yf.Hke>this.$.pu.ExcelRountripThresholdMs){fc.ULS.sendTraceTag(570712144,
0,50,"Periodic ping tests results when network is slow: {0}, consequtive slow ping iteration #: {1}",Pa,this.BXc++);return}}else fc.ULS.sendTraceTag(570712143,0,50,"EwaControl/ConnectivityObserver is null when conducting slow connection speed tests");fc.ULS.sendTraceTag(570712142,0,50,"Periodic ping tests results: {0}",Pa);this.BXc=1}}};A.prototype.Zh=function(V,Pa){V=Pa.context.methodName;if(V===Pd.a.s1a||V===Pd.a.aua)this.Uzb++,V=Date.now(),this.hdj(V)&&(this.Uzb=0,this.Nld=V,this.dlj())};A.prototype.uba=
function(){this.MLd("OnThrottledUserActivity")};A.prototype.pV=function(){this.dMd("OnDocumentHidden")};A.prototype.Pwa=function(){this.MLd("OnDocumentUnhidden")};A.prototype.MLd=function(V){this.lQa&&this.lQa.Po||(fc.ULS.sendTraceTag(570712141,0,50,"NetworkMeasurement.StartConnectionSpeedTest: starting ping tests. caller: {0}",V),this.lQa=Mg.a.instance.UB(Object(ld.a)(this,this.U3i,"sendConnectionSpeedMeasurement"),5E3,Eh.a.cjj),this.lQa.mja())};A.prototype.dMd=function(V){this.lQa&&this.lQa.Po&&
(fc.ULS.sendTraceTag(570712140,0,50,"NetworkMeasurement.StopConnectionSpeedTest: stopping ping tests. caller: {0}",V),this.lQa.cancel())};A.prototype.hdj=function(V){return this.Uzb>=this.Vzb&&V-this.Nld>this.Hpd};A.prototype.$Jg=function(){return A.nJf(this.$.Ba.SlowNetworkMeasurementsSamplePercentage)};A.prototype.zHi=function(){this.Vzb=this.$.Ba.NumberOfRequestToWaitPerNetworkMeasurement;this.Hpd=1E3*this.$.Ba.MinTimeBetweenNetworkMeasurementInSec;var V=this.$.Ba.NetworkMeasurementsSamplePercentage;
0<this.Vzb&&0<this.Hpd&&(this.yJd=A.nJf(V))&&this.vUh()};A.prototype.AHi=function(){if(!this.Qsc){this.Qsc=new Qf.a;var V=Jg.a.A7c(Object(ld.a)(this,this.bXi,"reportConectionLatencyTestResult"),"PrepareAndInitSlowNetworkTests.ConnectionSpeedTest",this.$,[gh.a.fyc]);V=Ml(V);for(var Pa=V.next();!Pa.done;Pa=V.next())this.Qsc.add(Pa.value);this.$.fa.Ff.Tq&&this.MLd("PrepareAndInitSlowNetworkTests")}};A.nJf=function(V){return 100*Math.random()<V};Object(ac.a)(A,"NetworkMeasurement",null,[7]);var ah=b(895);
v.prototype.jwj=function(){this.wT&&this.wT.YNf()};v.prototype.zpg=function(V){this.allOfflinePartialInteractivitiesDataInSession.push(V);this._count++};Jl.Object.defineProperties(v.prototype,{count:{configurable:!0,enumerable:!0,get:function(){return this._count}},wT:{configurable:!0,enumerable:!0,get:function(){return this.allOfflinePartialInteractivitiesDataInSession[this.allOfflinePartialInteractivitiesDataInSession.length-1]}}});Object(ac.a)(v,"OfflinePartialInteractivitiesDataForLog",null,[]);
Cm(w,J);w.prototype.C$i=function(V){this.timeFromLastOffline=V};w.prototype.h7i=function(V){this._errorDataDuringOfflineMode=V};Object(ac.a)(w,"OfflinePartialInteractivityData",J,[]);u.prototype.dispose=function(){this.$&&rf.a(this.$)&&rf.a(this.$).vg.jCd(Object(ld.a)(this,this.R6a,"onOfflineModePartialInteractivityStatusChanged"));Hg.a.Ia(this.Yqb);this.$=this.Yqb=null};u.prototype.R6a=function(V,Pa){Pa.zO?this.Fwi(Pa.Kma):this.Gwi()};u.prototype.vba=function(V,Pa){5===Pa.Jvf&&this.d0a()};u.prototype.qKf=
function(V,Pa){this.wT.h7i(Pa.ZT)};u.prototype.Fwi=function(V){this.wT=new w(vc.a.Ta.Lb,this.$,!!V);this.wT.C$i(-1!==this.Oxd?window.performance.now()-this.Oxd:-1);this.sMa.zpg(this.wT);rf.a(this.$).vg.GPc(Object(ld.a)(this,this.vba,"onToastShown"));this.d0a();this.Yqb=Mg.a.instance.UB(Object(ld.a)(this,this.d0a,"flushOfflinePartialInteractivityDataToIDB"),u.Tnh,Eh.a.d0a);Ef.a(this.$).hPc(Object(ld.a)(this,this.qKf,"saveErrorDataDuringOfflineMode"))};u.prototype.d0a=function(){this.sMa.jwj();this.r1i(u.Ovd,
Sys.Serialization.JavaScriptSerializer.serialize(this.sMa))};u.prototype.Gwi=function(){this.wT.bud(this.$);this.d0a();Hg.a.Ia(this.Yqb);this.Yqb=null;this.Oxd=window.performance.now();rf.a(this.$).vg.onc(Object(ld.a)(this,this.vba,"onToastShown"));Ef.a(this.$).VBd(Object(ld.a)(this,this.qKf,"saveErrorDataDuringOfflineMode"));this.cXi()};u.prototype.r1i=function(V,Pa){var Ib=this;this.$?this.$$e=ih.TaskExtensions.Da(this.$$e,function(){Ib.indexedDB.U9a(new ah.a(V,Pa))},this.$.ma):fc.ULS.sendTraceTag(573387486,
0,15,"OfflineModeTelemetryManager.SaveToIndexedDBSequential: EwaControl is null when attempting to write to IDB")};u.prototype.YWi=function(){var V=this.$.ma;ih.TaskExtensions.Da(ih.TaskExtensions.Da(this.indexedDB.yIa(u.Ovd),Object(ld.a)(this,this.CXi,"reportOfflinePartialInteractivityDataFromIDB"),V),Object(ld.a)(this,this.ORi,"removeDataFromIDB"),V)};u.prototype.CXi=function(V){V=V.result;Uf.a.na(V)||(this.y5f=!0,fc.ULS.sendTraceTag(576811915,0,50,"OfflineModeTelemetryManager.ReportOfflinePartialInteractivityDataFromIDB: Previous session's offline partial interactivy data: {0}",
V))};u.prototype.cXi=function(){if(this.wT){var V=Sys.Serialization.JavaScriptSerializer.serialize(this.wT);qc.EwaSettings.isChangeGateEnabled("OfficeVSO:5690761_AvailabilityUTRDuringWork_71qb3_Offline")?cf.b().tGb(560791645,0,50,x.offline,this.wT.durationMs,"OfflineModeTelemetryManager.ReportCurrentOfflinePartialInteractivityData: Ending offline partial interactivy data: {0}",V):fc.ULS.sendTraceTag(560791645,0,50,"OfflineModeTelemetryManager.ReportCurrentOfflinePartialInteractivityData: Ending offline partial interactivy data: {0}",
V)}qc.EwaSettings.isChangeGateEnabled("OfficeVSO:5508233_ReportNetworkDownVeto")&&this.wT&&this.wT.isToastShown&&Yb.Health.instance.recordQosError(ob.a.Yzj,[Nb.a.Gec],!0,!1,!1,!1,null)};u.prototype.ORi=function(){this.y5f&&(this.$?ih.TaskExtensions.Da(this.indexedDB.qye(u.Ovd),function(){fc.ULS.sendTraceTag(576811914,0,50,"OfflineModeTelemetryManager.RemoveDataFromIDB: Previous session's offline partial interactivy data successfuly removed from IDB.")},this.$.ma):fc.ULS.sendTraceTag(573387485,0,10,
"OfflineModeTelemetryManager.RemoveDataFromIDB: EwaControl is null when attempting to remove offline mode data stored in IDB."))};u.prototype.gAb=function(){if(this.sMa&&0<this.sMa.count){var V=Sys.Serialization.JavaScriptSerializer.serialize(this.sMa);fc.ULS.sendTraceTag(560791644,0,50,"OfflineModeTelemetryManager.OnBeforeUnload: This session's offline partial interactivy data: {0}",V)}};u.Ced="NetworkAvailability";u.Ded="NetworkAvailabilityData";u.Ovd="partialInteractivityData";u.Tnh=3E3;Object(ac.a)(u,
"OfflineModeTelemetryManager",null,[7]);k.prototype.dispose=function(){Hg.a.Ia(this.djf);Hg.a.Ia(this.Jqd);Hg.a.Ia(this.oka);Hg.a.Ia(this.mPg);this.$=null};Object(ac.a)(k,"NetworkConnectionTelemetryManager",null,[7]);Cm(t,J);t.prototype.R6a=function(){this.wasInteruptedByOfflineMode=!0};Object(ac.a)(t,"SilentReopenData",J,[]);r.prototype.dispose=function(){this.vg.GFf(Object(ld.a)(this,this.apf,"onLongInactivitySilentReopenPartialInteractivityStatusChanged"));this.vg.zVi(Object(ld.a)(this,this.Lsf,
"onSilentReopenDuringWorkPartialInteractivityStatusChanged"));this.D6=this.vg=this.$=null};r.prototype.Lsf=function(V,Pa){this.Isf(Pa,3)};r.prototype.apf=function(V,Pa){this.Isf(Pa,2)};r.prototype.Isf=function(V,Pa){V.zO?this.D6=new t(vc.a.Ta.Lb,this.$,!!V.Kma,Pa):(5===V.Kma&&(this.D6.wasInteruptedByOfflineMode=!0),3!==V.Kma&&2!==V.Kma||fc.ULS.sendTraceTag(542782152,0,10,"SilentReopenPartialInteractivityTelemetryManager.OnSilentReopen: BackToWork/DuringWork partial interactivity has been swapped to DuringWork/BackToWork."),
this.D6.bud(this.$),2===Pa?qc.EwaSettings.isChangeGateEnabled("OfficeVSO:5690761_AvailabilityUTRDuringWork_8dtae_B2W")?cf.b().uGb(571289604,0,50,x.offline,this.D6.durationMs,this.D6):fc.ULS.sendTraceTag(571289604,0,50,Lf.a.Oc(this.D6)):qc.EwaSettings.isChangeGateEnabled("OfficeVSO:5690761_AvailabilityUTRDuringWork_6w9lg_DuringWork")?cf.b().uGb(542782150,0,50,x.a6g,this.D6.durationMs,this.D6):fc.ULS.sendTraceTag(542782150,0,50,Lf.a.Oc(this.D6)),this.D6=null)};Object(ac.a)(r,"SilentReopenPartialInteractivityTelemetryManager",
null,[7]);var Wh=Md.a;Cm(m,Wh);m.prototype.dispose=function(){this.yf&&(this.Grc&&(this.yf.BUi(Object(ld.a)(this,this.bBb,"onNetworkDownEvent")),this.yf.DEb(Object(ld.a)(this,this.Hpf,"onNetworkResumedEvent"))),this.yf.gFf(Object(ld.a)(this,this.nlf,"onConnectivityIssuesBeganEvent")),this.yf.mTi(Object(ld.a)(this,this.olf,"onConnectivityIssuesEndedEvent")));this.Awb&&this.documentVisibilityObserver&&(this.documentVisibilityObserver.wEb(Object(ld.a)(this,this.Pwa,"onDocumentUnhidden")),this.Awb=!1);
this.$&&(this.umc&&this.svc(),this.$.fa&&(this.$.fa.aGf(Object(ld.a)(this,this.Ksf,"onSilentReopenDueToTimeoutOrDeploymentInitiated")),this.$.fa.Ff&&this.$.fa.Ff.kya(Object(ld.a)(this,this.uba,"onThrottledUserActivity"))));qc.EwaSettings.isChangeGateEnabled("OfficeVSO:5533387_ReportLongSilentReopenBackToWorkVeto")&&this.c0&&(this.c0.dispose(),this.c0=null);Hg.a.Ia(this.ghf);this.$=null;Wh.prototype.dispose.call(this)};m.prototype.Zfi=function(){this.rJd=!0};m.prototype.Rbe=function(){this.yma||(this.yma=
rf.a(this.$).vg.KVa(3,"NetworkConnectionStateManager.ActivateDuringWorkSilentReopenPartialInteractivity"))};m.prototype.YZh=function(){if(this.rJd)return this.rJd=!1,!0;var V=this.O6>this.fdf||this.ved>this.fdf&&10>this.O6;fc.ULS.sendTraceTag(571289602,0,50,"NetworkConnectionStateManager.IsBackToWorkSilentReopen: Inactivity duration: Time from last activity:{0}, Time gap between last two activities: {1}. return value:{2}",this.O6,this.ved,V);return V};m.prototype.NXi=function(){qc.EwaSettings.isChangeGateEnabled("OfficeVSO:5533387_ReportLongSilentReopenBackToWorkVeto")&&
(this.c0=Mg.a.instance.create(function(){Yb.Health.instance.recordQosError(ob.a.hjj,[Nb.a.Gec],!0,!0,!1,!1,null)},6E3,"ReportLongSilentReopenBackToWorkVeto",void 0,!0))};m.prototype.eng=function(){var V=this;this.yma||this.Q_?fc.ULS.sendTraceTag(542782155,0,10,"NetworkConnectionStateManager.ActivateSilentReopenDuringWorkWhenNeeded: Trying to activate during-work partial interactivity when we are already in this partial interactivity or there is a running timer that's going to do it soon."):this.Q_=
Mg.a.instance.create(function(){V.$?V.yma?fc.ULS.sendTraceTag(542782153,0,15,"NetworkConnectionStateManager.ActivateSilentReopenDuringWorkWhenNeeded: Tried to activate SilentReopenDuringWork PI when there is already an DuringWorkSilentReopen partial interactivity object"):vf.g(V.$).isEditing?(V.N8a||(vf.g(V.$).zc.mt(Object(ld.a)(V,V.Zk,"onEditEnded")),fc.ULS.sendTraceTag(541893722,0,50,"NetworkConnectionStateManager.ActivateSilentReopenDuringWorkWhenNeeded: Registered OnEditEnded while during-work silent reopen")),
V.O8a=!0,fc.ULS.sendTraceTag(541193986,0,50,"NetworkConnectionStateManager.ActivateSilentReopenDuringWorkWhenNeeded: Need to init during-work silent reopen partial interactivity but the user is during a cell edit. Registered to OnEditEnded event.")):V.Rbe():fc.ULS.sendTraceTag(542782154,0,50,"NetworkConnectionStateManager.ActivateSilentReopenDuringWorkWhenNeeded: EwaControl is null")},this.yUf,Eh.a.bij,void 0,!0)};m.prototype.bBb=function(){fc.ULS.sendTraceTag(541193988,0,50,"NetworkConnectionStateManager.OnNetworkDownEvent: Network down.");
this.ugc(1,!1)};m.prototype.Pwa=function(){var V=this;this.rja||this.zyb?window.setTimeout(function(){V.lOd()},this.fhf):this.lOd();this.documentVisibilityObserver.wEb(Object(ld.a)(this,this.Pwa,"onDocumentUnhidden"));this.Awb=!1};m.prototype.dgf=function(V){this.xXc=this.Yme(2,V,!0);this.Bge()};m.prototype.ugc=function(V,Pa){this.zSb=this.Yme(V,Pa,!1);this.Bge()};m.prototype.Yme=function(V,Pa,Ib){Ib=Ib?this.xXc:this.zSb;return Pa?Ib|V:Ib&~V};m.prototype.lOd=function(){var V=!!this.tMa,Pa=!!this.gQa,
Ib=!!this.yma,wc=!!this.s_b;this.zyb&&!V?this.dng():!this.zyb&&V&&this.E_g();!this.wfc||Pa||Ib?this.wfc||(Pa?this.xxe():(Ib||this.Q_&&this.Q_.Po)&&this.yxe()):this.FRf&&this.Bea?this.bng():!this.zHb||this.Bea||qc.EwaSettings.isChangeGateEnabled("OfficeVSO:5658794_DontActivatePartialInteractivityIfTimerIsRunning")&&this.Q_||this.eng();this.rja&&!wc?this.vZf(!0):!this.rja&&wc&&this.vZf(!1)};m.prototype.Zk=function(){fc.ULS.sendTraceTag(541193987,0,50,"NetworkConnectionStateManager.OnEditEnded: Edit ended. IsInOfflineMode:{0}, IsInDuringWorkSilentReopenMode:{1}",
this.zyb&&this.Grc,this.wfc&&!this.Bea&&this.zHb);this.zyb&&this.Grc&&this.Ube();this.wfc&&!this.Bea&&this.zHb&&this.Rbe();vf.g(this.$).zc.Qs(Object(ld.a)(this,this.Zk,"onEditEnded"));this.O8a=this.N8a=!1};m.prototype.dng=function(){this.$?this.tMa?fc.ULS.sendTraceTag(571289603,0,15,"NetworkConnectionStateManager.ActivateOfflinePartialInteractivityIfNeeded: Tried to activate offline PI when there is already an offline partial interactivity object"):vf.g(this.$).isEditing?(this.O8a||(vf.g(this.$).zc.mt(Object(ld.a)(this,
this.Zk,"onEditEnded")),fc.ULS.sendTraceTag(541893721,0,50,"NetworkConnectionStateManager.ActivateOfflinePartialInteractivityIfNeeded: Registered OnEditEnded during offline mode")),this.N8a=!0,fc.ULS.sendTraceTag(541193985,0,50,"NetworkConnectionStateManager.ActivateOfflinePartialInteractivityIfNeeded: Turned offline while user is editing a cell, registered to OnEditEnded event.")):this.Ube():fc.ULS.sendTraceTag(570949835,0,50,"NetworkConnectionStateManager.ActivateOfflinePartialInteractivityIfNeeded: EwaControl is null")};
m.prototype.Ube=function(){this.tMa||(this.tMa=rf.a(this.$).vg.KVa(5,"NetworkConnecStateManager.ActivateOfflinePartialInteractivity"))};m.prototype.Hpf=function(){fc.ULS.sendTraceTag(541193984,0,50,"NetworkConnectionStateManager.OnNetworkResumedEvent: network was resumed.");this.ugc(1,!0);this.N8a&&!this.O8a&&vf.g(this.$).zc.Qs(Object(ld.a)(this,this.Zk,"onEditEnded"));this.N8a=!1};m.prototype.E_g=function(){this.tMa&&(Hg.a.Ia(this.tMa),this.tMa=null)};m.prototype.xxe=function(){this.gQa&&(Hg.a.Ia(this.gQa),
this.gQa=null);qc.EwaSettings.isChangeGateEnabled("OfficeVSO:5533387_ReportLongSilentReopenBackToWorkVeto")&&this.c0&&this.c0.Po&&this.c0.cancel();this.c0=null};m.prototype.yxe=function(){this.yma&&(Hg.a.Ia(this.yma),this.yma=null);this.Q_&&(Hg.a.Ia(this.Q_),this.Q_=null);this.O8a&&!this.N8a&&vf.g(this.$).zc.Qs(Object(ld.a)(this,this.Zk,"onEditEnded"));this.O8a=!1};m.prototype.uba=function(V,Pa){this.ved=this.O6;this.O6=Pa.wuc};m.prototype.Ksf=function(){this.$&&(this.umc||(pf.a(this.$).NP(rg.a.WMa).esg(Object(ld.a)(this,
this.Tpf,"onOpenWebMethodErrorUserAlertExecuting")),this.$.Nk(Object(ld.a)(this,this.sd,"onWorkbookOpened")),this.umc=!0),this.Bea=this.YZh(),this.ugc(2,!1))};m.prototype.Tpf=function(){var V=pf.a(this.$).pi,Pa=V.jyg();V=Wd.f(V.cs.ld.errors,function(Ib){return Ib.MessageIdName});fc.ULS.sendTraceTag(545842889,0,50,"NetworkConnectionStateManager.OnOpenWebMethodErrorUserAlertExecuting: IsStateUnrecoverable:{0}, IsB2W:{1}, Errors: {2}",Pa,this.Bea,Lf.a.Oc(V));Pa&&(this.gQa?(this.Bea=!1,this.xxe(),this.svc()):
this.yma&&(this.yxe(),this.svc()))};m.prototype.sd=function(){this.$?(fc.ULS.sendTraceTag(541193955,0,50,"NetworkConnectionStateManager.OnWorkbookOpened: Workbook opened."),this.Bea=!1,qc.EwaSettings.isChangeGateEnabled("OfficeVSO:5543662_StopSilentReopenDuringWorkTimerMethodContextOnWorkbookOpened")&&this.Q_&&this.Q_.Po&&(Hg.a.Ia(this.Q_),this.Q_=null),qc.EwaSettings.isChangeGateEnabled("OfficeVSO:5533387_ReportLongSilentReopenBackToWorkVeto")&&this.c0&&this.c0.Po&&(Hg.a.Ia(this.c0),this.c0=null),
this.ugc(2,!0),this.svc()):fc.ULS.sendTraceTag(554717603,0,10,"NetworkConnectionStateManager.OnWorkbookOpened: bug monitoring: EwaControl is null.")};m.prototype.bng=function(){this.gQa||(this.gQa=rf.a(this.$).vg.KVa(2,"NetworkConnectionStateManager.ActivateLongInactivitySilentReopenPartialInteractivity",void 0,xf.a.instance.da(2089)));this.NXi()};m.prototype.nlf=function(){this.dgf(!0)};m.prototype.olf=function(){this.dgf(!1)};m.prototype.vZf=function(V){V?(this.s_b=rf.a(this.$).vg.KVa(4,"NetworkConnectionStateManager.ConnectivityIssues"),
this.vKi()):(Hg.a.Ia(this.s_b),this.s_b=null)};m.prototype.vKi=function(){if(this.$&&this.$.ra){var V=this.$.ra.xa.dc();bf.ib(this.$.ra.xa,null,null,null,V)}};m.prototype.svc=function(){pf.a(this.$).NP(rg.a.WMa).Kp(Object(ld.a)(this,this.Tpf,"onOpenWebMethodErrorUserAlertExecuting"));this.$.nl(Object(ld.a)(this,this.sd,"onWorkbookOpened"));this.umc=!1};m.prototype.Bge=function(){this.documentVisibilityObserver||fc.ULS.sendTraceTag(540641346,0,15,"NetworkConnectionStateManager.AdjustPartialInteractivityStateWhenPossible: Document visibility observer is null while it shouldn't be.");
this.documentVisibilityObserver&&this.documentVisibilityObserver.mj?this.Awb||(this.documentVisibilityObserver.tkb(Object(ld.a)(this,this.Pwa,"onDocumentUnhidden")),this.Awb=!0,fc.ULS.sendTraceTag(541193954,0,50,"NetworkConnectionStateManager.AdjustPartialInteractivityStateWhenPossible: tabbed out user, will update the partial interactivity state when the user will be back.")):this.lOd()};Jl.Object.defineProperties(m.prototype,{G0h:{configurable:!0,enumerable:!0,get:function(){return this.Bea}},zyb:{configurable:!0,
enumerable:!0,get:function(){return!(this.zSb&1)}},wfc:{configurable:!0,enumerable:!0,get:function(){return!(this.zSb&2)}},rja:{configurable:!0,enumerable:!0,get:function(){return!!(this.xXc&2)}}});Object(ac.a)(m,"NetworkConnectionStateManager",Md.a,[465,7]);var zh=Og.a;Cm(c,zh);c.prototype.create=function(){var V=this;ih.TaskExtensions.Da(Hf.GetServiceTaskFactory.Xa(this.$.ea,395,396,this.vb,"Microsoft.Office.Excel.WebUI.Client.IndexedDB.IIndexedDB"),function(Pa){V.Jb(V.$.ea.Ea(400,void 0)||new m(V.$,
Pa.result))},this.$.ma,3)};c.la=function(V){V.ea.La(401,new c(V))};Object(ac.a)(c,"NetworkConnectionStateManagerFactory",Og.a,[]);var Te=b(1349);d.prototype.dispose=function(){this.d1f();this.k1f();this.Rld=this.Dld=this.eN=this.nk=this.Jt=this.Plc=this.$=null;this.jSd=0};d.prototype.BBg=function(V){this.eN=V;this.Dld=V.rvg;this.Rld=V.TOi};d.prototype.MGa=function(){this.eN&&(this.hide(),this.d1f(),this.eN=null)};d.prototype.Y4h=function(){return!!this.eN&&this.Plc.y1h};d.prototype.phj=function(V){this.eN?
this.show(V):fc.ULS.shipAssertTag(577279773,0,!1,"RecoveryUIController.ShowRecoveryUI: recoveryUI is null.")};d.prototype.cCh=function(){return this.eN?this.eN.D$h:null};d.prototype.show=function(V){var Pa=this.eN.cyh();Pa?(this.Plc.showFloatie(Object.assign(new Te.a,{x:Pa.x,y:Pa.y}),this.eN.sIa(),V),this.Xj()):fc.ULS.sendTraceTag(577279772,0,100,"RecoveryUIController.Show: point is null.")};d.prototype.hide=function(){this.Y4h()&&this.Plc.aC();this.k1f()};d.prototype.Xj=function(){if(!this.q2b){var V=
vf.g(this.$);V.view.nt(Object(ld.a)(this,this.h3f,"updatePositionOnVisibleAreaChanged"));V.Ej.Cm(Object(ld.a)(this,this.Ize,"dismissRecoveryUIOnEditStarted"));this.nk.la("blur",Object(ld.a)(this,this.r3g,"dismissRecoveryUIOnDocumentHidden"));this.$.Na.rkb(Object(ld.a)(this,this.Mwa,"onCommandExecutionStarting"));this.$.Aa.Vf(Object(ld.a)(this,this.Jze,"dismissRecoveryUIOnSheetChanged"));(V=this.$.ea.Ea(65,void 0))&&V.s2&&V.s2.registerForCommentEvents(Object(ld.a)(this,this.Hze,"dismissRecoveryUIOnCommentsEvent"));
this.q2b=!0}this.n$b||(this.Jt.St(aa.a.Rb,this.$.domElement,Object(ld.a)(this,this.onKeyDown,"onKeyDown"),!0),this.Jt.St(aa.a.fe,this.$.domElement,Object(ld.a)(this,this.onKeyUp,"onKeyUp"),!0),this.n$b=!0)};d.prototype.d1f=function(){if(this.q2b){var V=vf.g(this.$);V.view.Tr(Object(ld.a)(this,this.h3f,"updatePositionOnVisibleAreaChanged"));V.Ej.mm(Object(ld.a)(this,this.Ize,"dismissRecoveryUIOnEditStarted"));this.nk.detach("blur");this.$.Na.Y8a(Object(ld.a)(this,this.Mwa,"onCommandExecutionStarting"));
this.$.Aa.wg(Object(ld.a)(this,this.Jze,"dismissRecoveryUIOnSheetChanged"));(V=this.$.ea.Ea(65,void 0))&&V.s2&&V.s2.unregisterForCommentEvents(Object(ld.a)(this,this.Hze,"dismissRecoveryUIOnCommentsEvent"));this.q2b=!1}};d.prototype.k1f=function(){this.n$b&&(this.Jt.kv(aa.a.Rb,this.$.domElement,Object(ld.a)(this,this.onKeyDown,"onKeyDown"),!0),this.Jt.kv(aa.a.fe,this.$.domElement,Object(ld.a)(this,this.onKeyUp,"onKeyUp"),!0),this.n$b=this.CZ=this.K4b=!1)};d.prototype.h3f=function(){var V=this;this.eN&&
(this.jSd=vc.a.Ta.we.m,this.hide(),Mg.a.instance.create(function(){V.byj()},250,"RecoveryUI.UpdatePositionOnVisibleAreaChanged",void 0,!0))};d.prototype.byj=function(){this.eN&&250<=vc.a.Ta.we.m-this.jSd&&this.show(-1)};d.prototype.Hze=function(V){10===V&&this.MGa()};d.prototype.r3g=function(){if(this.eN){var V=document.getElementById("PasteRecoveryUI");V&&le.a.rj===V.getAttribute(le.a.QX)&&V.click();this.MGa()}};d.prototype.Ize=function(){this.MGa()};d.prototype.Jze=function(){this.MGa()};d.prototype.onKeyUp=
function(V){if(this.eN){if(this.CZ)return!1;if(17===V.Ga.keyCode&&this.K4b){V=document.getElementById("PasteRecoveryUI");if(!V)return fc.ULS.shipAssertTag(577279771,0,!1,"RecoveryUIController.OnKeyUp: recoveryUIElement is null."),!1;var Pa=V.getAttribute(le.a.QX)||"";if(le.a.pp===Pa)return V.click(),!0}}return!1};d.prototype.onKeyDown=function(V){if(this.eN){this.K4b=!1;this.CZ=V.ctrlKey;V=V.Ga.keyCode;if(27===V)return this.MGa(),!0;if(17===V)return this.K4b=!0}return!1};d.prototype.Mwa=function(V,
Pa){V=Pa.je;-1027730316!==V.command&&-1059615499!==V.command?this.MGa():(Pa=Pa.properties)&&Pa.launcherId!==this.cCh()&&this.MGa()};Object(ac.a)(d,"RecoveryUIController",null,[464,7]);var Th=Og.a;Cm(a,Th);a.prototype.create=function(){var V=this,Pa=this.$;Pa.HG(function(Ib){Ib.Ned().then(function(wc){V.Jb(Pa.ea.Ea(406,void 0)||new d(Pa,wc,Yh.KeyInputManager.instance,Rb.a.instance.VB()))})})};a.la=function(V){V.ea.La(405,new a(V))};Object(ac.a)(a,"RecoveryUIControllerFactory",Og.a,[]);Type.registerNamespace("Microsoft.Office.Excel.WebUI.Client.InsertPicture");
Type.registerNamespace("_Ewa");Type.registerNamespace("Common");Type.registerNamespace("Common.App.ApplicationFeatureHelper");Ce.main();Type.registerNamespace("Common.App.InProductMessaging");Wc.main();Type.registerNamespace("Common.App.FirstRunExperienceLauncher");gc.main();Type.registerNamespace("Common.App.InsertFile");Type.registerNamespace("Common.App.InsertPicture");(function(){Cf.a.Ja(function(V){kc.la(V)})})();(function(){Cf.a.Ja(function(V){Ab.la(V)})})();(function(){Cf.a.Ja(function(){Cf.a.Ja(Za.la)})})();
(function(){Cf.a.Ja(function(){Cf.a.Ja(fb.la)})})();(function(){Cf.a.Ja(function(V){ib.la(V)})})();rb.a.Xi(".insert-media-dialog-old{width:870px;float:left;margin-top:7px}.insert-media-dialog{width:870px;width:clamp(400px,870px,80vw);float:left;margin-top:7px}.app-rtl .insert-media-dialog{float:right}.insert-media-frame{width:100%;height:100%;visibility:visible}.insert-media-panel-old{height:550px}.insert-media-panel{height:550px;height:clamp(300px,550px,90vh)}.keep-focus-start{position:absolute;width:-1000px;top:-1000px}.keep-focus{position:absolute;width:-1000px;top:1000px}.display-none{display:none}.padding-zero{padding:0}");
Cf.a.Ja(C.la);Cf.a.Ja(c.la);(function(){Cf.a.Ja(function(V){a.la(V)})})()},975:function(D,F,b){function a(y){var x=this;this.businessBar=this.a5a=null;this.$=y;this.ra=this.$.ra;this.localStorage=new w.a;this.r_b=!1;this.$.fa.Do(Object(t.a)(this,this.Rh,"onCommandUIGeneratedAndGridInteractive"));this.ra.yf.Akb(Object(t.a)(this,this.$wa,"onNetworkResumed"));this.ra.ls(Object(t.a)(this,this.Zh,"onWebMethodSuccess"));this.$.ea.ub(5,function(z){x.businessBar=z;z.rrg(Object(t.a)(x,x.soi,"onBusinessBarEntryDisplayChanged"))});
this.ra.FB(Object(t.a)(this,this.Vo,"onWebMethodError"))}function d(y){this.Kdd=[v.a.Y6f,v.a.fyc];this.oka=y;this.$=y.$;this.iN={}}function c(){this.scenario=null;this.timeElapsed=0;this.isNewSession=!1;this.rawData=null}b.r(F);D=b(0);var m=b(15),r=b(317),t=b(37),k=b(27),u=b(9),w=b(304);Object(D.a)(c,"ConnectionErrorLogInfo",null,[]);var v=b(1196),A=b(1241);d.prototype.W9h=function(){var y=Object(t.a)(this,this.Cq,"addResult");y=A.a.A7c(y,"OnNetworkDownImmediatePing",this.$,this.Kdd);y=Ml(y);for(var x=
y.next();!x.done;x=y.next())x.value.SEd()};d.prototype.Cq=function(y,x){this.iN[x]=y;this.aQh()&&this.GXi("OnNetworkDownImmediatePing"===y.caller)};d.prototype.aQh=function(){for(var y=Ml(this.Kdd),x=y.next();!x.done;x=y.next())if(x=x.value,void 0===this.iN[x]||null===this.iN[x])return!1;return!0};d.prototype.GXi=function(y){var x=this.$.yf.PU;y&&this.Ylj(x);y=Ml(this.Kdd);for(var z=y.next();!z.done;z=y.next())z=z.value,this.iN[z]=Sys.Serialization.JavaScriptSerializer.serialize(this.iN[z]);y=Date.now();
z=this.oka.Vad(b(975).NetworkConnectionHealthChecker.wzb).returnValue;var J=this.oka.Vad(b(975).NetworkConnectionHealthChecker.xGb).returnValue;this.iN.isOfflineMode=x;this.iN.networkDownBBAge=-1===z?z:y-z;this.iN.transientServerCommunicationFailuresBBAge=-1===J?J:y-J;this.oka.businessBar?(this.iN.isNetworkDownBBShown=this.oka.businessBar.ND(54).toString(),this.iN.isServerErrorBBShown=this.oka.businessBar.ND(21).toString()):(this.iN.isNetworkDownBBShown="unknown",this.iN.isServerErrorBBShown="unknown");
m.ULS.sendTraceTag(573851740,0,50,"ConnectionHealthTestsRunner.ReportPingResults: {0}",Sys.Serialization.JavaScriptSerializer.serialize(this.iN))};d.prototype.Ylj=function(y){for(var x=b(975).NetworkConnectionHealthChecker,z={},J=Ml(Object.keys(this.iN)),B=J.next();!B.done;B=J.next())B=this.iN[B.value],z[B.testName]=B.isSuccess;z.isOfflineMode=y;this.oka.mMd(x.wXc,Sys.Serialization.JavaScriptSerializer.serialize(z))};Object(D.a)(d,"ConnectionHealthTestsRunner",null,[]);b.d(F,"NetworkConnectionHealthChecker",
function(){return a});a.prototype.dispose=function(){this.$&&(this.$.fa&&this.$.fa.Sr(Object(t.a)(this,this.Rh,"onCommandUIGeneratedAndGridInteractive")),this.ra&&(this.ra.yf.DEb(Object(t.a)(this,this.$wa,"onNetworkResumed")),this.ra.YC(Object(t.a)(this,this.Vo,"onWebMethodError")),this.ra.Tt(Object(t.a)(this,this.Zh,"onWebMethodSuccess"))))};a.prototype.soi=function(y,x){x.e1c?this.uoi(x):this.toi(x)};a.prototype.uoi=function(y){var x={};x.Timestamp=Date.now().toString();switch(y.imb){case 21:this.a5a=
y.data.FailedMethod;x.FailedMethod=this.a5a;this.mMd(a.xGb,JSON.stringify(x));break;case 54:this.mMd(a.wzb,JSON.stringify(x))}};a.prototype.toi=function(y){switch(y.imb){case 21:this.r5a(a.xGb,!0);break;case 54:this.r5a(a.wzb,!0)}};a.prototype.mMd=function(y,x){try{this.localStorage.te()&&this.localStorage.setItem(y,x)}catch(z){m.ULS.sendTraceTag(573851747,0,15,"NetworkConnectionHealthChecker.StoreDataInLocalStorage: Failed to set item to local storage. reason: {0}",z.message||"Unknown")}};a.prototype.Vad=
function(y){if(this.localStorage.te()&&(y=this.localStorage.d1a(y))&&"null"!==y){var x=JSON.parse(y);y=parseInt(x.Timestamp);x=Sys.Serialization.JavaScriptSerializer.serialize(x);return{returnValue:y,rawData:x}}return{returnValue:-1,rawData:null}};a.prototype.Zh=function(y,x){y=x.context.methodName;this.a5a&&y===this.a5a&&(m.ULS.sendTraceTag(573851746,0,50,'NetworkConnectionHealthChecker.OnWebMethodSuccess: Failed web method "{0}" has now succeeded. Querying local storage for BB showings.',this.a5a),
this.r5a(a.xGb,!0),this.a5a=null);this.Acf(!1);this.r_b=!1};a.prototype.Vo=function(y,x){k.a.dh(x.errors,[-1387426400])&&!this.r_b&&(this.r_b=!0,this.VRf()&&window.performance.mark(a.cjf),(new d(this)).W9h())};a.prototype.Rh=function(){this.Acf(!0);this.r5a(a.wzb,!1);this.r5a(a.xGb,!1)};a.prototype.Acf=function(y){if(this.localStorage.te()){var x=this.localStorage.d1a(a.wXc);if(x&&"null"!==x){var z=-1;this.r_b&&(z=this.tyh(a.cjf,a.lni));m.ULS.sendTraceTag(573851745,0,50,"NetworkConnectionHealthChecker.LogPingResultsFromLocalStorage: Ping Results: {0}, Period offline: {1}, New session: {2}",
Sys.Serialization.JavaScriptSerializer.serialize(x),z,y);this.localStorage.removeItem(a.wXc)}}};a.prototype.tyh=function(y,x){if(!this.VRf())return-1;window.performance.measure(x,y);y=window.performance.getEntriesByName(x);return y.length&&y[y.length-1]?y[y.length-1].duration:(m.ULS.sendTraceTag(573851744,0,10,"NetworkConnectionHealthChecker.LogPingResultsFromLocalStorage: measure name {0} returned no measures.",x),-1)};a.prototype.r5a=function(y,x){try{var z=this.Vad(y);var J=z.rawData;var B=z.returnValue;
if(-1!==B){var C=Object.assign(new c,{timeElapsed:Date.now()-B,scenario:y,isNewSession:!x,rawData:J});m.ULS.sendTraceTag(573851743,0,50,"NetworkConnectionHealthChecker.LogNetworkIssueBBShown: {0}",JSON.stringify(C))}this.localStorage.removeItem(y)}catch(H){m.ULS.sendTraceTag(573851742,0,15,"NetworkConnectionHealthChecker.LogNetworkIssueBBShown: Failed to get item from local storage. reason: {0}",H.message||"Unknown")}};a.prototype.$wa=function(){m.ULS.sendTraceTag(573851741,0,50,"NetworkConnectionHealthChecker.OnNetworkResumed: Network resumed for session. Querying local storage for BB showings.");
this.r5a(a.wzb,!0)};a.prototype.VRf=function(){return u.HelperMethods.Qle&&r.a.SXb};a.wzb="NetworkDownBBShown";a.xGb="ServerCommunicationFailureBBShown";a.wXc="ConnectionHealthPingRsults";a.cjf="offMoStMa";a.lni="offMoDuMea";Object(D.a)(a,"NetworkConnectionHealthChecker",null,[7])}}]);

//# sourceMappingURL=EwaDS.pi.js.map
(window.dullscriptWebpackJsonp=window.dullscriptWebpackJsonp||[]).push([[15],{1056:function(D,F,b){function a(z){var J=this;this.$=z;(this.gm=this.$.ea.Ea(268,void 0))||c.ULS.shipAssertTag(34719498,0,!1,"CalcHelper constructor - IInstantaneousSupportInformationManager is not available");var B=v.EwaSettings.isChangeGateEnabled("OfficeVSO:5543503_loadCalcCurrentVersion")?w.a.current.En(55):w.a.current.En(58);this.logger=new u.a;this.documentLoc=excelOnlineCalc.location.documentLoc("",this.$.workbookContext.FullDocumentInfo.BreadcrumbDocName);
this.Zaa=new d(z,this.gm);excelOnlineCalc.config.initCalc(this.logger,this.gm?function(C){return J.gm.isFeatureEnabled(C)}:function(){return!1},B);this.sag=excelOnlineCalc.config.calcConfig(this.Zaa.localeInfo)}function d(z,J){z=b(1056).CalcHelper;J&&(J.Oe||c.ULS.shipAssertTag(34445250,0,!1,"LocaleHolder constructor - locale information is not available"));this.Dfg=z.sve(J,z.hve(J.Zha));this.Efg=excelOnlineCalc.calc.localeInfoFromData(this.localeData)}b.r(F);D=b(0);var c=b(15),m=b(371),r;(function(z){z[z.paren=
0]="paren";z[z.lead=1]="lead";z[z.intern=2]="intern";z[z.trail=3]="trail";z[z.undefined=4]="undefined"})(r||(r={}));Object(D.b)("CurrencyFormatOption",r);var t;(function(z){z[z.none=-1]="none";z[z.mdy=0]="mdy";z[z.dmy=1]="dmy";z[z.ymd=2]="ymd";z[z.myd=3]="myd";z[z.dym=4]="dym";z[z.ydm=5]="ydm"})(t||(t={}));Object(D.b)("DateOrderOption",t);var k=b(10);d.prototype.formatNumber=function(z){return this.localeInfo.formatNumber(z)};Jl.Object.defineProperties(d.prototype,{localeInfo:{configurable:!0,enumerable:!0,
get:function(){return this.Efg}},localeData:{configurable:!0,enumerable:!0,get:function(){return this.Dfg}}});Object(D.a)(d,"LocaleHolder",null,[]);var u=b(1006),w=b(48),v=b(1),A=b(7),y=b(16),x=b(186);b.d(F,"CalcHelper",function(){return a});a.prototype.tZg=function(){if(v.EwaSettings.isChangeGateEnabled("OfficeVSO:4986015_LetAutocompleteTelemetry")){if(!this.$.Aa)return c.ULS.shipAssertTag(562394562,0,!1,"CalcHelper.CurrentSheetIndex() - this.ewaControl.Sheets is null"),0;var z=this.$.Aa.sa;return z?
z.index:(c.ULS.shipAssertTag(562394561,0,!1,"CalcHelper.CurrentSheetIndex() - sheet is null"),0)}return this.$.Aa.sa.index};a.prototype.createParser=function(){var z={};z.config=this.config;return excelOnlineCalc.parse.createParser(z)};a.prototype.createNumberFormatter=function(){var z=excelOnlineCalc.numfmt.createFormatGlobals(this.config,function(){return excelOnlineCalc.util.failure(excelOnlineCalc.util.notImplemented(["getTime"]))});return excelOnlineCalc.numfmt.createNumberFormatter(z)};a.prototype.DXg=
function(z,J,B){J=excelOnlineCalc.location.gridCell(J,B);z=excelOnlineCalc.location.sheetIndex(this.documentLoc,z);return excelOnlineCalc.location.sheetGridCell(z,J)};a.prototype.Z9g=function(z,J){var B=excelOnlineCalc.calc.getEvalResultKind(z);switch(B){case 4:return{returnValue:z?this.Zaa.localeInfo.trueName:this.Zaa.localeInfo.falseName,kind:B};case 1:return{returnValue:v.EwaSettings.isChangeGateEnabled("OfficeVSO:3594728_SupportEvaluatingArrayOpersToString")?this.Tuc(this.Zaa.formatNumber(z),
J):this.Zaa.formatNumber(z),kind:B};case 2:return{returnValue:v.EwaSettings.isChangeGateEnabled("OfficeVSO:3594728_SupportEvaluatingArrayOpersToString")?this.Tuc(z.toString(),J):z.toString(),kind:B};case 128:return{returnValue:"",kind:B};case 8:switch(z.type){case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:return{returnValue:this.Zaa.localeInfo.errorNames[z.type],kind:B};default:return{returnValue:a.unknownError,kind:B}}case 32:return{returnValue:v.EwaSettings.isChangeGateEnabled("OfficeVSO:3594728_SupportEvaluatingArrayOpersToString")?
this.Tuc(this.VXg(z,J),J):"##UNSUPPORTED: ARRAY",kind:B};default:return{returnValue:y.a.instance.da(2110),kind:B}}};a.prototype.Tuc=function(z,J){return z.length<=J?z:z.substring(0,J-3)+"..."};a.prototype.VXg=function(z,J){for(var B=this.Zaa.localeInfo.leftBrace,C=0;C<z.rows;++C){for(var H=0;H<z.cols;++H)B+=z.opers[C][H],H<z.cols-1&&(B+=this.Zaa.localeInfo.columnSeparator);C<z.rows-1&&(B+=this.Zaa.localeInfo.rowSeparator)}return this.Tuc(B,J-1)+this.Zaa.localeInfo.rightBrace};a.sve=function(z,J){J=
void 0===J?null:J;var B=a.o0b(),C=z.Oe.TrueValueString,H=z.Oe.FalseValueString,W=z.Oe.DecimalSeparator.toString(),S=z.Oe.ListSeparator.toString(),N=z.Oe.ColumnSeparator.toString(),T=z.Oe.RowSeparator.toString(),fa=z.Oe.ThousandsDataArray,Y=z.Oe.ThousandSeparator.toString(),L=z.Oe.Lcid,P=z.Oe.Country,ea=z.Oe.DigitsNumber,X=z.Oe.ExpSeparatedBySpace,ja=z.Oe.FractionSeparator.toString(),R=z.Oe.PercentSeparatedBySpace,ba=A.a.nIg(Enum.toString(r,z.Oe.CurrencyFormat)),ha=z.Oe.CurrencySymbolLead,oa=z.Oe.CurrencySeparatedBySpace,
Sa=z.Oe.CurrencySymbolString,ma=z.Oe.DigitsCurrency,na=-1===z.Oe.DateOrder?"MDY":x.c(Enum.toString(t,z.Oe.DateOrder)),xa=z.Oe.DateSeparator.toString(),Oa=z.Oe.DateAlternativeSeparator.toString(),ib=z.Oe.Year4Digits,sb=z.Oe.Month2Digits,nb=z.Oe.Day2Digits,Gb=z.Oe.LongDateFormat,Ha=z.Oe.TimeSeparator.toString(),ca=null==z.Oe.TimeAltSeparator?null:z.Oe.TimeAltSeparator.toString(),Ra=z.Oe.Hour2Digits,ua=z.Oe.Use24HourClock,ta=z.Oe.AmPmSeparatedBySpace,db=[z.Oe.AmString,z.Oe.PmString],Ta=z.Oe.DayNameShortArray,
qb=z.Oe.DayNameLongArray,za=z.Oe.MonthNameShortArray,Ia=z.Oe.MonthNameLongArray,va=z.Oe.PictureSpecialArray,Ua=m.a.map(("\x00"+z.Oe.PictureSingleString).split(""),function(kc){return"\x00"===kc?null:kc}),Kb=z.Oe.PictureColorArray,ia=z.Oe.PictureDbnumArray,E=z.Oe.RowLetter.toString(),fb=z.Oe.ColumnLetter.toString(),Za=z.Oe.LeftBrace.toString(),ec=z.Oe.RightBrace.toString(),zc=z.Oe.LeftBracket.toString(),Ab=z.Oe.RightBracket.toString(),vb=a.gIh(z.Oe);return excelOnlineCalc.calc.localeData(J,B,C,H,E,
fb,Za,ec,zc,Ab,W,S,N,T,fa,Y,L,P,ea,X,ja,R,ba,ha,oa,Sa,ma,na,xa,Oa,ib,sb,nb,Gb,Ha,ca,Ra,ua,ta,db,Ta,qb,za,Ia,va,Ua,Kb,ia,vb,z.Oe.SysDateFormatString,z.Oe.SysTimeFormatString)};a.hve=function(z){var J=[];if(!z)return J;z=Ml(z);for(var B=z.next();!B.done;B=z.next()){B=B.value;var C=null;B.IsDynamicUdf||(C=excelOnlineCalc.calc.worksheetFunctionName(B.FunctionIndexInServer,B.NameUI));C&&Array.add(J,C)}return J};a.o0b=function(){for(var z=[],J=Object.keys(k.a.errorNames),B=0;B<J.length;B++){var C=excelOnlineCalc.calc.errorTypeName(B+
1,J[B]);C&&Array.add(z,C)}return z};a.gIh=function(z){var J=Array(6);J[1]="#"+z.AllStructRefString;J[3]="#"+z.HeadersStructRefString;J[2]="#"+z.DataStructRefString;J[4]="#"+z.TotalsStructRefString;J[5]="#"+z.ThisRowStructRefString;return J};Jl.Object.defineProperties(a.prototype,{config:{configurable:!0,enumerable:!0,get:function(){return this.sag}}});a.unknownError="##ERR##";Object(D.a)(a,"CalcHelper",null,[])},1116:function(D,F,b){function a(){}b.d(F,"a",function(){return a});D=b(0);a.uai="literal";
a.operator="operator";a.func="function";a.namedRange="namedRange";a.range="range";a.Haf="letName";a.all="*";a.qMd="structRefRange";Object(D.a)(a,"TraverseFormulaInterestTypes",null,[])},1117:function(D,F,b){function a(){}b.d(F,"a",function(){return a});D=b(0);a.cell="cell";a.range="range";a.row="row";a.column="col";Object(D.a)(a,"TraverseFormulaRefTypes",null,[])},1373:function(D,F,b){function a(wa){var Da=Wa.call(this)||this;Da.$=wa;Da.fc();return Da}function d(wa){var Da=Gc.call(this)||this;Da.$=
wa;Da.fc();return Da}function c(wa,Da){this.colors="rgba(95, 140, 237, {0});rgba(235, 94, 96, {0});rgba(141, 97, 194, {0});rgba(45, 150, 57, {0});rgba(191, 76, 145, {0});rgba(227, 130, 34, {0});rgba(55, 127, 158, {0})".split(";");this.gac=this.vXf=!1;this.Qc=wa;this.gridView=Ra.g(wa);this.calcManager=Da;this.c3h=nb.EwaSettings.isChangeGateEnabled("OfficeVSO:5041666_ImplementLogRecorderOnEwaJS");this.R5h=nb.EwaSettings.isChangeGateEnabled("OfficeVSO:5617699_FormulaSelectionFix");this.S5h=nb.EwaSettings.isChangeGateEnabled("OfficeVSO:5658633_IsSelectionUndoCrashFixEnabled");
this.Mjd=nb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.ExcelOnline.ArgumentAssistancePlugin",!1)&&nb.EwaSettings.isChangeGateEnabled("OfficeVSO:5623187_SelectSmartSuggestionsByDefault");this.gridView.Hc.mt(Object(X.a)(this,this.jAb,"onCellEditEnded"))}function m(wa,Da,Va,Jb){this.Eoj=wa;this.yYf=Da;this.Scc=void 0===Jb?!1:Jb;Va?(this.d4a=Va.IsRangeRef,this.Wua=Va.IsAbsoluteFirstRow,this.Vua=Va.IsAbsoluteFirstColumn,this.aKa=Va.IsAbsoluteSecondRow,this.$Ja=Va.IsAbsoluteSecondColumn):N.ULS.shipAssertTag(39856346,
0,!1,"MarqueeMetadata.Ctor: parseResultItem is null")}function r(wa){var Da=ic.call(this)||this;Da.$=wa;Da.fc();return Da}function t(wa){var Da=this;this.tl=null;this.A5f=!1;this.YDd=this.instantaneousSupportInformationManager=this.hNa=null;this.Cif={};this.Fif={};this.P4d=null;N.ULS.sendTraceTag(34936847,0,50,"Creating CalcManager");this.n3e=!1;this.wb=wa;this.jy=Ra.g(wa);this.cAc=null;this.gridView.Eq(Object(X.a)(this,this.onContentReady,"onContentReady"));this.gridView.Ha.bPc(Object(X.a)(this,
this.ekf,"onBlockPresent"));this.$.ea.ub(268,function(Va){Va.Oe?(N.ULS.sendTraceTag(576071815,0,50,"CalcManager.ctor: LocaleInformation already available..."),Da.Aic(Va,Sys.EventArgs.Empty)):(N.ULS.sendTraceTag(576071814,0,50,"CalcManager.ctor: waiting for LocaleInformation..."),Va.sfe(Object(X.a)(Da,Da.Aic,"onLocaleInformationAvailable")))})}function k(){}function u(){}function w(){this.$Ja=this.aKa=this.Vua=this.Wua=this.d4a=!1}function v(wa){this.Jzd=null;this.hnd=this.Izd=this.nBb=!1;this.Nxd=
0;this.Fxd=this.Hxd=this.Ixd=this.Gxd=-1;this.trueName="TRUE";this.falseName="FALSE";this.instantaneousSupportInformationManager=this.Qm=this.errorTypeNames=null;this.Fp=this.currentStateId=-1;this.Xra="";this.Q9=null;this.TUf=(this.Qc=wa)?wa.Ba.CalcWebWorkerSmokeTestPingIntervalMS:this.TUf;this.af=new ta.a;this.Gob=null;this.documentLoc=excelOnlineCalc.location.documentLoc("",this.Qc.workbookContext.FullDocumentInfo.BreadcrumbDocName);this.Yma()}function A(wa){this.sWd=null;this.init(wa)}function y(){}
function x(wa){this.nma=wa;this.a5=new za.a(Ia.a.Dl());this.Qgc=!1}function z(){this.pj=[];this.H1f=[];this.PXa={}}function J(wa,Da,Va,Jb,Hb){this.type=wa;this.fullName=Da;this.range=Va;this.sheetId=Jb;this.attributes=Hb;this.gG=null}function B(wa,Da){this.Xme=wa;this.sheetName=Da;this.Opc=!1}function C(wa){var Da=Ta.call(this)||this;Da.$=wa;Da.fc();return Da}function H(wa,Da){var Va=db.call(this)||this;Va.amd=R.a.Ve;Va.DTc=null;Va.numberFormattingCalculator=null;Va.mec=!1;Va.Ccb=!1;Va.Ibf=null;Va.Jbf=
null;N.ULS.sendTraceTag(35985034,0,50,"InstantaneousSupportInformationManager ctor start");Va.fa=wa;Va.$=Da;Va.PDb=null;Va.a$c=null;Va.AIa=null;Va.Pd=null;Va.ohc=new ta.a;Va.Srb=new ta.a;Va.hX=[];Va.cqh=new ta.a;Va.wMe={};Va.fa.ak(Object(X.a)(Va,Va.ed,"onSessionIdChanged"));Va.$.Nk(Object(X.a)(Va,Va.sd,"onWorkbookOpened"));Ra.g(Va.$).ga.mqa(Object(X.a)(Va,Va.njf,"onActiveCellChange"));nb.EwaSettings.ka(310)&&Va.fa.ot(Object(X.a)(Va,Va.hg,"onWorkbookMetadataChanged"));Va.QOa(H.y0e);N.ULS.sendTraceTag(35985035,
0,50,"InstantaneousSupportInformationManager ctor end");return Va}function W(wa){this.data=wa}function S(wa){var Da=na.call(this)||this;Da.oFj=wa;return Da}b.r(F);D=b(12);F=b(0);var N=b(15),T=b(211),fa=b(35),Y=b(48),L=b(86),P=b(5),ea=b(113),X=b(37),ja=b(210),R=b(10),ba=b(36),ha=b(1005),oa=b(214),Sa=b(1006),ma=b(81),na=Sys.EventArgs;Cm(S,na);Object(F.a)(S,"NumberFormatsUpdatedEventArgs",Sys.EventArgs,[]);var xa=b(44),Oa=b(42),ib=b(32),sb=b(27),nb=b(1),Gb=b(649),Ha=b(7),ca=b(273),Ra=b(20),ua=b(199);
Object(F.a)(W,"NumberFormatDataHolder",null,[]);var ta=b(125),db=ba.a;Cm(H,db);H.prototype.sfe=function(wa){this.addHandler(H.Mrd,wa)};H.prototype.iCd=function(wa){this.removeHandler(H.Mrd,wa)};H.prototype.wrg=function(wa){this.addHandler(H.IUc,wa)};H.prototype.aTi=function(wa){this.removeHandler(H.IUc,wa)};H.prototype.Yee=function(wa){this.addHandler(H.n7c,wa)};H.prototype.ZBd=function(wa){this.removeHandler(H.n7c,wa)};H.prototype.atg=function(wa){this.addHandler(H.Gbf,wa)};H.prototype.Zuc=function(wa,
Da){var Va=this.ohc.Ec(wa,0);var Jb=Va.value;Va=Va.returnValue;!Va&&0<wa&&this.$&&(N.ULS.sendTraceTag(40468576,0,50,"InstantaneousSupportInformationManager.TryGetNumberFormatCategory: failed to get category from numberFormatIndexToCategoryCache {0}",wa),this.hvh(wa),Da&&(Jb=this.gvh(wa),Va=!0),Gb.a(wa,this.$.uF)&&(Jb=6));return{returnValue:Va,category:Jb}};H.prototype.M1h=function(wa){var Da=this.Zuc(wa,!0);var Va=Da.category;if(Da.returnValue)return 6===Va;N.ULS.sendTraceTag(23156486,0,50,"InstantaneousSupportInformationManager.IsFormatInPercentageCategory: failed to get category from format index {0}",
wa);return!1};H.prototype.Foh=function(wa){N.ULS.sendTraceTag(37855392,0,50,"InstantaneousSupportInformationManager.ForceRefreshFunctionInfo: Forcing refresh of functions");this.AIa=ma.w(this.$.ra.xa,{FilterType:0},ca.b(Object(X.a)(this,this.drf,"onRefreshFunctionListSuccess"),wa),Object(X.a)(this,this.snf,"onGetFunctionListFailed"),null,null,null)};H.prototype.TLe=function(){this.QOa(H.y0e)};H.prototype.njf=function(){var wa=Ra.g(this.$);wa&&(wa=wa.Cc(null))&&this.Zuc(wa.cell.numberFormatIndex,!0)};
H.prototype.trd=function(wa){this.DTc=wa};H.prototype.hvh=function(wa){if(this.Srb&&this.$){var Da=this.Srb.Ec(wa);var Va=Da.value;if(!Da.returnValue||Va.isCompleted){N.ULS.sendTraceTag(24417758,0,50,"Getting number format category for format index: {0}",wa);Va=this.$.ra.xa;Da=Object(X.a)(this,this.psi,"onGetCategoryFromServerSuccess");var Jb=Va.Ra(1,null);Jb.ifmt=wa;(Va=ma.i(Va,"GetNumberFormatCategory",Jb,Da,null,null,null,4))&&this.Srb.ja(wa,Va)}}else N.ULS.sendTraceTag(25747617,0,15,"GetCategoryFromServerAsync called on disposed InstantaneousSupportInformationManager instance, skipping")};
H.prototype.gvh=function(wa){return 1<=wa&&8>=wa?1:9<=wa&&12>=wa?2:13===wa||14===wa?6:15===wa?8:17===wa|18===wa?7:19===wa?4:16===wa||20<=wa&&29>=wa||31===wa?11:30===wa?9:32<=wa&&35>=wa?3:0};H.prototype.isActive=function(){var wa=void 0===this.fa||null===this.fa,Da=!wa&&this.fa.pc;N.ULS.sendTraceTag(36227294,0,50,"InstantaneousSupportInformationManager.IsActive: instantaneous support information manager active:{0} - sessionStateManager IsNullOrUndefined: {1}",Da,wa);return Da};H.prototype.psi=function(wa){this.isActive()&&
(sb.a.Fq(wa.Errors)||!wa.Result?N.ULS.sendTraceTag(24417759,0,50,"GetCategoryFromServer failed, ignoring - server errors: {0}",wa.Errors?wa.Errors.join(","):"None"):(wa=wa.Result,N.ULS.sendTraceTag(24417760,0,50,"Updating number format category cache, format index = {0}, category = {1}",wa.Index,wa.Category),this.G8i(wa.Index,wa.Category),this.raiseEvent(H.IUc,new ha.a(wa.Index,wa.Category),this)))};H.prototype.G8i=function(wa,Da){this.ohc.ja(wa,Da)};H.prototype.dispose=function(){L.a.Ia(this.PDb);
this.PDb=null;this.GYb();for(var wa=Ml(this.Srb),Da=wa.next();!Da.done;Da=wa.next())(Da=Da.value.value)&&!Da.isCompleted&&P.AFrameworkApplication.Md.gv(Da.ou);this.Srb=null;this.fa&&(this.fa.xk(Object(X.a)(this,this.ed,"onSessionIdChanged")),this.Ccb&&this.fa.VC(Object(X.a)(this,this.PM,"onLatestStateIdChanged")),this.Ccb=!1,this.fa.ow(Object(X.a)(this,this.hg,"onWorkbookMetadataChanged")));this.fa=null;this.$&&Ra.g(this.$)&&Ra.g(this.$).ga&&(Ra.g(this.$).ga.gya(Object(X.a)(this,this.njf,"onActiveCellChange")),
this.$.nl(Object(X.a)(this,this.sd,"onWorkbookOpened")));this.$=null;db.prototype.dispose.call(this)};H.prototype.isFeatureEnabled=function(wa){try{switch(wa){case "LocaleLongDateFormat":return nb.EwaSettings.ka(199);case "GetLocaleDayNames":return nb.EwaSettings.ka(200);case "CalculateTextWidthIgnoreLetterSpacing":return nb.EwaSettings.ka(290);case "OfficeVSO:3657744_CalcFixForDateFormat":return nb.EwaSettings.isChangeGateEnabled("OfficeVSO:3657744_CalcFixForDateFormat");case "OfficeVSO:3858161_ClientSideEstimationForDateWithTheYearZero":return nb.EwaSettings.isChangeGateEnabled("OfficeVSO:3858161_ClientSideEstimationForDateWithTheYearZero");
case "CalcAutocompleteExperiment":return nb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CalcTSAutocompleteExperimentIsEnabled",!1);case "CalcNewFunctions":return nb.EwaSettings.ka(251);case "CalcContractChecks":return nb.EwaSettings.ka(252);case "CalcSupportDynamicArrays":return nb.EwaSettings.ka(253);case "CalcFormatCalculations":return nb.EwaSettings.ka(254);case "CalcFormulaCacheAPIChanges":return nb.EwaSettings.ka(255);case "CalcStrictFormulaChecking":return nb.EwaSettings.ka(256);
case "CalcSupportRowReference":return nb.EwaSettings.ka(267);case "CalcParserUsesPledges":return nb.EwaSettings.ka(315);case "CalcWebWorker":return!0;case "CalcWebWorkerTest":return nb.EwaSettings.ka(314);case "CalcLookupFunctions":return nb.EwaSettings.ka(316);case "CalcLogStopWatch":return nb.EwaSettings.ka(386);case "CalcPreventSpillingHack":return nb.EwaSettings.ka(257);case "CalcDynamicArrayOperators":return nb.EwaSettings.ka(104);case "CalcDotOperator":return nb.EwaSettings.ka(622);case "CalcLetFunction":return nb.EwaSettings.ka(756);
default:return wa.startsWith("OfficeVSO:")?nb.EwaSettings.isChangeGateEnabled(wa):!1}}catch(Da){return N.ULS.sendTraceTag(22374148,0,15,"InstantaneousSupportInformation.IsFeatureEnabled({0}): feature parsing failed, returning false. Exception: {1}.",wa,Da.toString()),!1}};H.prototype.QOa=function(wa){this.isActive()&&this.fa.mc.allowEdits?(L.a.Ia(this.PDb),this.PDb=null,this.PDb=xa.a.instance.create(Object(X.a)(this,this.refresh,"refresh"),wa,Oa.a.JXh)):N.ULS.sendTraceTag(36227295,0,50,"InstantaneousSupportInformationManager.ScheduleRefresh: won't schedule refresh. Edit permission: AllowEdits {0}, IsEditMode {1}",
void 0!==this.fa&&null!==this.fa&&void 0!==this.fa.mc&&null!==this.fa.mc?this.fa.mc.allowEdits:!1,void 0!==this.fa&&null!==this.fa?this.$.fa.isEditMode:!1)};H.prototype.refresh=function(){N.ULS.sendTraceTag(36227296,0,50,"InstantaneousSupportInformationManager.Refresh: start refresh");this.GYb();if(this.isActive()&&this.fa.mc.allowEdits){if(this.Ccb||this.Pd&&!(this.fa.xec>this.amd))this.jxc();else{N.ULS.sendTraceTag(34719488,0,50,"InstantaneousSupportInformationManager.Refresh: getting instantaneous support information.");
var wa=this.$.ra.xa,Da=this.Pd?this.Pd.Digest:"",Va=Object(X.a)(this,this.Tsi,"onGetInstantaneousSupportInformationSuccess"),Jb=Object(X.a)(this,this.Ssi,"onGetInstantaneousSupportInformationFailure"),Hb=wa.Ra(1,null);Hb.previousResponseDigest=Da;this.a$c=ma.i(wa,"GetInstantaneousSupportInformation",Hb,Va,Jb,null,null,132)}N.ULS.sendTraceTag(34719489,0,50,"InstantaneousSupportInformationManager.Refresh: getting functions info.");this.JQe()}};H.prototype.JQe=function(){N.ULS.sendTraceTag(34719490,
0,50,"InstantaneousSupportInformationManager.GetFunctionsInfoAsync called.");this.AIa?N.ULS.sendTraceTag(34719491,0,50,"InstantaneousSupportInformationManager.GetFunctionsInfoAsync already running, skipping."):this.isActive()?this.hX&&this.hX.length||(this.AIa=ma.w(this.$.ra.xa,{FilterType:0},Object(X.a)(this,this.Nsi,"onGetFunctionListSuccess"),Object(X.a)(this,this.snf,"onGetFunctionListFailed"),null,null,null)):N.ULS.sendTraceTag(37089857,0,50,"InstantaneousSupportInformationManager.GetFunctionsInfoAsync session is not yet active, skipping.")};
H.prototype.snf=function(wa){N.ULS.sendTraceTag(34719492,0,50,"InstantaneousSupportInformationManager.OnGetFunctionListFailed failed, status = {0}, HTTP status = {1}.",wa.data.status,wa.data.httpStatus);this.AIa=null};H.prototype.PM=function(){this.Ccb=!1;this.fa.VC(Object(X.a)(this,this.PM,"onLatestStateIdChanged"));this.QOa(this.mec?H.ZId:H.ird)};H.prototype.ed=function(wa,Da){N.ULS.sendTraceTag(37492506,0,50,"InstantaneousSupportInformationManager.OnSessionIdChanged called");oa.a(Da)&&this.QOa(H.ZId)};
H.prototype.hg=function(){N.ULS.sendTraceTag(40703904,0,50,"InstantaneousSupportInformationManager.OnWorkbookMetadataChanged called");3!==this.$.workbookContext.CalcMode&&this.trd(!this.$.workbookContext.CalcMode)};H.prototype.sd=function(){N.ULS.sendTraceTag(37492507,0,50,"InstantaneousSupportInformationManager.OnWorkbookOpened called");this.QOa(H.ZId);nb.EwaSettings.ka(310)&&3!==this.$.workbookContext.CalcMode&&this.trd(!this.$.workbookContext.CalcMode)};H.prototype.Nsi=function(wa,Da,Va){N.ULS.sendTraceTag(34719493,
0,50,"InstantaneousSupportInformationManager.OnGetFunctionListSuccess called.");this.AIa=null;this.isActive()?wa.StateId===R.a.Ve?(N.ULS.sendTraceTag(34719495,0,50,"InstantaneousSupportInformationManager.OnGetFunctionListSuccess: no session, waiting for session."),this.jxc()):!wa.Result||this.hX&&this.hX.length?this.QOa(H.ird):this.drf(wa,Da,Va):N.ULS.sendTraceTag(34719494,0,50,"InstantaneousSupportInformationManager.OnGetFunctionListSuccess: manager is inactive, skipping.")};H.prototype.drf=function(wa){this.hX=
wa.Result;N.ULS.sendTraceTag(34719496,0,50,"InstantaneousSupportInformationManager.OnGetFunctionListSuccess refreshing functions info list, returned {0} functions.",this.hX?this.hX.length:-1);wa=!1;if(this.hX){for(var Da=Ml(this.hX),Va=Da.next();!Va.done;Va=Da.next())if(Va=Va.value)this.wMe[Va.NameUI.toLocaleUpperCase()]=Va.FunctionIndex.toString(),Va.NameUI!==Va.NameDataStrings&&(this.wMe[Va.NameDataStrings.toLocaleUpperCase()]=Va.FunctionIndex.toString(),wa=!0),this.cqh.ja(Va.FunctionIndex,Va.NameUI);
this.raiseEvent(H.n7c,Sys.EventArgs.Empty,this)}wa&&N.ULS.sendTraceTag(36569610,0,50,"InstantaneousSupportInformationManager.OnGetFunctionListSuccess NameDataStrings functions names were used.")};H.prototype.Tsi=function(wa){if(this.isActive())if(N.ULS.shipAssertTag(21311552,0,!!this.$,"null ewaControl"),this.mec=!1,this.amd=wa.StateId,this.amd===R.a.Ve)this.mec=!0,this.jxc();else{if(wa.Result){var Da=this.Pd;this.Pd=wa.Result;N.ULS.sendTraceTag(21311553,0,50,"InstantaneousSupportInformation updated, new result digest: {0}.",
this.Pd.Digest);wa=[];if(Da)wa=H.YCh(Da.NumberFormats,this.Pd.NumberFormats);else for(Da=0;Da<this.Pd.NumberFormats.length;Da++)this.ohc.ja(Da,this.Pd.NumberFormats[Da].NumberFormatCategory);Da=Ml(wa);for(var Va=Da.next();!Va.done;Va=Da.next())Va=Va.value,this.ohc.ja(Va,this.Pd.NumberFormats[Va].NumberFormatCategory);this.Ovj(wa);this.raiseEvent(H.Mrd,new S(wa),this);nb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.StructuredReferencesInRangePicker",!1)&&this.raiseEvent(H.Gbf)}this.QOa(H.ird)}};
H.prototype.jxc=function(){this.Ccb||(this.Ccb=!0,this.fa.BD(Object(X.a)(this,this.PM,"onLatestStateIdChanged")))};H.prototype.Ssi=function(wa){this.isActive()&&(10===wa.data.status?N.ULS.sendTraceTag(21311554,0,50,"Instantaneous support information request cancelled."):(N.ULS.sendTraceTag(21311555,0,10,"Failed to update instantaneous support information, status = {0}, HTTP status = {1}.",wa.data.status,wa.data.httpStatus),this.mec=!0,this.jxc()))};H.prototype.GYb=function(){this.gv(this.a$c);this.gv(this.AIa);
this.AIa=this.a$c=null};H.prototype.gv=function(wa){wa&&!wa.isCompleted&&this.$.ra.xa.Jbb(wa.ou)};H.prototype.Ovj=function(wa){var Da=this;if(this.numberFormattingCalculator)0<wa.length&&(N.ULS.sendTraceTag(22374147,0,50,"InstantaneousSupportInformation: Updating number formatting calculator formats. IFMTs to update: {0}",wa.toString()),Jb=this.Eve(wa),this.numberFormattingCalculator.updateFormats(Jb,!0));else{N.ULS.sendTraceTag(22374146,0,50,"InstantaneousSupportInformation: Creating number formatting calculator");
wa=this.cVg();var Va=this.Eve(null);try{var Jb=new Sa.a;this.numberFormattingCalculator=numFmtCalc.initializeNumberFormatingCalculator(Jb,wa,Va,function(Hb){return Da.isFeatureEnabled(Hb)},this.$)}catch(Hb){N.ULS.sendTraceTag(24379932,0,10,"NumberFormattingCalculator creation failed, exception = {0}. Stack error = {1}",Hb,Hb.stack)}}};H.prototype.Eve=function(wa){var Da=this.Pd.NumberFormats.length,Va=null;if(wa){Da=wa.length;Va=new ta.a;wa=Ml(wa);for(var Jb=wa.next();!Jb.done;Jb=wa.next())Jb=Jb.value,
Va.ja(Jb,Jb)}Da=Array(Da);this.Ibf=this.dVg();this.Jbf=this.eVg();wa=0;Jb=Ml(this.Pd.NumberFormats);for(var Hb=Jb.next();!Hb.done;Hb=Jb.next())if(Hb=Hb.value,!Va||Va.tb(Hb.IfmtIndex)){var Mb={};Mb.index=Hb.IfmtIndex;Mb.formatString=" "+this.jIg(Hb.FormatString);Mb.isPredefined=Hb.Builtin;Da[wa]=Mb;++wa}return Da};H.prototype.jIg=function(wa){var Da=this.u0h(wa),Va=Da?this.Ibf:this.Jbf;if(ea.a.isEmpty(Va))return wa;for(var Jb=new Sys.StringBuilder,Hb=!1,Mb=0;Mb<wa.length;Mb++){var Ub=!1,pb=wa.charAt(Mb).toString();
Ha.a.equals(pb,'"',!1)?Hb=!Hb:Ub=pb in Va;var gb=Da||H.Dej(wa,Mb);Jb.append(Ub&&!Hb&&gb?Va[pb]:pb)}return Jb.toString()};H.prototype.eVg=function(){var wa={};H.aEa(wa,this.Pd.LocaleInformation.ThousandSeparator.toString(),",");H.aEa(wa,this.Pd.LocaleInformation.DecimalSeparator.toString(),".");return wa};H.prototype.dVg=function(){var wa={};void 0!==this.Pd.LocaleInformation.DayIndicator&&null!==this.Pd.LocaleInformation.DayIndicator&&void 0!==this.Pd.LocaleInformation.MonthIndicator&&null!==this.Pd.LocaleInformation.MonthIndicator&&
void 0!==this.Pd.LocaleInformation.YearIndicator&&null!==this.Pd.LocaleInformation.YearIndicator&&(H.aEa(wa,this.Pd.LocaleInformation.DayIndicator.toString(),"d"),H.aEa(wa,this.Pd.LocaleInformation.MonthIndicator.toString(),"m"),H.aEa(wa,this.Pd.LocaleInformation.YearIndicator.toString(),"y"));H.aEa(wa,this.Pd.LocaleInformation.DateAlternativeSeparator.toString(),"-");H.aEa(wa,this.Pd.LocaleInformation.DateSeparator.toString(),"/");return wa};H.prototype.u0h=function(wa){return-1<wa.indexOf(this.Pd.LocaleInformation.DayIndicator)||
-1<wa.indexOf(this.Pd.LocaleInformation.MonthIndicator)||-1<wa.indexOf(this.Pd.LocaleInformation.YearIndicator)};H.prototype.cVg=function(){var wa={};wa.lcid=this.Pd.LocaleInformation.Lcid;wa.amAlternativeString=this.Pd.LocaleInformation.AmAltString;wa.amPmSeparatedBySpace=this.Pd.LocaleInformation.AmPmSeparatedBySpace;wa.amString=this.Pd.LocaleInformation.AmString;wa.currencyAlternativeString="";wa.currencyFormat=this.Pd.LocaleInformation.CurrencyFormat;wa.currencySeparatedBySpace=this.Pd.LocaleInformation.CurrencySeparatedBySpace;
wa.currencyString="";wa.dateAlternativeSeparator=this.Pd.LocaleInformation.DateAlternativeSeparator.toString();wa.dateOrder=this.Pd.LocaleInformation.DateOrder;wa.dateSeparator=this.Pd.LocaleInformation.DateSeparator.toString();wa.decimalSeparator=this.Pd.LocaleInformation.DecimalSeparator.toString();wa.digitsCurrency=this.Pd.LocaleInformation.DigitsCurrency;wa.digitsNumber=this.Pd.LocaleInformation.DigitsNumber;wa.expSeparatedBySpace=this.Pd.LocaleInformation.ExpSeparatedBySpace;wa.fractionSeparator=
this.Pd.LocaleInformation.FractionSeparator.toString();wa.hour2Digits=this.Pd.LocaleInformation.Hour2Digits;wa.longDateFormat=this.Pd.LocaleInformation.LongDateFormat;wa.month2Digits=this.Pd.LocaleInformation.Month2Digits;wa.percentSeparatedBySpace=this.Pd.LocaleInformation.PercentSeparatedBySpace;wa.pmString=this.Pd.LocaleInformation.PmString;wa.pmAlternativeString=this.Pd.LocaleInformation.PmAltString;wa.thousandSeparator=this.Pd.LocaleInformation.ThousandSeparator.toString();wa.timeSeparator=this.Pd.LocaleInformation.TimeSeparator.toString();
wa.use24HourClock=this.Pd.LocaleInformation.Use24HourClock;wa.year4Digits=this.Pd.LocaleInformation.Year4Digits;wa.listSeparator=this.Pd.LocaleInformation.ListSeparator.toString();wa.columnSeparator=this.Pd.LocaleInformation.ColumnSeparator.toString();wa.rowSeparator=this.Pd.LocaleInformation.RowSeparator.toString();wa.trueValueString=this.Pd.LocaleInformation.TrueValueString;wa.falseValueString=this.Pd.LocaleInformation.FalseValueString;wa.allStructRefString=this.Pd.LocaleInformation.AllStructRefString;
wa.headersStructRefString=this.Pd.LocaleInformation.HeadersStructRefString;wa.dataStructRefString=this.Pd.LocaleInformation.DataStructRefString;wa.totalsStructRefString=this.Pd.LocaleInformation.TotalsStructRefString;wa.thisRowStructRefString=this.Pd.LocaleInformation.ThisRowStructRefString;var Da=!(void 0===this.Pd.LocaleInformation.DayIndicator||null===this.Pd.LocaleInformation.DayIndicator),Va=!(void 0===this.Pd.LocaleInformation.MonthIndicator||null===this.Pd.LocaleInformation.MonthIndicator),
Jb=!(void 0===this.Pd.LocaleInformation.YearIndicator||null===this.Pd.LocaleInformation.YearIndicator);Da&&Va&&Jb?(wa.dayIndicator=this.Pd.LocaleInformation.DayIndicator.toString(),wa.monthIndicator=this.Pd.LocaleInformation.MonthIndicator.toString(),wa.yearIndicator=this.Pd.LocaleInformation.YearIndicator.toString()):N.ULS.sendTraceTag(34349726,0,15,"Date indicators not initialized: DayIndicator is {0}, MonthIndicator is {1}, YearIndicator is {2}",Da?"not null":"null",Va?"not null":"null",Jb?"not null":
"null");return wa};H.YCh=function(wa,Da){if(!wa||!wa.length)return[];if(!Da||!Da.length){Da=Array(wa.length);for(var Va=0;Va<wa.length;++Va)Da[Va]=wa[Va].IfmtIndex;return Da}var Jb=new ta.a;wa=Ml(wa);for(Va=wa.next();!Va.done;Va=wa.next())Va=Va.value,Jb.ja(Va.IfmtIndex,new W(Va));wa=new ja.a;Va={};Da=Ml(Da);for(var Hb=Da.next();!Hb.done;Va={$cb:Va.$cb,WLb:Va.WLb},Hb=Da.next())Va.$cb=Hb.value,Va.WLb=void 0,function(Mb){return function(){var Ub=Jb.Ec(Mb.$cb.IfmtIndex);Mb.WLb=Ub.value;return Ub}}(Va)().returnValue&&
Va.WLb.data.FormatString===Va.$cb.FormatString||wa.add(Va.$cb.IfmtIndex);return wa.toArray()};H.Dej=function(wa,Da){if(!Da||Da===wa.length-1)return!1;var Va=wa.charAt(Da-1);wa=wa.charAt(Da+1);return"#"!==Va&&"0"!==Va&&"?"!==Va||"#"!==wa&&"0"!==wa&&"?"!==wa?!1:!0};H.aEa=function(wa,Da,Va){Ha.a.equals(Da,Va,!1)||(wa[Da]=Va)};Jl.Object.defineProperties(H.prototype,{Oe:{configurable:!0,enumerable:!0,get:function(){return this.Pd?this.Pd.LocaleInformation:null}},lba:{configurable:!0,enumerable:!0,get:function(){return this.Pd?
this.Pd.NumberFormats:[]}},Zha:{configurable:!0,enumerable:!0,get:function(){this.hX&&this.hX.length||this.JQe();return this.hX}},calculator:{configurable:!0,enumerable:!0,get:function(){return this.numberFormattingCalculator}},FXh:{configurable:!0,enumerable:!0,get:function(){return this.Pd&&void 0!==this.Pd.InstantaneousCalcWebWorkerPrecisionSamplingRate&&null!==this.Pd.InstantaneousCalcWebWorkerPrecisionSamplingRate?this.Pd.InstantaneousCalcWebWorkerPrecisionSamplingRate:H.a0g}},IXh:{configurable:!0,
enumerable:!0,get:function(){return this.Pd&&void 0!==this.Pd.InstantaneousCalcWebWorkerSampleWorkbookStatisticsRate&&null!==this.Pd.InstantaneousCalcWebWorkerSampleWorkbookStatisticsRate?this.Pd.InstantaneousCalcWebWorkerSampleWorkbookStatisticsRate:H.e0g}},HXh:{configurable:!0,enumerable:!0,get:function(){return this.Pd&&void 0!==this.Pd.InstantaneousCalcWebWorkerSampleRecalcStatisticsRate&&null!==this.Pd.InstantaneousCalcWebWorkerSampleRecalcStatisticsRate?this.Pd.InstantaneousCalcWebWorkerSampleRecalcStatisticsRate:
H.d0g}},GXh:{configurable:!0,enumerable:!0,get:function(){return this.Pd&&void 0!==this.Pd.InstantaneousCalcWebWorkerSamplePrecisionPrintFormulaRate&&null!==this.Pd.InstantaneousCalcWebWorkerSamplePrecisionPrintFormulaRate?this.Pd.InstantaneousCalcWebWorkerSamplePrecisionPrintFormulaRate:H.c0g}},b2e:{configurable:!0,enumerable:!0,get:function(){return this.Pd?this.Pd.InstantaneousCalcWebWorkerRenderingTimeLimitInMs:H.b0g}},Dfd:{configurable:!0,enumerable:!0,get:function(){return null!==this.DTc?this.DTc:
this.Pd?this.Pd.InstantaneousCalcManualMode:!1}}});H.Mrd="isim0";H.IUc="isim1";H.n7c="isim2";H.Gbf="isim3";H.y0e=100;H.ZId=1E3;H.ird=3E5;H.a0g=.001;H.e0g=.1;H.d0g=.2;H.c0g=.001;H.b0g=50;Object(F.a)(H,"InstantaneousSupportInformationManager",ba.a,[674,7]);var Ta=T.a;Cm(C,Ta);C.prototype.create=function(){var wa=this;this.$&&(N.ULS.sendTraceTag(35985040,0,50,"InstantaneousSupportInformationManagerFactory.Create: Start loading script"),fa.TaskExtensions.Da(Y.a.loadScript(47,4,this.vb,void 0,void 0,246),
function(){wa.Jb(wa.$.ea.Ea(268,void 0)||new H(wa.$.fa,wa.$))},this.ma,3))};C.la=function(wa){if(!wa)throw Error.argumentNull("ewaControl");wa.ea.La(246,new C(wa))};Object(F.a)(C,"InstantaneousSupportInformationManagerFactory",T.a,[]);var qb=b(82);Object(F.a)(B,"CalcBlockInformation",null,[]);Object(F.a)(J,"CalcNamedObject",null,[]);Object(F.a)(z,"GridCache",null,[]);var za=b(797),Ia=b(786);Object(F.a)(x,"SheetInformation",null,[]);var va=b(1056),Ua;(function(wa){wa[wa.initialization=0]="initialization";
wa[wa.contentReady=1]="contentReady";wa[wa.cellEdit=2]="cellEdit"})(Ua||(Ua={}));Object(F.b)("UpdateDataTrigger",Ua);var Kb=b(63);y.local="Local";y.Soj="Thread";Object(F.a)(y,"RecalcServiceCreateMode",null,[]);var ia=b(46),E=b(43),fb=b(154);A.prototype.init=function(wa){this.sWd=new ta.a;if(void 0!==wa&&null!==wa&&void 0!==wa.HeadersList&&null!==wa.HeadersList&&0<wa.HeadersList.length){wa=Ml(wa.HeadersList);for(var Da=wa.next();!Da.done;Da=wa.next())Da=Da.value,this.s9.ja(Da.Index,Da.Name)}};Jl.Object.defineProperties(A.prototype,
{s9:{configurable:!0,enumerable:!0,get:function(){return this.sWd}}});Object(F.a)(A,"ColHeadersListData",null,[]);var Za=b(95);b(186);var ec=b(333);v.prototype.dispose=function(){this.instantaneousSupportInformationManager&&this.instantaneousSupportInformationManager.iCd(Object(X.a)(this,this.Qpf,"onNumberFormatsUpdated"));this.Qc&&this.Qc.nl(Object(X.a)(this,this.sd,"onWorkbookOpened"));this.close()};v.prototype.Xbb=function(wa){if(!this.Qm)return!1;if(!this.instantaneousSupportInformationManager&&
(this.instantaneousSupportInformationManager=this.Qc.ea.Ea(268,void 0),!this.instantaneousSupportInformationManager))return N.ULS.sendTraceTag(42812304,0,50,"CalcAsyncEngine.UpdateData Failed to get instantaneousSupportInformationManager"),!1;2!==wa&&(this.currentStateId=this.Qc.fa.xec,this.currentStateId===R.a.Ve&&(this.currentStateId=this.Qc.fa.zf));if(1===wa&&this.currentStateId<this.Fp)return N.ULS.sendTraceTag(591680646,0,50,"CalcAsyncEngine::UpdateData() currentStateId:{0} < lastUpdatedStateId:{1} - ignoring update",
this.currentStateId,this.Fp),!1;this.I6i();wa&&this.Izd||(this.V$i(),this.c8i(),this.L8i(),this.setNumberFormats(),this.instantaneousSupportInformationManager.sfe(Object(X.a)(this,this.Qpf,"onNumberFormatsUpdated")),this.Qc.Nk(Object(X.a)(this,this.sd,"onWorkbookOpened")),this.Izd=!0);this.mOi();var Da=!1;wa||(Da=this.BVh());if(wa||Da)this.g$i()?(this.K$i(wa),this.J$i(),this.Fp=this.currentStateId,this.NKg()):N.ULS.sendTraceTag(595072545,0,15,"CalcAsyncEngine::UpdateData() for StateId:{0} failed - no Sheets information",
this.currentStateId);2!==wa&&this.resumeRecalc();return!0};v.prototype.evalFormula=function(wa){if(!this.Qm)return N.ULS.sendTraceTag(590956100,0,15,"CalcAsyncEngine.EvalFormula: recalc engine is null"),Promise.resolve({});wa=this.Qm.evalFormula(this.Qc.fa.zf,wa,Kb.d(this.Qc.Aa.sa));this.resumeRecalc();return wa};v.prototype.evalFormulaRange=function(wa,Da,Va){if(!this.Qm)return N.ULS.sendTraceTag(540389441,0,15,"CalcAsyncEngine.EvalFormulaRange: recalc engine is null"),Promise.reject(null);N.ULS.shipAssertTag(540389440,
0,Da.isSingle,"CalcAsyncEngine.EvalFormulaRange: originCell Range must be a single cell.");Va=ia.j(Va);Da=ia.o(Da,this.Qc);Da=excelOnlineCalc.calc.cellLocation(Da.FirstRow,Da.FirstColumn);Va=v.uT("EvalFormulaRange",Kb.d(this.Qc.Aa.sa),Va.FirstRow,Va.FirstColumn,Va.LastRow,Va.LastColumn);N.ULS.sendTraceTag(540389409,0,50,"CalcAsyncEngine.EvalFormulaRange: calling calc.ts's EvalFormulaRange API for state ID {0}",this.Fp);wa=this.Qm.evalFormulaRange(this.Fp,wa,Da,Va,null);wa.then(function(Jb){if(excelOnlineCalc.util.isSuccess(Jb)){var Hb=
[];Jb=Ml(Jb.value);for(var Mb=Jb.next();!Mb.done;Mb=Jb.next())Mb=Mb.value,excelOnlineCalc.util.isSuccess(Mb.value)||(Mb=Mb.value.reason.kind.toString(),Array.contains(Hb,Mb)||Hb.push(Mb));N.ULS.sendTraceTag(540389410,0,50,"CalcAsyncEngine.EvalFormulaRange - Evaluation of range complete. FailureReasons: {0}",Hb.length?Sys.Serialization.JavaScriptSerializer.serialize(Hb):"None")}else N.ULS.sendTraceTag(540389411,0,15,"CalcAsyncEngine.EvalFormulaRange: Calc.EvalFormulaRange returned a failed object. failure reason: {0}",
Jb.reason.kind)}).catch(function(Jb){N.ULS.sendTraceTag(540389408,0,10,"CalcAsyncEngine.EvalFormulaRange - promise rejected: {0}",Sys.Serialization.JavaScriptSerializer.serialize(Jb));return Promise.reject(Jb)});this.resumeRecalc();return wa};v.prototype.HGg=function(wa,Da,Va,Jb){Jb=void 0===Jb?null:Jb;if(this.Qm&&wa){var Hb=Kb.d(this.Qc.Aa.sa),Mb=wa.cell.DJ-1,Ub=wa.cell.QG-1,pb=Mb,gb=Ub,Qa=null;Jb&&(Qa=excelOnlineCalc.calc.cellLocation(Mb,Ub),Mb=Jb.top-1,Ub=Jb.left-1,pb=Jb.bottom-1,gb=Jb.right-1);
if(wa.cell.Sv)if(Jb=wa.cell.Sv.zSc,Jb===R.a.Ve)N.ULS.sendTraceTag(593503619,0,15,"CalcAsyncEngine::CalculateFormula() BlockRevision unknown for block:{0}",wa.cell.Sv.Od);else if(Jb<this.Fp)N.ULS.sendTraceTag(593503617,0,50,"CalcAsyncEngine::CalculateFormula() Can't calc edit in cell:({0},{1}) - blockRevision:{2} < lastUpdatedStateId:{3}",Mb,Ub,Jb,this.Fp);else if(Jb<this.currentStateId)N.ULS.sendTraceTag(591680645,0,50,"CalcAsyncEngine::CalculateFormula() Can't calc edit in cell:({0},{1}) - blockRevision:{2} < currentStateId:{3}",
Mb,Ub,Jb,this.currentStateId);else if(this.nBb||(this.Qm.setOnRecalcResults(Va),this.nBb=!0),this.s1f()&&!this.Xbb(2))N.ULS.sendTraceTag(593503616,0,15,"CalcAsyncEngine.CalculateFormula: UpdateData failed");else{gb=v.uT("CalculateFormula.cell",Hb,Mb,Ub,pb,gb);Va=[];var eb=Ra.g(this.Qc);pb=eb.Ph;Ra.g(this.Qc).$a.lj&&(pb=eb.Yf(1).Ph,pb.ama(1,1),pb.ama(3,1));eb=null;pb?eb=v.uT("CalculateFormula.viewport",Hb,pb.top-1,pb.left-1,pb.bottom-1,pb.right-1):N.ULS.sendTraceTag(554718349,0,50,"CalcAsyncEngine::CalculateFormula() viewportRange is null, calc will use entire sheet...");
Da=excelOnlineCalc.calc.inferredRangeFormulaEdit(gb,Da,Qa,eb);Array.add(Va,Da);wa=pb?String.format("CalcAsyncEngine::CalculateFormula() for sheet:{0} pos:({1},{2}) text:{3} stateId:{4} viewport:(({5},{6})-({7},{8}))",Hb,Mb,Ub,Ha.a.sWb(wa.cell.text),Jb,pb.top-1,pb.left-1,pb.bottom-1,pb.right-1):String.format("CalcAsyncEngine::CalculateFormula() for sheet:{0} pos:({1},{2}) text:{3} stateId:{4} viewport:(({5},{6})-({7},{8}))",Hb,Mb,Ub,Ha.a.sWb(wa.cell.text),Jb,"","","","");N.ULS.sendTraceTag(51513232,
0,50,wa);this.Qm.editRangeFormulas(Jb,Va);this.resumeRecalc()}else N.ULS.sendTraceTag(593503618,0,15,"CalcAsyncEngine::CalculateFormula() GridBlockModelProxy is null cell:({0},{1})",wa.cell.DJ,wa.cell.QG)}else N.ULS.sendTraceTag(51513233,0,15,"CalcAsyncEngine::CalculateFormula() recalc engine is null:{0}, modifiedCell is null:{1}",!this.Qm,!wa)};v.prototype.FGg=function(wa,Da,Va,Jb){Jb=void 0===Jb?null:Jb;var Hb=Kb.d(this.Qc.Aa.sa),Mb=wa.cell.DJ-1,Ub=wa.cell.QG-1,pb=Mb,gb=Ub,Qa=null;Jb&&(Qa=excelOnlineCalc.calc.cellLocation(Mb,
Ub),Mb=Jb.top-1,Ub=Jb.left-1,pb=Jb.bottom-1,gb=Jb.right-1);Va=this.HRd(wa,Va,"SetCell");0>Va||(gb=v.uT("CalculateFormula.cell",Hb,Mb,Ub,pb,gb),pb=[],Jb=this.nbd(Hb),Da=excelOnlineCalc.calc.inferredRangeFormulaEdit(gb,Da,Qa,Jb),Array.add(pb,Da),wa=(Da=this.SVe())?String.format("CalcAsyncEngine::CalculateFormula() for sheet:{0} pos:({1},{2}) text:{3} stateId:{4} viewport:(({5},{6})-({7},{8}))",Hb,Mb,Ub,Ha.a.sWb(wa.cell.text),Va,Da.top-1,Da.left-1,Da.bottom-1,Da.right-1):String.format("CalcAsyncEngine::CalculateFormula() for sheet:{0} pos:({1},{2}) text:{3} stateId:{4} viewport:(({5},{6})-({7},{8}))",
Hb,Mb,Ub,Ha.a.sWb(wa.cell.text),Va,"","","",""),N.ULS.sendTraceTag(542922397,0,50,wa),this.Qm.editRangeFormulas(Va,pb),this.resumeRecalc())};v.prototype.h3c=function(wa,Da,Va,Jb){if(!this.Qm)return N.ULS.sendTraceTag(538814167,0,15,"CalcAsyncEngine::EvalFormulaRangeOnClone recalc engine is null"),Promise.reject("RecalcService is null");N.ULS.shipAssertTag(538814166,0,Va.isSingle,"CalcAsyncEngine::EvalFormulaRangeOnClone originCell must be a single cell.");var Hb=Kb.d(this.Qc.Aa.sa),Mb=this.nbd(Hb),
Ub=null;if(wa){Ub=[];wa=Ml(wa);for(var pb=wa.next();!pb.done;pb=wa.next())if(pb=pb.value,pb.cell.QG!==Va.left){var gb=pb.cell.DJ-1;var Qa=pb.cell.QG-1;gb=v.uT("EvalFormulaRangeOnClone.cell",Hb,gb,Qa,gb,Qa);Qa=pb.text;Array.add(Ub,excelOnlineCalc.calc.rangeWrite(gb,excelOnlineCalc.calc.valueCellData(Qa,Qa,pb.cell.numberFormatIndex,null)))}}Va=excelOnlineCalc.calc.cellLocation(Va.top-1,Va.left-1);Da=v.uT("EvalFormulaRangeOnClone.outputColumnRange",Hb,Da.top-1,Da.left-1,Da.bottom-1,Da.right-1);Jb=[excelOnlineCalc.calc.cellFormulaRangeFormulaEdit(Da,
Jb,Va,Mb)];Ub=this.Qm.evalOnClonedModel(Ub,Jb);this.resumeRecalc();return Ub};v.prototype.wwe=function(wa){var Da=null;try{if(wa)if(this.Xra=Ra.g(this.Qc).Ha.Fta(wa),this.currentStateId=wa.FQa,this.currentStateId<this.Fp||this.currentStateId===R.a.Ve)N.ULS.sendTraceTag(594884824,0,50,"CalcAsyncEngine::CreateUpdatedRangesFromBlockModel() hash:{0} blockRevision:{1} < lastUpdatedStateId:{2}",this.Xra,this.currentStateId,this.Fp);else{if(this.GVh(),!this.TBg()){var Va=String.format("CalcAsyncEngine::CreateUpdatedRangesFromBlockModel() Block Hash:{0} StateId:{1}",
this.Xra,this.currentStateId);Da=this.Qc.Zb.Ic("ModelUpdate",Va);this.Gob=this.A1a(wa.sa.sheetName);if(!this.Gob){var Jb=!!(this.Qc.Gd&32);N.ULS.sendTraceTag(50671751,0,15,"CalcAsyncEngine::CreateUpdatedRangesFromBlockModel SheetName not found. Number of existing sheets {0}, scratchPad:{1}, sheetNameLength:{2} Hash:{3}",this.af.tb(this.currentStateId)&&this.af.oa(this.currentStateId).pj?this.af.oa(this.currentStateId).pj.length:0,Jb,wa.sa.sheetName?wa.sa.sheetName.length:-1,wa.sa.hash)}else if(Ra.g(this.Qc).Ha.Ml.TZa(wa.Od)){var Hb=
wa.fg;if(Hb){var Mb=Hb.getCalcBlockModel();if(!Mb)N.ULS.sendTraceTag(50671753,0,15,"CalcAsyncEngine::CreateUpdatedRangesFromBlockModel no model for block");else if(this.LBg(Mb)){this.af.oa(this.currentStateId).PXa[this.Xra]=new B(Mb,wa.sa.sheetName);var Ub=wa.ye;Ub?this.lpg(Ub.NamedObjects):N.ULS.sendTraceTag(574682057,0,15,"CalcAsyncEngine::CreateUpdatedRangesFromBlockModel GetGridBlockContentResponse is null")}}else N.ULS.sendTraceTag(50671752,0,15,"CalcAsyncEngine::CreateUpdatedRangesFromBlockModel no model accessor for block:{0}",
this.Xra)}}}else N.ULS.shipAssertTag(50671750,0,!1,"CalcAsyncEngine::CreateUpdatedRangesFromBlockModel() blockCacheItem is null")}finally{Da&&Da.stop()}};v.prototype.ctb=function(wa){if(!this.af.oa(this.currentStateId).pj||!this.af.oa(this.currentStateId).pj[0])return null;var Da=this.af.oa(this.currentStateId).pj[0].a5;if(!Da||!Da.tb(wa.name))return null;Da=Da.oa(wa.name);if(!Da||!Da.gG)return null;wa=new ja.a;Da=Ml(Da.gG.s9);for(var Va=Da.next();!Va.done;Va=Da.next())wa.add(Va.value.value);return wa};
v.prototype.getNameLoc=function(wa,Da){return this.wcc()?this.af.oa(this.currentStateId).pj[0].a5.tb(Da)?(wa=excelOnlineCalc.location.nameLoc(wa,Da),excelOnlineCalc.util.success(wa)):excelOnlineCalc.util.success(null):(wa=excelOnlineCalc.util.unavailable([2]),excelOnlineCalc.util.failure(wa))};v.prototype.getContainingTable=function(wa){if(!this.wcc())return wa=excelOnlineCalc.util.unavailable([2]),excelOnlineCalc.util.failure(wa);var Da=wa.range.col,Va=wa.range.row,Jb=this.af.oa(this.currentStateId).pj[0].a5,
Hb=null;Jb=Ml(Jb);for(var Mb=Jb.next();!Mb.done;Mb=Jb.next())if(Mb=Mb.value.value,2===Mb.type&&Ha.a.equals(wa.sheet.index.toString(),Mb.sheetId,!0)){var Ub=Mb.range;Da>=Ub.left-1&&Da<=Ub.right-1&&Va<=Ub.bottom-1&&Va>=Ub.top-1&&(Hb=excelOnlineCalc.location.nameScope(this.documentLoc,Mb.sheetId),Hb=excelOnlineCalc.location.nameLoc(Hb,Mb.fullName))}return Hb?excelOnlineCalc.util.success(Hb):excelOnlineCalc.util.success(null)};v.prototype.getStructRefColumn=function(wa,Da){if(!this.wcc()){var Va=excelOnlineCalc.util.unavailable([2]);
return excelOnlineCalc.util.failure(Va)}Va=wa.name;var Jb=this.af.oa(this.currentStateId).pj[0].a5;if(Jb.tb(Va)){Jb=Jb.oa(Va);var Hb=Jb.range;if(2!==Jb.type)return excelOnlineCalc.util.failure(this.mZc(5));var Mb=Jb.gG?Jb.gG.s9:null;if(!Mb)return excelOnlineCalc.util.success(null);for(var Ub=Ml(Mb),pb=Ub.next();!pb.done;pb=Ub.next())if(pb=pb.value,Ha.a.equals(pb.value,Da,!0))return wa=excelOnlineCalc.location.documentLoc(wa.scope.document.path,wa.scope.document.name),wa=excelOnlineCalc.location.sheetIndex(wa,
Jb.sheetId),Hb=excelOnlineCalc.location.gridRange(Hb.top-1,pb.key,Hb.bottom-Hb.top+1,1),Hb=excelOnlineCalc.location.sheetGridRange(wa,Hb),Va=excelOnlineCalc.location.structRefColumnLoc(Va,Hb,!!(Jb.attributes&16),!!(Jb.attributes&8)),excelOnlineCalc.util.success(Va);return Hb.right-Hb.left+1!==Mb.count?(Va=excelOnlineCalc.util.unavailable([17,wa,Da]),excelOnlineCalc.util.failure(Va)):excelOnlineCalc.util.failure(this.mZc(0))}return excelOnlineCalc.util.success(null)};v.prototype.getStructRefSpecialRef=
function(wa,Da){if(!this.wcc())return Da=excelOnlineCalc.util.unavailable([2]),excelOnlineCalc.util.failure(Da);var Va=this.af.oa(this.currentStateId).pj[0].a5;if(Va.tb(wa.name)){var Jb=Va.oa(wa.name);if(2!==Jb.type)return excelOnlineCalc.util.failure(this.mZc(5));Va=!!(Jb.attributes&16);var Hb=!!(Jb.attributes&8),Mb=Va?1:0,Ub=Hb?1:0;wa=excelOnlineCalc.location.documentLoc(wa.scope.document.path,wa.scope.document.name);wa=excelOnlineCalc.location.sheetIndex(wa,Jb.sheetId);Jb=Jb.range;var pb={};if(1===
Da)pb=excelOnlineCalc.location.gridRange(Jb.top-Mb-1,Jb.left-1,Jb.bottom+Ub-Jb.top+Mb+1,Jb.right-Jb.left+1);else if(2===Da)pb=excelOnlineCalc.location.gridRange(Jb.top-1,Jb.left-1,Jb.bottom-Jb.top+1,Jb.right-Jb.left+1);else if(3===Da)if(Va)pb=excelOnlineCalc.location.gridRange(Jb.top-2,Jb.left-1,1,Jb.right-Jb.left+1);else return excelOnlineCalc.util.success(null);else if(4===Da)if(Hb)pb=excelOnlineCalc.location.gridRange(Jb.bottom,Jb.left-1,1,Jb.right-Jb.left+1);else return excelOnlineCalc.util.success(null);
Da=excelOnlineCalc.location.sheetGridRange(wa,pb);return excelOnlineCalc.util.success(Da)}return excelOnlineCalc.util.success(null)};v.prototype.getDocumentLoc=function(wa,Da){if((Ha.a.equals(wa,this.documentLoc.path,!0)||!wa)&&Ha.a.equals(Da,this.documentLoc.name,!0))return excelOnlineCalc.util.success(this.documentLoc);wa=excelOnlineCalc.util.unavailable([0,excelOnlineCalc.location.documentLoc(wa,Da)]);return excelOnlineCalc.util.failure(wa)};v.prototype.getSheetIndex=function(wa,Da){if(!this.af.tb(this.currentStateId)||
!this.af.oa(this.currentStateId).pj)return Da=excelOnlineCalc.util.unavailable([2]),excelOnlineCalc.util.failure(Da);wa=this.af.oa(this.currentStateId).pj;for(var Va=1;Va<wa.length;Va++)if(Ha.a.equals(wa[Va].nma.sheetName,Da,!0))return excelOnlineCalc.util.success(wa[Va].nma.sheetId);return excelOnlineCalc.util.success(null)};v.prototype.getSheetName=function(wa,Da){if(!this.af.tb(this.currentStateId)||!this.af.oa(this.currentStateId).pj)return Da=excelOnlineCalc.util.unavailable([2]),excelOnlineCalc.util.failure(Da);
wa=this.af.oa(this.currentStateId).pj;for(var Va=1;Va<wa.length;Va++)if(Ha.a.equals(wa[Va].nma.sheetId,Da,!0))return excelOnlineCalc.util.success(wa[Va].nma.sheetName);return excelOnlineCalc.util.success(null)};v.prototype.getUserDefinedFuncLoc=function(){return excelOnlineCalc.util.notImplemented(["ParseGlobals.GetUserDefinedFuncLoc not implemented in main thread"])};v.prototype.getSheetRangeIndexes=function(){return excelOnlineCalc.util.notImplemented(["ParseGlobals.GetSheetRangeIndexes not implemented in main thread"])};
v.prototype.GGg=function(wa,Da,Va){var Jb=Ra.g(this.Qc),Hb=Jb.Cc(Da);Hb=this.HRd(Hb,null,"CopyPaste");Va=this.HRd(Jb.Cc(wa),Va,"CopyPaste");if(0>Hb||0>Va||Hb!==Va)N.ULS.sendTraceTag(542922396,0,15,"CalcAsyncEngine::CalculateFormulaForCopyPaste(). Revision not valid. sourceRevision:{0}, targetRevision:{1}.",Va,Hb);else{Va=[];Jb=Kb.d(this.Qc.Aa.sa);var Mb=this.nbd(Jb);wa=v.uT("CalculateFormulaForCopyPaste.srcRange",Jb,wa.top-1,wa.left-1,wa.bottom-1,wa.right-1);Da=v.uT("CalculateFormulaForCopyPaste.targetRange",
Jb,Da.top-1,Da.left-1,Da.bottom-1,Da.right-1);Da=excelOnlineCalc.calc.copyPasteRangePasteEdit(Da,wa,Mb);Array.add(Va,Da);Da=Mb?String.format("CalcAsyncEngine::CalculateFormulaForCopyPaste() for sheet:{0}, stateId:{1} viewport:(({2},{3})-({4},{5}))",Jb,Hb,Mb.row,Mb.column,Mb.lastRow,Mb.lastColumn):String.format("CalcAsyncEngine::CalculateFormulaForCopyPaste() for sheet:{0}, stateId:{1} viewport:(({2},{3})-({4},{5}))",Jb,Hb,"","","","");N.ULS.sendTraceTag(542922395,0,50,Da);this.Qm.editRangePaste(Hb,
Va);this.resumeRecalc()}};v.prototype.nbd=function(wa){var Da=this.SVe(),Va=null;Da?Va=v.uT("GetViewport.viewport",wa,Da.top-1,Da.left-1,Da.bottom-1,Da.right-1):N.ULS.sendTraceTag(542922394,0,50,"CalcAsyncEngine::GetViewport() viewportRange is null, calc will use entire sheet...");return Va};v.prototype.SVe=function(){var wa=Ra.g(this.Qc),Da=wa.Ph;if(Ra.g(this.Qc).$a.lj){Da=wa.Yf(1).Ph;if(nb.EwaSettings.isChangeGateEnabled("OfficeVSO:5497152_JSCrash_At_CalcAsyncEngine_GetViewportRange")&&!Da)return N.ULS.sendTraceTag(540615327,
0,15,"CalcAsyncEngine::GetViewportRange viewportRange is null."),null;Da.ama(1,1);Da.ama(3,1)}return Da};v.prototype.HRd=function(wa,Da,Va){if(!this.Qm||!wa)return N.ULS.sendTraceTag(542922393,0,15,"CalcAsyncEngine::ValidateCalculateFormulaInit() recalc engine is null:{0}, modifiedCell is null:{1}, operation:{2}",!this.Qm,!wa,Va),-1;var Jb=wa.cell.DJ-1,Hb=wa.cell.QG-1;if(wa.cell.Sv){var Mb=wa.cell.Sv.zSc;if(Mb===R.a.Ve)return N.ULS.sendTraceTag(542922392,0,15,"CalcAsyncEngine::ValidateCalculateFormulaInit() BlockRevision unknown for block:{0}, operation:{1}",
wa.cell.Sv.Od,Va),-1}else return N.ULS.sendTraceTag(542922391,0,15,"CalcAsyncEngine::ValidateCalculateFormulaInit() GridBlockModelProxy is null cell:({0},{1}), operation:{2}",wa.cell.DJ,wa.cell.QG,Va),-1;if(Mb<this.Fp)return N.ULS.sendTraceTag(542922390,0,50,"CalcAsyncEngine::ValidateCalculateFormulaInit() Can't calc edit in cell:({0},{1}) - blockRevision:{2} < lastUpdatedStateId:{3}, operation:{4}",Jb,Hb,Mb,this.Fp,Va),-1;if(Mb<this.currentStateId)return N.ULS.sendTraceTag(542922389,0,50,"CalcAsyncEngine::ValidateCalculateFormulaInit() Can't calc edit in cell:({0},{1}) - blockRevision:{2} < currentStateId:{3}, operation:{4}",
Jb,Hb,Mb,this.currentStateId,Va),-1;Da&&!this.nBb&&(this.Qm.setOnRecalcResults(Da),this.nBb=!0);return this.s1f()&&!this.Xbb(2)?(N.ULS.sendTraceTag(542922388,0,15,"CalcAsyncEngine.ValidateCalculateFormulaInit: UpdateData failed. operation:{0}",Va),-1):Mb};v.prototype.getFormulaBarText=function(wa,Da,Va){return Da&&Da.startsWith("'")?Da:wa.cell.formulaBarText||Va.toString()};v.prototype.LWg=function(wa,Da,Va){var Jb=null;if(this.Dne()&&this.af.oa(this.Fp).PXa){var Hb=this.af.oa(this.Fp).PXa[wa];Hb&&
Hb.Opc&&(Jb=Hb.Xme)}Va=this.f_h(Jb,Da,Va);Da=this.hOg(Jb,Da,Va);N.ULS.sendTraceTag(50671754,0,50,"CalcAsyncEngine::CreateRangeUpdateCommands() completed for Block Hash:{0} StateId:{1} number of formulas {2}",wa,this.currentStateId,Da)};v.prototype.f_h=function(wa,Da,Va){var Jb=!1,Hb=v.qOe(Da);if(wa){var Mb=v.qOe(wa);Ha.a.equals(Mb,Hb,!1)&&(Jb=!0)}Jb?this.Npg(wa,this.Fp,Va):this.Ppg(Da,Va);return Jb};v.prototype.Dne=function(){var wa=!1;this.Qm&&-1!==this.Fp&&(wa=this.Qm.stateIdAvailable(this.Fp));
return wa&&this.af.tb(this.Fp)&&this.Fp<this.currentStateId};v.prototype.hOg=function(wa,Da,Va){var Jb=0;var Hb,Mb;for(Da.reset();Hb=Da.getNextCell();)ua.e(Hb.formula)&&Jb++,(Mb=Va?wa.getCell(Hb.row,Hb.col):null)?this.eOg(Da,Hb,Mb):this.Opg(Da,Hb);if(Va)for(wa.reset();Mb=wa.getNextCell();)(Hb=Da.getCell(Mb.row,Mb.col))||this.Ude(wa,Mb);return Jb};v.prototype.L8i=function(){this.Qm.setOnUpdateRequest(function(){})};v.prototype.K8i=function(){var wa=this;this.Qm.setOnUnresponsive(function(Da,Va,Jb,
Hb){wa.PAi(Da,Va,Jb,Hb)})};v.prototype.PAi=function(wa,Da,Va,Jb){N.ULS.sendTraceTag(571245912,0,15,"CalcAsyncEngine.onUnresponsive: worker thread was unresponsive. timeout:{0}, waitTime:{1}, timeoutCount:{2}, hasBeenClosed:{3}.",wa,Da,Va,Jb);Jb&&(this.$Yi(),this.Yma())};v.prototype.$Yi=function(){this.sd(null,null);this.hnd=this.nBb=!1;this.Nxd=0;this.Fxd=this.Hxd=this.Ixd=this.Gxd=-1};v.prototype.close=function(){this.Qm.close()};v.prototype.clearCache=function(){this.Qm.clearCache()};v.prototype.resumeRecalc=
function(){this.Qm.resumeRecalc()};v.prototype.c8i=function(){this.Qm.setA1ReferenceStyle(!0)};v.prototype.mOi=function(){if(this.instantaneousSupportInformationManager){var wa=this.instantaneousSupportInformationManager.FXh,Da=this.instantaneousSupportInformationManager.IXh,Va=this.instantaneousSupportInformationManager.HXh,Jb=this.instantaneousSupportInformationManager.GXh,Hb=!1;wa!==this.Gxd&&(Hb=!0,this.Gxd=wa);Da!==this.Ixd&&(Hb=!0,this.Ixd=Da);Va!==this.Hxd&&(Hb=!0,this.Hxd=Va);Jb!==this.Fxd&&
(Hb=!0,this.Fxd=Jb);var Mb=[];nb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CalcTSExceLintExperimentIsEnabled",!1)&&(Hb=excelOnlineCalc.calc.runExperiment("ExceLintExperiment",null),Mb.push(Hb),Hb=!0);nb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.UnitExperiment",!1)&&(Hb=excelOnlineCalc.calc.runExperiment("UnitExperiment",null),Mb.push(Hb),Hb=!0);nb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.CalcTSAutocompleteExperimentIsEnabled",!1)&&(Hb=excelOnlineCalc.calc.runExperiment("AutocompleteExperiment",
null),Mb.push(Hb),Hb=!0);Hb&&(wa=excelOnlineCalc.calc.recalcServiceConfig(null,wa,null,Da,null,null,null,Va,Mb,Jb),this.Qm.reconfigure(wa))}};v.prototype.K$i=function(wa){var Da=this,Va=null;if(this.af.tb(this.currentStateId))try{this.Q9=[];var Jb=String.format("CalcAsyncEngine::SetUpdatedRanges() StateId:{0} UpdateTriggerData:{1}",this.currentStateId,Ua[wa]);Va=this.Qc.Zb.Ic("ModelUpdate",Jb);ea.a.forEach(this.af.oa(this.currentStateId).PXa,function(Hb,Mb){Mb.Opc||(Da.LWg(Hb,Mb.Xme,Mb.sheetName),
Mb.Opc=!0)},null);this.Qm.updateRanges(this.currentStateId,this.Q9)}finally{Va&&Va.stop()}else N.ULS.sendTraceTag(595072542,0,15,"CalcAsyncEngine::SetUpdatedRanges StateId:{0} does not exist in GridCache",this.currentStateId)};v.prototype.J$i=function(){var wa=[],Da=this.Dne(),Va=Da&&this.af.oa(this.Fp).pj&&this.af.oa(this.Fp).pj[0]&&this.af.oa(this.Fp).pj[0].Qgc?this.af.oa(this.Fp).pj[0].a5:null;this.qse(Va,this.af.oa(this.currentStateId).pj[0].a5,null,this.Fp,wa);this.af.oa(this.currentStateId).pj[0].Qgc=
!0;for(var Jb=1;Jb<this.af.oa(this.currentStateId).pj.length;Jb++)Va=-1,Da&&this.af.oa(this.Fp).pj&&(Va=this.wad(this.af.oa(this.currentStateId).pj[Jb].nma.sheetName,this.Fp)),Va=-1!==Va&&this.af.oa(this.Fp).pj[Va].Qgc?this.af.oa(this.Fp).pj[Va].a5:null,this.qse(Va,this.af.oa(this.currentStateId).pj[Jb].a5,this.af.oa(this.currentStateId).pj[Jb].nma.sheetId,this.Fp,wa),this.af.oa(this.currentStateId).pj[Jb].Qgc=!0;this.Qm.updateNamedObjects(this.currentStateId,wa)};v.prototype.qse=function(wa,Da,Va,
Jb,Hb){if(void 0!==Va&&null!==Va){var Mb=excelOnlineCalc.calc.undefinedNamesWrite(Va);Array.add(Hb,Mb)}if(wa){var Ub=!1,pb=[];Mb=[];if(Da)for(var gb=Ml(Da),Qa=gb.next();!Qa.done;Qa=gb.next()){Qa=Qa.value;var eb=Qa.value;if(wa.tb(Qa.key)){var xb=wa.oa(Qa.key);v.Iki(xb,eb)?Ub=!0:(xb=excelOnlineCalc.calc.namedObject(Qa.key,null),Array.add(pb,xb),v.AOc(Qa.key,eb,Mb))}else v.AOc(Qa.key,eb,Mb)}wa=Ml(wa);for(Qa=wa.next();!Qa.done;Qa=wa.next())gb=Qa.value,Da&&Da.tb(gb.key)||(gb=excelOnlineCalc.calc.namedObject(gb.key,
null),Array.add(pb,gb));Ub&&(Da=excelOnlineCalc.calc.namedObjectsPromote(Va,Jb),Array.add(Hb,Da));0<pb.length&&(Da=excelOnlineCalc.calc.namedObjectsWrite(Va,pb),Array.add(Hb,Da));0<Mb.length&&(Va=excelOnlineCalc.calc.namedObjectsWrite(Va,Mb),Array.add(Hb,Va))}else if(Da){Mb=[];Da=Ml(Da);for(Jb=Da.next();!Jb.done;Jb=Da.next())Jb=Jb.value,v.AOc(Jb.key,Jb.value,Mb);0<Mb.length&&(Va=excelOnlineCalc.calc.namedObjectsWrite(Va,Mb),Array.add(Hb,Va))}};v.prototype.TBg=function(){return this.af.oa(this.currentStateId).PXa[this.Xra]?
(N.ULS.sendTraceTag(50671763,0,50,"CalcAsyncEngine::BlockPreviouslyHandled Block Hash:{0} StateId:{1} previously handled",this.Xra,this.currentStateId),!0):!1};v.prototype.LBg=function(wa){return 1===wa.getColumnNumbers().length&&wa.getColumnNumbers()[0]===v.fpd+1?!1:!0};v.prototype.BVh=function(){var wa=this,Da=!1;Ra.g(this.Qc).Ha.J6c(function(Va){Va.state&1&&wa.Qc.fa.zf===Va.Ie.Revision&&(wa.wwe(Va),Da=!0)});return Da};v.prototype.Due=function(wa,Da){var Va=wa.getRowNumbers(),Jb=wa.getColumnNumbers();
wa=Va[0]-1;Va=Va[Va.length-1]-1;var Hb=Jb[0]-1;Jb=Jb[Jb.length-1]-1;(Da=this.A1a(Da))||N.ULS.sendTraceTag(594581026,0,15,"CalcAsyncEngine::CreateBlockRangeLocation SheetName not found. Number of existing sheets {0}",this.af.tb(this.currentStateId)&&this.af.oa(this.currentStateId).pj?this.af.oa(this.currentStateId).pj.length:0);return v.uT("CreateBlockRangeLocation",Da,wa,Hb,Va,Jb)};v.prototype.Npg=function(wa,Da,Va){if(Va=this.Due(wa,Va)){var Jb=v.p0b(wa.getRowNumbers());wa=v.p0b(wa.getColumnNumbers());
Da=excelOnlineCalc.calc.rangePromote(Va,Da,Jb,wa);this.Q9[this.Q9.length]=Da}};v.prototype.Ppg=function(wa,Da){if(Da=this.Due(wa,Da)){var Va=v.p0b(wa.getRowNumbers());wa=v.p0b(wa.getColumnNumbers());wa=excelOnlineCalc.calc.rangeWrite(Da,null,Va,wa);this.Q9[this.Q9.length]=wa}};v.prototype.eOg=function(wa,Da,Va){var Jb=null,Hb=0,Mb=0;switch(Da.valueType){case 2:Jb=this.jbd(Da);var Ub=this.jbd(Va);Ub=Ha.a.equals(Ub,Jb,!1);break;case 1:null===Da.value&&null===Va.value?Ub=!0:(Hb=parseFloat(Da.value),
Ub=parseFloat(Va.value)===Hb);break;default:null===Da.value&&null===Va.value?Ub=!0:(Mb=parseFloat(Da.value),Ub=Mb===parseFloat(Va.value))}Ub&&Da.valueType===Va.valueType&&Da.ifmt===Va.ifmt&&Da.formulaType===Va.formulaType&&Ha.a.equals(Va.formula,Da.formula,!1)||(void 0!==Da.formula&&null!==Da.formula||void 0!==Da.value&&null!==Da.value||void 0!==Da.text&&null!==Da.text?this.dVb(wa,Da,Jb,Hb,Mb):this.Ude(wa,Da))};v.prototype.lpg=function(wa){if(this.Qc.Ab&&this.Qc.Ab.items)for(var Da=0;Da<this.Qc.Ab.count;Da++){var Va=
this.Qc.Ab.items[Da];if(2===Va.type||3===Va.type){var Jb=0,Hb=Va.name,Mb=Hb.lastIndexOf("!");if(0<Mb){Jb=Hb.substr(0,Mb);"'"===Jb.charAt(0)&&(Jb=Jb.substr(1,Jb.length-2));Jb=this.wad(Jb,this.currentStateId);if(-1===Jb){N.ULS.sendTraceTag(595096334,0,15,"CalcAsyncEngine::AddNamedObjectsInBlock SheetName not found. Number of existing sheets {0}",this.af.tb(this.currentStateId)&&this.af.oa(this.currentStateId).pj?this.af.oa(this.currentStateId).pj.length:0);continue}Hb=Hb.substr(Mb+1)}Jb=this.af.oa(this.currentStateId).pj[Jb].a5;
var Ub=Va.usedRange;2===Va.type&&(Ub=fb.a(Va));if(Jb.tb(Hb)){if(Mb=Jb.oa(Hb),nb.EwaSettings.isChangeGateEnabled("OfficeVSO:5502630_AddNamedObjectsInBlock_updateRange")&&(Mb.range=Ub,Mb.attributes=Va.attributes),2===Mb.type&&(Hb=v.tKe(Va.name,wa)))if(!Mb.gG)Mb.gG=new A(Hb.ColHeadersList);else if(Hb.ColHeadersList)for(Hb=Ml(Hb.ColHeadersList.HeadersList),Va=Hb.next();!Va.done;Va=Hb.next())Va=Va.value,Mb.gG.s9.ja(Va.Index,Va.Name)}else(Mb=this.A1a(Va.sheetName))?(Mb=new J(Va.type,Va.name,Ub,Mb,Va.attributes),
2===Mb.type&&(Va=v.tKe(Va.name,wa))&&(Mb.gG=new A(Va.ColHeadersList)),Jb.ja(Hb,Mb)):N.ULS.sendTraceTag(574682056,0,50,"CalcAsyncEngine::AddNamedObjectsInBlock SheetName not found. Number of existing sheets {0}",this.af.tb(this.currentStateId)&&this.af.oa(this.currentStateId).pj?this.af.oa(this.currentStateId).pj.length:0)}}};v.prototype.dVb=function(wa,Da,Va,Jb,Hb){var Mb=wa.getRowNumbers()[Da.row]-1;wa=wa.getColumnNumbers()[Da.col]-1;Mb=v.uT("AddRangeUpdateCommand",this.Gob,Mb,wa,Mb,wa);wa=null;
var Ub=Da.formula||Da.text,pb=excelOnlineCalc.calc.blankValue,gb=null;void 0!==Da.text&&null!==Da.text||void 0!==Da.value&&null!==Da.value||(Va="",gb="This cell contains blanks only",Da.formulaType||(Ub=""));switch(Da.valueType){case 2:null!==Va&&(Da.formulaType||(wa=excelOnlineCalc.calc.valueCellData(Ub,Va,Da.ifmt,gb)),1===Da.formulaType&&(wa=excelOnlineCalc.calc.cellFormulaCellData(Ub,Va,Da.ifmt,gb)),2===Da.formulaType&&(wa=excelOnlineCalc.calc.valueCellData("",pb,0,"This cell is a part of an array")));
break;case 1:isNaN(Jb)?N.ULS.sendTraceTag(50857250,0,50,"CalcAsyncEngine::AddRangeUpdateCommand Cell({0},{1}) invalid numeric value",Da.row,Da.col):(Da.formulaType||(wa=excelOnlineCalc.calc.valueCellData(Ub,Jb,Da.ifmt,null)),1===Da.formulaType&&(wa=excelOnlineCalc.calc.cellFormulaCellData(Ub,Jb,Da.ifmt,null)),2===Da.formulaType&&(wa=excelOnlineCalc.calc.valueCellData("",pb,0,"This cell is a part of an array")));break;case 3:isNaN(Hb)?N.ULS.sendTraceTag(50857251,0,15,"CalcAsyncEngine::AddRangeUpdateCommand Cell({0},{1}) invalid boolean value",
Da.row,Da.col):(Va=1===Hb?!0:!1,Da.formulaType||(wa=excelOnlineCalc.calc.valueCellData(Ub,Va,Da.ifmt,null)),1===Da.formulaType&&(wa=excelOnlineCalc.calc.cellFormulaCellData(Ub,Va,Da.ifmt,null)),2===Da.formulaType&&(wa=excelOnlineCalc.calc.valueCellData("",pb,0,"This cell is a part of an array")));break;case 4:isNaN(Hb)?N.ULS.sendTraceTag(50857280,0,15,"CalcAsyncEngine::AddRangeUpdateCommand Cell({0},{1}) invalid error value",Da.row,Da.col):(Va=excelOnlineCalc.calc.errorValue(Hb),Da.formulaType||(wa=
excelOnlineCalc.calc.valueCellData(Ub,Va,Da.ifmt,null)),1===Da.formulaType&&(wa=excelOnlineCalc.calc.cellFormulaCellData(Ub,Va,Da.ifmt,null)),2===Da.formulaType&&(wa=excelOnlineCalc.calc.valueCellData("",pb,0,"This cell is a part of an array")));break;default:wa=excelOnlineCalc.calc.valueCellData("",pb,Da.ifmt,null)}wa&&(Da=excelOnlineCalc.calc.rangeWrite(Mb,wa,null,null),this.Q9[this.Q9.length]=Da)};v.prototype.Opg=function(wa,Da){switch(Da.valueType){case 2:this.dVb(wa,Da,this.jbd(Da),null,0);break;
case 1:this.dVb(wa,Da,null,parseFloat(Da.value),0);break;default:this.dVb(wa,Da,null,null,parseFloat(Da.value))}};v.prototype.Ude=function(wa,Da){var Va=wa.getRowNumbers()[Da.row]-1;wa=wa.getColumnNumbers()[Da.col]-1;Va=v.uT("AddRangeUpdateCommandEmptyCell",this.Gob,Va,wa,Va,wa);Da=excelOnlineCalc.calc.valueCellData("",excelOnlineCalc.calc.blankValue,Da.ifmt,null);Da=excelOnlineCalc.calc.rangeWrite(Va,Da,null,null);this.Q9[this.Q9.length]=Da};v.prototype.A1a=function(wa){wa=this.wad(wa,this.currentStateId);
return 0<wa?this.af.oa(this.currentStateId).pj[wa].nma.sheetId:null};v.prototype.wad=function(wa,Da){if(!this.af.tb(Da))return N.ULS.sendTraceTag(595072538,0,15,"CalcAsyncEngine.GetSheetInternalIndex StateId:{0} does not exist in GridCache",Da),-1;if(!this.af.oa(Da).pj)return N.ULS.sendTraceTag(595072537,0,15,"CalcAsyncEngine.GetSheetInternalIndex sheetsInformation == null for StateId:{0}",Da),-1;Da=this.af.oa(Da).pj;for(var Va=1;Va<Da.length;Va++)if(Ha.a.equals(Da[Va].nma.sheetName,wa,!1))return Va;
return-1};v.prototype.g$i=function(){if(!this.af.tb(this.currentStateId)||!this.af.oa(this.currentStateId).pj.length)return N.ULS.sendTraceTag(595072536,0,15,"CalcAsyncEngine::SetSheetNamesAndUsedRanges() No sheets information for StateId:{0} or StateId does not exist in GridCache",this.currentStateId),!1;for(var wa=[],Da=1;Da<this.af.oa(this.currentStateId).pj.length;Da++){var Va=this.af.oa(this.currentStateId).pj[Da];Va&&Array.add(wa,Va.nma)}this.Qm.updateSheetNames(this.currentStateId,wa);this.Qm.updateUnusedCells(this.currentStateId,
this.af.oa(this.currentStateId).H1f);return!0};v.prototype.setNumberFormats=function(){if(this.instantaneousSupportInformationManager){for(var wa=[],Da=Ml(this.instantaneousSupportInformationManager.lba),Va=Da.next();!Va.done;Va=Da.next())Va=Va.value,Va=excelOnlineCalc.calc.numberFormat(Va.IfmtIndex,Va.FormatString,Va.Builtin),Array.add(wa,Va);this.Qm.setNumberFormats(wa,!0)}};v.prototype.I6i=function(){if(this.instantaneousSupportInformationManager&&this.instantaneousSupportInformationManager.Oe){var wa=
this.EVh();if(!this.hnd||wa)this.o0b(),this.instantaneousSupportInformationManager.Oe.TrueValueString&&(this.trueName=this.instantaneousSupportInformationManager.Oe.TrueValueString),this.instantaneousSupportInformationManager.Oe.FalseValueString&&(this.falseName=this.instantaneousSupportInformationManager.Oe.FalseValueString),wa=va.CalcHelper.sve(this.instantaneousSupportInformationManager,wa),this.Qm.setLocale(wa),this.hnd=!0}};v.prototype.V$i=function(){var wa=null;if(void 0!==this.Qc.workbookContext.TimeZoneInformation&&
null!==this.Qc.workbookContext.TimeZoneInformation){wa=null;this.Qc.workbookContext.TimeZoneInformation.StandardDate.Month&&(wa=excelOnlineCalc.date.dateTime(this.Qc.workbookContext.TimeZoneInformation.StandardDate.Year,this.Qc.workbookContext.TimeZoneInformation.StandardDate.Month,this.Qc.workbookContext.TimeZoneInformation.StandardDate.Day,this.Qc.workbookContext.TimeZoneInformation.StandardDate.Hour,this.Qc.workbookContext.TimeZoneInformation.StandardDate.Minute,this.Qc.workbookContext.TimeZoneInformation.StandardDate.Second,
this.Qc.workbookContext.TimeZoneInformation.StandardDate.DayOfWeek+1,this.Qc.workbookContext.TimeZoneInformation.StandardDate.Milliseconds,3));var Da=null;this.Qc.workbookContext.TimeZoneInformation.DaylightDate.Month&&(Da=excelOnlineCalc.date.dateTime(this.Qc.workbookContext.TimeZoneInformation.DaylightDate.Year,this.Qc.workbookContext.TimeZoneInformation.DaylightDate.Month,this.Qc.workbookContext.TimeZoneInformation.DaylightDate.Day,this.Qc.workbookContext.TimeZoneInformation.DaylightDate.Hour,
this.Qc.workbookContext.TimeZoneInformation.DaylightDate.Minute,this.Qc.workbookContext.TimeZoneInformation.DaylightDate.Second,this.Qc.workbookContext.TimeZoneInformation.DaylightDate.DayOfWeek+1,this.Qc.workbookContext.TimeZoneInformation.DaylightDate.Milliseconds,3));wa=excelOnlineCalc.date.tzData(this.Qc.workbookContext.TimeZoneInformation.Bias,wa,this.Qc.workbookContext.TimeZoneInformation.StandardBias,Da,this.Qc.workbookContext.TimeZoneInformation.DaylightBias)}else N.ULS.sendTraceTag(589088772,
0,15,"CalcAsyncEngine.SetWorkbookProperties: TimeZoneInformation is null");wa=excelOnlineCalc.calc.workbookProps(this.Qc.workbookContext.F1904,this.Qc.workbookContext.FDateCompatibility,wa);this.Qm.setWorkbookProps(wa)};v.prototype.Qpf=function(){this.setNumberFormats()};v.prototype.sd=function(){N.ULS.sendTraceTag(595072535,0,50,"CalcAsyncEngine.OnWorkbookOpened() called");this.af=new ta.a;this.currentStateId=this.Fp=-1;this.Xra="";this.Gob=null;this.Izd=!1;this.Qm&&this.clearCache()};v.prototype.Yma=
function(){var wa=this;nb.EwaSettings.ka(314)&&ec.c(excelOnlineCalc.worker.runSmokeTest(1/0,this.TUf,!0)).continueWith(function(Va){Va.Kg?N.ULS.sendTraceTag(40768413,0,15,"CalcAsyncEngine.TryInitialize: calc smoke test failed: {0}",Va.Kg.toString()):N.ULS.sendTraceTag(40768412,0,50,"CalcAsyncEngine.TryInitialize: calc smoke test ended - a new one should start")});var Da=nb.EwaSettings.ka(708)?y.local:y.Soj;this.Jzd=ec.c(excelOnlineCalc.calc.createRecalcService(Da,E.a.jva()));this.Jzd.continueWith(function(Va){Va.Kg?
N.ULS.sendTraceTag(42321621,0,50,"CalcAsyncEngine.TryInitialize: Calc web worker failed: {0}",Va.Kg.toString()):(N.ULS.sendTraceTag(42321620,0,50,"CalcAsyncEngine.TryInitialize: Calc web worker is working as expected"),wa.Qm=wa.Jzd.result,wa.Qm?wa.Xbb(0)?wa.K8i():N.ULS.sendTraceTag(594884823,0,15,"CalcAsyncEngine.TryInitialize: UpdateData failed to initialize"):N.ULS.sendTraceTag(42812306,0,50,"CalcAsyncEngine.TryInitialize: Calc web worker result is null"))})};v.prototype.EVh=function(){var wa=this.instantaneousSupportInformationManager.Zha;
if(!wa||this.Nxd===wa.length)return null;this.Nxd=wa.length;return va.CalcHelper.hve(wa)};v.prototype.o0b=function(){this.errorTypeNames=va.CalcHelper.o0b()};v.prototype.GVh=function(){if(!(this.af.tb(this.currentStateId)&&0<this.af.oa(this.currentStateId).pj.length)){this.af.ja(this.currentStateId,new z);this.af.oa(this.currentStateId).pj[0]=new x(null);for(var wa=this.Qc.Aa,Da=0;Da<wa.count;Da++){var Va=Object(qb.a)(Za.a,wa.getItem(Da));if(Va){void 0!==Va.sheetId&&null!==Va.sheetId&&void 0!==Va.name&&
null!==Va.name&&Va.sheetId.length&&Va.sheetName.length||N.ULS.sendTraceTag(591189921,0,15,"CalcAsyncEngine::InitializeGridForStateId() invalid sheet - index:{0} Id:{1} Hash:{2} NameLength:{3}",Da,Va.sheetId,Va.hash,Va.name?Va.name.length:-1);var Jb=excelOnlineCalc.calc.sheetName(Va.sheetId,Va.name);this.af.oa(this.currentStateId).pj[Da+1]=new x(Jb);Jb=Va.usedRange.yW();Jb=excelOnlineCalc.calc.rangeLocation(0,0,Jb.LastRow,Jb.LastColumn);Va=excelOnlineCalc.calc.unusedCellsUpdate(Va.sheetId,Jb);Array.add(this.af.oa(this.currentStateId).H1f,
Va)}else N.ULS.sendTraceTag(595072534,0,15,"CalcAsyncEngine.InitializeGridForStateId(): not sheet item for StateId:{0} sheet-index:{1}",this.currentStateId,Da)}}};v.prototype.NKg=function(){for(var wa=Ml(this.af),Da=wa.next();!Da.done;Da=wa.next())Da=Da.value,Da.key<this.Fp&&this.af.remove(Da.key)};v.prototype.jbd=function(wa){wa=wa.value||wa.text;if(void 0===wa||null===wa)wa="";return wa};v.prototype.s1f=function(){if(!this.af.tb(this.currentStateId))return!1;var wa=!1;ea.a.forEach(this.af.oa(this.currentStateId).PXa,
function(Da,Va){Va.Opc||(wa=!0)},null);return wa};v.prototype.mZc=function(wa){var Da={};Da.reason=wa;Da.kind=1;return Da};v.prototype.wcc=function(){return this.af.tb(this.currentStateId)&&this.af.oa(this.currentStateId).pj&&this.af.oa(this.currentStateId).pj[0]&&this.af.oa(this.currentStateId).pj[0].a5?!0:!1};v.MSg=function(wa){var Da=[];if(wa&&wa.s9){wa=Ml(wa.s9);for(var Va=wa.next();!Va.done;Va=wa.next())Va=Va.value,Va=excelOnlineCalc.calc.columnData(Va.key,Va.value),Array.add(Da,Va)}return Da};
v.Iki=function(wa,Da){if(wa.type!==Da.type||wa.attributes!==Da.attributes||!Ha.a.equals(wa.fullName,Da.fullName,!1)||!wa.range.equals(Da.range))return!1;if(!wa.gG&&!Da.gG)return!0;if(!wa.gG||!Da.gG||wa.gG.s9.count!==Da.gG.s9.count)return!1;var Va={};wa=Ml(wa.gG.s9);for(var Jb=wa.next();!Jb.done;Va={bdb:Va.bdb,idb:Va.idb},Jb=wa.next())if(Va.bdb=Jb.value,Va.idb=void 0,!(Va.bdb.value&&function(Hb){return function(){var Mb=Da.gG.s9.Ec(Hb.bdb.key);Hb.idb=Mb.value;return Mb}}(Va)().returnValue&&Va.idb&&
Ha.a.equals(Va.bdb.value,Va.idb,!1)))return!1;return!0};v.AOc=function(wa,Da,Va){var Jb=v.uT("NamedObject",Da.sheetId,Da.range.top-1,Da.range.left-1,Da.range.bottom-1,Da.range.right-1);if(2===Da.type){var Hb=!!(Da.attributes&16),Mb=!!(Da.attributes&8);Da=v.MSg(Da.gG);Jb=excelOnlineCalc.calc.namedTableData(Jb,Hb,Mb,Da);wa=excelOnlineCalc.calc.namedObject(wa,Jb)}else Jb=excelOnlineCalc.calc.namedRangeData(Jb),wa=excelOnlineCalc.calc.namedObject(wa,Jb);Array.add(Va,wa)};v.qOe=function(wa){var Da=Sys.Serialization.JavaScriptSerializer.serialize(wa.getRowNumbers());
wa=Sys.Serialization.JavaScriptSerializer.serialize(wa.getColumnNumbers());return Da+wa};v.p0b=function(wa){var Da=null;if(1<wa.length)for(var Va=1;Va<wa.length;Va++)for(var Jb=0;wa[Va-1]+1+Jb<wa[Va];)Da=Da||[],Array.add(Da,wa[Va-1]+Jb),Jb++;return Da};v.tKe=function(wa,Da){if(!Da)return null;for(var Va=0,Jb=Da.length;Va<Jb;++Va)if(Ha.a.equals(wa,Da[Va].Name,!1))return Da[Va];return null};v.uT=function(wa,Da,Va,Jb,Hb,Mb){function Ub(pb,gb,Qa,eb){(0>Qa||Qa>=eb)&&N.ULS.sendTraceTag(591204771,0,15,"CalcAsyncEngine::CreateSheetRangeLocation() callerId:{0} invalid {1}:{2}",
pb,gb,Qa)}void 0!==Da&&null!==Da||N.ULS.sendTraceTag(591189920,0,15,"CalcAsyncEngine::CreateSheetRangeLocation() callerId:{0} sheetId is null",wa);Ub(wa,"top",Va,v.iff);Ub(wa,"left",Jb,v.fpd);Ub(wa,"bottom",Hb,v.iff);Ub(wa,"right",Mb,v.fpd);return excelOnlineCalc.calc.sheetRangeLocation(Da,Va,Jb,Hb,Mb)};v.iff=1048576;v.fpd=16384;Object(F.a)(v,"CalcAsyncEngine",null,[7]);Object(F.a)(w,"AbsoluteRelativeReferenceInfo",null,[]);var zc=b(1115),Ab=b(25);u.rxf="#";Object(F.a)(u,"Operators",null,[]);var vb=
b(1116);k.sheet="Sheet";k.sheetRange="SheetRange";k.document="Document";k.xSh="Ident";Object(F.a)(k,"TraverseFormulaQualifierTypes",null,[]);var kc=b(1117),td=b(1007),Oc=b(905),tc=b(52),sc=b(60);t.prototype.dispose=function(){var wa=this;N.ULS.sendTraceTag(34445255,0,50,"CalcManager.Dispose called");this.$.ea.ub(268,function(Da){Da.iCd(Object(X.a)(wa,wa.Aic,"onLocaleInformationAvailable"));Da.ZBd(Object(X.a)(wa,wa.jic,"onFunctionsInfoReady"))});this.gridView&&(this.gridView.Ps(Object(X.a)(this,this.onContentReady,
"onContentReady")),this.gridView.Ha&&this.gridView.Ha.VEf(Object(X.a)(this,this.ekf,"onBlockPresent")),this.jy=null);this.Fif=this.Cif=this.cAc=null};t.prototype.IGg=function(wa,Da,Va,Jb){Jb=void 0===Jb?null:Jb;this.tl&&(nb.EwaSettings.isChangeGateEnabled("OfficeVSO:5470583_Calculate_Formula_Refactoring")?this.tl.FGg(wa,Da,Va,Jb):this.tl.HGg(wa,Da,Va,Jb))};t.prototype.evalFormula=function(wa){return this.tl?this.tl.evalFormula(wa):Promise.reject("calc engine not initialized")};t.prototype.evalFormulaRange=
function(wa,Da,Va){return this.tl?this.tl.evalFormulaRange(wa,Da,Va):Promise.reject("calc engine not initialized")};t.prototype.h3c=function(wa,Da,Va,Jb){return this.tl?this.tl.h3c(wa,Da,Va,Jb):Promise.reject("CalcEngine is null")};t.prototype.ctb=function(wa){return this.tl?(N.ULS.shipAssertTag(574682055,0,2===wa.type,"CalcManager.GetTableHeaders() - ActiveItem is not a table"),this.tl.ctb(wa)):null};t.prototype.nwg=function(wa,Da){if(!Da||2!==wa.type)return!1;wa=fb.a(wa);return wa.right-wa.left+
1===Da.count};t.prototype.$Ie=function(wa){if(!this.hNa)return this.A5f||N.ULS.sendTraceTag(37826832,0,15,"CalcManager.ExtractReferenceWrappers - parser not initialized"),null;var Da=this.Gra(Ab.Range.xd(1,1));Da=nb.EwaSettings.isChangeGateEnabled("OfficeVSO:5412141_CalcParseFormulaAPIUpdate")?this.hNa.parseFormula(excelOnlineCalc.parse.parseLocals(1,Da.range),wa):this.hNa.parseFormula(2,Da.range,1,wa);if(!excelOnlineCalc.parse.parseResultHelper.isSuccess(Da))return N.ULS.sendTraceTag(37826833,0,
10,"CalcManager.ExtractReferenceWrappers - ParseFormula failed"),null;try{if(nb.EwaSettings.getBooleanFeatureGate("Microsoft.Office.Excel.StructuredReferencesHighlighting",!1)){var Va=this.gridView.ga.ya.activeCell,Jb=excelOnlineCalc.location.gridCell(Va.top-1,Va.left-1),Hb=excelOnlineCalc.location.documentLoc("",this.$.workbookContext.FullDocumentInfo.BreadcrumbDocName),Mb=excelOnlineCalc.location.sheetIndex(Hb,this.$.Aa.sa.sheetId),Ub=this.eXg(Jb,Mb);this.YDd||(this.YDd=excelOnlineCalc.util.createResolver(this.dXg()));
var pb=excelOnlineCalc.parse.parseResultHelper.extractReferences(Da,this.vr.config.localeInfo,nb.EwaSettings.ka(634),Ub,this.YDd)}else pb=excelOnlineCalc.parse.parseResultHelper.extractReferences(Da,this.vr.config.localeInfo,nb.EwaSettings.ka(634));nb.EwaSettings.ka(104)&&this.cyj(pb,wa);return pb}catch(gb){return N.ULS.sendTraceTag(39396449,0,10,"CalcManager.ExtractReferenceWrappers - exception: {0}",gb.message),null}};t.prototype.extractLetVariables=function(wa,Da){if(!this.hNa)return this.A5f||
N.ULS.sendTraceTag(588891980,0,15,"CalcManager.ExtractLetVariables - parser not initialized"),null;var Va=this.Gra(Ab.Range.xd(1,1));wa=nb.EwaSettings.isChangeGateEnabled("OfficeVSO:5412141_CalcParseFormulaAPIUpdate")?this.hNa.parseFormula(excelOnlineCalc.parse.parseLocals(1,Va.range),wa):this.hNa.parseFormula(2,Va.range,1,wa);if(!excelOnlineCalc.parse.parseResultHelper.isSuccess(wa))return N.ULS.sendTraceTag(588891979,0,10,"CalcManager.ExtractLetVariables - ParseFormula failed"),null;try{return excelOnlineCalc.parse.parseResultHelper.extractLetVariables(wa,
Da,this.vr.config.localeInfo)}catch(Jb){return N.ULS.sendTraceTag(588891978,0,10,"CalcManager.ExtractLetVariables - exception: {0}",Jb.message),null}};t.prototype.extractReferences=function(wa,Da,Va){if(!Da)return N.ULS.sendTraceTag(38576192,0,10,"CalcManager.ExtractReferences - sheetName is null"),null;if(!Va)return N.ULS.sendTraceTag(38576193,0,10,"CalcManager.ExtractReferences - documentName is null"),null;var Jb=this.$Ie(wa);if(!Jb)return N.ULS.sendTraceTag(39396450,0,15,"CalcManager.ExtractReferences - ExtractReferenceWrappers returned null"),
null;try{return this.gWg(Jb,Da,Va,wa)}catch(Hb){return N.ULS.sendTraceTag(37826834,0,10,"CalcManager.ExtractReferences - exception: {0}",Hb.message),null}};t.prototype.zIh=function(wa,Da,Va,Jb){if(!wa)return N.ULS.sendTraceTag(42473290,0,10,"CalcManager.GetSubExpressionSpanForContextualFormulaPreview - range is null"),null;if(!Da||0>=Da.length)return N.ULS.sendTraceTag(42473291,0,10,"CalcManager.GetSubExpressionSpanForContextualFormulaPreview - formula is null/empty"),null;wa=this.Gra(wa);if(!this.vr||
!wa)return null;var Hb=this.Trb(wa).returnValue;if(!Hb||Hb.q3a)return null;Va=excelOnline.utils.getCharIndexInTextFromPoint(Va,Jb,nb.EwaSettings.ka(634));return 0>Va?null:excelOnlineCalc.runtime.getSubExpressionFromFormulaCharacterIndex(this.vr.config,Va,Da,wa)};t.prototype.xGg=function(wa,Da,Va,Jb){var Hb=this;if(!wa)return N.ULS.sendTraceTag(41756244,0,10,"CalcManager.CalcPartialResultsForFormula - range is null"),null;var Mb=null;return this.evalFormula(Da).then(function(Ub){var pb=Hb.vr.Z9g(Ub,
Va),gb=pb.returnValue;8!==pb.kind||gb.length&&gb!==va.CalcHelper.unknownError?Ub=0:(N.ULS.sendTraceTag(41756250,0,50,"EvalSession.GetPartialResultValueForFormula - EvalResultToString error"),Ub=excelOnlineCalc.calc.getEvalFailureReason(Ub),void 0!==Ub&&null!==Ub||N.ULS.shipAssertTag(587559249,0,!1,"CalcHelper.GetEvalFailureReason() - result is not a failure, function should not be called"),Ub=1);return Mb=Jb?new zc.a(gb,Jb.start,Jb.end,Ub):new zc.a(gb,-1,-1,Ub)},function(Ub){N.ULS.sendTraceTag(41756251,
0,10,"EvalSession.GetPartialResultValueForFormula - exception: {0}",Ub);return Promise.resolve(Mb)})};t.prototype.getSubExpressionSpan=function(wa){return this.vr&&wa?excelOnlineCalc.runtime.getSubExpressionSpan(wa):null};t.prototype.getFormulaSubExpressionObject=function(wa,Da,Va){return this.vr&&wa&&Da&&Va?excelOnlineCalc.runtime.getFormulaSubExpressionObject(this.vr.config,Da,Va,this.Gra(wa)):null};t.prototype.CIh=function(wa,Da,Va){return this.vr&&wa&&Da?excelOnlineCalc.runtime.getSubstitutedSubExpressionString(this.vr.config,
Da,Va,this.Gra(wa)):null};t.prototype.AIh=function(wa,Da,Va){return this.vr&&wa&&Da?excelOnlineCalc.runtime.getSubExpressionSubspans(this.vr.config.localeInfo,Da,Va):null};t.prototype.rCh=function(){return this.vr?this.vr.config.localeInfo.listSeparator:null};t.prototype.isFormulaSubExpressionVolatile=function(wa){return this.vr?excelOnlineCalc.runtime.isFormulaSubExpressionVolatile(this.vr.config.localeInfo,wa):!1};t.prototype.Gra=function(wa){return wa&&this.vr?this.vr.DXg(this.vr.tZg(),wa.top-
1,wa.left-1):null};t.prototype.Q1h=function(wa,Da){wa=this.v$c(wa);if(void 0===wa||null===wa)return null;wa=this.oq.createFormat(wa.FormatString,wa.Builtin);if(!excelOnlineCalc.util.isSuccess(wa))return null;Da=this.oq.parseEdit(Da,wa.value);return excelOnlineCalc.util.isSuccess(Da)?Da.value.kind===td.a.formula:null};t.prototype.u$c=function(wa){if(!wa.isValid())return N.ULS.sendTraceTag(555032866,0,50,"CalcManager.GetNumberFormat: invalid format was given! ifmt: {0}, format string: {1}, format obj: {2}",
null!=wa.fE?wa.fE.toString():"null",wa.formatString?Ha.a.GI(wa.formatString):"null",wa.numberFormat?"!null":"null"),null;var Da=wa.fBh();if("String"===Object.getType(Da).getName())var Va=this.Fif;else if("Number"===Object.getType(Da).getName())Va=this.Cif;else return N.ULS.sendTraceTag(555848470,0,10,"CalcManager.GetNumberFormat: key is of unknown type!"),null;Da=Da.toString();if(Da in Va)return Va[Da].numberFormat;Va[Da]=wa;return wa.numberFormat};t.prototype.getWorksheetFuncId=function(wa){return this.localeInfo.getWorksheetFuncId(wa)};
t.prototype.gWg=function(wa,Da,Va,Jb){for(var Hb=nb.EwaSettings.ka(745),Mb={Items:[]},Ub=0;Ub<wa.length;Ub++){var pb=wa[Ub],gb={};gb.Start=pb.span.start;gb.End=pb.span.end;if(Hb&&pb.kind===vb.a.func)gb.End=pb.span.start+pb.ref.name.length,Array.add(Mb.Items,{Span:gb,IsFunction:!0});else if(Hb&&pb.kind===vb.a.uai)pb=pb.ref.value.oper.kind,Array.add(Mb.Items,{Span:gb,IsString:2===pb,IsBoolean:4===pb,IsNumber:1===pb});else if(this.a5g(pb,Da,Va)){var Qa=new w,eb=this.PFh(pb,Da,Qa,Jb);if(nb.EwaSettings.ka(634)){var xb=
this.hCh(pb),dc=this.gCh(pb);if(eb||dc&&0<=xb)gb={Span:gb,LetNumber:xb,LetName:dc,Range:eb},gb.IsRangeRef=Qa.d4a,gb.IsAbsoluteFirstRow=Qa.Wua,gb.IsAbsoluteFirstColumn=Qa.Vua,gb.IsAbsoluteSecondRow=Qa.aKa,gb.IsAbsoluteSecondColumn=Qa.$Ja,gb.IsStructRef=pb.kind===vb.a.qMd,Array.add(Mb.Items,gb)}else eb&&(gb={Span:gb,Range:eb},gb.IsRangeRef=Qa.d4a,gb.IsAbsoluteFirstRow=Qa.Wua,gb.IsAbsoluteFirstColumn=Qa.Vua,gb.IsAbsoluteSecondRow=Qa.aKa,gb.IsAbsoluteSecondColumn=Qa.$Ja,gb.IsStructRef=pb.kind===vb.a.qMd,
Array.add(Mb.Items,gb))}}Mb.Items.sort(function(Nc,Pc){return Nc.Span.Start-Pc.Span.Start});return Mb};t.prototype.hCh=function(wa){return wa.kind===vb.a.Haf?wa.ref.number:-1};t.prototype.gCh=function(wa){return wa.kind===vb.a.Haf?wa.ref.name:null};t.prototype.PFh=function(wa,Da,Va,Jb){if(wa.kind===vb.a.range)return Va.d4a=!0,this.zte(wa,Da,Va,Jb);if(wa.kind===vb.a.namedRange){Va=wa.ref;(wa=this.$.Ab.getItemByName(Va.name))||(wa=this.$.Ab.getItemByName(Da+"!"+Va.name));if(!(wa&&wa.sheetName&&wa.usedRange&&
Ha.a.equals(wa.sheetName,Da,!0)))return null;Da=2===wa.type?fb.a(wa):wa.usedRange;return ia.m(Da,wa)}if(wa.kind===vb.a.qMd){var Hb=wa.ref,Mb;Hb.name?(Mb=this.$.Ab.getItemByName(Hb.name))||(Mb=this.$.Ab.getItemByName(Da+"!"+Hb.name)):Mb=this.gridView.kc.Rk(this.gridView.ga.ya.activeCell);if(!(Mb&&Mb.sheetName&&Mb.usedRange&&Ha.a.equals(Mb.sheetName,Da,!0)))return null;Va.d4a=!1;return this.zte(wa,Da,Va,Jb)}return null};t.prototype.zte=function(wa,Da,Va,Jb){wa=wa.ref;if(wa.type){if(wa.type===kc.a.column){var Hb=
wa.startIndex;wa=wa.endIndex;Va.Vua=Hb.kind===Oc.a.abs;Va.$Ja=wa.kind===Oc.a.abs;return this.createRange(0,Hb.index,R.a.Gh,wa.index,Da)}if(wa.type===kc.a.row)return Hb=wa.endIndex,Va.Wua=wa.startIndex.kind===Oc.a.abs,Va.aKa=Hb.kind===Oc.a.abs,this.createRange(wa.startIndex.index,0,wa.endIndex.index,R.a.Qh,Da);if(wa.type===kc.a.cell){Hb=wa.row;var Mb=wa.col;Va.Wua=Va.aKa=Hb.kind===Oc.a.abs;Va.Vua=Va.$Ja=Mb.kind===Oc.a.abs;return this.TYb(wa.span.end,Jb)&&(Va=Ab.Range.xd(Hb.index+1,Mb.index+1),Va=this.gridView.kc.LUe(Va))?
ia.n(Va,Da):this.createRange(Hb.index,Mb.index,Hb.index,Mb.index,Da)}if(wa.type===kc.a.range){Hb=wa.top;Mb=wa.left;Jb=wa.bottom;wa=wa.right;var Ub=Math.min(Hb.index,Jb.index),pb=Math.min(Mb.index,wa.index),gb=Math.max(Hb.index,Jb.index),Qa=Math.max(Mb.index,wa.index);Va.Wua=Hb.kind===Oc.a.abs;Va.aKa=Jb.kind===Oc.a.abs;Va.Vua=Mb.kind===Oc.a.abs;Va.$Ja=wa.kind===Oc.a.abs;return this.createRange(Ub,pb,gb,Qa,Da)}N.ULS.sendTraceTag(37826835,0,10,"CalcManager.CovertFormulaRefToRange: Unsupported formula ref type '{0}'",
wa.type);return null}N.ULS.sendTraceTag(38082381,0,15,"CalcManager.CovertFormulaRefToRange: traverseFormulaRef.Type is null");return null};t.prototype.TYb=function(wa,Da){return Da.length>=wa&&0<wa&&Da.charAt(wa-1)===u.rxf};t.prototype.CGg=function(wa,Da,Va){this.tl&&this.tl.GGg(wa,Da,Va)};t.prototype.v$c=function(wa){return this.instantaneousSupportInformationManager&&this.instantaneousSupportInformationManager.lba&&this.instantaneousSupportInformationManager.lba[wa]&&this.oq?this.instantaneousSupportInformationManager.lba[wa]:
null};t.prototype.toXLNumber=function(wa){if(!this.oq)return null;wa=excelOnlineCalc.numfmt.toXLNumber(this.config.mathpack,this.oq,wa);return excelOnlineCalc.util.isSuccess(wa)?wa.value:null};t.prototype.cyj=function(wa,Da){if(wa){wa=Ml(wa);for(var Va=wa.next();!Va.done;Va=wa.next())if(Va=Va.value,Va.ref.type&&Va.ref.type===kc.a.cell){var Jb=Va.ref;t.iHi(Jb,Da)&&(Jb.span.end+=1,Va.span.end+=1)}}};t.prototype.createRange=function(wa,Da,Va,Jb,Hb){var Mb={};Mb.FirstRow=wa;Mb.FirstColumn=Da;Mb.LastRow=
Va;Mb.LastColumn=Jb;Mb.SheetName=Hb;return Mb};t.prototype.a5g=function(wa,Da,Va){var Jb=wa.ref.qualifier;if(!Jb)return!0;switch(wa.ref.qualifier.type){case k.sheet:return wa=Jb.document,Ha.a.equals(Jb.sheet,Da,!0)&&(!wa||Ha.a.equals(wa.document,Va,!0));case k.sheetRange:return Da=this.$.Aa.getItemByName(Da),Va=this.$.Aa.getItemByName(Jb.sheet1),Jb=this.$.Aa.getItemByName(Jb.sheet2),!!Da&&!!Va&&!!Jb&&(Va.index<=Da.index&&Da.index<=Jb.index||Jb.index<=Da.index&&Da.index<=Va.index);case k.document:return Ha.a.equals(Jb.document,
Va,!0);case k.xSh:return Jb=Jb.name,Ha.a.equals(Jb,Da,!0)||Ha.a.equals(Jb,Va,!0);default:return N.ULS.sendTraceTag(38113474,0,10,"CalcManager.GetQualifierData: Unsupported formula qualifier type '{0}'",Jb.type),!1}};t.prototype.Lsj=function(wa){this.instantaneousSupportInformationManager=wa;wa.lba.length&&wa.Zha.length?(this.cAc=new va.CalcHelper(this.gridView.$),this.hNa=this.vr.createParser(),this.P4d=this.vr.createNumberFormatter(),this.n3e=!0,N.ULS.sendTraceTag(34936851,0,50,"CalcManager.TryInitializeInternal: calc initialized"),
this.tl||(N.ULS.sendTraceTag(40768414,0,50,"CalcManager creating calc engine"),this.tl=new v(this.$))):N.ULS.sendTraceTag(34936850,0,15,"CalcManager.TryInitializeInternal: IInstantaneousSupportInformationManager locale information missing, cannot initialize calc. number formats count = {0}, functions info count = {1}",wa.lba.length,wa.Zha.length.toString())};t.prototype.Aic=function(wa){N.ULS.sendTraceTag(34936852,0,50,"CalcManager.OnLocaleInformationAvailable() called");wa.iCd(Object(X.a)(this,this.Aic,
"onLocaleInformationAvailable"));wa.Zha.length?this.jic(wa,Sys.EventArgs.Empty):(N.ULS.sendTraceTag(34936853,0,50,"CalcManager.OnLocaleInformationAvailable() - waiting for functions information"),wa.Yee(Object(X.a)(this,this.jic,"onFunctionsInfoReady")))};t.prototype.jic=function(wa){N.ULS.sendTraceTag(34936854,0,50,"CalcManager.OnFunctionsInfoReady called");wa.ZBd(Object(X.a)(this,this.jic,"onFunctionsInfoReady"));this.Lsj(wa)};t.prototype.onContentReady=function(){var wa=this;this.tl&&(this.instantaneousSupportInformationManager&&
this.instantaneousSupportInformationManager.Dfd||tc.Task.delay(0).CWCT(function(){wa.tl.Xbb(1)},null,0,sc.a.current))};t.prototype.ekf=function(wa,Da){this.tl&&(this.instantaneousSupportInformationManager&&this.instantaneousSupportInformationManager.Dfd||this.tl.wwe(Da.Qd.block))};t.prototype.Trb=function(wa){if(!wa)return{returnValue:null,emptyCell:!1};var Da=this.getSheetName(wa.sheet.index);if(!Da)return N.ULS.sendTraceTag(37789893,0,50,"CalcManager.GetCellFromBlockCache: No sheet index {0}",wa.sheet.index),
{returnValue:null,emptyCell:!1};var Va=t.convertToRange(wa);Da=this.gridView.Trb(Da,Va.top,Va.left);return Da?Da.W4g?{returnValue:Da,emptyCell:!1}:(N.ULS.sendTraceTag(37789895,0,50,"CalcManager.GetCellFromBlockCache: cell {0} {1} is empty",wa.range.row,wa.range.col),{returnValue:null,emptyCell:!0}):(N.ULS.sendTraceTag(37789894,0,50,"CalcManager.GetCellFromBlockCache: cellProxy is null for cell {0} {1}",wa.range.row,wa.range.col),{returnValue:null,emptyCell:!1})};t.prototype.getSheetName=function(wa){var Da=
this.gridView.$.Aa.getItem(wa);return Da?Da.sheetName:(N.ULS.sendTraceTag(37789896,0,50,"CalcManager.GetSheetName - no sheet in index {0}",wa),null)};t.prototype.eXg=function(wa,Da){var Va={allowUnqualifiedCell:!0,wrapCellReferences:!0};Va.config=this.vr.config;Va.originGridCell=excelOnlineCalc.util.success(wa);Va.originSheet=excelOnlineCalc.util.success(Da);return Va};t.prototype.dXg=function(){var wa={};wa.config=this.vr.config;wa.getNameLoc=Object(X.a)(this.tl,this.tl.getNameLoc,"getNameLoc");
wa.getContainingTable=Object(X.a)(this.tl,this.tl.getContainingTable,"getContainingTable");wa.getStructRefColumn=Object(X.a)(this.tl,this.tl.getStructRefColumn,"getStructRefColumn");wa.getStructRefSpecialRef=Object(X.a)(this.tl,this.tl.getStructRefSpecialRef,"getStructRefSpecialRef");wa.getDocumentLoc=Object(X.a)(this.tl,this.tl.getDocumentLoc,"getDocumentLoc");wa.getSheetIndex=Object(X.a)(this.tl,this.tl.getSheetIndex,"getSheetIndex");wa.getSheetName=Object(X.a)(this.tl,this.tl.getSheetName,"getSheetName");
wa.getUserDefinedFuncLoc=Object(X.a)(this.tl,this.tl.getUserDefinedFuncLoc,"getUserDefinedFuncLoc");wa.getSheetRangeIndexes=Object(X.a)(this.tl,this.tl.getSheetRangeIndexes,"getSheetRangeIndexes");return wa};t.iHi=function(wa,Da){return Da.length>wa.span.end&&Da.charAt(wa.span.end)===u.rxf};t.convertToRange=function(wa){return Ab.Range.xd(wa.range.row+1,wa.range.col+1)};Jl.Object.defineProperties(t.prototype,{vr:{configurable:!0,enumerable:!0,get:function(){return this.cAc}},gridView:{configurable:!0,
enumerable:!0,get:function(){return this.jy}},$:{configurable:!0,enumerable:!0,get:function(){return this.wb}},oq:{configurable:!0,enumerable:!0,get:function(){return this.P4d}},localeInfo:{configurable:!0,enumerable:!0,get:function(){return this.vr?this.vr.config.localeInfo:null}},config:{configurable:!0,enumerable:!0,get:function(){return this.vr.config}}});Object(F.a)(t,"CalcManager",null,[688,7]);var ic=T.a;Cm(r,ic);r.prototype.create=function(){var wa=this;if(this.$){N.ULS.sendTraceTag(38082369,
0,50,"CalcManagerFactory.Create: Start loading script");if(nb.EwaSettings.isChangeGateEnabled("OfficeVSO:5543503_loadCalcCurrentVersion")){var Da=55;var Va="Current"}else Da=58,Va="Stable";N.ULS.sendTraceTag(592221332,0,50,"CalcManagerFactory.Create: Calc {0} JS was loaded",Va);fa.TaskExtensions.Da(Y.a.loadScript(Da,4,this.vb,void 0,void 0,265),function(){N.ULS.sendTraceTag(38082370,0,50,"CalcManagerFactory.Create: Raised create service event");var Jb=wa.$.ea.Ea(266,!1);Jb||(N.ULS.sendTraceTag(39982036,
0,50,"CalcManagerFactory.Create: CalcManager is not registered, creating new CalcManager"),Jb=new t(wa.$));wa.Jb(Jb)},this.ma,3)}else N.ULS.sendTraceTag(38082339,0,50,"CalcManagerFactory.Create: ewaControl is null, cann't create the service")};r.la=function(wa){wa&&wa.ea&&wa.ea.La(265,new r(wa))};Object(F.a)(r,"CalcManagerFactory",T.a,[]);var Ga=b(4),cb=b(316);Object(F.a)(m,"MarqueeMetadata",null,[]);var Tb=b(129),Bb=b(639),nc=b(334);c.prototype.DW=function(wa,Da){this.c3h&&wa.textBox.addEventLogRecord("ColoredReferencesManager.TryUpdateColoredReferences");
if(this.vXf||this.Mjd&&wa.qM)return!1;var Va=void 0!==Da&&null!==Da?Da:wa.text;if(this.calcManager&&1<Va.length&&ua.e(Va)){var Jb=this.I$c(),Hb=this.TSe(),Mb=this.Qc.workbookContext.WorkbookFileName,Ub=!1,pb=.01>Math.random()?Object(qb.a)(Tb.a,this.Qc.Zb.Ic("LoadingUIShown","ColoredReferencesManager")):null;try{var gb=this.calcManager.extractReferences(Va,Hb,Mb);if(!gb)return N.ULS.sendTraceTag(37859356,0,50,"ColoredReferencesManager.UpdateColoredReferences: extractReferences is null (might be an invalid formula)"),
!1;Hb=[];Mb=[];for(var Qa=[],eb=[],xb=0,dc=0,Nc=new ib.a(!1),Pc="",Fd=Ml(gb.Items),Ea=Fd.next();!Ea.done;Ea=Fd.next()){var Xa=Ea.value;Ub=Xa.IsStructRef||Ub;if(Xa.IsBoolean||Xa.IsNumber||Xa.IsString){var hc=Xa.IsBoolean?c.bCg:Xa.IsNumber?c.rmi:c.cmj;this.dEa(Mb,Va,xb,Xa.Span.Start,null);this.dEa(Mb,Va,Xa.Span.Start,Xa.Span.End,hc);xb=Xa.Span.End}else if(nb.EwaSettings.ka(634)){if(Xa.Range||Xa.LetName&&0<=Xa.LetNumber){gb=null;if(Xa.Range){var Xb=ia.D(Xa.Range);gb=this.Jta(Xb,Nc,1);Array.add(Hb,new nc.a(Xb,
Jb))}else Xa.LetName&&0<=Xa.LetNumber&&(gb=Pc=this.Svh(Xa.LetName,Xa.LetNumber,Nc,Pc),dc!==Nc.count&&wa.colors.add(Xa.Span.Start+"-"+Xa.Span.End,this.colors[(Nc.count-1)%this.colors.length]));this.dEa(Mb,Va,xb,Xa.Span.Start,null);this.dEa(Mb,Va,Xa.Span.Start,Xa.Span.End,gb);xb=Xa.Span.End;Array.add(Qa,Xa.Span);var Ic=Mb.length-1;Array.add(eb,new m(Ic,Mb[Ic].text,Xa));dc=Nc.count}}else if(Xa.Range){var Qc=ia.D(Xa.Range),Cb=this.Jta(Qc,Nc,1);this.dEa(Mb,Va,xb,Xa.Span.Start,null);this.dEa(Mb,Va,Xa.Span.Start,
Xa.Span.End,Cb);Array.add(Hb,new nc.a(Qc,Jb));xb=Xa.Span.End;Array.add(Qa,Xa.Span);var $c=Mb.length-1;Array.add(eb,new m($c,Mb[$c].text,Xa))}}this.dEa(Mb,Va,xb,Va.length,null);this.B$i(wa,Mb,!!Da);var ae=wa.textBox.text;if(!Ha.a.equals(ae,Va,!1)){N.ULS.shipAssertTag(38114182,0,!1,"ColoredReferencesManager.UpdateColoredReferences: The text we created is different from the original text. Setting the original text back. currentTextLength [{0}], originalTextLength [{1}]",ae.length,Va.length);var Mc=wa.textBox.caretPosition;
wa.textBox.text=Va;wa.textBox.caretPosition=Mc;return!0}this.C$b(Hb,Nc,eb);nb.EwaSettings.ka(634)&&0<Hb.length&&N.ULS.sendTraceTag(587559248,0,50,"ColoredReferencesManager.UpdateColoredReferences: Cell reference(s) colored");nb.EwaSettings.ka(634)&&0<wa.colors.count&&N.ULS.sendTraceTag(587559247,0,50,"ColoredReferencesManager.UpdateColoredReferences: Let name(s) colored");return this.gac=!0}finally{pb&&pb.pza(function(){Ub&&N.ULS.sendTraceTag(555061504,0,50,"ColoredReferencesManager.UpdateColoredReferences: Formula with structured reference is highlighted in {0} ms",
pb.Gc)})}}else return this.C$b(null,null),this.gac&&(this.gac=!1,this.S5h?(Jb=wa.textBox.caretPosition,wa.textBox.setPlainText(Va),wa.textBox.caretPosition=Math.min(Jb,Va.length)):this.R5h?(Jb=wa.textBox.caretPosition,wa.textBox.setPlainText(Va),wa.textBox.caretPosition=Jb):wa.textBox.setPlainText(Va),Da)?!0:!1};c.prototype.rgf=function(wa,Da,Va){if(!wa||!Da||!Va)return N.ULS.shipAssertTag(38926101,0,!!wa,"ColoredReferencesManager.MoveMarqueeRange: cellContentEditor is null"),N.ULS.shipAssertTag(38926102,
0,!!Da,"ColoredReferencesManager.MoveMarqueeRange: highlightState is null"),N.ULS.shipAssertTag(38926103,0,!!Va,"ColoredReferencesManager.MoveMarqueeRange: newRange is null"),!1;var Jb=Object(qb.a)(m,Da.metadata);if(!Jb)return N.ULS.shipAssertTag(38621456,0,!1,"ColoredReferencesManager.MoveMarqueeRange: marqueeMetadata is null"),!1;var Hb=Jb.Eoj,Mb=Jb.yYf,Ub=this.gridView.kc.m4e(Va)?Va.B7b(Jb.Vua,Jb.Wua):Va.u1a(Jb.Vua,Jb.Wua,Jb.$Ja,Jb.aKa);if(!Ub)return N.ULS.shipAssertTag(38926104,0,!1,"ColoredReferencesManager.MoveMarqueeRange: newText is null"),
!1;var pb=Mb.indexOf("!");-1!==pb&&(Ub=Mb.substring(0,pb+1)+Ub);if(!wa.textBox.changeTextInExistingTextPart(Hb,Mb,Ub))return N.ULS.shipAssertTag(38926105,0,!1,"ColoredReferencesManager.MoveMarqueeRange: failed to change the text part"),!1;Jb.yYf=Ub;Hb=!0;for(Mb=1;4>=Mb;Mb++)(Ub=Ra.g(this.Qc).Sb.sJ(3,Mb,Da.t9))?(Ub.range=Va,Ub.metadata=Jb):(N.ULS.shipAssertTag(38926106,0,!1,"ColoredReferencesManager.MoveMarqueeRange: highlightStateInPane is null"),Hb=!1);this.gridView.Sb.update(!1,!1);this.gridView.zc.Zi&&
(this.gridView.zc.textBox.text=wa.text);this.gridView.zc.oDb(new cb.a(!0));return Hb};c.prototype.h3h=function(wa){if(3!==wa.Qq)return N.ULS.shipAssertTag(38847496,0,!1,"ColoredReferencesManager.IsMarqueeHighlightDragable: not HighlightDivIndex.Marquee."),!1;wa=Object(qb.a)(m,wa.metadata);return wa?wa.d4a&&!wa.Scc:(N.ULS.shipAssertTag(38847497,0,!1,"ColoredReferencesManager.IsMarqueeHighlightDragable: marqueeMetadata is null."),!1)};c.prototype.Rab=function(wa,Da){N.ULS.sendTraceTag(42767445,0,50,
"ColoredReferencesManager.SuspendResumeColoredReferences: "+(Da?"suspending":"resuming")+" colored references");Da&&(this.C$b(null,null),wa.textBox.lLg());this.vXf=Da};c.prototype.dispose=function(){this.gridView&&this.gridView.Hc&&this.gridView.Hc.Qs(Object(X.a)(this,this.jAb,"onCellEditEnded"))};c.prototype.n_e=function(wa){var Da=this.I$c(),Va=this.TSe(),Jb=this.Qc.workbookContext.WorkbookFileName,Hb=[],Mb=new ib.a(!1),Ub=[];if(Va=this.calcManager.extractReferences(wa,Va,Jb)){Va=Ml(Va.Items);for(Jb=
Va.next();!Jb.done;Jb=Va.next())if(Jb=Jb.value,Jb.Range){var pb=ia.D(Jb.Range);Array.add(Hb,new nc.a(pb,Da));this.Jta(pb,Mb,1);Array.add(Ub,new m(Jb.Span.Start,wa.substring(Jb.Span.Start,Jb.Span.End),Jb,!0))}this.C$b(Hb,Mb,Ub)}};c.prototype.Jta=function(wa,Da,Va){var Jb=Da.getItem(wa.toString());Jb||(Jb=this.colors[Da.count%this.colors.length],Da.add(wa.toString(),Jb));return String.format(Jb,Va)};c.prototype.Svh=function(wa,Da,Va,Jb){wa="["+wa+", "+Da+"]";Da=Va.getItem(wa);Da||(Da=Va.count%this.colors.length,
Da=this.colors[Da],Jb===String.format(Da,1)&&(Va.add("skip-"+wa,Da),Da=Va.count%this.colors.length,Da=this.colors[Da]),Va.add(wa,Da));return String.format(Da,1)};c.prototype.dEa=function(wa,Da,Va,Jb,Hb){N.ULS.shipAssertTag(37859357,0,Va<=Jb,"ColoredReferencesManager.AddTextPart: startIndex cannot be larger than endIndex");Va<Jb&&(Da=Da.substring(Va,Jb),Array.add(wa,Object.assign(new Bb.a,{text:Da,color:Hb})))};c.prototype.C$b=function(wa,Da,Va){var Jb=this;Va=void 0===Va?null:Va;wa&&wa.length?(N.ULS.sendTraceTag(41492675,
0,50,"ColoredReferencesManager.HighlightRanges: number of ranges to highlight: "+wa.length),wa.reverse(),Va.reverse(),this.gridView.Sb.Zu(wa,[3],!0,function(Hb,Mb){if(Hb&&Hb.range&&Mb){N.ULS.shipAssertTag(37859361,0,Da.tb(Hb.range.toString()),"ColoredReferencesManager.HighlightRanges: The range '{0}' doesn't exist in the range to color dictionary",Hb.range.toString());var Ub=Jb.Jta(Hb.range,Da,.1),pb=Jb.Jta(Hb.range,Da,1);Jb.Qc.frame&&Jb.Qc.frame.nC&&Jb.Qc.frame.nC.taa||(Mb.style.background=Ub);Mb.style.borderColor=
pb;Va&&(Mb.setAttribute(Ga.a.Kub,Hb.t9),Hb.metadata=Va[Hb.t9])}else N.ULS.shipAssertTag(37859358,0,!!Hb,"ColoredReferencesManager.HighlightRanges: state is null"),N.ULS.shipAssertTag(37859359,0,!!Hb.range,"ColoredReferencesManager.HighlightRanges: state.Range is null"),N.ULS.shipAssertTag(37859360,0,!!Mb,"ColoredReferencesManager.HighlightRanges: div is null")})):(wa=this.Qc.Zb.Ic("UserAction","HideRangesHighlightsStopwatch"),this.gridView.Sb.ll([3]),this.gridView.Sb.x$a(new nc.a(null,this.I$c()),
[3]),wa.stop())};c.prototype.B$i=function(wa,Da,Va){var Jb=wa.textBox;Jb.BJ=!0;var Hb=Jb.selection,Mb=Hb.index;Hb=Mb+Hb.length;Jb.setTextFromTextParts(Da);Da=Jb.text.length;Jb.selectRange(Math.min(Mb,Da),Math.min(Hb,Da));Va&&wa.oDb(new cb.a);Jb.BJ=!1};c.prototype.I$c=function(){return this.SSe().sheetId};c.prototype.TSe=function(){return this.SSe().sheetName};c.prototype.SSe=function(){return this.gridView.Ns&&this.gridView.Ns.gK?this.gridView.Ns.gK:this.Qc.sa};c.prototype.jAb=function(){this.gac=
!1};c.rmi="rgba(9, 134, 88, 1)";c.bCg="rgba(0, 0, 255, 1)";c.cmj="rgba(163, 21, 21, 1)";Object(F.a)(c,"ColoredReferencesManager",null,[709,7]);var Gc=T.a;Cm(d,Gc);d.prototype.create=function(){var wa=this;this.$.ea.ub(266,function(Da){wa.Jb(new c(wa.$,Da))})};d.la=function(wa){wa.ea.La(282,new d(wa))};Object(F.a)(d,"ColoredReferencesManagerFactory",T.a,[]);var La=b(919),Wa=T.a;Cm(a,Wa);a.prototype.create=function(){var wa=this;this.$.ea.ub(266,function(Da){wa.Jb(new La.RelativeAndAbsoluteReferencesManager(Da))})};
a.la=function(wa){wa.ea.La(295,new a(wa))};Object(F.a)(a,"RelativeAndAbsoluteReferencesManagerFactory",T.a,[]);Type.registerNamespace("_Ewa");D.a.Ja(C.la);D.a.Ja(r.la);D.a.Ja(d.la);D.a.Ja(a.la)},905:function(D,F,b){function a(){}b.d(F,"a",function(){return a});D=b(0);a.abs="Abs";a.rel="Rel";Object(D.a)(a,"PositionBaseType",null,[])},919:function(D,F,b){function a(W){this.calcManager=W}function d(){return w.call(this)||this}function c(){this.mpc=this.firstRow=null;return this}function m(){return w.call(this)||
this}function r(){this.right=this.left=this.bottom=this.top=null;return this}function t(){return w.call(this)||this}function k(){this.lpc=this.firstColumn=null;return this}function u(){var W=w.call(this)||this;W.Rcc=!1;return W}function w(){this.end=this.start=0;this.Uu=null}function v(){this.column=this.row=null;return this}function A(){}b.r(F);D=b(0);var y=b(15);Object(D.a)(A,"Reference",null,[]);Cm(v,A);Object(D.a)(v,"CellReference",A,[]);w.prototype.Jxg=function(W,S){for(var N=0;N<this.Uu.length;N++){var T=
this.FWb(W,this.Uu[N]);S.append(T);N<this.Uu.length-1&&S.append(":")}};Object(D.a)(w,"IReferenceSequence",null,[]);var x=b(25),z=b(905);Cm(u,w);u.prototype.v8b=function(){var W=b(919).RelativeAndAbsoluteReferencesManager,S=this.Uu[0];return W.shf(S.row.kind===z.a.abs,S.column.kind===z.a.abs)};u.prototype.FWb=function(W,S){S=x.Range.xd(S.row.index+1,S.column.index+1);return this.Rcc?S.B7b(1===W||3===W,1===W||2===W):S.u1a(1===W||3===W,1===W||2===W,!0,!0)};Object(D.a)(u,"CellReferenceSequence",w,[]);
Cm(k,A);Object(D.a)(k,"ColumnReference",A,[]);Cm(t,w);t.prototype.v8b=function(){var W=this.Uu[0];return b(919).RelativeAndAbsoluteReferencesManager.Vff(W.firstColumn,W.lpc).kind===z.a.abs?2:3};t.prototype.FWb=function(W,S){return x.Range.rrb(S.firstColumn.index+1,S.lpc.index+1).u1a(1===W||3===W,!0,1===W||3===W,!0)};Object(D.a)(t,"ColumnReferenceSequence",w,[]);Cm(r,A);Object(D.a)(r,"RangeReference",A,[]);Cm(m,w);m.prototype.v8b=function(){var W=b(919).RelativeAndAbsoluteReferencesManager,S=this.Uu[0];
return W.shf(S.top.kind===z.a.abs,S.left.kind===z.a.abs)};m.prototype.FWb=function(W,S){S=new x.Range(S.top.index+1,S.left.index+1,S.bottom.index+1,S.right.index+1,!1,!1);var N=1===W||3===W;W=1===W||2===W;return S.u1a(N,W,N,W)};Object(D.a)(m,"RangeReferenceSequence",w,[]);Cm(c,A);Object(D.a)(c,"RowReference",A,[]);Cm(d,w);d.prototype.v8b=function(){var W=this.Uu[0];return b(919).RelativeAndAbsoluteReferencesManager.Vff(W.firstRow,W.mpc).kind===z.a.abs?0:1};d.prototype.FWb=function(W,S){return x.Range.o6b(S.firstRow.index+
1,S.mpc.index+1).u1a(!0,1===W||2===W,!0,1===W||2===W)};Object(D.a)(d,"RowReferenceSequence",w,[]);var J=b(1116),B=b(1117),C=b(7),H=b(199);b.d(F,"RelativeAndAbsoluteReferencesManager",function(){return a});a.prototype.sGa=function(W,S,N){var T=S;var fa=N;if(C.a.na(W)||!H.e(W))return{returnValue:W,Tqd:T,Sqd:fa};var Y=this.calcManager.$Ie(W);if(!Y)return y.ULS.sendTraceTag(39396451,0,15,"RelativeAndAbsoluteReferencesManager.CycleThroughRelativeAndAbsoluteReferences: Couldn't extract references (might be invalid formula)"),
{returnValue:null,Tqd:T,Sqd:fa};Y=this.tHh(Y,W,S,N);for(var L=0,P=new Sys.StringBuilder,ea=0,X=0;X<Y.length;X++)if(this.wAe(Y[X],S,N)){L=Y[X].v8b();T=Y[X].start;break}for(;X<Y.length&&this.wAe(Y[X],S,N);X++)P.append(W.substring(ea,Y[X].start)),Y[X].Jxg(L,P),ea=Y[X].end;ea&&(fa=P.toString().length);P.append(W.substring(ea,W.length));return{returnValue:P.toString(),Tqd:T,Sqd:fa}};a.prototype.tHh=function(W,S,N,T){for(var fa=[],Y=0;Y<W.length;Y++){var L=W[Y];if(L.kind===J.a.range)if(L=L.ref,L.type===
B.a.cell){var P=L;L=Object.assign(new u,{start:L.span.start,end:L.span.end,Uu:[Object.assign(new v,{column:P.col,row:P.row})],Rcc:this.calcManager.TYb(L.span.end,S)});fa.push(L)}else if(L.type===B.a.range)this.xAe(L.topLeftSpan,N,T)&&this.xAe(L.bottomRightSpan,N,T)?(P=new r,L.top.index<=L.bottom.index?(P.top=L.top,P.bottom=L.bottom):(P.bottom=L.top,P.top=L.bottom),L.left.index<=L.right.index?(P.left=L.left,P.right=L.right):(P.right=L.left,P.left=L.right),L=Object.assign(new m,{start:L.topLeftSpan.start,
end:L.bottomRightSpan.end,Uu:[P]}),fa.push(L)):(P=Object.assign(new u,{start:L.topLeftSpan.start,end:L.topLeftSpan.end,Uu:[Object.assign(new v,{column:L.left,row:L.top})],Rcc:this.calcManager.TYb(L.topLeftSpan.end,S)}),L=Object.assign(new u,{start:L.bottomRightSpan.start,end:L.bottomRightSpan.end,Uu:[Object.assign(new v,{column:L.right,row:L.bottom})],Rcc:this.calcManager.TYb(L.topLeftSpan.end,S)}),fa.push(P),fa.push(L));else if(L.type===B.a.column){P=L;for(L=Object.assign(new t,{start:L.span.start,
end:L.span.end,Uu:[Object.assign(new k,{firstColumn:P.startIndex,lpc:P.endIndex})]});L.end<S.length-1&&":"===S.charAt(L.end)&&Y<W.length-1;)if(P=W[Y+1].ref,P.type===B.a.column&&P.span.start===L.end+1){var ea=P;L.Uu.push(Object.assign(new k,{firstColumn:ea.startIndex,lpc:ea.endIndex}));L.end=P.span.end;Y++}else break;fa.push(L)}else if(L.type===B.a.row){P=L;for(L=Object.assign(new d,{start:L.span.start,end:L.span.end,Uu:[Object.assign(new c,{firstRow:P.startIndex,mpc:P.endIndex})]});L.end<S.length-
1&&":"===S.charAt(L.end)&&Y<W.length-1;)if(P=W[Y+1].ref,P.type===B.a.row&&P.span.start===L.end+1)ea=P,L.Uu.push(Object.assign(new c,{firstRow:ea.startIndex,mpc:ea.endIndex})),L.end=P.span.end,Y++;else break;fa.push(L)}}return fa};a.prototype.wAe=function(W,S,N){return!(W.start>N||S>W.end)};a.prototype.xAe=function(W,S,N){return!(W.start>N||S>W.end)};a.Vff=function(W,S){return W.index<=S.index?W:S};a.shf=function(W,S){return S||W?S&&W?2:!S&&W?3:0:1};Object(D.a)(a,"RelativeAndAbsoluteReferencesManager",
null,[708])}}]);

//# sourceMappingURL=EwaDS.calc.js.map